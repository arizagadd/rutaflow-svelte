import{Z as ht,s as Xe,e as c,j as C,b as u,q as E,d as K,h as a,m as y,v as m,i as q,w as l,x as te,n as Ie,z as He,_ as Kt,B as j,o as st,k as Se,$ as pt,t as ae,r as se,f as G,a0 as xt,y as ke,a1 as et,A as ye,a2 as at,l as Wt,p as Xt}from"../chunks/index.BYLndrM5.js";import{S as Je,i as Ye,t as rt,a as ut,c as Jt,b as Yt,d as Zt,m as Qt,e as $t,g as en}from"../chunks/index.BNHbygFo.js";import{e as Be,u as tt,d as nt,a as tn,c as ft,b as qt,f as nn,g as on,i as Ft,h as ln,j as jt,s as mt,k as Ze,m as rn,n as an,o as sn,q as cn,r as un,p as fn}from"../chunks/index.dliyGe0H.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as ot,a as Ve,I as _n}from"../chunks/IonPage.KvUD72q2.js";import{q as dn,t as hn}from"../chunks/ion-modal.CsJaVgKZ.js";import{g as je}from"../chunks/entry.CXu_Rfag.js";const pn=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},mn=function(i){return document.createElement(i).constructor!==HTMLElement},vn=(i,e)=>{mn(i)||pn(i,e)},Re=async(i,e,t)=>{dn(),hn(),vn(i,e);const o=await ot.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Ke=ht({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Vt=ht({flag:[]});function bn(i){let e,t,o,n,r="Cancelar",h,_,b="Captura de Km/Gas",N,I,f,s="Confirmar",g,d,v,p,w,P,D;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=b,N=C(),I=c("ion-buttons"),f=c("ion-button"),f.textContent=s,g=C(),d=c("ion-content"),v=c("ion-item"),p=c("ion-input"),this.h()},l(M){e=u(M,"ION-HEADER",{translucent:!0});var A=E(e);t=u(A,"ION-TOOLBAR",{});var k=E(t);o=u(k,"ION-BUTTONS",{slot:!0});var L=E(o);n=u(L,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-17pq4f4"&&(n.textContent=r),L.forEach(a),h=y(k),_=u(k,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-1yhkaq7"&&(_.textContent=b),N=y(k),I=u(k,"ION-BUTTONS",{slot:!0});var T=E(I);f=u(T,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),K(f)!=="svelte-cm6j4s"&&(f.textContent=s),T.forEach(a),k.forEach(a),A.forEach(a),g=y(M),d=u(M,"ION-CONTENT",{fullscreen:!0});var O=E(d);v=u(O,"ION-ITEM",{});var S=E(v);p=u(S,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var R=E(p);R.forEach(a),S.forEach(a),O.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(f,"strong",""),m(I,"slot","end"),m(e,"translucent",""),m(p,"class","fin-km"),m(p,"inputmode","numeric"),m(p,"pattern","[0-9]*"),m(p,"type","number"),m(p,"placeholder",w="Ingresa "+i[0]+" actual"),m(p,"value",i[1]),m(p,"required",""),m(d,"fullscreen","")},m(M,A){q(M,e,A),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(t,N),l(t,I),l(I,f),q(M,g,A),q(M,d,A),l(d,v),l(v,p),P||(D=[te(n,"click",i[2]),te(f,"click",i[3]),te(p,"input",i[4])],P=!0)},p(M,[A]){A&1&&w!==(w="Ingresa "+M[0]+" actual")&&m(p,"placeholder",w),A&2&&m(p,"value",M[1])},i:Ie,o:Ie,d(M){M&&(a(e),a(g),a(d)),P=!1,He(D)}}}function gn(i,e,t){const o=Kt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let h;Vt.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,h="kilometraje"):t(0,h="litros de gasolina")});let _=0;function b(){ot.dismiss()}function N(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Ke.update(s=>({...s,km_inicial:[_]})):r=="gas_inicial"?Ke.update(s=>({...s,gas_inicial:[_]})):r=="km_final"?Ke.update(s=>({...s,km_final:[_]})):r=="gas_final"&&Ke.update(s=>({...s,gas_final:[_]})),b()}return[h,_,b,N,f=>t(1,_=f.target.value)]}class En extends Je{constructor(e){super(),Ye(this,e,gn,bn,Xe,{})}}const ct=ht({items:[],checkedIndices:[],mandatory:[]});function Et(i,e,t){const o=i.slice();return o[49]=e[t],o[50]=e,o[51]=t,o}function In(i){let e,t,o,n,r,h="Kilometraje inicial",_,b,N=i[0]?i[0]+" km.":"Cargar km",I,f,s,g,d,v,p,w="Gasolina inicial (litros)",P,D,M=i[1]?i[1]+" litros":"Cargar gas",A,k,L,T;return k=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=C(),r=c("p"),r.textContent=h,_=C(),b=c("ion-button"),I=ae(N),f=C(),s=c("ion-item"),g=c("ion-label"),d=c("input"),v=C(),p=c("p"),p.textContent=w,P=C(),D=c("ion-button"),A=ae(M),this.h()},l(O){e=u(O,"ION-ITEM",{});var S=E(e);t=u(S,"ION-LABEL",{style:!0});var R=E(t);o=u(R,"INPUT",{id:!0,style:!0,type:!0}),n=y(R),r=u(R,"P",{style:!0,"data-svelte-h":!0}),K(r)!=="svelte-88twxi"&&(r.textContent=h),R.forEach(a),_=y(S),b=u(S,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var B=E(b);I=se(B,N),B.forEach(a),S.forEach(a),f=y(O),s=u(O,"ION-ITEM",{});var z=E(s);g=u(z,"ION-LABEL",{style:!0});var V=E(g);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),v=y(V),p=u(V,"P",{style:!0,"data-svelte-h":!0}),K(p)!=="svelte-1ux30eb"&&(p.textContent=w),V.forEach(a),P=y(z),D=u(z,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var X=E(D);A=se(X,M),X.forEach(a),z.forEach(a),this.h()},h(){G(o,"id","chkbox-km-ini"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-ini"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(p,"margin-left","10px"),j(g,"display","flex"),m(D,"fill","outline"),m(D,"class","loadGasInicial"),m(D,"size","small"),j(D,"height","16px "),k.p(o,d)},m(O,S){q(O,e,S),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[27](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,f,S),q(O,s,S),l(s,g),l(g,d),i[29](d),d.checked=~(i[4]||[]).indexOf(d.__value),l(g,v),l(g,p),l(s,P),l(s,D),l(D,A),L||(T=[te(o,"change",i[26]),te(b,"click",i[28]),te(d,"change",i[30]),te(D,"click",i[31])],L=!0)},p(O,S){S[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),S[0]&1&&N!==(N=O[0]?O[0]+" km.":"Cargar km")&&ke(I,N),S[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),S[0]&2&&M!==(M=O[1]?O[1]+" litros":"Cargar gas")&&ke(A,M)},d(O){O&&(a(e),a(f),a(s)),i[27](null),i[29](null),k.r(),L=!1,He(T)}}}function On(i){let e,t,o,n,r,h="Kilometraje final",_,b,N=i[2]?i[2]+" km.":"Cargar km",I,f,s,g,d,v,p,w="Gasolina final (litros)",P,D,M=i[3]?i[3]+" litros":"Cargar gas",A,k,L,T;return k=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=C(),r=c("p"),r.textContent=h,_=C(),b=c("ion-button"),I=ae(N),f=C(),s=c("ion-item"),g=c("ion-label"),d=c("input"),v=C(),p=c("p"),p.textContent=w,P=C(),D=c("ion-button"),A=ae(M),this.h()},l(O){e=u(O,"ION-ITEM",{});var S=E(e);t=u(S,"ION-LABEL",{style:!0});var R=E(t);o=u(R,"INPUT",{id:!0,style:!0,type:!0}),n=y(R),r=u(R,"P",{style:!0,"data-svelte-h":!0}),K(r)!=="svelte-ccmu71"&&(r.textContent=h),R.forEach(a),_=y(S),b=u(S,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var B=E(b);I=se(B,N),B.forEach(a),S.forEach(a),f=y(O),s=u(O,"ION-ITEM",{});var z=E(s);g=u(z,"ION-LABEL",{style:!0});var V=E(g);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),v=y(V),p=u(V,"P",{style:!0,"data-svelte-h":!0}),K(p)!=="svelte-wsoyd2"&&(p.textContent=w),V.forEach(a),P=y(z),D=u(z,"ION-BUTTON",{fill:!0,size:!0,class:!0});var X=E(D);A=se(X,M),X.forEach(a),z.forEach(a),this.h()},h(){G(o,"id","chkbox-km-fin"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-fin"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(p,"margin-left","10px"),j(g,"display","flex"),m(D,"fill","outline"),m(D,"size","small"),m(D,"class","loadGasInicial"),k.p(o,d)},m(O,S){q(O,e,S),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[21](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,f,S),q(O,s,S),l(s,g),l(g,d),d.checked=~(i[4]||[]).indexOf(d.__value),i[24](d),l(g,v),l(g,p),l(s,P),l(s,D),l(D,A),L||(T=[te(o,"change",i[19]),te(b,"click",i[22]),te(d,"change",i[23]),te(D,"click",i[25])],L=!0)},p(O,S){S[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),S[0]&4&&N!==(N=O[2]?O[2]+" km.":"Cargar km")&&ke(I,N),S[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),S[0]&8&&M!==(M=O[3]?O[3]+" litros":"Cargar gas")&&ke(A,M)},d(O){O&&(a(e),a(f),a(s)),i[21](null),i[24](null),k.r(),L=!1,He(T)}}}function kn(i){let e=[],t=new Map,o,n=Be(i[12]);const r=h=>h[49].id_checklist_event;for(let h=0;h<n.length;h+=1){let _=Et(i,n,h),b=r(_);t.set(b,e[h]=It(b,_))}return{c(){for(let h=0;h<e.length;h+=1)e[h].c();o=Se()},l(h){for(let _=0;_<e.length;_+=1)e[_].l(h);o=Se()},m(h,_){for(let b=0;b<e.length;b+=1)e[b]&&e[b].m(h,_);q(h,o,_)},p(h,_){_[0]&202864&&(n=Be(h[12]),e=tt(e,_,r,1,h,n,t,o.parentNode,nt,It,o,Et))},d(h){h&&a(o);for(let _=0;_<e.length;_+=1)e[_].d(h)}}}function It(i,e){let t,o,n,r=e[49],h,_,b=e[49].item+"",N,I,f,s,g=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"",d,v,p,w,P,D,M;const A=()=>e[33](n,r),k=()=>e[33](null,r);function L(){return e[34](e[49])}function T(...O){return e[36](e[49],...O)}return P=pt(e[20][0]),{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),h=C(),_=c("p"),N=ae(b),I=C(),f=c("ion-button"),s=c("label"),d=ae(g),v=C(),p=c("input"),w=C(),this.h()},l(O){t=u(O,"ION-ITEM",{});var S=E(t);o=u(S,"ION-LABEL",{style:!0});var R=E(o);n=u(R,"INPUT",{id:!0,style:!0,type:!0}),h=y(R),_=u(R,"P",{style:!0});var B=E(_);N=se(B,b),B.forEach(a),R.forEach(a),I=y(S),f=u(S,"ION-BUTTON",{fill:!0,class:!0,size:!0});var z=E(f);s=u(z,"LABEL",{for:!0});var V=E(s);d=se(V,g),V.forEach(a),v=y(z),p=u(z,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),z.forEach(a),w=y(S),S.forEach(a),this.h()},h(){G(n,"id",`chkbox-${e[49].id_checklist_event}`),j(n,"pointer-events","auto"),G(n,"type","checkbox"),n.__value=e[49].id_checklist_event,xt(n,n.__value),n.required=!0,j(_,"margin-left","10px"),j(o,"display","flex"),G(s,"for","chklist-"+e[49].id_checklist_event),j(p,"display","none"),G(p,"id","chklist-"+e[49].id_checklist_event),G(p,"name","fileToUpload"),G(p,"type","file"),G(p,"accept","image/*"),m(f,"fill","outline"),m(f,"class","loadEvidence svelte-1lh6nay"),m(f,"size","small"),P.p(n),this.first=t},m(O,S){q(O,t,S),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),A(),l(o,h),l(o,_),l(_,N),l(t,I),l(t,f),l(f,s),l(s,d),l(f,v),l(f,p),e[35](p),l(t,w),D||(M=[te(n,"change",e[32]),te(n,"change",L),te(p,"change",T)],D=!0)},p(O,S){e=O,S[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[49]&&(k(),r=e[49],A()),S[0]&2048&&g!==(g=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"")&&ke(d,g)},d(O){O&&a(t),k(),e[35](null),P.r(),D=!1,He(M)}}}function Nn(i){let e,t,o,n,r="Cancelar",h,_,b="Requerimientos de ruta",N,I,f,s,g,d,v,p="Confirmar",w,P;function D(L,T){return L[13]?On:In}let A=D(i)(i),k=i[12]&&kn(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=b,N=C(),I=c("ion-content"),f=c("ion-list"),A.c(),s=C(),k&&k.c(),g=C(),d=c("ion-footer"),v=c("ion-button"),v.textContent=p,this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var T=E(e);t=u(T,"ION-TOOLBAR",{});var O=E(t);o=u(O,"ION-BUTTONS",{slot:!0});var S=E(o);n=u(S,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1dnmkxs"&&(n.textContent=r),S.forEach(a),h=y(O),_=u(O,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-ucox25"&&(_.textContent=b),O.forEach(a),T.forEach(a),N=y(L),I=u(L,"ION-CONTENT",{fullscreen:!0});var R=E(I);f=u(R,"ION-LIST",{});var B=E(f);A.l(B),s=y(B),k&&k.l(B),B.forEach(a),R.forEach(a),g=y(L),d=u(L,"ION-FOOTER",{});var z=E(d);v=u(z,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(v)!=="svelte-g82qqw"&&(v.textContent=p),z.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(e,"translucent",""),m(I,"fullscreen",""),m(v,"fill","outline"),m(v,"color","tertiary"),m(v,"strong",""),j(v,"width","99%"),j(v,"height","auto")},m(L,T){q(L,e,T),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(L,N,T),q(L,I,T),l(I,f),A.m(f,null),l(f,s),k&&k.m(f,null),q(L,g,T),q(L,d,T),l(d,v),w||(P=[te(n,"click",i[14]),te(v,"click",i[15])],w=!0)},p(L,T){A.p(L,T),L[12]&&k.p(L,T)},i:Ie,o:Ie,d(L){L&&(a(e),a(N),a(I),a(g),a(d)),A.d(),k&&k.d(),w=!1,He(P)}}}function _t(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>_t(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function it(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function Tn(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,h=o.componentProps.routeId,_=o.componentProps.isLast;let b,N,I,f,s=[],g=null,d={},v,p,w,P,D={},M={};st(()=>{_?console.log("Último checklist"):ct.update(U=>(U.mandatory=_t(n,"mandatory"),U.items=_t(n,"id_checklist_event"),U))});const A=async()=>{await(await Ve.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},k=async()=>{await(await Ve.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},L=async U=>{await(await Ve.create({header:"Datos inválidos",message:U=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},T=()=>{ot.dismiss(),r?je(`/drivers/${r}`):je("/drivers/me")},O=()=>{if(_){var U=z(I,"km"),x=z(f,"gas");const _e=new FormData;_e.append("km_final",U),_e.append("gas_final",x),_e.append("id_route",h),U&&x?(T(),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:_e}).then(be=>be.json()).then(be=>{k()}).catch(be=>{console.error("Error fetching data:",be)})):A()}else{var le=z(b,"km"),fe=z(N,"gas");ct.update(_e=>{const be=_e.items,J=_e.mandatory;if(be.every(ee=>_e.checkedIndices.includes(ee))&&le&&fe){T();const ee=new FormData;for(const oe in D)if(D.hasOwnProperty(oe)){const{img:Oe,img_id:ne}=D[oe];ee.append(`selectedImages[${oe}][img]`,Oe),ee.append(`selectedImages[${oe}][img_id]`,ne)}ee.append("km_inicial",le),ee.append("gas_inicial",fe),ee.append("id_route",h),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ee}).then(oe=>oe.json()).then(oe=>{J&&J[0]=="1"?it(h,"checklist-pending"):it(h,"enroute")}).catch(oe=>{console.error("Error fetching data:",oe)})}else if(!J&&le&&fe){var $=new FormData;$.append("km_inicial",le),$.append("gas_inicial",fe),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:$}).then(ee=>ee.json()).then(ee=>{it(h,"enroute")}).catch(ee=>{console.error("Error fetching data:",ee)})}else A();return _e})}H()},S=async(U,x)=>{const fe=U.target.files[0],_e=await R(fe);if(_e){const be=new FormData;be.append("fileToUpload",_e);try{const J=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:be});if(J.ok){const W=await J.json();D={...D,[x]:{img:W.img,img_id:W.img_id}},t(11,M={...M,[x]:W.filename}),B(x),t(6,d[x].checked=!0,d)}else console.error("File upload failed:",J.statusText)}catch(J){console.error("Error during file upload:",J)}}},R=async U=>new Promise(x=>{const le=new FileReader;le.onload=fe=>{const _e=new Image;_e.src=fe.target.result,_e.onload=()=>{const be=document.createElement("canvas"),J=be.getContext("2d"),W=800,$=600;let ee=_e.width,oe=_e.height;ee>W&&(oe*=W/ee,ee=W),oe>$&&(ee*=$/oe,oe=$),be.width=ee,be.height=oe,J.drawImage(_e,0,0,ee,oe),be.toBlob(Oe=>{x(Oe)},"image/jpeg",.7)}},le.readAsDataURL(U)}),B=U=>{ct.update(x=>(x.checkedIndices.indexOf(U)===-1?x.checkedIndices.push(U):console.error(`ID ${U} is already checked.`),x.items.forEach(fe=>{fe.id_checklist_event===U&&(fe.checked=!0)}),x))};function z(U,x){return/^\d+$/.test(U)?parseInt(U,10):(L(x),null)}function V(U,x){X(x),o.componentProps.data_type=x,Re("modal-gas-km",En,{r:x}).then(()=>{Ke.subscribe(le=>{Y(le,x)})})}function X(U){Vt.update(x=>({...x,flag:[U]}))}function Y(U,x){t(0,b=U.km_inicial?U.km_inicial:null),t(1,N=U.gas_inicial?U.gas_inicial:null),t(2,I=U.km_final?U.km_final:null),t(3,f=U.gas_final?U.gas_final:null),x=="km_inicial"&&t(7,v.checked=!0,v),x=="gas_inicial"&&t(8,p.checked=!0,p),x=="km_final"&&t(9,w.checked=!0,w),x=="gas_final"&&t(10,P.checked=!0,P)}function H(){Ke.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const F=[[]];function Z(){s=et(F[0],this.__value,this.checked),t(4,s)}function ie(U){ye[U?"unshift":"push"](()=>{w=U,t(9,w)})}const pe=U=>V(U,"km_final");function ue(){s=et(F[0],this.__value,this.checked),t(4,s)}function he(U){ye[U?"unshift":"push"](()=>{P=U,t(10,P)})}const Pe=U=>V(U,"gas_final");function ge(){s=et(F[0],this.__value,this.checked),t(4,s)}function Le(U){ye[U?"unshift":"push"](()=>{v=U,t(7,v)})}const me=U=>V(U,"km_inicial");function de(U){ye[U?"unshift":"push"](()=>{p=U,t(8,p)})}function ce(){s=et(F[0],this.__value,this.checked),t(4,s)}const Ee=U=>V(U,"gas_inicial");function Ue(){s=et(F[0],this.__value,this.checked),t(4,s)}function Te(U,x){ye[U?"unshift":"push"](()=>{d[x.id_checklist_event]=U,t(6,d)})}const Ce=U=>B(U.id_checklist_event);function De(U){ye[U?"unshift":"push"](()=>{g=U,t(5,g)})}return[b,N,I,f,s,g,d,v,p,w,P,M,n,_,T,O,S,B,V,Z,F,ie,pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue,Te,Ce,De,(U,x)=>S(x,U.id_checklist_event)]}class Gt extends Je{constructor(e){super(),Ye(this,e,Tn,Nn,Xe,{},null,[-1,-1])}}function Cn(i){let e,t,o,n,r,h="Teléfono de Negocio",_,b,N=i[4].client_phone+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(s),n=u(s,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1u5l7fz"&&(r.textContent=h),_=y(g),b=u(g,"H2",{});var d=E(b);I=se(d,N),d.forEach(a),g.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",nn),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href","tel:"+i[4].client_phone)},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function yn(i){let e,t,o,n,r,h="Domicilio Alternativo",_,b,N=i[4].line2+"",I,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),f=C(),s=c("ion-icon"),this.h()},l(g){e=u(g,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(d),n=u(d,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=y(v),b=u(v,"H2",{});var p=E(b);I=se(p,N),p.forEach(a),v.forEach(a),f=y(d),s=u(d,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),d.forEach(a),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ze),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[4].line2)},m(g,d){q(g,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s)},p:Ie,d(g){g&&a(e)}}}function wn(i){let e,t,o,n,r,h="Domicilio",_,b,N=i[4].line1+"",I,f,s,g,d=i[4].line2&&i[4].line2.trim().length,v,p=d&&Ln(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),f=C(),s=c("ion-icon"),g=C(),p&&p.c(),v=Se(),this.h()},l(w){e=u(w,"ION-ITEM",{href:!0});var P=E(e);t=u(P,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(P),n=u(P,"ION-LABEL",{class:!0});var D=E(n);r=u(D,"P",{"data-svelte-h":!0}),K(r)!=="svelte-cbm7q1"&&(r.textContent=h),_=y(D),b=u(D,"H2",{});var M=E(b);I=se(M,N),M.forEach(a),D.forEach(a),f=y(P),s=u(P,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),P.forEach(a),g=y(w),p&&p.l(w),v=Se(),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ze),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line1)},m(w,P){q(w,e,P),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s),q(w,g,P),p&&p.m(w,P),q(w,v,P)},p(w,P){d&&p.p(w,P)},d(w){w&&(a(e),a(g),a(v)),p&&p.d(w)}}}function Ln(i){let e,t,o,n,r,h="Domicilio Alternativo",_,b,N=i[4].line2+"",I,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),f=C(),s=c("ion-icon"),this.h()},l(g){e=u(g,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(d),n=u(d,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=y(v),b=u(v,"H2",{});var p=E(b);I=se(p,N),p.forEach(a),v.forEach(a),f=y(d),s=u(d,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),d.forEach(a),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ze),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line2)},m(g,d){q(g,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s)},p:Ie,d(g){g&&a(e)}}}function Ot(i){let e,t,o,n,r,h="Llamar al Cliente",_,b,N,I,f,s=`<ion-icon icon="${rn}" slot="start"></ion-icon>
                    Notificar Cliente`,g,d;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),N=ae(i[2]),I=C(),f=c("ion-button"),f.innerHTML=s,this.h()},l(v){e=u(v,"ION-ITEM",{});var p=E(e);t=u(p,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(p),n=u(p,"ION-LABEL",{class:!0});var w=E(n);r=u(w,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1f6ke1o"&&(r.textContent=h),_=y(w),b=u(w,"H2",{});var P=E(b);N=se(P,i[2]),P.forEach(a),w.forEach(a),I=y(p),f=u(p,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),K(f)!=="svelte-tgc0di"&&(f.innerHTML=s),p.forEach(a),this.h()},h(){m(t,"icon",on),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(f,"fill","outline"),j(f,"margin-left","16px")},m(v,p){q(v,e,p),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,N),l(e,I),l(e,f),g||(d=te(f,"click",i[8]),g=!0)},p(v,p){p&4&&ke(N,v[2])},d(v){v&&a(e),g=!1,d()}}}function kt(i){let e,t,o,n,r,h="Notas de ubicación",_,b,N;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),N=ae(i[3]),this.h()},l(I){e=u(I,"ION-ITEM",{});var f=E(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(f),n=u(f,"ION-LABEL",{class:!0});var s=E(n);r=u(s,"P",{"data-svelte-h":!0}),K(r)!=="svelte-nhm2ft"&&(r.textContent=h),_=y(s),b=u(s,"H2",{});var g=E(b);N=se(g,i[3]),g.forEach(a),s.forEach(a),f.forEach(a),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(I,f){q(I,e,f),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,N)},p(I,f){f&8&&ke(N,I[3])},d(I){I&&a(e)}}}function Sn(i){let e,t,o,n,r,h="Horarios",_,b,N=i[4].schedule+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(s),n=u(s,"ION-LABEL",{});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-11q7hm5"&&(r.textContent=h),_=y(g),b=u(g,"H2",{});var d=E(b);I=se(d,N),d.forEach(a),g.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",ln),m(t,"slot","start")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Pn(i){let e,t,o,n,r,h="Notas del operador",_,b,N=i[4].driver_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(s),n=u(s,"ION-LABEL",{});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1yk9qp4"&&(r.textContent=h),_=y(g),b=u(g,"H2",{});var d=E(b);I=se(d,N),d.forEach(a),g.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",jt),m(t,"slot","start")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Mn(i){let e,t=i[4].logistic_comments!="<br>"&&An(i);return{c(){t&&t.c(),e=Se()},l(o){t&&t.l(o),e=Se()},m(o,n){t&&t.m(o,n),q(o,e,n)},p(o,n){o[4].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&a(e),t&&t.d(o)}}}function An(i){let e,t,o,n,r,h="Comentarios logísticos",_,b,N=i[4].logistic_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),b=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=y(s),n=u(s,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1iz85r6"&&(r.textContent=h),_=y(g),b=u(g,"H2",{});var d=E(b);I=se(d,N),d.forEach(a),g.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Nt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){at(t.src,o=i[1])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&2&&!at(t.src,o=n[1])&&m(t,"src",o)},d(n){n&&a(e)}}}function Bn(i){let e,t,o,n,r="Cancelar",h,_,b=i[4].title+"",N,I,f,s,g="Confirmar",d,v,p,w,P,D,M,A,k="Negocio",L,T,O=i[4].client_name+"",S,R,B=i[4].client_phone&&i[4].client_phone.trim().length,z,V,X,Y,H=i[4].schedule&&i[4].schedule.trim().length,F,Z,ie=i[4].logistic_comments&&i[4].logistic_comments.trim().length,pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue,Te,Ce="Subir Evidencia",De,Ne,U,x,le,fe=B&&Cn(i);function _e(Q,ve){if(Q[4].line1&&Q[4].line1.trim().length)return wn;if(Q[4].line2&&Q[4].line2.trim().length)return yn}let be=_e(i),J=be&&be(i),W=i[2]&&Ot(i),$=i[3]&&i[3]!=="<br>"&&kt(i),ee=H&&Sn(i),oe=i[4].driver_comments&&Pn(i),Oe=ie&&Mn(i),ne=i[1]&&Nt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),N=ae(b),I=C(),f=c("ion-buttons"),s=c("ion-button"),s.textContent=g,d=C(),v=c("ion-content"),p=c("ion-list"),w=c("ion-item"),P=c("ion-icon"),D=C(),M=c("ion-label"),A=c("p"),A.textContent=k,L=C(),T=c("h2"),S=ae(O),R=C(),fe&&fe.c(),z=C(),J&&J.c(),V=C(),W&&W.c(),X=C(),$&&$.c(),Y=C(),ee&&ee.c(),F=C(),oe&&oe.c(),Z=C(),Oe&&Oe.c(),pe=C(),ue=c("ion-item"),he=c("ion-icon"),Pe=C(),ge=c("ion-textarea"),Le=C(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("ion-icon"),Ue=C(),Te=c("label"),Te.textContent=Ce,De=C(),Ne=c("input"),U=C(),ne&&ne.c(),this.h()},l(Q){e=u(Q,"ION-HEADER",{translucent:!0});var ve=E(e);t=u(ve,"ION-TOOLBAR",{});var Me=E(t);o=u(Me,"ION-BUTTONS",{slot:!0});var Ae=E(o);n=u(Ae,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Ae.forEach(a),h=y(Me),_=u(Me,"ION-TITLE",{title:!0});var ze=E(_);N=se(ze,b),ze.forEach(a),I=y(Me),f=u(Me,"ION-BUTTONS",{slot:!0});var Qe=E(f);s=u(Qe,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),K(s)!=="svelte-1ida0il"&&(s.textContent=g),Qe.forEach(a),Me.forEach(a),ve.forEach(a),d=y(Q),v=u(Q,"ION-CONTENT",{fullscreen:!0});var $e=E(v);p=u($e,"ION-LIST",{});var re=E(p);w=u(re,"ION-ITEM",{});var qe=E(w);P=u(qe,"ION-ICON",{icon:!0,slot:!0}),E(P).forEach(a),D=y(qe),M=u(qe,"ION-LABEL",{});var Fe=E(M);A=u(Fe,"P",{"data-svelte-h":!0}),K(A)!=="svelte-57b1dg"&&(A.textContent=k),L=y(Fe),T=u(Fe,"H2",{});var vt=E(T);S=se(vt,O),vt.forEach(a),Fe.forEach(a),qe.forEach(a),R=y(re),fe&&fe.l(re),z=y(re),J&&J.l(re),V=y(re),W&&W.l(re),X=y(re),$&&$.l(re),Y=y(re),ee&&ee.l(re),F=y(re),oe&&oe.l(re),Z=y(re),Oe&&Oe.l(re),pe=y(re),ue=u(re,"ION-ITEM",{});var lt=E(ue);he=u(lt,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(a),Pe=y(lt),ge=u(lt,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(a),lt.forEach(a),Le=y(re),me=u(re,"SECTION",{});var bt=E(me);de=u(bt,"LABEL",{for:!0,style:!0});var gt=E(de);ce=u(gt,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ge=E(ce);Ee=u(Ge,"ION-ICON",{icon:!0,slot:!0}),E(Ee).forEach(a),Ue=y(Ge),Te=u(Ge,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),K(Te)!=="svelte-1as0od8"&&(Te.textContent=Ce),De=y(Ge),Ne=u(Ge,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ge.forEach(a),gt.forEach(a),bt.forEach(a),U=y(re),ne&&ne.l(re),re.forEach(a),$e.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",i[4].title),m(s,"strong",""),m(f,"slot","end"),m(e,"translucent",""),m(P,"icon",tn),m(P,"slot","start"),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Notas"),m(ge,"placeholder","Escribe aquí..."),m(Ee,"icon",qt),m(Ee,"slot","start"),G(Te,"for","eventEvidence"),j(Te,"padding","8px 10px"),j(Ne,"display","none"),G(Ne,"id","eventEvidence"),G(Ne,"name","fileToUpload"),G(Ne,"type","file"),G(Ne,"accept","image/*"),m(ce,"fill","outline"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(v,"fullscreen","")},m(Q,ve){q(Q,e,ve),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,N),l(t,I),l(t,f),l(f,s),q(Q,d,ve),q(Q,v,ve),l(v,p),l(p,w),l(w,P),l(w,D),l(w,M),l(M,A),l(M,L),l(M,T),l(T,S),l(p,R),fe&&fe.m(p,null),l(p,z),J&&J.m(p,null),l(p,V),W&&W.m(p,null),l(p,X),$&&$.m(p,null),l(p,Y),ee&&ee.m(p,null),l(p,F),oe&&oe.m(p,null),l(p,Z),Oe&&Oe.m(p,null),l(p,pe),l(p,ue),l(ue,he),l(ue,Pe),l(ue,ge),i[9](ge),l(p,Le),l(p,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Ue),l(ce,Te),l(ce,De),l(ce,Ne),l(p,U),ne&&ne.m(p,null),x||(le=[te(n,"click",i[6]),te(s,"click",i[7]),te(Ne,"change",i[5])],x=!0)},p(Q,[ve]){B&&fe.p(Q,ve),J&&J.p(Q,ve),Q[2]?W?W.p(Q,ve):(W=Ot(Q),W.c(),W.m(p,X)):W&&(W.d(1),W=null),Q[3]&&Q[3]!=="<br>"?$?$.p(Q,ve):($=kt(Q),$.c(),$.m(p,Y)):$&&($.d(1),$=null),H&&ee.p(Q,ve),Q[4].driver_comments&&oe.p(Q,ve),ie&&Oe.p(Q,ve),Q[1]?ne?ne.p(Q,ve):(ne=Nt(Q),ne.c(),ne.m(p,null)):ne&&(ne.d(1),ne=null)},i:Ie,o:Ie,d(Q){Q&&(a(e),a(d),a(v)),fe&&fe.d(),J&&J.d(),W&&W.d(),$&&$.d(),ee&&ee.d(),oe&&oe.d(),Oe&&Oe.d(),i[9](null),ne&&ne.d(),x=!1,He(le)}}}const Tt=/Teléfono:\s*(\d{10,})/;function Dn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,h=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",b="",N={latitude:null,longitude:null},I="",f=n.comments_ext;if(n.comments_ext){const k=n.comments_ext.match(Tt);k&&(I=k[1],f=n.comments_ext.replace(Tt,"").trim())}const s=async()=>{await(await Ve.create({header:"SMS enviado",message:"Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+I,buttons:[{text:"Cerrar"}]})).present()},g=async()=>{await(await Ve.create({header:"SMS no enviado",message:"Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.",buttons:[{text:"Cerrar"}]})).present()},d=async k=>{const T=k.target.files[0],O=await v(T);if(O){const S=new FormData;S.append("fileToUpload",O);try{const R=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:S});if(R.ok){const B=await R.json();t(1,_=B.img),b=B.img_id}else console.error("File upload failed:",R.statusText)}catch(R){console.error("Error during file upload:",R)}}},v=async k=>new Promise(L=>{const T=new FileReader;T.onload=O=>{const S=new Image;S.src=O.target.result,S.onload=()=>{const R=document.createElement("canvas"),B=R.getContext("2d"),z=800,V=600;let X=S.width,Y=S.height;X>z&&(Y*=z/X,X=z),Y>V&&(X*=V/Y,Y=V),R.width=X,R.height=Y,B.drawImage(S,0,0,X,Y),R.toBlob(H=>{L(H)},"image/jpeg",.7)}},T.readAsDataURL(k)}),p=()=>{o.dismiss({data:Date.now()})},w=async()=>{try{if(await D()){const L={id_route:n.id_route,id_event:n.id_event,comments:h.value,img:_,img_id:b,lat:N.latitude,lon:N.longitude},T=new FormData;for(const z in L)T.append(z,L[z]);const S=await(await fetch("https://dev.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:T})).json();p();const R={},B=L.id_route;r&&P("","",B,r)}else console.log("No entré")}catch(k){console.error("Error fetching data:",k)}},P=(k,L,T,O)=>{o.componentProps.routeId=T,o.componentProps.driverId=n.id_driver,Re("modal-km-gas",Gt,{checklist:k,driverId:L,routeId:T,isLast:O}).then(S=>{})},D=async()=>navigator.geolocation?new Promise((k,L)=>{navigator.geolocation.getCurrentPosition(T=>{N.latitude=T.coords.latitude,N.longitude=T.coords.longitude,k(!0)},T=>{console.error("Error getting location:",T),k(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function M(k){k.stopPropagation();const L=new FormData;L.append("client_phone",I),L.append("client_name",n.title),L.append("delivery_phone",n.client_phone),L.append("enterprise_name",n.enterprise_name);try{const T=await fetch("https://dev.rutaflow.com/api/admin/message_central/send_sms.php",{method:"POST",body:L});if(T.ok){const O=await T.json();s()}else g()}catch(T){console.error("Error during file upload:",T)}}function A(k){ye[k?"unshift":"push"](()=>{h=k,t(0,h)})}return[h,_,I,f,n,d,p,w,M,A]}class Hn extends Je{constructor(e){super(),Ye(this,e,Dn,Bn,Xe,{})}}function Ct(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){at(t.src,o=i[0])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&1&&!at(t.src,o=n[0])&&m(t,"src",o)},d(n){n&&a(e)}}}function Un(i){let e,t,o,n,r="Cancelar",h,_,b="Agregar Gasto",N,I,f,s,g,d,v,p,w,P,D,M,A,k,L,T,O,S,R='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',B,z,V="Efectivo",X,Y,H="Tarjeta",F,Z,ie="Transferencia",pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue=`<ion-icon icon="${qt}" slot="start"></ion-icon>
                        Subir Evidencia`,Te,Ce,De,Ne,U,x,le,fe="Confirmar",_e,be,J=i[0]&&Ct(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=b,N=C(),I=c("ion-content"),f=c("ion-list"),s=c("ion-item"),g=c("ion-icon"),d=C(),v=c("ion-input"),p=C(),w=c("ion-item"),P=c("ion-icon"),D=C(),M=c("ion-input"),A=C(),k=c("ion-item"),L=c("ion-icon"),T=C(),O=c("ion-select"),S=c("div"),S.innerHTML=R,B=C(),z=c("ion-select-option"),z.textContent=V,X=C(),Y=c("ion-select-option"),Y.textContent=H,F=C(),Z=c("ion-select-option"),Z.textContent=ie,pe=C(),ue=c("ion-item"),he=c("ion-icon"),Pe=C(),ge=c("ion-textarea"),Le=C(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("label"),Ee.innerHTML=Ue,Te=C(),Ce=c("input"),De=C(),J&&J.c(),Ne=C(),U=c("ion-footer"),x=c("ion-toolbar"),le=c("ion-button"),le.textContent=fe,this.h()},l(W){e=u(W,"ION-HEADER",{translucent:!0});var $=E(e);t=u($,"ION-TOOLBAR",{});var ee=E(t);o=u(ee,"ION-BUTTONS",{slot:!0});var oe=E(o);n=u(oe,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1f8rjcf"&&(n.textContent=r),oe.forEach(a),h=y(ee),_=u(ee,"ION-TITLE",{title:!0,"data-svelte-h":!0}),K(_)!=="svelte-10xvxus"&&(_.textContent=b),ee.forEach(a),$.forEach(a),N=y(W),I=u(W,"ION-CONTENT",{fullscreen:!0});var Oe=E(I);f=u(Oe,"ION-LIST",{});var ne=E(f);s=u(ne,"ION-ITEM",{});var Q=E(s);g=u(Q,"ION-ICON",{icon:!0,slot:!0}),E(g).forEach(a),d=y(Q),v=u(Q,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(v).forEach(a),Q.forEach(a),p=y(ne),w=u(ne,"ION-ITEM",{});var ve=E(w);P=u(ve,"ION-ICON",{icon:!0,slot:!0}),E(P).forEach(a),D=y(ve),M=u(ve,"ION-INPUT",{label:!0,type:!0,value:!0}),E(M).forEach(a),ve.forEach(a),A=y(ne),k=u(ne,"ION-ITEM",{});var Me=E(k);L=u(Me,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(a),T=y(Me),O=u(Me,"ION-SELECT",{placeholder:!0,value:!0});var Ae=E(O);S=u(Ae,"DIV",{slot:!0,"data-svelte-h":!0}),K(S)!=="svelte-wl764p"&&(S.innerHTML=R),B=y(Ae),z=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(z)!=="svelte-i9crym"&&(z.textContent=V),X=y(Ae),Y=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(Y)!=="svelte-fx0z11"&&(Y.textContent=H),F=y(Ae),Z=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(Z)!=="svelte-1c24jf2"&&(Z.textContent=ie),Ae.forEach(a),Me.forEach(a),pe=y(ne),ue=u(ne,"ION-ITEM",{});var ze=E(ue);he=u(ze,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(a),Pe=y(ze),ge=u(ze,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(a),ze.forEach(a),Le=y(ne),me=u(ne,"SECTION",{});var Qe=E(me);de=u(Qe,"LABEL",{for:!0,style:!0});var $e=E(de);ce=u($e,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var re=E(ce);Ee=u(re,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),K(Ee)!=="svelte-1m9yw22"&&(Ee.innerHTML=Ue),Te=y(re),Ce=u(re,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),re.forEach(a),$e.forEach(a),Qe.forEach(a),De=y(ne),J&&J.l(ne),ne.forEach(a),Oe.forEach(a),Ne=y(W),U=u(W,"ION-FOOTER",{});var qe=E(U);x=u(qe,"ION-TOOLBAR",{});var Fe=E(x);le=u(Fe,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(le)!=="svelte-1c7dl3f"&&(le.textContent=fe),Fe.forEach(a),qe.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",""),m(e,"translucent",""),m(g,"icon",jt),m(g,"slot","start"),m(v,"label","Concepto"),m(v,"type","text"),m(v,"placeholder","Escribe aquí..."),m(v,"value",i[5]?i[5]:""),m(P,"icon",ft),m(P,"slot","start"),m(M,"label","Cantidad"),m(M,"type","number"),m(M,"value",i[6]?i[6]:""),m(L,"icon",an),m(L,"slot","start"),G(S,"slot","label"),m(z,"value","cash"),m(Y,"value","card"),m(Z,"value","transfer"),m(O,"placeholder","Tipo de pago"),m(O,"value",i[7]?i[7]:""),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Comentarios"),m(ge,"placeholder","Escribe aquí..."),G(Ee,"for","eventEvidence"),j(Ee,"width","100%"),j(Ee,"padding","8px"),j(Ce,"display","none"),G(Ce,"id","eventEvidence"),G(Ce,"name","fileToUpload"),G(Ce,"type","file"),G(Ce,"accept","image/*"),m(ce,"fill","outline"),m(ce,"size","small"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(I,"fullscreen",""),m(le,"fill","outline"),m(le,"color","tertiary"),m(le,"strong",""),j(le,"width","99%"),j(le,"height","auto")},m(W,$){q(W,e,$),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(W,N,$),q(W,I,$),l(I,f),l(f,s),l(s,g),l(s,d),l(s,v),i[11](v),l(f,p),l(f,w),l(w,P),l(w,D),l(w,M),i[12](M),l(f,A),l(f,k),l(k,L),l(k,T),l(k,O),l(O,S),l(O,B),l(O,z),l(O,X),l(O,Y),l(O,F),l(O,Z),i[13](O),l(f,pe),l(f,ue),l(ue,he),l(ue,Pe),l(ue,ge),i[14](ge),l(f,Le),l(f,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Te),l(ce,Ce),l(f,De),J&&J.m(f,null),q(W,Ne,$),q(W,U,$),l(U,x),l(x,le),_e||(be=[te(n,"click",i[9]),te(Ce,"change",i[8]),te(le,"click",i[10])],_e=!0)},p(W,[$]){W[0]?J?J.p(W,$):(J=Ct(W),J.c(),J.m(f,null)):J&&(J.d(1),J=null)},i:Ie,o:Ie,d(W){W&&(a(e),a(N),a(I),a(Ne),a(U)),i[11](null),i[12](null),i[13](null),i[14](null),J&&J.d(),_e=!1,He(be)}}}function Rn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,h=o.componentProps.ex_amount,_=o.componentProps.ex_type,b=o.componentProps.id_expense,N="",I="",f="",s=0,g="",d="";st(()=>{});const v=async(T,O)=>{await(await Ve.create({header:T||"Error",message:O||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},p=async T=>{const S=T.target.files[0],R=await w(S);if(R){const B=new FormData;B.append("fileToUpload",R);try{const z=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:B});if(z.ok){const V=await z.json();t(0,N=V.img),I=V.img_id}else console.error("File upload failed:",z.statusText)}catch(z){console.error("Error during file upload:",z)}}},w=async T=>new Promise(O=>{const S=new FileReader;S.onload=R=>{const B=new Image;B.src=R.target.result,B.onload=()=>{const z=document.createElement("canvas"),V=z.getContext("2d"),X=800,Y=600;let H=B.width,F=B.height;H>X&&(F*=X/H,H=X),F>Y&&(H*=Y/F,F=Y),z.width=H,z.height=F,V.drawImage(B,0,0,H,F),z.toBlob(Z=>{O(Z)},"image/jpeg",.7)}},S.readAsDataURL(T)}),P=()=>{ot.dismiss()},D=()=>{var T=new Object;T.id_route=n,T.comments=g.value,T.type=f.value,T.img=N,T.img_id=I,T.amount=s.value,T.concept=d.value,T.status="done",T.id_expense=b||"null";const O=new FormData;for(const S in T)O.append(S,T[S]);!I||!N||!g.value||!s.value||!d.value?v("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://dev.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:O}).then(S=>S.json()).then(S=>{P()}).catch(S=>{console.error("Error fetching data:",S)})};function M(T){ye[T?"unshift":"push"](()=>{d=T,t(4,d)})}function A(T){ye[T?"unshift":"push"](()=>{s=T,t(2,s)})}function k(T){ye[T?"unshift":"push"](()=>{f=T,t(1,f)})}function L(T){ye[T?"unshift":"push"](()=>{g=T,t(3,g)})}return[N,f,s,g,d,r,h,_,p,P,D,M,A,k,L]}class dt extends Je{constructor(e){super(),Ye(this,e,Rn,Un,Xe,{})}}function yt(i,e,t){const o=i.slice();return o[7]=e[t],o}function zn(i){let e,t="Cargar gasto",o,n;function r(...h){return i[4](i[7],...h)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(h){e=u(h,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),K(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){m(e,"fill","outline"),m(e,"size","small"),m(e,"aria-selected","")},m(h,_){q(h,e,_),o||(n=te(e,"click",r),o=!0)},p(h,_){i=h},d(h){h&&a(e),o=!1,n()}}}function qn(i){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),K(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){m(e,"fill","solid"),m(e,"size","small"),m(e,"aria-selected","")},m(o,n){q(o,e,n)},p:Ie,d(o){o&&a(e)}}}function wt(i,e){let t,o,n,r=e[7].concept+"",h,_,b;function N(s,g){return s[7].status=="done"?qn:zn}let f=N(e)(e);return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),h=ae(r),_=C(),f.c(),b=C(),this.h()},l(s){t=u(s,"ION-ITEM",{});var g=E(t);o=u(g,"ION-LABEL",{style:!0});var d=E(o);n=u(d,"P",{style:!0});var v=E(n);h=se(v,r),v.forEach(a),d.forEach(a),_=y(g),f.l(g),b=y(g),g.forEach(a),this.h()},h(){j(n,"margin-left","10px"),j(o,"display","flex"),this.first=t},m(s,g){q(s,t,g),l(t,o),l(o,n),l(n,h),l(t,_),f.m(t,null),l(t,b)},p(s,g){e=s,f.p(e,g)},d(s){s&&a(t),f.d()}}}function Fn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${sn}"></ion-icon>`,h,_,b="Lista de gastos",N,I,f,s=[],g=new Map,d,v,p,w="Cerrar",P,D,M=Be(i[0]);const A=k=>k[7].id_expenses;for(let k=0;k<M.length;k+=1){let L=yt(i,M,k),T=A(L);g.set(T,s[k]=wt(T,L))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=C(),_=c("ion-title"),_.textContent=b,N=C(),I=c("ion-content"),f=c("ion-list");for(let k=0;k<s.length;k+=1)s[k].c();d=C(),v=c("ion-footer"),p=c("ion-button"),p.textContent=w,this.h()},l(k){e=u(k,"ION-HEADER",{translucent:!0});var L=E(e);t=u(L,"ION-TOOLBAR",{});var T=E(t);o=u(T,"ION-BUTTONS",{slot:!0});var O=E(o);n=u(O,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-160xz3i"&&(n.innerHTML=r),O.forEach(a),h=y(T),_=u(T,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-e3wnox"&&(_.textContent=b),T.forEach(a),L.forEach(a),N=y(k),I=u(k,"ION-CONTENT",{fullscreen:!0});var S=E(I);f=u(S,"ION-LIST",{});var R=E(f);for(let z=0;z<s.length;z+=1)s[z].l(R);R.forEach(a),S.forEach(a),d=y(k),v=u(k,"ION-FOOTER",{});var B=E(v);p=u(B,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(p)!=="svelte-zv7v83"&&(p.textContent=w),B.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","end"),m(e,"translucent",""),m(I,"fullscreen",""),m(p,"fill","outline"),m(p,"color","tertiary"),m(p,"strong",""),j(p,"width","99%"),j(p,"height","auto")},m(k,L){q(k,e,L),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(k,N,L),q(k,I,L),l(I,f);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(f,null);q(k,d,L),q(k,v,L),l(v,p),P||(D=[te(n,"click",i[3]),te(p,"click",i[1])],P=!0)},p(k,[L]){L&5&&(M=Be(k[0]),s=tt(s,L,A,1,k,M,g,f,nt,wt,null,yt))},i:Ie,o:Ie,d(k){k&&(a(e),a(N),a(I),a(d),a(v));for(let L=0;L<s.length;L+=1)s[L].d();P=!1,He(D)}}}function jn(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;st(()=>{});const o=()=>{ot.dismiss()};function n(_,b,N,I,f){e.componentProps.ex_amount=N,e.componentProps.ex_concept=b,e.componentProps.ex_type=I,e.componentProps.id_expense=f,Re("modal-expense",dt,{amount:N,concept:b,type:I,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{Re("modal-expense",dt,{routeId:_}).then(b=>{}),o()},(_,b)=>n(b,_.concept,_.amount,_.type,_.id_expenses)]}class Vn extends Je{constructor(e){super(),Ye(this,e,jn,Fn,Xe,{})}}function Lt(i,e,t){const o=i.slice();return o[30]=e[t],o}function St(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Pt(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Mt(i){let e,t;return e=new _n({props:{$$slots:{default:[Xn]},$$scope:{ctx:i}}}),{c(){Yt(e.$$.fragment)},l(o){Zt(e.$$.fragment,o)},m(o,n){Qt(e,o,n),t=!0},p(o,n){const r={};n[0]&507|n[1]&32&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(rt(e.$$.fragment,o),t=!0)},o(o){ut(e.$$.fragment,o),t=!1},d(o){$t(e,o)}}}function Gn(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,h,_=[],b=new Map,N,I,f=i[4]&&At(i),s=Be(i[5]);const g=d=>d[30].id_event;for(let d=0;d<s.length;d+=1){let v=Lt(i,s,d),p=g(v);b.set(p,_[d]=Dt(p,v))}return{c(){f&&f.c(),e=C(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=C(),h=c("ion-list");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){f&&f.l(d),e=y(d),t=u(d,"ION-CONTENT",{});var v=E(t);o=u(v,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(o)!=="svelte-19e7x43"&&(o.innerHTML=n),r=y(v),h=u(v,"ION-LIST",{});var p=E(h);for(let w=0;w<_.length;w+=1)_[w].l(p);p.forEach(a),v.forEach(a),this.h()},h(){m(o,"slot","fixed")},m(d,v){f&&f.m(d,v),q(d,e,v),q(d,t,v),l(t,o),i[23](o),l(t,r),l(t,h);for(let p=0;p<_.length;p+=1)_[p]&&_[p].m(h,null);N||(I=te(o,"ionRefresh",i[9]),N=!0)},p(d,v){d[4]?f?f.p(d,v):(f=At(d),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),v[0]&42016&&(s=Be(d[5]),_=tt(_,v,g,1,d,s,b,h,nt,Dt,null,Lt))},d(d){d&&(a(e),a(t)),f&&f.d(d),i[23](null);for(let v=0;v<_.length;v+=1)_[v].d();N=!1,I()}}}function Kn(i){let e,t;function o(h,_){return _[0]&128&&(e=null),e==null&&(e=!!h[7].every(Zn)),e?Wn:xn}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Se()},l(h){r.l(h),t=Se()},m(h,_){r.m(h,_),q(h,t,_)},p(h,_){n===(n=o(h,_))&&r?r.p(h,_):(r.d(1),r=n(h),r&&(r.c(),r.m(t.parentNode,t)))},d(h){h&&a(t),r.d(h)}}}function At(i){let e=i[11]("",i[1],i[0])+"",t;return{c(){t=ae(e)},l(o){t=se(o,e)},m(o,n){q(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[11]("",o[1],o[0])+"")&&ke(t,e)},d(o){o&&a(t)}}}function Bt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function Dt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,N,I,f,s,g=e[30].title+"",d,v,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,D,M,A,k=p&&Bt();function L(){return e[24](e[30])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=C(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(g),v=C(),k&&k.c(),w=C(),P=c("ion-icon"),D=C(),this.h()},l(T){t=u(T,"ION-ITEM",{});var O=E(t);o=u(O,"ION-AVATAR",{slot:!0});var S=E(o);n=u(S,"DIV",{class:!0,title:!0,style:!0});var R=E(n);r=u(R,"DIV",{class:!0});var B=E(r);_=se(B,h),B.forEach(a),R.forEach(a),S.forEach(a),N=y(O),I=u(O,"ION-LABEL",{button:!0});var z=E(I);f=u(z,"ION-TEXT",{color:!0});var V=E(f);s=u(V,"H3",{});var X=E(s);d=se(X,g),v=y(X),k&&k.l(X),X.forEach(a),V.forEach(a),z.forEach(a),w=y(O),P=u(O,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(P).forEach(a),D=y(O),O.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),m(I,"button",""),m(P,"icon",Ze),m(P,"slot","end"),j(P,"color",we(e[30])),this.first=t},m(T,O){q(T,t,O),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,s),l(s,d),l(s,v),k&&k.m(s,null),l(t,w),l(t,P),l(t,D),M||(A=te(I,"click",L),M=!0)},p(T,O){e=T,O[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),O[0]&32&&b!==(b=xe(e[30].status))&&G(n,"title",b),O[0]&32&&j(n,"background-color",we(e[30])),O[0]&32&&j(n,"color",We(we(e[30]))),O[0]&32&&g!==(g=e[30].title+"")&&ke(d,g),O[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?k||(k=Bt(),k.c(),k.m(s,null)):k&&(k.d(1),k=null),O[0]&32&&j(P,"color",we(e[30]))},d(T){T&&a(t),k&&k.d(),M=!1,A()}}}function xn(i){let e=i[11](i[7],i[1],i[0])+"",t,o,n,r,h='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,b,N=[],I=new Map,f,s,g=Be(i[5]);const d=v=>v[30].id_event;for(let v=0;v<g.length;v+=1){let p=St(i,g,v),w=d(p);I.set(w,N[v]=Ut(w,p))}return{c(){t=ae(e),o=C(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=h,_=C(),b=c("ion-list");for(let v=0;v<N.length;v+=1)N[v].c();this.h()},l(v){t=se(v,e),o=y(v),n=u(v,"ION-CONTENT",{});var p=E(n);r=u(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(r)!=="svelte-1poui8g"&&(r.innerHTML=h),_=y(p),b=u(p,"ION-LIST",{});var w=E(b);for(let P=0;P<N.length;P+=1)N[P].l(w);w.forEach(a),p.forEach(a),this.h()},h(){m(r,"slot","fixed")},m(v,p){q(v,t,p),q(v,o,p),q(v,n,p),l(n,r),i[21](r),l(n,_),l(n,b);for(let w=0;w<N.length;w+=1)N[w]&&N[w].m(b,null);f||(s=te(r,"ionRefresh",i[9]),f=!0)},p(v,p){p[0]&131&&e!==(e=v[11](v[7],v[1],v[0])+"")&&ke(t,e),p[0]&74784&&(g=Be(v[5]),N=tt(N,p,d,1,v,g,I,b,nt,Ut,null,St))},d(v){v&&(a(t),a(o),a(n)),i[21](null);for(let p=0;p<N.length;p+=1)N[p].d();f=!1,s()}}}function Wn(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,h=[],_=new Map,b,N,I=Be(i[5]);const f=s=>s[30].id_event;for(let s=0;s<I.length;s+=1){let g=Pt(i,I,s),d=f(g);_.set(d,h[s]=zt(d,g))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=C(),r=c("ion-list");for(let s=0;s<h.length;s+=1)h[s].c();this.h()},l(s){e=u(s,"ION-CONTENT",{});var g=E(e);t=u(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(t)!=="svelte-1t1tzpj"&&(t.innerHTML=o),n=y(g),r=u(g,"ION-LIST",{});var d=E(r);for(let v=0;v<h.length;v+=1)h[v].l(d);d.forEach(a),g.forEach(a),this.h()},h(){m(t,"slot","fixed")},m(s,g){q(s,e,g),l(e,t),i[19](t),l(e,n),l(e,r);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(r,null);b||(N=te(t,"ionRefresh",i[9]),b=!0)},p(s,g){g[0]&74784&&(I=Be(s[5]),h=tt(h,g,f,1,s,I,_,r,nt,zt,null,Pt))},d(s){s&&a(e),i[19](null);for(let g=0;g<h.length;g+=1)h[g].d();b=!1,N()}}}function Ht(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function Ut(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,N,I,f,s,g=e[30].title+"",d,v,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,D="",M,A,k,L,T,O=p&&Ht();function S(){return e[22](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=C(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(g),v=C(),O&&O.c(),w=C(),P=c("div"),P.innerHTML=D,M=C(),A=c("ion-icon"),k=C(),this.h()},l(R){t=u(R,"ION-ITEM",{});var B=E(t);o=u(B,"ION-AVATAR",{slot:!0});var z=E(o);n=u(z,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var X=E(r);_=se(X,h),X.forEach(a),V.forEach(a),z.forEach(a),N=y(B),I=u(B,"ION-LABEL",{button:!0});var Y=E(I);f=u(Y,"ION-TEXT",{color:!0});var H=E(f);s=u(H,"H3",{});var F=E(s);d=se(F,g),v=y(F),O&&O.l(F),F.forEach(a),H.forEach(a),w=y(Y),P=u(Y,"DIV",{class:!0,"data-svelte-h":!0}),K(P)!=="svelte-130ohbs"&&(P.innerHTML=D),Y.forEach(a),M=y(B),A=u(B,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(a),k=y(B),B.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(P,"class","sub svelte-ziybgw"),m(I,"button",""),m(A,"icon",Ze),m(A,"slot","end"),this.first=t},m(R,B){q(R,t,B),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,s),l(s,d),l(s,v),O&&O.m(s,null),l(I,w),l(I,P),l(t,M),l(t,A),l(t,k),L||(T=te(I,"click",S),L=!0)},p(R,B){e=R,B[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),B[0]&32&&b!==(b=xe(e[30].status))&&G(n,"title",b),B[0]&32&&j(n,"background-color",we(e[30])),B[0]&32&&j(n,"color",We(we(e[30]))),B[0]&32&&g!==(g=e[30].title+"")&&ke(d,g),B[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?O||(O=Ht(),O.c(),O.m(s,null)):O&&(O.d(1),O=null)},d(R){R&&a(t),O&&O.d(),L=!1,T()}}}function Rt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function zt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,N,I,f,s,g=e[30].title+"",d,v,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,D="",M,A,k,L,T,O=p&&Rt();function S(){return e[20](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=C(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(g),v=C(),O&&O.c(),w=C(),P=c("div"),P.innerHTML=D,M=C(),A=c("ion-icon"),k=C(),this.h()},l(R){t=u(R,"ION-ITEM",{});var B=E(t);o=u(B,"ION-AVATAR",{slot:!0});var z=E(o);n=u(z,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var X=E(r);_=se(X,h),X.forEach(a),V.forEach(a),z.forEach(a),N=y(B),I=u(B,"ION-LABEL",{button:!0});var Y=E(I);f=u(Y,"ION-TEXT",{color:!0});var H=E(f);s=u(H,"H3",{});var F=E(s);d=se(F,g),v=y(F),O&&O.l(F),F.forEach(a),H.forEach(a),w=y(Y),P=u(Y,"DIV",{class:!0,"data-svelte-h":!0}),K(P)!=="svelte-130ohbs"&&(P.innerHTML=D),Y.forEach(a),M=y(B),A=u(B,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(a),k=y(B),B.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(P,"class","sub svelte-ziybgw"),m(I,"button",""),m(A,"icon",Ze),m(A,"slot","end"),this.first=t},m(R,B){q(R,t,B),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,s),l(s,d),l(s,v),O&&O.m(s,null),l(I,w),l(I,P),l(t,M),l(t,A),l(t,k),L||(T=te(I,"click",S),L=!0)},p(R,B){e=R,B[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),B[0]&32&&b!==(b=xe(e[30].status))&&G(n,"title",b),B[0]&32&&j(n,"background-color",we(e[30])),B[0]&32&&j(n,"color",We(we(e[30]))),B[0]&32&&g!==(g=e[30].title+"")&&ke(d,g),B[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?O||(O=Rt(),O.c(),O.m(s,null)):O&&(O.d(1),O=null)},d(R){R&&a(t),O&&O.d(),L=!1,T()}}}function Xn(i){let e,t,o,n,r=`<ion-icon icon="${cn}"></ion-icon>`,h,_,b,N=`<ion-icon icon="${un}"></ion-icon>`,I,f,s=i[6].name+"",g,d,v,p,w;function P(A,k){if(A[7].length>0)return Kn;if(!A[3])return Gn}let D=P(i),M=D&&D(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=C(),_=c("ion-buttons"),b=c("ion-button"),b.innerHTML=N,I=C(),f=c("ion-title"),g=ae(s),d=C(),M&&M.c(),v=Se(),this.h()},l(A){e=u(A,"ION-HEADER",{translucent:!0});var k=E(e);t=u(k,"ION-TOOLBAR",{});var L=E(t);o=u(L,"ION-BUTTONS",{slot:!0});var T=E(o);n=u(T,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),K(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),T.forEach(a),h=y(L),_=u(L,"ION-BUTTONS",{slot:!0});var O=E(_);b=u(O,"ION-BUTTON",{"data-svelte-h":!0}),K(b)!=="svelte-nf50hj"&&(b.innerHTML=N),O.forEach(a),I=y(L),f=u(L,"ION-TITLE",{});var S=E(f);g=se(S,s),S.forEach(a),L.forEach(a),k.forEach(a),d=y(A),M&&M.l(A),v=Se(),this.h()},h(){m(n,"title","Atrás"),m(n,"alt","Atrás"),m(o,"slot","start"),m(_,"slot","end"),m(e,"translucent","")},m(A,k){q(A,e,k),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,b),l(t,I),l(t,f),l(f,g),q(A,d,k),M&&M.m(A,k),q(A,v,k),p||(w=[te(n,"click",i[14]),te(b,"click",i[18])],p=!0)},p(A,k){k[0]&64&&s!==(s=A[6].name+"")&&ke(g,s),D===(D=P(A))&&M?M.p(A,k):(M&&M.d(1),M=D&&D(A),M&&(M.c(),M.m(v.parentNode,v)))},d(A){A&&(a(e),a(d),a(v)),M&&M.d(A),p=!1,He(w)}}}function Jn(i){let e,t,o,n=i[2]&&Mt(i);return{c(){e=C(),n&&n.c(),t=Se(),this.h()},l(r){Wt("svelte-kn0kph",document.head).forEach(a),e=y(r),n&&n.l(r),t=Se(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,h){q(r,e,h),n&&n.m(r,h),q(r,t,h),o=!0},p(r,h){r[2]?n?(n.p(r,h),h[0]&4&&rt(n,1)):(n=Mt(r),n.c(),rt(n,1),n.m(t.parentNode,t)):n&&(en(),ut(n,1,1,()=>{n=null}),Jt())},i(r){o||(rt(n),o=!0)},o(r){ut(n),o=!1},d(r){r&&(a(e),a(t)),n&&n.d(r)}}}function we(i){let e="#ffffff";return i.status==="pending"?e="#f2e300":i.status==="completed"&&(e="#44d900"),e}function xe(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function We(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function Yn(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const Zn=i=>i.img;function Qn(i,e,t){let o;Xt(i,fn,H=>t(17,o=H));var n=this&&this.__awaiter||function(H,F,Z,ie){function pe(ue){return ue instanceof Z?ue:new Z(function(he){he(ue)})}return new(Z||(Z=Promise))(function(ue,he){function Pe(me){try{Le(ie.next(me))}catch(de){he(de)}}function ge(me){try{Le(ie.throw(me))}catch(de){he(de)}}function Le(me){me.done?ue(me.value):pe(me.value).then(Pe,ge)}Le((ie=ie.apply(H,F||[])).next())})};let{routeId:r}=e,{driverId:h}=e,_=new Object,b=!0,N=!1,I=[],f={},s=[],g=[],d,v=!1;const p=()=>n(void 0,void 0,void 0,function*(){yield w(r),d.complete()});st(()=>{p()});function w(H){return n(this,void 0,void 0,function*(){const F=new FormData;F.append("id_route",H);try{const ie=yield(yield fetch("https://dev.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:F})).json();t(6,f=ie.data.seguimiento_list[0]),t(5,I=ie.data.event_list),t(7,s=ie.data.checklist),g=ie.data.expenses,f&&t(4,N=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,b=!1)}catch(Z){t(3,b=!1),console.error("Error fetching data:",Z)}})}const P=H=>new Promise((F,Z)=>{const ie=new FormData;ie.append("id_route",H.id_route),ie.append("id_event",H.id_event),fetch("https://dev.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:ie}).then(pe=>pe.json()).then(pe=>{F(pe.data.event_evidence[0])}).catch(pe=>{console.error("Error fetching data:",pe),Z(pe)})}),D=(H,F)=>{P(H).then(Z=>{Z&&(H.img=Z.img,H.driver_comments=Z.driver_comments,H.comments=Z.comments),Re("modal-delivery-info",Hn,{delivery:H,isLast:F}).then(ie=>{})})},M=(H,F,Z)=>{var ie=!1;return v||(v=!0,Re("modal-checklist",Gt,{checklist:H,driverId:F,routeId:Z,isLast:ie}).then(pe=>{v=!1}),Yn(Z,"checklist")),""},A=H=>n(void 0,void 0,void 0,function*(){return yield w(H),g.length>0?Re("modal-expense-detail",Vn,{routeId:H,expenses:g}).then(F=>{}):Re("modal-expense",dt,{routeId:H}).then(F=>{}),""}),k=H=>{if(H.tracking_type=="subscription"){if(H.subscriber_info&&H.payment_type==="cash"&&new Date(H.subscriber_info.payment_next)<new Date)return!0}else if(H.tracking_type=="ecommerce"&&Number(H.payment_pending)>0)return!0;return!1},L=()=>{_.id_driver?je(`/drivers/${_.id_driver}`):je("/drivers/me")},T=(H,F)=>n(void 0,void 0,void 0,function*(){yield(yield Ve.create({header:H||"Error",message:F||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function O(H){return H===I.length-1}const S=()=>A(r);function R(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const B=(H,F)=>D(H,O(F));function z(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const V=(H,F)=>D(H,O(F));function X(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const Y=H=>{const F=I.findIndex(he=>he.id_event===H.id_event),Z=F===0,ie=F>0?I[F-1]:null,pe=Z||ie&&ie.img!==null,ue=H.img!==null&&H.img!=="";pe||Z&&!ue?D(H):T("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=H=>{"routeId"in H&&t(0,r=H.routeId),"driverId"in H&&t(1,h=H.driverId)},i.$$.update=()=>{i.$$.dirty[0]&131077&&(t(0,{routeId:r,driverId:h}=o.params,r,(t(1,h),t(17,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="superadmin")?(w(r),je(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(w(r),je(`/drivers/${_.id_driver}/routes/${r}`)):je("/"))},[r,h,_,b,N,I,f,s,d,p,D,M,A,k,L,T,O,o,S,R,B,z,V,X,Y]}class ro extends Je{constructor(e){super(),Ye(this,e,Qn,Jn,Xe,{routeId:0,driverId:1},null,[-1,-1])}}export{ro as component};
