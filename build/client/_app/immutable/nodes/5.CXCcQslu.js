import{Z as mt,s as Ye,e as c,j as N,b as u,q as E,d as J,h as a,m as T,v as p,i as F,w as l,x as ne,n as Ne,z as Ue,_ as xt,B as V,o as ot,k as Me,$ as vt,t as he,r as pe,f as X,a0 as $t,a1 as nt,A as Pe,y as we,a2 as ct,l as en,p as tn,F as nn}from"../chunks/index.BYLndrM5.js";import{S as Ze,i as xe,t as st,a as _t,c as on,b as ln,d as rn,m as an,e as sn,g as cn}from"../chunks/index.BNHbygFo.js";import{e as Re,u as lt,d as it,a as un,c as dt,b as Xt,f as fn,g as _n,i as Jt,h as dn,j as Qt,s as gt,k as $e,m as hn,n as pn,o as mn,q as vn,r as gn,p as bn}from"../chunks/index.DaK2-4TK.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as rt,a as Ke,I as En}from"../chunks/IonPage.KvUD72q2.js";import{q as In,t as kn}from"../chunks/ion-modal.CsJaVgKZ.js";import{g as Ge}from"../chunks/entry.DzTzH-_9.js";const On=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,Nn=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},Tn=function(i){return document.createElement(i).constructor!==HTMLElement},Cn=(i,e)=>{Tn(i)||Nn(i,e)},Fe=async(i,e,t)=>{In(),kn(),Cn(i,e);const o=await rt.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Xe=mt({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Yt=mt({flag:[]});function yn(i){let e,t,o,n,r="Cancelar",d,_,b="Captura de Km/Gas",O,k,f,s="Confirmar",m,h,v,g,S,y,R;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=b,O=N(),k=c("ion-buttons"),f=c("ion-button"),f.textContent=s,m=N(),h=c("ion-content"),v=c("ion-item"),g=c("ion-input"),this.h()},l(A){e=u(A,"ION-HEADER",{translucent:!0});var U=E(e);t=u(U,"ION-TOOLBAR",{});var C=E(t);o=u(C,"ION-BUTTONS",{slot:!0});var L=E(o);n=u(L,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-17pq4f4"&&(n.textContent=r),L.forEach(a),d=T(C),_=u(C,"ION-TITLE",{"data-svelte-h":!0}),J(_)!=="svelte-1yhkaq7"&&(_.textContent=b),O=T(C),k=u(C,"ION-BUTTONS",{slot:!0});var M=E(k);f=u(M,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),J(f)!=="svelte-cm6j4s"&&(f.textContent=s),M.forEach(a),C.forEach(a),U.forEach(a),m=T(A),h=u(A,"ION-CONTENT",{fullscreen:!0});var I=E(h);v=u(I,"ION-ITEM",{});var D=E(v);g=u(D,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var P=E(g);P.forEach(a),D.forEach(a),I.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(f,"strong",""),p(k,"slot","end"),p(e,"translucent",""),p(g,"class","fin-km"),p(g,"inputmode","numeric"),p(g,"pattern","[0-9]*"),p(g,"type","number"),p(g,"placeholder",S="Ingresa "+i[0]+" actual"),p(g,"value",i[1]),p(g,"required",""),p(h,"fullscreen","")},m(A,U){F(A,e,U),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),l(t,O),l(t,k),l(k,f),F(A,m,U),F(A,h,U),l(h,v),l(v,g),y||(R=[ne(n,"click",i[2]),ne(f,"click",i[3]),ne(g,"input",i[4])],y=!0)},p(A,[U]){U&1&&S!==(S="Ingresa "+A[0]+" actual")&&p(g,"placeholder",S),U&2&&p(g,"value",A[1])},i:Ne,o:Ne,d(A){A&&(a(e),a(m),a(h)),y=!1,Ue(R)}}}function wn(i,e,t){const o=xt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let d;Yt.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,d="kilometraje"):t(0,d="litros de gasolina")});let _=0;function b(){rt.dismiss()}function O(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Xe.update(s=>({...s,km_inicial:[_]})):r=="gas_inicial"?Xe.update(s=>({...s,gas_inicial:[_]})):r=="km_final"?Xe.update(s=>({...s,km_final:[_]})):r=="gas_final"&&Xe.update(s=>({...s,gas_final:[_]})),b()}return[d,_,b,O,f=>t(1,_=f.target.value)]}class Ln extends Ze{constructor(e){super(),xe(this,e,wn,yn,Ye,{})}}const ut=mt({items:[],checkedIndices:[],mandatory:[]});function kt(i,e,t){const o=i.slice();return o[51]=e[t],o[52]=e,o[53]=t,o}function Sn(i){let e,t,o,n,r,d="Kilometraje inicial",_,b,O=i[0]?i[0]+" km.":"Cargar km",k,f,s,m,h,v,g,S="Gasolina inicial (litros)",y,R,A=i[1]?i[1]+" litros":"Cargar gas",U,C,L,M;return C=vt(i[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=N(),r=c("p"),r.textContent=d,_=N(),b=c("ion-button"),k=he(O),f=N(),s=c("ion-item"),m=c("ion-label"),h=c("input"),v=N(),g=c("p"),g.textContent=S,y=N(),R=c("ion-button"),U=he(A),this.h()},l(I){e=u(I,"ION-ITEM",{});var D=E(e);t=u(D,"ION-LABEL",{style:!0});var P=E(t);o=u(P,"INPUT",{id:!0,style:!0,type:!0}),n=T(P),r=u(P,"P",{style:!0,"data-svelte-h":!0}),J(r)!=="svelte-88twxi"&&(r.textContent=d),P.forEach(a),_=T(D),b=u(D,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var w=E(b);k=pe(w,O),w.forEach(a),D.forEach(a),f=T(I),s=u(I,"ION-ITEM",{});var B=E(s);m=u(B,"ION-LABEL",{style:!0});var q=E(m);h=u(q,"INPUT",{id:!0,style:!0,type:!0}),v=T(q),g=u(q,"P",{style:!0,"data-svelte-h":!0}),J(g)!=="svelte-1ux30eb"&&(g.textContent=S),q.forEach(a),y=T(B),R=u(B,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var j=E(R);U=pe(j,A),j.forEach(a),B.forEach(a),this.h()},h(){X(o,"id","chkbox-km-ini"),V(o,"pointer-events","auto"),X(o,"type","checkbox"),o.required=!0,V(r,"margin-left","10px"),V(t,"display","flex"),p(b,"fill","outline"),p(b,"size","small"),p(b,"class","loadKmInicial"),p(b,"aria-selected",""),X(h,"id","chkbox-gas-ini"),V(h,"pointer-events","auto"),X(h,"type","checkbox"),h.required=!0,V(g,"margin-left","10px"),V(m,"display","flex"),p(R,"fill","outline"),p(R,"class","loadGasInicial"),p(R,"size","small"),V(R,"height","16px "),C.p(o,h)},m(I,D){F(I,e,D),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[28](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,k),F(I,f,D),F(I,s,D),l(s,m),l(m,h),i[30](h),h.checked=~(i[4]||[]).indexOf(h.__value),l(m,v),l(m,g),l(s,y),l(s,R),l(R,U),L||(M=[ne(o,"change",i[27]),ne(b,"click",i[29]),ne(h,"change",i[31]),ne(R,"click",i[32])],L=!0)},p(I,D){D[0]&16&&(o.checked=~(I[4]||[]).indexOf(o.__value)),D[0]&1&&O!==(O=I[0]?I[0]+" km.":"Cargar km")&&we(k,O),D[0]&16&&(h.checked=~(I[4]||[]).indexOf(h.__value)),D[0]&2&&A!==(A=I[1]?I[1]+" litros":"Cargar gas")&&we(U,A)},d(I){I&&(a(e),a(f),a(s)),i[28](null),i[30](null),C.r(),L=!1,Ue(M)}}}function Pn(i){let e,t,o,n,r,d="Kilometraje final",_,b,O=i[2]?i[2]+" km.":"Cargar km",k,f,s,m,h,v,g,S="Gasolina final (litros)",y,R,A=i[3]?i[3]+" litros":"Cargar gas",U,C,L,M;return C=vt(i[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=N(),r=c("p"),r.textContent=d,_=N(),b=c("ion-button"),k=he(O),f=N(),s=c("ion-item"),m=c("ion-label"),h=c("input"),v=N(),g=c("p"),g.textContent=S,y=N(),R=c("ion-button"),U=he(A),this.h()},l(I){e=u(I,"ION-ITEM",{});var D=E(e);t=u(D,"ION-LABEL",{style:!0});var P=E(t);o=u(P,"INPUT",{id:!0,style:!0,type:!0}),n=T(P),r=u(P,"P",{style:!0,"data-svelte-h":!0}),J(r)!=="svelte-ccmu71"&&(r.textContent=d),P.forEach(a),_=T(D),b=u(D,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var w=E(b);k=pe(w,O),w.forEach(a),D.forEach(a),f=T(I),s=u(I,"ION-ITEM",{});var B=E(s);m=u(B,"ION-LABEL",{style:!0});var q=E(m);h=u(q,"INPUT",{id:!0,style:!0,type:!0}),v=T(q),g=u(q,"P",{style:!0,"data-svelte-h":!0}),J(g)!=="svelte-wsoyd2"&&(g.textContent=S),q.forEach(a),y=T(B),R=u(B,"ION-BUTTON",{fill:!0,size:!0,class:!0});var j=E(R);U=pe(j,A),j.forEach(a),B.forEach(a),this.h()},h(){X(o,"id","chkbox-km-fin"),V(o,"pointer-events","auto"),X(o,"type","checkbox"),o.required=!0,V(r,"margin-left","10px"),V(t,"display","flex"),p(b,"fill","outline"),p(b,"size","small"),p(b,"class","loadKmInicial"),p(b,"aria-selected",""),X(h,"id","chkbox-gas-fin"),V(h,"pointer-events","auto"),X(h,"type","checkbox"),h.required=!0,V(g,"margin-left","10px"),V(m,"display","flex"),p(R,"fill","outline"),p(R,"size","small"),p(R,"class","loadGasInicial"),C.p(o,h)},m(I,D){F(I,e,D),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[22](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,k),F(I,f,D),F(I,s,D),l(s,m),l(m,h),h.checked=~(i[4]||[]).indexOf(h.__value),i[25](h),l(m,v),l(m,g),l(s,y),l(s,R),l(R,U),L||(M=[ne(o,"change",i[20]),ne(b,"click",i[23]),ne(h,"change",i[24]),ne(R,"click",i[26])],L=!0)},p(I,D){D[0]&16&&(o.checked=~(I[4]||[]).indexOf(o.__value)),D[0]&4&&O!==(O=I[2]?I[2]+" km.":"Cargar km")&&we(k,O),D[0]&16&&(h.checked=~(I[4]||[]).indexOf(h.__value)),D[0]&8&&A!==(A=I[3]?I[3]+" litros":"Cargar gas")&&we(U,A)},d(I){I&&(a(e),a(f),a(s)),i[22](null),i[25](null),C.r(),L=!1,Ue(M)}}}function Mn(i){let e=[],t=new Map,o,n=Re(i[13]);const r=d=>d[51].id_checklist_event;for(let d=0;d<n.length;d+=1){let _=kt(i,n,d),b=r(_);t.set(b,e[d]=Ot(b,_))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();o=Me()},l(d){for(let _=0;_<e.length;_+=1)e[_].l(d);o=Me()},m(d,_){for(let b=0;b<e.length;b+=1)e[b]&&e[b].m(d,_);F(d,o,_)},p(d,_){_[0]&407664&&(n=Re(d[13]),e=lt(e,_,r,1,d,n,t,o.parentNode,it,Ot,o,kt))},d(d){d&&a(o);for(let _=0;_<e.length;_+=1)e[_].d(d)}}}function An(i){let e,t=(i[12][i[51].id_checklist_event]?i[12][i[51].id_checklist_event]:"Cargar evidencia")+"",o;return{c(){e=c("label"),o=he(t),this.h()},l(n){e=u(n,"LABEL",{for:!0,class:!0});var r=E(e);o=pe(r,t),r.forEach(a),this.h()},h(){X(e,"for","chklist-"+i[51].id_checklist_event),X(e,"class","button-label svelte-1ruehls")},m(n,r){F(n,e,r),l(e,o)},p(n,r){r[0]&4096&&t!==(t=(n[12][n[51].id_checklist_event]?n[12][n[51].id_checklist_event]:"Cargar evidencia")+"")&&we(o,t)},d(n){n&&a(e)}}}function Bn(i){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0,class:!0}),E(e).forEach(a),this.h()},h(){p(e,"name","dots"),p(e,"class","button-spinner svelte-1ruehls")},m(t,o){F(t,e,o)},p:Ne,d(t){t&&a(e)}}}function Ot(i,e){let t,o,n,r=e[51],d,_,b=e[51].item+"",O,k,f,s=e[51].mandatory=="1"?" * ":"",m,h,v,g,S,y,R,A,U,C;const L=()=>e[34](n,r),M=()=>e[34](null,r);function I(){return e[35](e[51])}function D(q,j){return q[11][q[51].id_checklist_event]?Bn:An}let P=D(e),w=P(e);function B(...q){return e[37](e[51],...q)}return A=vt(e[21][0]),{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),d=N(),_=c("p"),O=he(b),k=N(),f=c("b"),m=he(s),h=N(),v=c("ion-button"),g=c("div"),w.c(),S=N(),y=c("input"),R=N(),this.h()},l(q){t=u(q,"ION-ITEM",{});var j=E(t);o=u(j,"ION-LABEL",{style:!0});var G=E(o);n=u(G,"INPUT",{id:!0,style:!0,type:!0}),d=T(G),_=u(G,"P",{style:!0});var ce=E(_);O=pe(ce,b),k=T(ce),ce.forEach(a),f=u(G,"B",{style:!0});var $=E(f);m=pe($,s),$.forEach(a),G.forEach(a),h=T(j),v=u(j,"ION-BUTTON",{fill:!0,class:!0,size:!0});var ue=E(v);g=u(ue,"DIV",{class:!0});var _e=E(g);w.l(_e),S=T(_e),y=u(_e,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),_e.forEach(a),ue.forEach(a),R=T(j),j.forEach(a),this.h()},h(){X(n,"id",`chkbox-${e[51].id_checklist_event}`),V(n,"pointer-events","auto"),X(n,"type","checkbox"),n.__value=e[51].id_checklist_event,$t(n,n.__value),n.required=!0,V(_,"margin-left","10px"),V(f,"margin-left","5px"),V(o,"display","flex"),V(y,"display","none"),X(y,"id","chklist-"+e[51].id_checklist_event),X(y,"name","fileToUpload"),X(y,"type","file"),X(y,"accept","image/*"),X(g,"class","button-content svelte-1ruehls"),p(v,"fill","outline"),p(v,"class","loadEvidence svelte-1ruehls"),p(v,"size","small"),A.p(n),this.first=t},m(q,j){F(q,t,j),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),L(),l(o,d),l(o,_),l(_,O),l(_,k),l(o,f),l(f,m),l(t,h),l(t,v),l(v,g),w.m(g,null),l(g,S),l(g,y),e[36](y),l(t,R),U||(C=[ne(n,"change",e[33]),ne(n,"change",I),ne(y,"change",B)],U=!0)},p(q,j){e=q,j[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[51]&&(M(),r=e[51],L()),P===(P=D(e))&&w?w.p(e,j):(w.d(1),w=P(e),w&&(w.c(),w.m(g,S)))},d(q){q&&a(t),M(),w.d(),e[36](null),A.r(),U=!1,Ue(C)}}}function Dn(i){let e,t,o,n,r="Cancelar",d,_,b="REQUERIMIENTOS DE RUTA",O,k,f,s,m,h,v,g="Confirmar",S,y;function R(L,M){return L[14]?Pn:Sn}let U=R(i)(i),C=i[13]&&Mn(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=b,O=N(),k=c("ion-content"),f=c("ion-list"),U.c(),s=N(),C&&C.c(),m=N(),h=c("ion-footer"),v=c("ion-button"),v.textContent=g,this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var M=E(e);t=u(M,"ION-TOOLBAR",{});var I=E(t);o=u(I,"ION-BUTTONS",{slot:!0});var D=E(o);n=u(D,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-1dnmkxs"&&(n.textContent=r),D.forEach(a),d=T(I),_=u(I,"ION-TITLE",{"data-svelte-h":!0}),J(_)!=="svelte-19bar5p"&&(_.textContent=b),I.forEach(a),M.forEach(a),O=T(L),k=u(L,"ION-CONTENT",{fullscreen:!0});var P=E(k);f=u(P,"ION-LIST",{});var w=E(f);U.l(w),s=T(w),C&&C.l(w),w.forEach(a),P.forEach(a),m=T(L),h=u(L,"ION-FOOTER",{});var B=E(h);v=u(B,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),J(v)!=="svelte-g82qqw"&&(v.textContent=g),B.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(e,"translucent",""),p(k,"fullscreen",""),p(v,"fill","outline"),p(v,"color","tertiary"),p(v,"strong",""),V(v,"width","99%"),V(v,"height","auto")},m(L,M){F(L,e,M),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),F(L,O,M),F(L,k,M),l(k,f),U.m(f,null),l(f,s),C&&C.m(f,null),F(L,m,M),F(L,h,M),l(h,v),S||(y=[ne(n,"click",i[15]),ne(v,"click",i[16])],S=!0)},p(L,M){U.p(L,M),L[13]&&C.p(L,M)},i:Ne,o:Ne,d(L){L&&(a(e),a(O),a(k),a(m),a(h)),U.d(),C&&C.d(),S=!1,Ue(y)}}}function ht(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>ht(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function ft(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function zn(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,d=o.componentProps.routeId,_=o.componentProps.isLast;let b,O,k,f,s=[],m=null,h={},v,g,S,y,R={},A={},U={};ot(()=>{_?console.log("Último checklist"):ut.update(z=>(z.mandatory=ht(n,"mandatory"),z.items=ht(n,"id_checklist_event"),z))});function C(z){t(11,R[z]=!0,R)}const L=async()=>{await(await Ke.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},M=async()=>{await(await Ke.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},I=async z=>{await(await Ke.create({header:"Datos inválidos",message:z=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},D=()=>{rt.dismiss(),r?Ge(`/drivers/${r}`):Ge("/drivers/me")},P=()=>{if(_){var z=j(k,"km"),K=j(f,"gas");const ve=new FormData;ve.append("km_final",z),ve.append("gas_final",K),ve.append("id_route",d),z&&K?(D(),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ve}).then(Y=>Y.json()).then(Y=>{M()}).catch(Y=>{console.error("Error fetching data:",Y)})):L()}else{var ge=j(b,"km"),Ce=j(O,"gas");ut.update(ve=>{ve.items;const Y=ve.mandatory;if(ve.items.filter((te,se)=>ve.mandatory[se]==="1").every(te=>ve.checkedIndices.includes(te))&&ge&&Ce){D();const te=new FormData;for(const se in A)if(A.hasOwnProperty(se)){const{img:Ie,img_id:oe}=A[se];te.append(`selectedImages[${se}][img]`,Ie),te.append(`selectedImages[${se}][img_id]`,oe)}te.append("km_inicial",ge),te.append("gas_inicial",Ce),te.append("id_route",d),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:te}).then(se=>se.json()).then(se=>{Y&&Y.some(Ie=>Ie==="1")?ft(d,"checklist-pending"):ft(d,"enroute")}).catch(se=>{console.error("Error fetching data:",se)})}else if(!Y&&ge&&Ce){var de=new FormData;de.append("km_inicial",ge),de.append("gas_inicial",Ce),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:de}).then(te=>te.json()).then(te=>{ft(d,"enroute")}).catch(te=>{console.error("Error fetching data:",te)})}else L();return ve})}ue()},w=async(z,K)=>{C(K);const Ce=z.target.files[0],ve=await B(Ce);if(ve){const Y=new FormData;Y.append("fileToUpload",ve);try{const Z=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:Y});if(Z.ok){const Q=await Z.json();A={...A,[K]:{img:Q.img,img_id:Q.img_id}},t(12,U={...U,[K]:Q.filename}),q(K),t(6,h[K].checked=!0,h),t(11,R[K]=!1,R)}else console.error("File upload failed:",Z.statusText)}catch(Z){console.error("Error during file upload:",Z)}}},B=async z=>new Promise(K=>{const ge=new FileReader;ge.onload=Ce=>{const ve=new Image;ve.src=Ce.target.result,ve.onload=()=>{const Y=document.createElement("canvas"),Z=Y.getContext("2d"),Q=800,de=600;let te=ve.width,se=ve.height;te>Q&&(se*=Q/te,te=Q),se>de&&(te*=de/se,se=de),Y.width=te,Y.height=se,Z.drawImage(ve,0,0,te,se),Y.toBlob(Ie=>{K(Ie)},"image/jpeg",.7)}},ge.readAsDataURL(z)}),q=z=>{ut.update(K=>(K.checkedIndices.indexOf(z)===-1?K.checkedIndices.push(z):console.error(`ID ${z} is already checked.`),K.items.forEach(Ce=>{Ce.id_checklist_event===z&&(Ce.checked=!0)}),K))};function j(z,K){return/^\d+$/.test(z)?parseInt(z,10):(I(K),null)}function G(z,K){ce(K),o.componentProps.data_type=K,Fe("modal-gas-km",Ln,{r:K}).then(()=>{Xe.subscribe(ge=>{$(ge,K)})})}function ce(z){Yt.update(K=>({...K,flag:[z]}))}function $(z,K){t(0,b=z.km_inicial?z.km_inicial:null),t(1,O=z.gas_inicial?z.gas_inicial:null),t(2,k=z.km_final?z.km_final:null),t(3,f=z.gas_final?z.gas_final:null),K=="km_inicial"&&v&&t(7,v.checked=!0,v),K=="gas_inicial"&&g&&t(8,g.checked=!0,g),K=="km_final"&&S&&t(9,S.checked=!0,S),K=="gas_final"&&y&&t(10,y.checked=!0,y)}function ue(){Xe.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const _e=[[]];function H(){s=nt(_e[0],this.__value,this.checked),t(4,s)}function W(z){Pe[z?"unshift":"push"](()=>{S=z,t(9,S)})}const x=z=>G(z,"km_final");function le(){s=nt(_e[0],this.__value,this.checked),t(4,s)}function ie(z){Pe[z?"unshift":"push"](()=>{y=z,t(10,y)})}const re=z=>G(z,"gas_final");function me(){s=nt(_e[0],this.__value,this.checked),t(4,s)}function be(z){Pe[z?"unshift":"push"](()=>{v=z,t(7,v)})}const ae=z=>G(z,"km_inicial");function Ee(z){Pe[z?"unshift":"push"](()=>{g=z,t(8,g)})}function Te(){s=nt(_e[0],this.__value,this.checked),t(4,s)}const Oe=z=>G(z,"gas_inicial");function Le(){s=nt(_e[0],this.__value,this.checked),t(4,s)}function ze(z,K){Pe[z?"unshift":"push"](()=>{h[K.id_checklist_event]=z,t(6,h)})}const ye=z=>q(z.id_checklist_event);function He(z){Pe[z?"unshift":"push"](()=>{m=z,t(5,m)})}return[b,O,k,f,s,m,h,v,g,S,y,R,U,n,_,D,P,w,q,G,H,_e,W,x,le,ie,re,me,be,ae,Ee,Te,Oe,Le,ze,ye,He,(z,K)=>w(K,z.id_checklist_event)]}class Zt extends Ze{constructor(e){super(),xe(this,e,zn,Dn,Ye,{},null,[-1,-1])}}function Hn(i){let e,t,o,n,r,d="Teléfono de Negocio",_,b,O=i[6].client_phone+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{class:!0});var m=E(n);r=u(m,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1u5l7fz"&&(r.textContent=d),_=T(m),b=u(m,"H2",{});var h=E(b);k=pe(h,O),h.forEach(a),m.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",fn),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(e,"href","tel:"+i[6].client_phone)},m(f,s){F(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p:Ne,d(f){f&&a(e)}}}function Rn(i){let e,t,o,n,r,d="Domicilio Alternativo",_,b,O=i[6].line2+"",k,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),f=N(),s=c("ion-icon"),this.h()},l(m){e=u(m,"ION-ITEM",{href:!0});var h=E(e);t=u(h,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(h),n=u(h,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1ub9uzw"&&(r.textContent=d),_=T(v),b=u(v,"H2",{});var g=E(b);k=pe(g,O),g.forEach(a),v.forEach(a),f=T(h),s=u(h,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),h.forEach(a),this.h()},h(){p(t,"icon",gt),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",$e),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[6].line2)},m(m,h){F(m,e,h),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k),l(e,f),l(e,s)},p:Ne,d(m){m&&a(e)}}}function Un(i){let e,t,o,n,r,d="Domicilio",_,b,O=i[6].line1+"",k,f,s,m,h=i[6].line2&&i[6].line2.trim().length,v,g=h&&Fn(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),f=N(),s=c("ion-icon"),m=N(),g&&g.c(),v=Me(),this.h()},l(S){e=u(S,"ION-ITEM",{href:!0});var y=E(e);t=u(y,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(y),n=u(y,"ION-LABEL",{class:!0});var R=E(n);r=u(R,"P",{"data-svelte-h":!0}),J(r)!=="svelte-cbm7q1"&&(r.textContent=d),_=T(R),b=u(R,"H2",{});var A=E(b);k=pe(A,O),A.forEach(a),R.forEach(a),f=T(y),s=u(y,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),y.forEach(a),m=T(S),g&&g.l(S),v=Me(),this.h()},h(){p(t,"icon",gt),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",$e),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line1)},m(S,y){F(S,e,y),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k),l(e,f),l(e,s),F(S,m,y),g&&g.m(S,y),F(S,v,y)},p(S,y){h&&g.p(S,y)},d(S){S&&(a(e),a(m),a(v)),g&&g.d(S)}}}function Fn(i){let e,t,o,n,r,d="Domicilio Alternativo",_,b,O=i[6].line2+"",k,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),f=N(),s=c("ion-icon"),this.h()},l(m){e=u(m,"ION-ITEM",{href:!0});var h=E(e);t=u(h,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(h),n=u(h,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1ub9uzw"&&(r.textContent=d),_=T(v),b=u(v,"H2",{});var g=E(b);k=pe(g,O),g.forEach(a),v.forEach(a),f=T(h),s=u(h,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),h.forEach(a),this.h()},h(){p(t,"icon",gt),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",$e),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line2)},m(m,h){F(m,e,h),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k),l(e,f),l(e,s)},p:Ne,d(m){m&&a(e)}}}function Nt(i){let e,t,o,n,r,d="Contacto del Cliente",_,b,O,k,f=i[2]&&i[2]==="1"&&Tt(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),O=he(i[4]),k=N(),f&&f.c(),this.h()},l(s){e=u(s,"ION-ITEM",{});var m=E(e);t=u(m,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(m),n=u(m,"ION-LABEL",{class:!0});var h=E(n);r=u(h,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1utsyb6"&&(r.textContent=d),_=T(h),b=u(h,"H2",{});var v=E(b);O=pe(v,i[4]),v.forEach(a),h.forEach(a),k=T(m),f&&f.l(m),m.forEach(a),this.h()},h(){p(t,"icon",_n),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(s,m){F(s,e,m),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,O),l(e,k),f&&f.m(e,null)},p(s,m){m&16&&we(O,s[4]),s[2]&&s[2]==="1"?f?f.p(s,m):(f=Tt(s),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(s){s&&a(e),f&&f.d()}}}function Tt(i){let e,t=`<ion-icon icon="${hn}" slot="start"></ion-icon>
                        Notificar Cliente`,o,n;return{c(){e=c("ion-button"),e.innerHTML=t,this.h()},l(r){e=u(r,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),J(e)!=="svelte-w3qtwm"&&(e.innerHTML=t),this.h()},h(){p(e,"fill","outline"),V(e,"margin-left","16px")},m(r,d){F(r,e,d),o||(n=ne(e,"click",i[10]),o=!0)},p:Ne,d(r){r&&a(e),o=!1,n()}}}function Ct(i){let e,t,o,n,r,d="Notas de ubicación",_,b,O;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),O=he(i[5]),this.h()},l(k){e=u(k,"ION-ITEM",{});var f=E(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(f),n=u(f,"ION-LABEL",{class:!0});var s=E(n);r=u(s,"P",{"data-svelte-h":!0}),J(r)!=="svelte-nhm2ft"&&(r.textContent=d),_=T(s),b=u(s,"H2",{});var m=E(b);O=pe(m,i[5]),m.forEach(a),s.forEach(a),f.forEach(a),this.h()},h(){p(t,"icon",Jt),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(k,f){F(k,e,f),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,O)},p(k,f){f&32&&we(O,k[5])},d(k){k&&a(e)}}}function qn(i){let e,t,o,n,r,d="Horarios",_,b,O=i[6].schedule+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{});var m=E(n);r=u(m,"P",{"data-svelte-h":!0}),J(r)!=="svelte-11q7hm5"&&(r.textContent=d),_=T(m),b=u(m,"H2",{});var h=E(b);k=pe(h,O),h.forEach(a),m.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",dn),p(t,"slot","start")},m(f,s){F(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p:Ne,d(f){f&&a(e)}}}function jn(i){let e,t,o,n,r,d="Notas del operador",_,b,O=i[6].driver_comments+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{});var m=E(n);r=u(m,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1yk9qp4"&&(r.textContent=d),_=T(m),b=u(m,"H2",{});var h=E(b);k=pe(h,O),h.forEach(a),m.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",Qt),p(t,"slot","start")},m(f,s){F(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p:Ne,d(f){f&&a(e)}}}function Vn(i){let e,t=i[6].logistic_comments!="<br>"&&Gn(i);return{c(){t&&t.c(),e=Me()},l(o){t&&t.l(o),e=Me()},m(o,n){t&&t.m(o,n),F(o,e,n)},p(o,n){o[6].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&a(e),t&&t.d(o)}}}function Gn(i){let e,t,o,n,r,d="Comentarios logísticos",_,b,O=i[6].logistic_comments+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),b=c("h2"),k=he(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{class:!0});var m=E(n);r=u(m,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1iz85r6"&&(r.textContent=d),_=T(m),b=u(m,"H2",{});var h=E(b);k=pe(h,O),h.forEach(a),m.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",Jt),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(f,s){F(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p:Ne,d(f){f&&a(e)}}}function yt(i){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0}),E(e).forEach(a),this.h()},h(){p(e,"name","dots")},m(t,o){F(t,e,o)},d(t){t&&a(e)}}}function wt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){ct(t.src,o=i[1])||p(t,"src",o),p(t,"alt","Evidencia fotográfica"),V(t,"max-width","100%"),V(t,"margin-top","16px")},m(n,r){F(n,e,r),l(e,t)},p(n,r){r&2&&!ct(t.src,o=n[1])&&p(t,"src",o)},d(n){n&&a(e)}}}function Kn(i){let e,t,o,n,r="Cancelar",d,_,b=i[6].title+"",O,k,f,s,m="Confirmar",h,v,g,S,y,R,A,U,C="Negocio",L,M,I=i[6].client_name+"",D,P,w=i[6].client_phone&&i[6].client_phone.trim().length,B,q,j,G,ce=i[6].schedule&&i[6].schedule.trim().length,$,ue,_e=i[6].logistic_comments&&i[6].logistic_comments.trim().length,H,W,x,le,ie,re,me,be,ae,Ee,Te,Oe,Le="Subir Evidencia",ze,ye,He,Ae,z,K,ge=w&&Hn(i);function Ce(ee,ke){if(ee[6].line1&&ee[6].line1.trim().length)return Un;if(ee[6].line2&&ee[6].line2.trim().length)return Rn}let ve=Ce(i),Y=ve&&ve(i),Z=i[4]&&Nt(i),Q=i[5]&&i[5]!=="<br>"&&Ct(i),de=ce&&qn(i),te=i[6].driver_comments&&jn(i),se=_e&&Vn(i),Ie=i[3]&&yt(),oe=i[1]&&wt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),O=he(b),k=N(),f=c("ion-buttons"),s=c("ion-button"),s.textContent=m,h=N(),v=c("ion-content"),g=c("ion-list"),S=c("ion-item"),y=c("ion-icon"),R=N(),A=c("ion-label"),U=c("p"),U.textContent=C,L=N(),M=c("h2"),D=he(I),P=N(),ge&&ge.c(),B=N(),Y&&Y.c(),q=N(),Z&&Z.c(),j=N(),Q&&Q.c(),G=N(),de&&de.c(),$=N(),te&&te.c(),ue=N(),se&&se.c(),H=N(),W=c("ion-item"),x=c("ion-icon"),le=N(),ie=c("ion-textarea"),re=N(),me=c("section"),be=c("label"),ae=c("ion-button"),Ee=c("ion-icon"),Te=N(),Oe=c("label"),Oe.textContent=Le,ze=N(),ye=c("input"),He=N(),Ie&&Ie.c(),Ae=N(),oe&&oe.c(),this.h()},l(ee){e=u(ee,"ION-HEADER",{translucent:!0});var ke=E(e);t=u(ke,"ION-TOOLBAR",{});var Be=E(t);o=u(Be,"ION-BUTTONS",{slot:!0});var De=E(o);n=u(De,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-1f8rjcf"&&(n.textContent=r),De.forEach(a),d=T(Be),_=u(Be,"ION-TITLE",{title:!0});var qe=E(_);O=pe(qe,b),qe.forEach(a),k=T(Be),f=u(Be,"ION-BUTTONS",{slot:!0});var et=E(f);s=u(et,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),J(s)!=="svelte-1ida0il"&&(s.textContent=m),et.forEach(a),Be.forEach(a),ke.forEach(a),h=T(ee),v=u(ee,"ION-CONTENT",{fullscreen:!0});var tt=E(v);g=u(tt,"ION-LIST",{});var fe=E(g);S=u(fe,"ION-ITEM",{});var je=E(S);y=u(je,"ION-ICON",{icon:!0,slot:!0}),E(y).forEach(a),R=T(je),A=u(je,"ION-LABEL",{});var Ve=E(A);U=u(Ve,"P",{"data-svelte-h":!0}),J(U)!=="svelte-57b1dg"&&(U.textContent=C),L=T(Ve),M=u(Ve,"H2",{});var bt=E(M);D=pe(bt,I),bt.forEach(a),Ve.forEach(a),je.forEach(a),P=T(fe),ge&&ge.l(fe),B=T(fe),Y&&Y.l(fe),q=T(fe),Z&&Z.l(fe),j=T(fe),Q&&Q.l(fe),G=T(fe),de&&de.l(fe),$=T(fe),te&&te.l(fe),ue=T(fe),se&&se.l(fe),H=T(fe),W=u(fe,"ION-ITEM",{});var at=E(W);x=u(at,"ION-ICON",{icon:!0,slot:!0}),E(x).forEach(a),le=T(at),ie=u(at,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ie).forEach(a),at.forEach(a),re=T(fe),me=u(fe,"SECTION",{});var Et=E(me);be=u(Et,"LABEL",{for:!0,style:!0});var It=E(be);ae=u(It,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var We=E(ae);Ee=u(We,"ION-ICON",{icon:!0,slot:!0}),E(Ee).forEach(a),Te=T(We),Oe=u(We,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),J(Oe)!=="svelte-1as0od8"&&(Oe.textContent=Le),ze=T(We),ye=u(We,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),We.forEach(a),It.forEach(a),Et.forEach(a),He=T(fe),Ie&&Ie.l(fe),Ae=T(fe),oe&&oe.l(fe),fe.forEach(a),tt.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(_,"title",i[6].title),p(s,"strong",""),p(f,"slot","end"),p(e,"translucent",""),p(y,"icon",un),p(y,"slot","start"),p(x,"icon",dt),p(x,"slot","start"),p(ie,"label","Notas"),p(ie,"placeholder","Escribe aquí..."),p(Ee,"icon",Xt),p(Ee,"slot","start"),X(Oe,"for","eventEvidence"),V(Oe,"padding","8px 10px"),V(ye,"display","none"),X(ye,"id","eventEvidence"),X(ye,"name","fileToUpload"),X(ye,"type","file"),X(ye,"accept","image/*"),p(ae,"fill","outline"),p(ae,"class","loadEvidence"),p(ae,"expand","block"),X(be,"for","eventEvidence"),V(be,"display","block"),V(be,"width","100%"),p(v,"fullscreen","")},m(ee,ke){F(ee,e,ke),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),l(_,O),l(t,k),l(t,f),l(f,s),F(ee,h,ke),F(ee,v,ke),l(v,g),l(g,S),l(S,y),l(S,R),l(S,A),l(A,U),l(A,L),l(A,M),l(M,D),l(g,P),ge&&ge.m(g,null),l(g,B),Y&&Y.m(g,null),l(g,q),Z&&Z.m(g,null),l(g,j),Q&&Q.m(g,null),l(g,G),de&&de.m(g,null),l(g,$),te&&te.m(g,null),l(g,ue),se&&se.m(g,null),l(g,H),l(g,W),l(W,x),l(W,le),l(W,ie),i[11](ie),l(g,re),l(g,me),l(me,be),l(be,ae),l(ae,Ee),l(ae,Te),l(ae,Oe),l(ae,ze),l(ae,ye),l(g,He),Ie&&Ie.m(g,null),l(g,Ae),oe&&oe.m(g,null),z||(K=[ne(n,"click",i[8]),ne(s,"click",i[9]),ne(ye,"change",i[7])],z=!0)},p(ee,[ke]){w&&ge.p(ee,ke),Y&&Y.p(ee,ke),ee[4]?Z?Z.p(ee,ke):(Z=Nt(ee),Z.c(),Z.m(g,j)):Z&&(Z.d(1),Z=null),ee[5]&&ee[5]!=="<br>"?Q?Q.p(ee,ke):(Q=Ct(ee),Q.c(),Q.m(g,G)):Q&&(Q.d(1),Q=null),ce&&de.p(ee,ke),ee[6].driver_comments&&te.p(ee,ke),_e&&se.p(ee,ke),ee[3]?Ie||(Ie=yt(),Ie.c(),Ie.m(g,Ae)):Ie&&(Ie.d(1),Ie=null),ee[1]?oe?oe.p(ee,ke):(oe=wt(ee),oe.c(),oe.m(g,null)):oe&&(oe.d(1),oe=null)},i:Ne,o:Ne,d(ee){ee&&(a(e),a(h),a(v)),ge&&ge.d(),Y&&Y.d(),Z&&Z.d(),Q&&Q.d(),de&&de.d(),te&&te.d(),se&&se.d(),i[11](null),Ie&&Ie.d(),oe&&oe.d(),z=!1,Ue(K)}}}const Lt=/Teléfono:\s*(\d{10,})/;function St(i,e){for(let t=0;t<e.length;t++)if(e[t].alias===i)return e[t].val;return""}function Wn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,d=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",b="",O={latitude:null,longitude:null},k=new Object,f="",s="",m=!1,h="",v=n.comments_ext;if(ot(()=>{I()}),n.comments_ext){const P=n.comments_ext.match(Lt);P&&(h=P[1],v=n.comments_ext.replace(Lt,"").trim())}const g=async()=>{await(await Ke.create({header:"SMS enviado",message:"Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+h,buttons:[{text:"Cerrar"}]})).present()},S=async()=>{await(await Ke.create({header:"SMS no enviado",message:"Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.",buttons:[{text:"Cerrar"}]})).present()},y=async P=>{t(3,m=!0);const B=P.target.files[0],q=await R(B);if(q){const j=new FormData;j.append("fileToUpload",q);try{const G=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:j});if(G.ok){const ce=await G.json();t(1,_=ce.img),b=ce.img_id}else console.error("File upload failed:",G.statusText)}catch(G){console.error("Error during file upload:",G)}finally{t(3,m=!1)}}},R=async P=>new Promise(w=>{const B=new FileReader;B.onload=q=>{const j=new Image;j.src=q.target.result,j.onload=()=>{const G=document.createElement("canvas"),ce=G.getContext("2d"),$=800,ue=600;let _e=j.width,H=j.height;_e>$&&(H*=$/_e,_e=$),H>ue&&(_e*=ue/H,H=ue),G.width=_e,G.height=H,ce.drawImage(j,0,0,_e,H),G.toBlob(W=>{w(W)},"image/jpeg",.7)}},B.readAsDataURL(P)}),A=()=>{o.dismiss({data:Date.now()})},U=async()=>{try{if(await L()){const w={id_route:n.id_route,id_event:n.id_event,comments:d.value,img:_,img_id:b,lat:O.latitude,lon:O.longitude,...f==="0"&&{approve:"0"},...r&&{isLast:!0}},B=new FormData;for(const $ in w)B.append($,w[$]);const j=await(await fetch("https://dev.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:B})).json();A();const G={},ce=w.id_route;r&&C("","",ce,r)}}catch(P){console.error("Error fetching data:",P)}},C=(P,w,B,q)=>{o.componentProps.routeId=B,o.componentProps.driverId=n.id_driver,Fe("modal-km-gas",Zt,{checklist:P,driverId:w,routeId:B,isLast:q}).then(j=>{})},L=async()=>navigator.geolocation?new Promise((P,w)=>{navigator.geolocation.getCurrentPosition(B=>{O.latitude=B.coords.latitude,O.longitude=B.coords.longitude,P(!0)},B=>{console.error("Error getting location:",B),P(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function M(P){P.stopPropagation();const w=new FormData;w.append("client_phone",h),w.append("client_name",n.title),w.append("delivery_phone",n.client_phone),w.append("enterprise_name",n.enterprise_name);try{const B=await fetch("https://dev.rutaflow.com/api/admin/message_central/send_sms.php",{method:"POST",body:w});if(B.ok){const q=await B.json();g()}else S()}catch(B){console.error("Error during file upload:",B)}}const I=async P=>{if(n.id_enterprise){const w=new FormData;w.append("id_enterprise",n.id_enterprise);try{const B=await fetch("https://dev.rutaflow.com/api/admin/enterprise/enterprise_settings.php",{method:"POST",body:w});B.ok?(k=(await B.json()).nodos,f=St("stops_wait_approval",k),t(2,s=St("sms_active",k))):console.error("File upload failed:",B.statusText)}catch(B){console.error("Error during file upload:",B)}}};function D(P){Pe[P?"unshift":"push"](()=>{d=P,t(0,d)})}return[d,_,s,m,h,v,n,y,A,U,M,D]}class Xn extends Ze{constructor(e){super(),xe(this,e,Wn,Kn,Ye,{})}}function Pt(i){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0}),E(e).forEach(a),this.h()},h(){p(e,"name","dots")},m(t,o){F(t,e,o)},d(t){t&&a(e)}}}function Mt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){ct(t.src,o=i[0])||p(t,"src",o),p(t,"alt","Evidencia fotográfica"),V(t,"max-width","100%"),V(t,"margin-top","16px")},m(n,r){F(n,e,r),l(e,t)},p(n,r){r&1&&!ct(t.src,o=n[0])&&p(t,"src",o)},d(n){n&&a(e)}}}function Jn(i){let e,t,o,n,r="Cancelar",d,_,b="AGREGAR GASTO",O,k,f,s,m,h,v,g,S,y,R,A,U,C,L,M,I,D,P='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',w,B,q="Efectivo",j,G,ce="Tarjeta",$,ue,_e="Transferencia",H,W,x,le,ie,re,me,be,ae,Ee,Te=`<ion-icon icon="${Xt}" slot="start"></ion-icon>
                        Subir Evidencia`,Oe,Le,ze,ye,He,Ae,z,K,ge="Confirmar",Ce,ve,Y=i[5]&&Pt(),Z=i[0]&&Mt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=b,O=N(),k=c("ion-content"),f=c("ion-list"),s=c("ion-item"),m=c("ion-icon"),h=N(),v=c("ion-input"),g=N(),S=c("ion-item"),y=c("ion-icon"),R=N(),A=c("ion-input"),U=N(),C=c("ion-item"),L=c("ion-icon"),M=N(),I=c("ion-select"),D=c("div"),D.innerHTML=P,w=N(),B=c("ion-select-option"),B.textContent=q,j=N(),G=c("ion-select-option"),G.textContent=ce,$=N(),ue=c("ion-select-option"),ue.textContent=_e,H=N(),W=c("ion-item"),x=c("ion-icon"),le=N(),ie=c("ion-textarea"),re=N(),me=c("section"),be=c("label"),ae=c("ion-button"),Ee=c("label"),Ee.innerHTML=Te,Oe=N(),Le=c("input"),ze=N(),Y&&Y.c(),ye=N(),Z&&Z.c(),He=N(),Ae=c("ion-footer"),z=c("ion-toolbar"),K=c("ion-button"),K.textContent=ge,this.h()},l(Q){e=u(Q,"ION-HEADER",{translucent:!0});var de=E(e);t=u(de,"ION-TOOLBAR",{});var te=E(t);o=u(te,"ION-BUTTONS",{slot:!0});var se=E(o);n=u(se,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-1f8rjcf"&&(n.textContent=r),se.forEach(a),d=T(te),_=u(te,"ION-TITLE",{title:!0,"data-svelte-h":!0}),J(_)!=="svelte-efps2s"&&(_.textContent=b),te.forEach(a),de.forEach(a),O=T(Q),k=u(Q,"ION-CONTENT",{fullscreen:!0});var Ie=E(k);f=u(Ie,"ION-LIST",{});var oe=E(f);s=u(oe,"ION-ITEM",{});var ee=E(s);m=u(ee,"ION-ICON",{icon:!0,slot:!0}),E(m).forEach(a),h=T(ee),v=u(ee,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(v).forEach(a),ee.forEach(a),g=T(oe),S=u(oe,"ION-ITEM",{});var ke=E(S);y=u(ke,"ION-ICON",{icon:!0,slot:!0}),E(y).forEach(a),R=T(ke),A=u(ke,"ION-INPUT",{label:!0,type:!0,value:!0}),E(A).forEach(a),ke.forEach(a),U=T(oe),C=u(oe,"ION-ITEM",{});var Be=E(C);L=u(Be,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(a),M=T(Be),I=u(Be,"ION-SELECT",{placeholder:!0,value:!0});var De=E(I);D=u(De,"DIV",{slot:!0,"data-svelte-h":!0}),J(D)!=="svelte-wl764p"&&(D.innerHTML=P),w=T(De),B=u(De,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),J(B)!=="svelte-i9crym"&&(B.textContent=q),j=T(De),G=u(De,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),J(G)!=="svelte-fx0z11"&&(G.textContent=ce),$=T(De),ue=u(De,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),J(ue)!=="svelte-1c24jf2"&&(ue.textContent=_e),De.forEach(a),Be.forEach(a),H=T(oe),W=u(oe,"ION-ITEM",{});var qe=E(W);x=u(qe,"ION-ICON",{icon:!0,slot:!0}),E(x).forEach(a),le=T(qe),ie=u(qe,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ie).forEach(a),qe.forEach(a),re=T(oe),me=u(oe,"SECTION",{});var et=E(me);be=u(et,"LABEL",{for:!0,style:!0});var tt=E(be);ae=u(tt,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var fe=E(ae);Ee=u(fe,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),J(Ee)!=="svelte-1m9yw22"&&(Ee.innerHTML=Te),Oe=T(fe),Le=u(fe,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),fe.forEach(a),tt.forEach(a),et.forEach(a),ze=T(oe),Y&&Y.l(oe),ye=T(oe),Z&&Z.l(oe),oe.forEach(a),Ie.forEach(a),He=T(Q),Ae=u(Q,"ION-FOOTER",{});var je=E(Ae);z=u(je,"ION-TOOLBAR",{});var Ve=E(z);K=u(Ve,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),J(K)!=="svelte-1c7dl3f"&&(K.textContent=ge),Ve.forEach(a),je.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(_,"title",""),p(e,"translucent",""),p(m,"icon",Qt),p(m,"slot","start"),p(v,"label","Concepto"),p(v,"type","text"),p(v,"placeholder","Escribe aquí..."),p(v,"value",i[6]?i[6]:""),p(y,"icon",dt),p(y,"slot","start"),p(A,"label","Cantidad"),p(A,"type","number"),p(A,"value",i[7]?i[7]:""),p(L,"icon",pn),p(L,"slot","start"),X(D,"slot","label"),p(B,"value","cash"),p(G,"value","card"),p(ue,"value","transfer"),p(I,"placeholder","Tipo de pago"),p(I,"value",i[8]?i[8]:""),p(x,"icon",dt),p(x,"slot","start"),p(ie,"label","Comentarios"),p(ie,"placeholder","Escribe aquí..."),X(Ee,"for","eventEvidence"),V(Ee,"width","100%"),V(Ee,"padding","8px"),V(Le,"display","none"),X(Le,"id","eventEvidence"),X(Le,"name","fileToUpload"),X(Le,"type","file"),X(Le,"accept","image/*"),p(ae,"fill","outline"),p(ae,"size","small"),p(ae,"class","loadEvidence"),p(ae,"expand","block"),X(be,"for","eventEvidence"),V(be,"display","block"),V(be,"width","100%"),p(k,"fullscreen",""),p(K,"fill","outline"),p(K,"color","tertiary"),p(K,"strong",""),V(K,"width","99%"),V(K,"height","auto")},m(Q,de){F(Q,e,de),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),F(Q,O,de),F(Q,k,de),l(k,f),l(f,s),l(s,m),l(s,h),l(s,v),i[12](v),l(f,g),l(f,S),l(S,y),l(S,R),l(S,A),i[13](A),l(f,U),l(f,C),l(C,L),l(C,M),l(C,I),l(I,D),l(I,w),l(I,B),l(I,j),l(I,G),l(I,$),l(I,ue),i[14](I),l(f,H),l(f,W),l(W,x),l(W,le),l(W,ie),i[15](ie),l(f,re),l(f,me),l(me,be),l(be,ae),l(ae,Ee),l(ae,Oe),l(ae,Le),l(f,ze),Y&&Y.m(f,null),l(f,ye),Z&&Z.m(f,null),F(Q,He,de),F(Q,Ae,de),l(Ae,z),l(z,K),Ce||(ve=[ne(n,"click",i[10]),ne(Le,"change",i[9]),ne(K,"click",i[11])],Ce=!0)},p(Q,[de]){Q[5]?Y||(Y=Pt(),Y.c(),Y.m(f,ye)):Y&&(Y.d(1),Y=null),Q[0]?Z?Z.p(Q,de):(Z=Mt(Q),Z.c(),Z.m(f,null)):Z&&(Z.d(1),Z=null)},i:Ne,o:Ne,d(Q){Q&&(a(e),a(O),a(k),a(He),a(Ae)),i[12](null),i[13](null),i[14](null),i[15](null),Y&&Y.d(),Z&&Z.d(),Ce=!1,Ue(ve)}}}function Qn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,d=o.componentProps.ex_amount,_=o.componentProps.ex_type,b=o.componentProps.id_expense,O="",k="",f="",s=0,m="",h="",v=!1;ot(()=>{});const g=async(I,D)=>{await(await Ke.create({header:I||"Error",message:D||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},S=async I=>{t(5,v=!0);const P=I.target.files[0],w=await y(P);if(w){const B=new FormData;B.append("fileToUpload",w);try{const q=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:B});if(q.ok){const j=await q.json();t(0,O=j.img),k=j.img_id}else console.error("File upload failed:",q.statusText)}catch(q){console.error("Error during file upload:",q)}finally{t(5,v=!1)}}},y=async I=>new Promise(D=>{const P=new FileReader;P.onload=w=>{const B=new Image;B.src=w.target.result,B.onload=()=>{const q=document.createElement("canvas"),j=q.getContext("2d"),G=800,ce=600;let $=B.width,ue=B.height;$>G&&(ue*=G/$,$=G),ue>ce&&($*=ce/ue,ue=ce),q.width=$,q.height=ue,j.drawImage(B,0,0,$,ue),q.toBlob(_e=>{D(_e)},"image/jpeg",.7)}},P.readAsDataURL(I)}),R=()=>{rt.dismiss()},A=()=>{var I=new Object;I.id_route=n,I.comments=m.value,I.type=f.value,I.img=O,I.img_id=k,I.amount=s.value,I.concept=h.value,I.status="done",I.id_expense=b||"null";const D=new FormData;for(const P in I)D.append(P,I[P]);!k||!O||!m.value||!s.value||!h.value?g("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://dev.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:D}).then(P=>P.json()).then(P=>{R()}).catch(P=>{console.error("Error fetching data:",P)})};function U(I){Pe[I?"unshift":"push"](()=>{h=I,t(4,h)})}function C(I){Pe[I?"unshift":"push"](()=>{s=I,t(2,s)})}function L(I){Pe[I?"unshift":"push"](()=>{f=I,t(1,f)})}function M(I){Pe[I?"unshift":"push"](()=>{m=I,t(3,m)})}return[O,f,s,m,h,v,r,d,_,S,R,A,U,C,L,M]}class pt extends Ze{constructor(e){super(),xe(this,e,Qn,Jn,Ye,{})}}function At(i,e,t){const o=i.slice();return o[7]=e[t],o}function Yn(i){let e,t="Cargar gasto",o,n;function r(...d){return i[4](i[7],...d)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(d){e=u(d,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),J(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){p(e,"fill","outline"),p(e,"size","small"),p(e,"aria-selected","")},m(d,_){F(d,e,_),o||(n=ne(e,"click",r),o=!0)},p(d,_){i=d},d(d){d&&a(e),o=!1,n()}}}function Zn(i){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),J(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){p(e,"fill","solid"),p(e,"size","small"),p(e,"aria-selected","")},m(o,n){F(o,e,n)},p:Ne,d(o){o&&a(e)}}}function Bt(i,e){let t,o,n,r=e[7].concept+"",d,_,b;function O(s,m){return s[7].status=="done"?Zn:Yn}let f=O(e)(e);return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),d=he(r),_=N(),f.c(),b=N(),this.h()},l(s){t=u(s,"ION-ITEM",{});var m=E(t);o=u(m,"ION-LABEL",{style:!0});var h=E(o);n=u(h,"P",{style:!0});var v=E(n);d=pe(v,r),v.forEach(a),h.forEach(a),_=T(m),f.l(m),b=T(m),m.forEach(a),this.h()},h(){V(n,"margin-left","10px"),V(o,"display","flex"),this.first=t},m(s,m){F(s,t,m),l(t,o),l(o,n),l(n,d),l(t,_),f.m(t,null),l(t,b)},p(s,m){e=s,f.p(e,m)},d(s){s&&a(t),f.d()}}}function xn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${mn}"></ion-icon>`,d,_,b="LISTA DE GASTOS",O,k,f,s=[],m=new Map,h,v,g,S="Cerrar",y,R,A=Re(i[0]);const U=C=>C[7].id_expenses;for(let C=0;C<A.length;C+=1){let L=At(i,A,C),M=U(L);m.set(M,s[C]=Bt(M,L))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,d=N(),_=c("ion-title"),_.textContent=b,O=N(),k=c("ion-content"),f=c("ion-list");for(let C=0;C<s.length;C+=1)s[C].c();h=N(),v=c("ion-footer"),g=c("ion-button"),g.textContent=S,this.h()},l(C){e=u(C,"ION-HEADER",{translucent:!0});var L=E(e);t=u(L,"ION-TOOLBAR",{});var M=E(t);o=u(M,"ION-BUTTONS",{slot:!0});var I=E(o);n=u(I,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-160xz3i"&&(n.innerHTML=r),I.forEach(a),d=T(M),_=u(M,"ION-TITLE",{"data-svelte-h":!0}),J(_)!=="svelte-1phn90x"&&(_.textContent=b),M.forEach(a),L.forEach(a),O=T(C),k=u(C,"ION-CONTENT",{fullscreen:!0});var D=E(k);f=u(D,"ION-LIST",{});var P=E(f);for(let B=0;B<s.length;B+=1)s[B].l(P);P.forEach(a),D.forEach(a),h=T(C),v=u(C,"ION-FOOTER",{});var w=E(v);g=u(w,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),J(g)!=="svelte-zv7v83"&&(g.textContent=S),w.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","end"),p(e,"translucent",""),p(k,"fullscreen",""),p(g,"fill","outline"),p(g,"color","tertiary"),p(g,"strong",""),V(g,"width","99%"),V(g,"height","auto")},m(C,L){F(C,e,L),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),F(C,O,L),F(C,k,L),l(k,f);for(let M=0;M<s.length;M+=1)s[M]&&s[M].m(f,null);F(C,h,L),F(C,v,L),l(v,g),y||(R=[ne(n,"click",i[3]),ne(g,"click",i[1])],y=!0)},p(C,[L]){L&5&&(A=Re(C[0]),s=lt(s,L,U,1,C,A,m,f,it,Bt,null,At))},i:Ne,o:Ne,d(C){C&&(a(e),a(O),a(k),a(h),a(v));for(let L=0;L<s.length;L+=1)s[L].d();y=!1,Ue(R)}}}function $n(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;ot(()=>{});const o=()=>{rt.dismiss()};function n(_,b,O,k,f){e.componentProps.ex_amount=O,e.componentProps.ex_concept=b,e.componentProps.ex_type=k,e.componentProps.id_expense=f,Fe("modal-expense",pt,{amount:O,concept:b,type:k,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{Fe("modal-expense",pt,{routeId:_}).then(b=>{}),o()},(_,b)=>n(b,_.concept,_.amount,_.type,_.id_expenses)]}class eo extends Ze{constructor(e){super(),xe(this,e,$n,xn,Ye,{})}}const{document:Dt}=On;function zt(i,e,t){const o=i.slice();return o[34]=e[t],o}function Ht(i,e,t){const o=i.slice();return o[34]=e[t],o[36]=t,o}function Rt(i,e,t){const o=i.slice();return o[34]=e[t],o[36]=t,o}function Ut(i){let e,t;return e=new En({props:{$$slots:{default:[ao]},$$scope:{ctx:i}}}),{c(){ln(e.$$.fragment)},l(o){rn(e.$$.fragment,o)},m(o,n){an(e,o,n),t=!0},p(o,n){const r={};n[0]&1019|n[1]&512&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(st(e.$$.fragment,o),t=!0)},o(o){_t(e.$$.fragment,o),t=!1},d(o){sn(e,o)}}}function to(i){let e,t='<div id="g_map" style="width: 100%; height: 100vh;"></div>';return{c(){e=c("ion-content"),e.innerHTML=t},l(o){e=u(o,"ION-CONTENT",{"data-svelte-h":!0}),J(e)!=="svelte-1ydw6i9"&&(e.innerHTML=t)},m(o,n){F(o,e,n)},p:Ne,d(o){o&&a(e)}}}function no(i){let e;function t(r,d){if(r[7].length>0)return lo;if(!r[3])return oo}let o=t(i),n=o&&o(i);return{c(){n&&n.c(),e=Me()},l(r){n&&n.l(r),e=Me()},m(r,d){n&&n.m(r,d),F(r,e,d)},p(r,d){o===(o=t(r))&&n?n.p(r,d):(n&&n.d(1),n=o&&o(r),n&&(n.c(),n.m(e.parentNode,e)))},d(r){r&&a(e),n&&n.d(r)}}}function oo(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,d,_=[],b=new Map,O,k,f=i[4]&&Ft(i),s=Re(i[5]);const m=h=>h[34].id_event;for(let h=0;h<s.length;h+=1){let v=zt(i,s,h),g=m(v);b.set(g,_[h]=jt(g,v))}return{c(){f&&f.c(),e=N(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=N(),d=c("ion-list");for(let h=0;h<_.length;h+=1)_[h].c();this.h()},l(h){f&&f.l(h),e=T(h),t=u(h,"ION-CONTENT",{});var v=E(t);o=u(v,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(o)!=="svelte-1srnbs3"&&(o.innerHTML=n),r=T(v),d=u(v,"ION-LIST",{});var g=E(d);for(let S=0;S<_.length;S+=1)_[S].l(g);g.forEach(a),v.forEach(a),this.h()},h(){p(o,"slot","fixed")},m(h,v){f&&f.m(h,v),F(h,e,v),F(h,t,v),l(t,o),i[26](o),l(t,r),l(t,d);for(let g=0;g<_.length;g+=1)_[g]&&_[g].m(d,null);O||(k=ne(o,"ionRefresh",i[10]),O=!0)},p(h,v){h[4]?f?f.p(h,v):(f=Ft(h),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),v[0]&167968&&(s=Re(h[5]),_=lt(_,v,m,1,h,s,b,d,it,jt,null,zt))},d(h){h&&(a(e),a(t)),f&&f.d(h),i[26](null);for(let v=0;v<_.length;v+=1)_[v].d();O=!1,k()}}}function lo(i){let e,t;function o(d,_){return _[0]&144&&(e=null),e==null&&(e=!!(d[7].filter(uo).every(fo)&&!d[4])),e?ro:io}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Me()},l(d){r.l(d),t=Me()},m(d,_){r.m(d,_),F(d,t,_)},p(d,_){n===(n=o(d,_))&&r?r.p(d,_):(r.d(1),r=n(d),r&&(r.c(),r.m(t.parentNode,t)))},d(d){d&&a(t),r.d(d)}}}function Ft(i){let e=i[13]("",i[1],i[0])+"",t;return{c(){t=he(e)},l(o){t=pe(o,e)},m(o,n){F(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[13]("",o[1],o[0])+"")&&we(t,e)},d(o){o&&a(t)}}}function qt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){X(e,"class","notes svelte-egzizz")},m(t,o){F(t,e,o)},d(t){t&&a(e)}}}function jt(i,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,b,O,k,f,s,m=e[34].title+"",h,v,g=e[34].support_list&&e[34].support_list.length||e[15](e[34]),S,y,R,A,U,C=g&&qt();function L(){return e[27](e[34])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=he(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=he(m),v=N(),C&&C.c(),S=N(),y=c("ion-icon"),R=N(),this.h()},l(M){t=u(M,"ION-ITEM",{});var I=E(t);o=u(I,"ION-AVATAR",{slot:!0});var D=E(o);n=u(D,"DIV",{class:!0,title:!0,style:!0});var P=E(n);r=u(P,"DIV",{class:!0});var w=E(r);_=pe(w,d),w.forEach(a),P.forEach(a),D.forEach(a),O=T(I),k=u(I,"ION-LABEL",{button:!0});var B=E(k);f=u(B,"ION-TEXT",{color:!0});var q=E(f);s=u(q,"H3",{});var j=E(s);h=pe(j,m),v=T(j),C&&C.l(j),j.forEach(a),q.forEach(a),B.forEach(a),S=T(I),y=u(I,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(y).forEach(a),R=T(I),I.forEach(a),this.h()},h(){X(r,"class","order svelte-egzizz"),X(n,"class","order-wrapper svelte-egzizz"),X(n,"title",b=Je(e[34].status)),V(n,"background-color",Se(e[34].status)),V(n,"color",Qe(Se(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),p(k,"button",""),p(y,"icon",$e),p(y,"slot","end"),V(y,"color",Se(e[34].status)),this.first=t},m(M,I){F(M,t,I),l(t,o),l(o,n),l(n,r),l(r,_),l(t,O),l(t,k),l(k,f),l(f,s),l(s,h),l(s,v),C&&C.m(s,null),l(t,S),l(t,y),l(t,R),A||(U=ne(k,"click",L),A=!0)},p(M,I){e=M,I[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&we(_,d),I[0]&32&&b!==(b=Je(e[34].status))&&X(n,"title",b),I[0]&32&&V(n,"background-color",Se(e[34].status)),I[0]&32&&V(n,"color",Qe(Se(e[34].status))),I[0]&32&&m!==(m=e[34].title+"")&&we(h,m),I[0]&32&&(g=e[34].support_list&&e[34].support_list.length||e[15](e[34])),g?C||(C=qt(),C.c(),C.m(s,null)):C&&(C.d(1),C=null),I[0]&32&&V(y,"color",Se(e[34].status))},d(M){M&&a(t),C&&C.d(),A=!1,U()}}}function io(i){let e=i[13](i[7],i[1],i[0])+"",t,o,n,r,d='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,b,O=[],k=new Map,f,s,m=Re(i[5]);const h=v=>v[34].id_event;for(let v=0;v<m.length;v+=1){let g=Ht(i,m,v),S=h(g);k.set(S,O[v]=Gt(S,g))}return{c(){t=he(e),o=N(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=d,_=N(),b=c("ion-list");for(let v=0;v<O.length;v+=1)O[v].c();this.h()},l(v){t=pe(v,e),o=T(v),n=u(v,"ION-CONTENT",{});var g=E(n);r=u(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(r)!=="svelte-dvt1s"&&(r.innerHTML=d),_=T(g),b=u(g,"ION-LIST",{});var S=E(b);for(let y=0;y<O.length;y+=1)O[y].l(S);S.forEach(a),g.forEach(a),this.h()},h(){p(r,"slot","fixed")},m(v,g){F(v,t,g),F(v,o,g),F(v,n,g),l(n,r),i[24](r),l(n,_),l(n,b);for(let S=0;S<O.length;S+=1)O[S]&&O[S].m(b,null);f||(s=ne(r,"ionRefresh",i[10]),f=!0)},p(v,g){g[0]&131&&e!==(e=v[13](v[7],v[1],v[0])+"")&&we(t,e),g[0]&299040&&(m=Re(v[5]),O=lt(O,g,h,1,v,m,k,b,it,Gt,null,Ht))},d(v){v&&(a(t),a(o),a(n)),i[24](null);for(let g=0;g<O.length;g+=1)O[g].d();f=!1,s()}}}function ro(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,d=[],_=new Map,b,O,k=Re(i[5]);const f=s=>s[34].id_event;for(let s=0;s<k.length;s+=1){let m=Rt(i,k,s),h=f(m);_.set(h,d[s]=Wt(h,m))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=N(),r=c("ion-list");for(let s=0;s<d.length;s+=1)d[s].c();this.h()},l(s){e=u(s,"ION-CONTENT",{});var m=E(e);t=u(m,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(t)!=="svelte-15ukrgn"&&(t.innerHTML=o),n=T(m),r=u(m,"ION-LIST",{});var h=E(r);for(let v=0;v<d.length;v+=1)d[v].l(h);h.forEach(a),m.forEach(a),this.h()},h(){p(t,"slot","fixed")},m(s,m){F(s,e,m),l(e,t),i[22](t),l(e,n),l(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(r,null);b||(O=ne(t,"ionRefresh",i[10]),b=!0)},p(s,m){m[0]&299040&&(k=Re(s[5]),d=lt(d,m,f,1,s,k,_,r,it,Wt,null,Rt))},d(s){s&&a(e),i[22](null);for(let m=0;m<d.length;m+=1)d[m].d();b=!1,O()}}}function Vt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){X(e,"class","notes svelte-egzizz")},m(t,o){F(t,e,o)},d(t){t&&a(e)}}}function Gt(i,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,b,O,k,f,s,m=e[34].title+"",h,v,g=e[34].support_list&&e[34].support_list.length||e[15](e[34]),S,y,R="",A,U,C,L,M,I=g&&Vt();function D(){return e[25](e[34],e[36])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=he(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=he(m),v=N(),I&&I.c(),S=N(),y=c("div"),y.innerHTML=R,A=N(),U=c("ion-icon"),C=N(),this.h()},l(P){t=u(P,"ION-ITEM",{});var w=E(t);o=u(w,"ION-AVATAR",{slot:!0});var B=E(o);n=u(B,"DIV",{class:!0,title:!0,style:!0});var q=E(n);r=u(q,"DIV",{class:!0});var j=E(r);_=pe(j,d),j.forEach(a),q.forEach(a),B.forEach(a),O=T(w),k=u(w,"ION-LABEL",{button:!0});var G=E(k);f=u(G,"ION-TEXT",{color:!0});var ce=E(f);s=u(ce,"H3",{});var $=E(s);h=pe($,m),v=T($),I&&I.l($),$.forEach(a),ce.forEach(a),S=T(G),y=u(G,"DIV",{class:!0,"data-svelte-h":!0}),J(y)!=="svelte-qaecoo"&&(y.innerHTML=R),G.forEach(a),A=T(w),U=u(w,"ION-ICON",{icon:!0,slot:!0}),E(U).forEach(a),C=T(w),w.forEach(a),this.h()},h(){X(r,"class","order svelte-egzizz"),X(n,"class","order-wrapper svelte-egzizz"),X(n,"title",b=Je(e[34].status)),V(n,"background-color",Se(e[34].status)),V(n,"color",Qe(Se(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),X(y,"class","sub svelte-egzizz"),p(k,"button",""),p(U,"icon",$e),p(U,"slot","end"),this.first=t},m(P,w){F(P,t,w),l(t,o),l(o,n),l(n,r),l(r,_),l(t,O),l(t,k),l(k,f),l(f,s),l(s,h),l(s,v),I&&I.m(s,null),l(k,S),l(k,y),l(t,A),l(t,U),l(t,C),L||(M=ne(k,"click",D),L=!0)},p(P,w){e=P,w[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&we(_,d),w[0]&32&&b!==(b=Je(e[34].status))&&X(n,"title",b),w[0]&32&&V(n,"background-color",Se(e[34].status)),w[0]&32&&V(n,"color",Qe(Se(e[34].status))),w[0]&32&&m!==(m=e[34].title+"")&&we(h,m),w[0]&32&&(g=e[34].support_list&&e[34].support_list.length||e[15](e[34])),g?I||(I=Vt(),I.c(),I.m(s,null)):I&&(I.d(1),I=null)},d(P){P&&a(t),I&&I.d(),L=!1,M()}}}function Kt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){X(e,"class","notes svelte-egzizz")},m(t,o){F(t,e,o)},d(t){t&&a(e)}}}function Wt(i,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,b,O,k,f,s,m=e[34].title+"",h,v,g=e[34].support_list&&e[34].support_list.length||e[15](e[34]),S,y,R="",A,U,C,L,M,I=g&&Kt();function D(){return e[23](e[34],e[36])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=he(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=he(m),v=N(),I&&I.c(),S=N(),y=c("div"),y.innerHTML=R,A=N(),U=c("ion-icon"),C=N(),this.h()},l(P){t=u(P,"ION-ITEM",{});var w=E(t);o=u(w,"ION-AVATAR",{slot:!0});var B=E(o);n=u(B,"DIV",{class:!0,title:!0,style:!0});var q=E(n);r=u(q,"DIV",{class:!0});var j=E(r);_=pe(j,d),j.forEach(a),q.forEach(a),B.forEach(a),O=T(w),k=u(w,"ION-LABEL",{button:!0});var G=E(k);f=u(G,"ION-TEXT",{color:!0});var ce=E(f);s=u(ce,"H3",{});var $=E(s);h=pe($,m),v=T($),I&&I.l($),$.forEach(a),ce.forEach(a),S=T(G),y=u(G,"DIV",{class:!0,"data-svelte-h":!0}),J(y)!=="svelte-qaecoo"&&(y.innerHTML=R),G.forEach(a),A=T(w),U=u(w,"ION-ICON",{icon:!0,slot:!0}),E(U).forEach(a),C=T(w),w.forEach(a),this.h()},h(){X(r,"class","order svelte-egzizz"),X(n,"class","order-wrapper svelte-egzizz"),X(n,"title",b=Je(e[34].status)),V(n,"background-color",Se(e[34].status)),V(n,"color",Qe(Se(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),X(y,"class","sub svelte-egzizz"),p(k,"button",""),p(U,"icon",$e),p(U,"slot","end"),this.first=t},m(P,w){F(P,t,w),l(t,o),l(o,n),l(n,r),l(r,_),l(t,O),l(t,k),l(k,f),l(f,s),l(s,h),l(s,v),I&&I.m(s,null),l(k,S),l(k,y),l(t,A),l(t,U),l(t,C),L||(M=ne(k,"click",D),L=!0)},p(P,w){e=P,w[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&we(_,d),w[0]&32&&b!==(b=Je(e[34].status))&&X(n,"title",b),w[0]&32&&V(n,"background-color",Se(e[34].status)),w[0]&32&&V(n,"color",Qe(Se(e[34].status))),w[0]&32&&m!==(m=e[34].title+"")&&we(h,m),w[0]&32&&(g=e[34].support_list&&e[34].support_list.length||e[15](e[34])),g?I||(I=Kt(),I.c(),I.m(s,null)):I&&(I.d(1),I=null)},d(P){P&&a(t),I&&I.d(),L=!1,M()}}}function ao(i){let e,t,o,n,r=`<ion-icon icon="${vn}"></ion-icon>`,d,_,b,O=`<ion-icon icon="${gn}"></ion-icon>`,k,f,s=(i[6].name?i[6].name.toUpperCase():"")+"",m,h,v,g='<ion-segment-button value="list"><ion-label>Paradas</ion-label></ion-segment-button> <ion-segment-button value="map"><ion-label>Mapa</ion-label></ion-segment-button>',S,y,R,A;function U(M,I){if(M[9]==="list")return no;if(M[9]==="map")return to}let C=U(i),L=C&&C(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,d=N(),_=c("ion-buttons"),b=c("ion-button"),b.innerHTML=O,k=N(),f=c("ion-title"),m=he(s),h=N(),v=c("ion-segment"),v.innerHTML=g,S=N(),L&&L.c(),y=Me(),this.h()},l(M){e=u(M,"ION-HEADER",{translucent:!0});var I=E(e);t=u(I,"ION-TOOLBAR",{});var D=E(t);o=u(D,"ION-BUTTONS",{slot:!0});var P=E(o);n=u(P,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),J(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),P.forEach(a),d=T(D),_=u(D,"ION-BUTTONS",{slot:!0});var w=E(_);b=u(w,"ION-BUTTON",{"data-svelte-h":!0}),J(b)!=="svelte-nf50hj"&&(b.innerHTML=O),w.forEach(a),k=T(D),f=u(D,"ION-TITLE",{});var B=E(f);m=pe(B,s),B.forEach(a),D.forEach(a),h=T(I),v=u(I,"ION-SEGMENT",{value:!0,"data-svelte-h":!0}),J(v)!=="svelte-lue4c9"&&(v.innerHTML=g),I.forEach(a),S=T(M),L&&L.l(M),y=Me(),this.h()},h(){p(n,"title","Atrás"),p(n,"alt","Atrás"),p(o,"slot","start"),p(_,"slot","end"),p(v,"value","list"),p(e,"translucent","")},m(M,I){F(M,e,I),l(e,t),l(t,o),l(o,n),l(t,d),l(t,_),l(_,b),l(t,k),l(t,f),l(f,m),l(e,h),l(e,v),F(M,S,I),L&&L.m(M,I),F(M,y,I),R||(A=[ne(n,"click",i[16]),ne(b,"click",i[20]),ne(v,"ionChange",i[21])],R=!0)},p(M,I){I[0]&64&&s!==(s=(M[6].name?M[6].name.toUpperCase():"")+"")&&we(m,s),C===(C=U(M))&&L?L.p(M,I):(L&&L.d(1),L=C&&C(M),L&&(L.c(),L.m(y.parentNode,y)))},d(M){M&&(a(e),a(S),a(y)),L&&L.d(M),R=!1,Ue(A)}}}function so(i){let e,t,o,n=i[2]&&Ut(i);return{c(){e=N(),n&&n.c(),t=Me(),this.h()},l(r){en("svelte-kn0kph",Dt.head).forEach(a),e=T(r),n&&n.l(r),t=Me(),this.h()},h(){Dt.title="Rutaflow - Detalles de ruta"},m(r,d){F(r,e,d),n&&n.m(r,d),F(r,t,d),o=!0},p(r,d){r[2]?n?(n.p(r,d),d[0]&4&&st(n,1)):(n=Ut(r),n.c(),st(n,1),n.m(t.parentNode,t)):n&&(cn(),_t(n,1,1,()=>{n=null}),on())},i(r){o||(st(n),o=!0)},o(r){_t(n),o=!1},d(r){r&&(a(e),a(t)),n&&n.d(r)}}}function Se(i){let e="#ffffff";return i==="pending"?e="#f2e300":i==="completed"&&(e="#44d900"),e}function Je(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function Qe(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function co(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const uo=i=>i.mandatory==="1",fo=i=>i.img;function _o(i,e,t){let o;tn(i,bn,H=>t(19,o=H));var n=this&&this.__awaiter||function(H,W,x,le){function ie(re){return re instanceof x?re:new x(function(me){me(re)})}return new(x||(x=Promise))(function(re,me){function be(Te){try{Ee(le.next(Te))}catch(Oe){me(Oe)}}function ae(Te){try{Ee(le.throw(Te))}catch(Oe){me(Oe)}}function Ee(Te){Te.done?re(Te.value):ie(Te.value).then(be,ae)}Ee((le=le.apply(H,W||[])).next())})};let{routeId:r}=e,{driverId:d}=e,_=new Object,b=!0,O=!1,k=[],f={},s=[],m=[],h,v=!1,g="list",S;const y=()=>n(void 0,void 0,void 0,function*(){yield A(r),h.complete()});ot(()=>n(void 0,void 0,void 0,function*(){yield A(r)}));function R(H){return n(this,void 0,void 0,function*(){if(t(9,g=H),g==="map"){yield nn(),S=document.getElementById("g_map");const W=new google.maps.Map(S,{zoom:8,center:{lat:20.6745683,lng:-103.3986104},mapId:"4504f8b37365c3d0"}),x=new google.maps.LatLngBounds,{AdvancedMarkerElement:le,PinElement:ie}=yield google.maps.importLibrary("marker");navigator.geolocation?navigator.geolocation.getCurrentPosition(function(re){const me=new google.maps.LatLng(re.coords.latitude,re.coords.longitude);new google.maps.Circle({strokeColor:"#00BFFF",strokeOpacity:.2,strokeWeight:0,fillColor:"#00BFFF",fillOpacity:.2,map:W,center:me,radius:150}),new google.maps.Circle({strokeColor:"#FFFFFF",strokeOpacity:1,strokeWeight:3,fillColor:"#0062ff",fillOpacity:1,map:W,center:me,radius:35}),x.extend(me)},function(re){console.error("Error retrieving location:",re)}):console.error("Geolocation not supported by this browser."),k.forEach((re,me)=>{const be=parseFloat(re.lat),ae=parseFloat(re.lon),Ee=new google.maps.LatLng(be,ae),Te=new google.maps.Marker({position:{lat:be,lng:ae},map:W,title:re.title}),Oe=new ie({background:Se(re.status),borderColor:"#000",glyphColor:"#000",glyph:(parseInt(re.pos)+1).toString()});new le({map:W,position:Ee,content:Oe.element,title:"Parada "+(parseInt(re.pos)+1).toString()+": "+re.title}).addListener("click",function(ze){C(re,w(me))}),x.extend(Te.getPosition())}),W.fitBounds(x)}})}function A(H){return n(this,void 0,void 0,function*(){const W=new FormData;W.append("id_route",H);try{const le=yield(yield fetch("https://dev.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:W})).json();t(6,f=le.data.seguimiento_list[0]),t(5,k=le.data.event_list),t(7,s=le.data.checklist),m=le.data.expenses,f&&t(4,O=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,b=!1)}catch(x){t(3,b=!1),console.error("Error fetching data:",x)}})}const U=H=>new Promise((W,x)=>{const le=new FormData;le.append("id_route",H.id_route),le.append("id_event",H.id_event),fetch("https://dev.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:le}).then(ie=>ie.json()).then(ie=>{W(ie.data.event_evidence[0])}).catch(ie=>{console.error("Error fetching data:",ie),x(ie)})}),C=(H,W)=>{U(H).then(x=>{x&&(H.img=x.img,H.driver_comments=x.driver_comments,H.comments=x.comments),Fe("modal-delivery-info",Xn,{delivery:H,isLast:W}).then(le=>{}).finally(()=>{A(r)})})},L=(H,W,x)=>{var le=!1;return v||(v=!0,Fe("modal-checklist",Zt,{checklist:H,driverId:W,routeId:x,isLast:le}).then(ie=>{v=!1}),co(x,"checklist")),""},M=H=>n(void 0,void 0,void 0,function*(){return yield A(H),m.length>0?Fe("modal-expense-detail",eo,{routeId:H,expenses:m}).then(W=>{}):Fe("modal-expense",pt,{routeId:H}).then(W=>{}),""}),I=H=>{if(H.tracking_type=="subscription"){if(H.subscriber_info&&H.payment_type==="cash"&&new Date(H.subscriber_info.payment_next)<new Date)return!0}else if(H.tracking_type=="ecommerce"&&Number(H.payment_pending)>0)return!0;return!1},D=()=>{_.id_driver?Ge(`/drivers/${_.id_driver}`):Ge("/drivers/me")},P=(H,W)=>n(void 0,void 0,void 0,function*(){yield(yield Ke.create({header:H||"Error",message:W||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function w(H){return H===k.length-1}const B=()=>M(r),q=H=>R(H.detail.value);function j(H){Pe[H?"unshift":"push"](()=>{h=H,t(8,h)})}const G=(H,W)=>C(H,w(W));function ce(H){Pe[H?"unshift":"push"](()=>{h=H,t(8,h)})}const $=(H,W)=>C(H,w(W));function ue(H){Pe[H?"unshift":"push"](()=>{h=H,t(8,h)})}const _e=H=>{const W=k.findIndex(me=>me.id_event===H.id_event),x=W===0,le=W>0?k[W-1]:null,ie=x||le&&le.img!==null,re=H.img!==null&&H.img!=="";ie||x&&!re?C(H):P("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=H=>{"routeId"in H&&t(0,r=H.routeId),"driverId"in H&&t(1,d=H.driverId)},i.$$.update=()=>{i.$$.dirty[0]&524293&&(t(0,{routeId:r,driverId:d}=o.params,r,(t(1,d),t(19,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="superadmin")?(A(r),Ge(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(A(r),Ge(`/drivers/${_.id_driver}/routes/${r}`)):Ge("/"))},[r,d,_,b,O,k,f,s,h,g,y,R,C,L,M,I,D,P,w,o,B,q,j,G,ce,$,ue,_e]}class Io extends Ze{constructor(e){super(),xe(this,e,_o,so,Ye,{routeId:0,driverId:1},null,[-1,-1])}}export{Io as component};
