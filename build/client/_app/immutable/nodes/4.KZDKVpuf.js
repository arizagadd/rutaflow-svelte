import{s as de,j as U,k as Z,l as _e,h as d,m as q,i as z,p as pe,e as g,t as j,b,q as N,r as J,d as K,f as V,v as R,w as u,x as Q,y as W,z as he,A as se,n as me,B as Y,C as ve}from"../chunks/index.CdEBkEwf.js";import{S as ge,i as be,t as X,a as x,c as ke,b as ye,d as Ie,m as Ee,e as Te,g as Oe}from"../chunks/index.Dw8w8a4z.js";import{I as Ne,g as Se,l as Re,p as we,e as ie,u as Ae,d as De}from"../chunks/index.Cu3w5aUh.js";import"../chunks/index-6e05b96e.C_9q9BoX.js";import{a as Le,D as Ce}from"../chunks/overlays-b874c3c3.lKAmWwNI.js";import{g as F}from"../chunks/entry.DTfJnh1-.js";function le(n,e,a){const o=n.slice();return o[20]=e[a],o}function re(n){let e,a;return e=new Ne({props:{$$slots:{default:[Me]},$$scope:{ctx:n}}}),{c(){ye(e.$$.fragment)},l(o){Ie(e.$$.fragment,o)},m(o,t){Ee(e,o,t),a=!0},p(o,t){const i={};t&8388639&&(i.$$scope={dirty:t,ctx:o}),e.$set(i)},i(o){a||(X(e.$$.fragment,o),a=!0)},o(o){x(e.$$.fragment,o),a=!1},d(o){Te(e,o)}}}function He(n){let e,a='<ion-row class="h-full items-center"><ion-col class="text-center"><h2 class="text-3xl text-muted mb-4 svelte-13map4f">No hay rutas pendientes para hoy</h2> <p class="text-muted svelte-13map4f">Espere indicaciones de su supervisor</p></ion-col></ion-row>';return{c(){e=g("ion-grid"),e.innerHTML=a,this.h()},l(o){e=b(o,"ION-GRID",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-g63gp8"&&(e.innerHTML=a),this.h()},h(){R(e,"class","ion-text-center h-full")},m(o,t){z(o,e,t)},p:me,d(o){o&&d(e)}}}function Be(n){let e=[],a=new Map,o,t=ie(n[1]);const i=s=>s[20].id_route;for(let s=0;s<t.length;s+=1){let r=le(n,t,s),_=i(r);a.set(_,e[s]=ue(_,r))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();o=Z()},l(s){for(let r=0;r<e.length;r+=1)e[r].l(s);o=Z()},m(s,r){for(let _=0;_<e.length;_+=1)e[_]&&e[_].m(s,r);z(s,o,r)},p(s,r){r&386&&(t=ie(s[1]),e=Ae(e,r,i,1,s,t,a,o.parentNode,De,ue,o,le))},d(s){s&&d(o);for(let r=0;r<e.length;r+=1)e[r].d(s)}}}function ue(n,e){var C,l;let a,o,t,i,s=e[8]((C=e[20].name)==null?void 0:C.charAt(0))+"",r,_,D,T,p,h=((l=e[20].name)==null?void 0:l.toUpperCase())+"",w,I,k,L,A=e[20].date_start+"",S,E,B,M;return{key:n,first:null,c(){a=g("ion-item"),o=g("ion-avatar"),t=g("div"),i=g("div"),r=j(s),D=U(),T=g("ion-label"),p=g("h2"),w=j(h),I=U(),k=g("h3"),L=j("Inicio: "),S=j(A),E=U(),this.h()},l(y){a=b(y,"ION-ITEM",{button:!0});var c=N(a);o=b(c,"ION-AVATAR",{slot:!0});var m=N(o);t=b(m,"DIV",{class:!0,style:!0,title:!0});var f=N(t);i=b(f,"DIV",{class:!0});var v=N(i);r=J(v,s),v.forEach(d),f.forEach(d),m.forEach(d),D=q(c),T=b(c,"ION-LABEL",{});var O=N(T);p=b(O,"H2",{});var H=N(p);w=J(H,h),H.forEach(d),I=q(O),k=b(O,"H3",{class:!0});var P=N(k);L=J(P,"Inicio: "),S=J(P,A),P.forEach(d),O.forEach(d),E=q(c),c.forEach(d),this.h()},h(){V(i,"class","route-symbol svelte-13map4f"),V(t,"class","route-color svelte-13map4f"),Y(t,"background-color",$(e[20].status)),Y(t,"color",fe($(e[20].status))),V(t,"title",_=ce(e[20].status)),R(o,"slot","start"),V(k,"class","text-muted svelte-13map4f"),R(a,"button",""),this.first=a},m(y,c){z(y,a,c),u(a,o),u(o,t),u(t,i),u(i,r),u(a,D),u(a,T),u(T,p),u(p,w),u(T,I),u(T,k),u(k,L),u(k,S),u(a,E),B||(M=Q(a,"click",function(){ve(e[7](e[20].id_route,e[20].status))&&e[7](e[20].id_route,e[20].status).apply(this,arguments)}),B=!0)},p(y,c){var m,f;e=y,c&2&&s!==(s=e[8]((m=e[20].name)==null?void 0:m.charAt(0))+"")&&W(r,s),c&2&&Y(t,"background-color",$(e[20].status)),c&2&&Y(t,"color",fe($(e[20].status))),c&2&&_!==(_=ce(e[20].status))&&V(t,"title",_),c&2&&h!==(h=((f=e[20].name)==null?void 0:f.toUpperCase())+"")&&W(w,h),c&2&&A!==(A=e[20].date_start+"")&&W(S,A)},d(y){y&&d(a),B=!1,M()}}}function Me(n){let e,a,o,t,i,s=n[0].name+"",r,_,D,T,p,h='<ion-select-option value="enroute">Rutas en curso</ion-select-option> <ion-select-option value="routes-of-day">Rutas del día</ion-select-option> <ion-select-option value="yesterday-routes">Rutas de ayer</ion-select-option> <ion-select-option value="week-routes">Rutas de la semana</ion-select-option>',w,I,k,L=`<ion-icon icon="${Re}"></ion-icon>`,A,S,E,B='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',M,C,l,y;function c(v,O){return v[2]?Be:He}let m=c(n),f=m(n);return{c(){e=g("ion-header"),a=g("ion-toolbar"),o=g("ion-buttons"),t=g("ion-button"),i=g("span"),r=j(s),D=U(),T=g("ion-title"),p=g("ion-select"),p.innerHTML=h,w=U(),I=g("ion-buttons"),k=g("ion-button"),k.innerHTML=L,A=U(),S=g("ion-content"),E=g("ion-refresher"),E.innerHTML=B,M=U(),C=g("ion-list"),f.c(),this.h()},l(v){e=b(v,"ION-HEADER",{translucent:!0});var O=N(e);a=b(O,"ION-TOOLBAR",{});var H=N(a);o=b(H,"ION-BUTTONS",{slot:!0});var P=N(o);t=b(P,"ION-BUTTON",{class:!0,title:!0});var ee=N(t);i=b(ee,"SPAN",{class:!0});var te=N(i);r=J(te,s),te.forEach(d),ee.forEach(d),P.forEach(d),D=q(H),T=b(H,"ION-TITLE",{});var ne=N(T);p=b(ne,"ION-SELECT",{id:!0,interface:!0,value:!0,"data-svelte-h":!0}),K(p)!=="svelte-npp4es"&&(p.innerHTML=h),ne.forEach(d),w=q(H),I=b(H,"ION-BUTTONS",{slot:!0});var ae=N(I);k=b(ae,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),K(k)!=="svelte-1uwf95q"&&(k.innerHTML=L),ae.forEach(d),H.forEach(d),O.forEach(d),A=q(v),S=b(v,"ION-CONTENT",{});var G=N(S);E=b(G,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(E)!=="svelte-1m9d3bo"&&(E.innerHTML=B),M=q(G),C=b(G,"ION-LIST",{});var oe=N(C);f.l(oe),oe.forEach(d),G.forEach(d),this.h()},h(){V(i,"class","name-span svelte-13map4f"),R(t,"class","name-btn svelte-13map4f"),R(t,"title",_=n[0].name),R(o,"slot","start"),R(p,"id","quick-filter"),R(p,"interface","action-sheet"),R(p,"value","routes-of-day"),R(k,"title","Salir"),R(k,"alt","Salir"),R(I,"slot","end"),R(e,"translucent",""),R(E,"slot","fixed")},m(v,O){z(v,e,O),u(e,a),u(a,o),u(o,t),u(t,i),u(i,r),u(a,D),u(a,T),u(T,p),n[12](p),u(a,w),u(a,I),u(I,k),z(v,A,O),z(v,S,O),u(S,E),n[13](E),u(S,M),u(S,C),f.m(C,null),l||(y=[Q(p,"ionChange",n[6]),Q(k,"click",n[9]),Q(E,"ionRefresh",n[5])],l=!0)},p(v,O){O&1&&s!==(s=v[0].name+"")&&W(r,s),O&1&&_!==(_=v[0].name)&&R(t,"title",_),m===(m=c(v))&&f?f.p(v,O):(f.d(1),f=m(v),f&&(f.c(),f.m(C,null)))},d(v){v&&(d(e),d(A),d(S)),n[12](null),n[13](null),f.d(),l=!1,he(y)}}}function Ue(n){let e,a,o,t=n[0]&&re(n);return{c(){e=U(),t&&t.c(),a=Z(),this.h()},l(i){_e("svelte-qavk4j",document.head).forEach(d),e=q(i),t&&t.l(i),a=Z(),this.h()},h(){document.title="Rutas - Rutaflow"},m(i,s){z(i,e,s),t&&t.m(i,s),z(i,a,s),o=!0},p(i,[s]){i[0]?t?(t.p(i,s),s&1&&X(t,1)):(t=re(i),t.c(),X(t,1),t.m(a.parentNode,a)):t&&(Oe(),x(t,1,1,()=>{t=null}),ke())},i(i){o||(X(t),o=!0)},o(i){x(t),o=!1},d(i){i&&(d(e),d(a)),t&&t.d(i)}}}function $(n){let e="#ffffff";return n==="pending"?e="#FAD733":n==="completed"?e="#27C24C":n=="enroute"?e="#3BBAC2":n=="paused"?e="#949DB9":n=="cancelled"?e="#F05050":n=="checklist"?e="#F6A833":n=="checklist-pending"&&(e="#E98C00"),e}function ce(n){let e="";return n==="pending"?e="Pendiente":n==="completed"?e="Completado":n=="enroute"?e="En ruta":n=="paused"?e="Pausado":n=="cancelled"?e="Cancelado":n=="checklist"?e="En checklist":n=="checklist-pending"&&(e="Pendiente de aprobar checklist"),e}function fe(n){n.slice(0,1)==="#"&&(n=n.slice(1)),n.length===3&&(n=n.split("").map(function(i){return i+i}).join(""));const e=parseInt(n.substr(0,2),16),a=parseInt(n.substr(2,2),16),o=parseInt(n.substr(4,2),16);return(e*299+a*587+o*114)/1e3>=128?"#414040":"#fff"}function qe(){var n=new Date,e=n.getDate(),a=n.getMonth()+1,o=n.getFullYear(),t=o+"-"+a+"-"+e;return{today:t,year:o,month:a,date:n,day:e}}function ze(n,e,a){let o;pe(n,we,l=>a(11,o=l));let{driverId:t}=e,i=Ce,s=[],r=[],_=[],D=[],T=!1,p=!1,h=new Object,w,I="routes-of-day";const k=async()=>{await L(),w.complete()};function L(){const l={id_enterprise:h.id_enterprise||"null",id_user_over:h.id_user,token:h.token},y=(I==null?void 0:I.value)||I,c=qe();if(y==="enroute")l.status="enroute";else if(y==="routes-of-day")l.actual_date=c.today;else if(y==="yesterday-routes"){let m=new Date(c.date);m.setDate(m.getDate()-1),l.actual_date=m.toISOString().split("T")[0]}else if(y==="week-routes"){let m=new Date(c.date),f=c.date.getDay()===0?6:c.date.getDay()-1;m.setDate(c.date.getDate()-f),l.actual_date=m.toISOString().split("T")[0],l.actual_date2=c.today}Se(`${i}api/admin/report/seguimiento_list.php`,function(m){s=m.data.seguimiento_list,r=m.data.event_list,t==="me"&&p?_=s:_=s.filter(f=>f.id_driver===t),a(1,D=_.filter(f=>f.status!=="completed"&&f.status!=="cancelled"&&f.status!=="finished")),a(2,T=D.length>0)},l)}function A(l,y){y=="checklist-pending"?E("Checklist Pendiente de Autorizar","La lista de requerimientos de ruta está en revisión, podrás inciar la ruta una vez autorizado el checklist."):F(`/drivers/${t}/routes/${l}`)}const S=l=>l.charAt(0).toUpperCase()+l.slice(1),E=async(l,y)=>{await(await Le.create({header:l||"Error",message:y||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},B=()=>{F("/"),p=!1,localStorage.removeItem("userSession")};function M(l){se[l?"unshift":"push"](()=>{I=l,a(4,I)})}function C(l){se[l?"unshift":"push"](()=>{w=l,a(3,w)})}return n.$$set=l=>{"driverId"in l&&a(10,t=l.driverId)},n.$$.update=()=>{n.$$.dirty&3073&&(a(10,{driverId:t}=o.params,t),a(0,h=JSON.parse(localStorage.getItem("userSession"))),h?t=="me"&&h.id_user?h.type=="admin"||h.type=="super"?(F("/drivers/me"),L(),p=!0):(E("Usuario no autorizado","Este usuario no tiene acceso a la app de Rutaflow, entrar en contacto con soporte"),F("/")):h&&t&&(F(`/drivers/${h.id_driver}`),L()):(E("Sesión cerrada","Será redireccionado para volver a ingresar"),F("/")))},[h,D,T,w,I,k,L,A,S,B,t,o,M,C]}class Ye extends ge{constructor(e){super(),be(this,e,ze,Ue,de,{driverId:10})}}export{Ye as component};
