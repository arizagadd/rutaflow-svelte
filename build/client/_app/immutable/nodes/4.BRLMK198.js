import{s as ce,j as H,k as Z,l as ue,h as p,m as z,i as B,p as de,e as b,t as j,b as k,q as E,r as J,d as K,v as D,w as d,x as Q,y as W,z as fe,A as ne,n as _e,f as F,B as Y,C as pe}from"../chunks/index.CdEBkEwf.js";import{S as he,i as me,t as X,a as x,c as ve,b as ge,d as be,m as ke,e as ye,g as Ie}from"../chunks/index.Dw8w8a4z.js";import{g as Ee,l as Te,p as Oe,e as oe,u as Ne,d as Se}from"../chunks/index.By3iV_o1.js";import"../chunks/index-6e05b96e.C_9q9BoX.js";import{I as Re,a as we,D as De}from"../chunks/IonPage.CHnXyFSZ.js";import{g as P}from"../chunks/entry.DlWua9u_.js";function ae(n,e,o){const a=n.slice();return a[20]=e[o],a}function se(n){let e,o;return e=new Re({props:{$$slots:{default:[Ce]},$$scope:{ctx:n}}}),{c(){ge(e.$$.fragment)},l(a){be(e.$$.fragment,a)},m(a,t){ke(e,a,t),o=!0},p(a,t){const i={};t&8388639&&(i.$$scope={dirty:t,ctx:a}),e.$set(i)},i(a){o||(X(e.$$.fragment,a),o=!0)},o(a){x(e.$$.fragment,a),o=!1},d(a){ye(e,a)}}}function Ae(n){let e,o='<ion-row class="h-full items-center"><ion-col class="text-center"><h2 class="text-3xl text-muted mb-4 svelte-1xh3ip">No hay rutas pendientes para hoy</h2> <p class="text-muted svelte-1xh3ip">Espere indicaciones de su supervisor</p></ion-col></ion-row>';return{c(){e=b("ion-grid"),e.innerHTML=o,this.h()},l(a){e=k(a,"ION-GRID",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-3d9uou"&&(e.innerHTML=o),this.h()},h(){D(e,"class","ion-text-center h-full")},m(a,t){B(a,e,t)},p:_e,d(a){a&&p(e)}}}function Le(n){let e=[],o=new Map,a,t=oe(n[1]);const i=s=>s[20].id_route;for(let s=0;s<t.length;s+=1){let u=ae(n,t,s),h=i(u);o.set(h,e[s]=ie(h,u))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();a=Z()},l(s){for(let u=0;u<e.length;u+=1)e[u].l(s);a=Z()},m(s,u){for(let h=0;h<e.length;h+=1)e[h]&&e[h].m(s,u);B(s,a,u)},p(s,u){u&386&&(t=oe(s[1]),e=Ne(e,u,i,1,s,t,o,a.parentNode,Se,ie,a,ae))},d(s){s&&p(a);for(let u=0;u<e.length;u+=1)e[u].d(s)}}}function ie(n,e){var M,c;let o,a,t,i,s=e[8]((M=e[20].name)==null?void 0:M.charAt(0))+"",u,h,v,N,S,f=((c=e[20].name)==null?void 0:c.toUpperCase())+"",g,T,O,y,I=e[20].date_start+"",A,R,w,C;return{key:n,first:null,c(){o=b("ion-item"),a=b("ion-avatar"),t=b("div"),i=b("div"),u=j(s),v=H(),N=b("ion-label"),S=b("h2"),g=j(f),T=H(),O=b("h3"),y=j("Inicio: "),A=j(I),R=H(),this.h()},l(m){o=k(m,"ION-ITEM",{button:!0});var l=E(o);a=k(l,"ION-AVATAR",{slot:!0});var r=E(a);t=k(r,"DIV",{class:!0,style:!0,title:!0});var _=E(t);i=k(_,"DIV",{class:!0});var L=E(i);u=J(L,s),L.forEach(p),_.forEach(p),r.forEach(p),v=z(l),N=k(l,"ION-LABEL",{});var U=E(N);S=k(U,"H2",{});var V=E(S);g=J(V,f),V.forEach(p),T=z(U),O=k(U,"H3",{class:!0});var q=E(O);y=J(q,"Inicio: "),A=J(q,I),q.forEach(p),U.forEach(p),R=z(l),l.forEach(p),this.h()},h(){F(i,"class","route-symbol svelte-1xh3ip"),F(t,"class","route-color svelte-1xh3ip"),Y(t,"background-color",$(e[20].status)),Y(t,"color",re($(e[20].status))),F(t,"title",h=le(e[20].status)),D(a,"slot","start"),F(O,"class","text-muted svelte-1xh3ip"),D(o,"button",""),this.first=o},m(m,l){B(m,o,l),d(o,a),d(a,t),d(t,i),d(i,u),d(o,v),d(o,N),d(N,S),d(S,g),d(N,T),d(N,O),d(O,y),d(O,A),d(o,R),w||(C=Q(o,"click",function(){pe(e[7](e[20].id_route,e[20].status))&&e[7](e[20].id_route,e[20].status).apply(this,arguments)}),w=!0)},p(m,l){var r,_;e=m,l&2&&s!==(s=e[8]((r=e[20].name)==null?void 0:r.charAt(0))+"")&&W(u,s),l&2&&Y(t,"background-color",$(e[20].status)),l&2&&Y(t,"color",re($(e[20].status))),l&2&&h!==(h=le(e[20].status))&&F(t,"title",h),l&2&&f!==(f=((_=e[20].name)==null?void 0:_.toUpperCase())+"")&&W(g,f),l&2&&I!==(I=e[20].date_start+"")&&W(A,I)},d(m){m&&p(o),w=!1,C()}}}function Ce(n){let e,o,a,t,i=n[0].name+"",s,u,h,v,N='<ion-select-option value="enroute">Rutas en curso</ion-select-option> <ion-select-option value="routes-of-day">Rutas del día</ion-select-option> <ion-select-option value="yesterday-routes">Rutas de ayer</ion-select-option> <ion-select-option value="week-routes">Rutas de la semana</ion-select-option>',S,f,g,T=`<ion-icon icon="${Te}"></ion-icon>`,O,y,I,A='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',R,w,C,M;function c(r,_){return r[2]?Le:Ae}let m=c(n),l=m(n);return{c(){e=b("ion-header"),o=b("ion-toolbar"),a=b("ion-buttons"),t=b("ion-button"),s=j(i),u=H(),h=b("ion-title"),v=b("ion-select"),v.innerHTML=N,S=H(),f=b("ion-buttons"),g=b("ion-button"),g.innerHTML=T,O=H(),y=b("ion-content"),I=b("ion-refresher"),I.innerHTML=A,R=H(),w=b("ion-list"),l.c(),this.h()},l(r){e=k(r,"ION-HEADER",{translucent:!0});var _=E(e);o=k(_,"ION-TOOLBAR",{});var L=E(o);a=k(L,"ION-BUTTONS",{slot:!0});var U=E(a);t=k(U,"ION-BUTTON",{});var V=E(t);s=J(V,i),V.forEach(p),U.forEach(p),u=z(L),h=k(L,"ION-TITLE",{});var q=E(h);v=k(q,"ION-SELECT",{id:!0,interface:!0,value:!0,"data-svelte-h":!0}),K(v)!=="svelte-znqezo"&&(v.innerHTML=N),q.forEach(p),S=z(L),f=k(L,"ION-BUTTONS",{slot:!0});var ee=E(f);g=k(ee,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),K(g)!=="svelte-83ekyc"&&(g.innerHTML=T),ee.forEach(p),L.forEach(p),_.forEach(p),O=z(r),y=k(r,"ION-CONTENT",{});var G=E(y);I=k(G,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(I)!=="svelte-1wkherr"&&(I.innerHTML=A),R=z(G),w=k(G,"ION-LIST",{});var te=E(w);l.l(te),te.forEach(p),G.forEach(p),this.h()},h(){D(a,"slot","start"),D(v,"id","quick-filter"),D(v,"interface","action-sheet"),D(v,"value","routes-of-day"),D(g,"title","Salir"),D(g,"alt","Salir"),D(f,"slot","end"),D(e,"translucent",""),D(I,"slot","fixed")},m(r,_){B(r,e,_),d(e,o),d(o,a),d(a,t),d(t,s),d(o,u),d(o,h),d(h,v),n[12](v),d(o,S),d(o,f),d(f,g),B(r,O,_),B(r,y,_),d(y,I),n[13](I),d(y,R),d(y,w),l.m(w,null),C||(M=[Q(v,"ionChange",n[6]),Q(g,"click",n[9]),Q(I,"ionRefresh",n[5])],C=!0)},p(r,_){_&1&&i!==(i=r[0].name+"")&&W(s,i),m===(m=c(r))&&l?l.p(r,_):(l.d(1),l=m(r),l&&(l.c(),l.m(w,null)))},d(r){r&&(p(e),p(O),p(y)),n[12](null),n[13](null),l.d(),C=!1,fe(M)}}}function He(n){let e,o,a,t=n[0]&&se(n);return{c(){e=H(),t&&t.c(),o=Z(),this.h()},l(i){ue("svelte-qavk4j",document.head).forEach(p),e=z(i),t&&t.l(i),o=Z(),this.h()},h(){document.title="Rutas - Rutaflow"},m(i,s){B(i,e,s),t&&t.m(i,s),B(i,o,s),a=!0},p(i,[s]){i[0]?t?(t.p(i,s),s&1&&X(t,1)):(t=se(i),t.c(),X(t,1),t.m(o.parentNode,o)):t&&(Ie(),x(t,1,1,()=>{t=null}),ve())},i(i){a||(X(t),a=!0)},o(i){x(t),a=!1},d(i){i&&(p(e),p(o)),t&&t.d(i)}}}function $(n){let e="#ffffff";return n==="pending"?e="#FAD733":n==="completed"?e="#27C24C":n=="enroute"?e="#3BBAC2":n=="paused"?e="#949DB9":n=="cancelled"?e="#F05050":n=="checklist"?e="#F6A833":n=="checklist-pending"&&(e="#E98C00"),e}function le(n){let e="";return n==="pending"?e="Pendiente":n==="completed"?e="Completado":n=="enroute"?e="En ruta":n=="paused"?e="Pausado":n=="cancelled"?e="Cancelado":n=="checklist"?e="En checklist":n=="checklist-pending"&&(e="Pendiente de aprobar checklist"),e}function re(n){n.slice(0,1)==="#"&&(n=n.slice(1)),n.length===3&&(n=n.split("").map(function(i){return i+i}).join(""));const e=parseInt(n.substr(0,2),16),o=parseInt(n.substr(2,2),16),a=parseInt(n.substr(4,2),16);return(e*299+o*587+a*114)/1e3>=128?"#414040":"#fff"}function ze(){var n=new Date,e=n.getDate(),o=n.getMonth()+1,a=n.getFullYear(),t=a+"-"+o+"-"+e;return{today:t,year:a,month:o,date:n,day:e}}function Be(n,e,o){let a;de(n,Oe,c=>o(11,a=c));let{driverId:t}=e,i=De,s=[],u=[],h=[],v=[],N=!1,S=!1,f=new Object,g,T="routes-of-day";const O=async()=>{await y(),g.complete()};function y(){const c={id_enterprise:f.id_enterprise||"null",id_user_over:f.id_user,token:f.token},m=(T==null?void 0:T.value)||T,l=ze();if(m==="enroute")c.status="enroute";else if(m==="routes-of-day")c.actual_date=l.today;else if(m==="yesterday-routes"){let r=new Date(l.date);r.setDate(r.getDate()-1),c.actual_date=r.toISOString().split("T")[0]}else if(m==="week-routes"){let r=new Date(l.date),_=l.date.getDay()===0?6:l.date.getDay()-1;r.setDate(l.date.getDate()-_),c.actual_date=r.toISOString().split("T")[0],c.actual_date2=l.today}Ee(`${i}api/admin/report/seguimiento_list.php`,function(r){s=r.data.seguimiento_list,u=r.data.event_list,t==="me"&&S?h=s:h=s.filter(_=>_.id_driver===t),o(1,v=h.filter(_=>_.status!=="completed"&&_.status!=="cancelled"&&_.status!=="finished")),o(2,N=v.length>0)},c)}function I(c,m){m=="checklist-pending"?R("Checklist Pendiente de Autorizar","La lista de requerimientos de ruta está en revisión, podrás inciar la ruta una vez autorizado el checklist."):m=="checklist"?R("Ruta en Estado de Checklist","Una vez completado el checklist podrás continuar con la ruta."):P(`/drivers/${t}/routes/${c}`)}const A=c=>c.charAt(0).toUpperCase()+c.slice(1),R=async(c,m)=>{await(await we.create({header:c||"Error",message:m||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},w=()=>{P("/"),S=!1,localStorage.removeItem("userSession")};function C(c){ne[c?"unshift":"push"](()=>{T=c,o(4,T)})}function M(c){ne[c?"unshift":"push"](()=>{g=c,o(3,g)})}return n.$$set=c=>{"driverId"in c&&o(10,t=c.driverId)},n.$$.update=()=>{n.$$.dirty&3073&&(o(10,{driverId:t}=a.params,t),o(0,f=JSON.parse(localStorage.getItem("userSession"))),f?t=="me"&&f.id_user?f.type=="admin"||f.type=="super"?(P("/drivers/me"),y(),S=!0):(R("Usuario no autorizado","Este usuario no tiene acceso a la app de Rutaflow, entrar en contacto con soporte"),P("/")):f&&t&&(P(`/drivers/${f.id_driver}`),y(),console.log("Volví a entrar 2")):(R("Sesión cerrada","Será redireccionado para volver a ingresar"),P("/")))},[f,v,N,g,T,O,y,I,A,w,t,a,C,M]}class je extends he{constructor(e){super(),me(this,e,Be,He,ce,{driverId:10})}}export{je as component};
