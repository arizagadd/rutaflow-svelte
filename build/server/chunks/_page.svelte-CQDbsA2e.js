import { c as create_ssr_component, d as subscribe, v as validate_component, a as add_attribute, e as escape, f as each } from './ssr-BvR1n3wf.js';
import { p as page, I as IonPage } from './IonPage-D5oPt8FW.js';
import { g as goto } from './client-DpIAX_q0.js';
import { arrowBack, cashOutline, locationOutline } from 'ionicons/icons/index.mjs';
import { modalController } from '@ionic/core';
import { defineCustomElement } from '@ionic/core/components/ion-modal.js';
import { initialize } from '@ionic/core/components/index.js';
import './exports-BGi7-Rnc.js';

const registerCustomElement = (tagName, component) => {
  if (!customElements.get(tagName)) {
    class SvelteElement extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: "open" });
      }
      connectedCallback() {
        const props = {};
        for (const attribute of this.attributes) {
          props[attribute.name] = attribute.value;
        }
        new component({
          target: this.shadowRoot,
          props
        });
      }
    }
    customElements.define(tagName, SvelteElement);
  }
};
const isRegistered = function(name) {
  return document.createElement(name).constructor !== HTMLElement;
};
const registerWebComponentOnce = (selector, component) => {
  if (!isRegistered(selector)) {
    registerCustomElement(selector, component);
  }
};
const IonicShowModal = async (selector, component, componentProps) => {
  initialize();
  defineCustomElement();
  registerWebComponentOnce(selector, component);
  const modal = await modalController.create({
    component: selector,
    componentProps
  });
  modal.present();
  return await modal.onWillDismiss();
};
const css$1 = {
  code: ".loadEvidence.svelte-1lh6nay{--background:#93e9be;--background-hover:#9ce0be;--background-activated:#88f4be;--background-focused:#88f4be;--color:blue;--border-radius:0;--border-color:#000;--border-style:solid;--border-width:1px;--box-shadow:0 2px 6px 0 rgb(0, 0, 0, 0.25);--ripple-color:deeppink;--padding-top:10px;--padding-bottom:10px}",
  map: `{"version":3,"file":"_ChecklistControl.svelte","sources":["_ChecklistControl.svelte"],"sourcesContent":["<script>\\n    import GasKmModal from './GasKmModal.svelte';\\n    import {IonicShowModal} from \\"../../../../../services/IonicControllers\\";\\n    import { modalController } from '@ionic/core';\\n    import { checklistStore } from '../../../../../stores/checklistStore';\\n    import { alertController } from '@ionic/core';\\n    import { goto } from '$app/navigation';\\n\\timport { onMount } from 'svelte';\\n    import { gasKmStore } from '../../../../../stores/gasKmStore';\\n    import { flagStore } from '../../../../../stores/flagStore';\\n\\n    let overlayElement = document.querySelector(\\"ion-modal\\");\\n    //console.log(overlayElement.componentProps);\\n    const checklist = overlayElement.componentProps.checklist;\\n    const driverId = overlayElement.componentProps.driverId;\\n    const routeId = overlayElement.componentProps.routeId;\\n    const isLast = overlayElement.componentProps.isLast;\\n    let km_inicial,gas_inicial,km_final,gas_final;\\n    let checkk = [];\\n    let evidenceChecklist=null;\\n    let checkbox_item={};\\n    let KmInicial,GasInicial,KmFinal,GasFinal;\\n\\n    // checklist trae las img en caso de que existan, declarar selectedImage como objeto\\n    let selectedImages = {};\\n    let imagesName = {};\\n\\n    onMount(() => {\\n        if(isLast){\\n            console.log(\\"Último checklist\\");\\n        }else{\\n            // guardar en store.items del checklistStore el valor de checklist (el total de checklist por ruta)\\n            checklistStore.update(store => {\\n                store.mandatory = getChecklistArray(checklist,\\"mandatory\\");\\n                store.items = getChecklistArray(checklist,\\"id_checklist_event\\");\\n                //store.mandatory = lv.mandatoryValues;\\n                return store;\\n            });\\n        }\\n        \\n    });\\n\\n    const alertIncompleteChecklist = async () => {\\n\\t\\tconst alert = await alertController.create({\\n\\t\\t\\theader: 'Datos o checklist incompletos',\\n\\t\\t\\tmessage: 'Carga la evidencia requerida y marca todas las casillas para confirmar',\\n\\t\\t\\tbuttons: [\\n                {\\n                    text: 'Cerrar'\\n                }\\n\\t\\t\\t]\\n\\t\\t});\\n\\t\\n\\t\\tawait alert.present();\\n\\t};\\n\\n    const alertDataSent = async () => {\\n\\t\\tconst alert = await alertController.create({\\n\\t\\t\\theader: 'Datos capturados',\\n\\t\\t\\tmessage: 'El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta',\\n\\t\\t\\tbuttons: [\\n                {\\n                    text: 'Cerrar'\\n                }\\n\\t\\t\\t]\\n\\t\\t});\\n\\t\\n\\t\\tawait alert.present();\\n\\t};\\n\\n    const alertInitialValues = async (u) => {\\n\\t\\tconst alert = await alertController.create({\\n\\t\\t\\theader: 'Datos inválidos',\\n\\t\\t\\tmessage: u==\\"km\\"?'Llena correctamente el campo de kilometraje inicial':'Llena correctamente el campo de gasolina inicial',\\n\\t\\t\\tbuttons: [\\n                {\\n                    text: 'Cerrar'\\n                }\\n\\t\\t\\t]\\n\\t\\t});\\n\\t\\n\\t\\tawait alert.present();\\n\\t};\\n\\n    function getChecklistArray(obj,type) {\\n\\n        // Ensure obj is an object or an array and not null\\n        if ((typeof obj === 'object' && obj !== null) || Array.isArray(obj)) {\\n            // If obj is an array, collect IDs from each object in the array\\n            if (Array.isArray(obj)) {\\n                return obj.map(item => getChecklistArray(item,type)).flat();\\n            } else {\\n                // Get the keys (property names) of the object\\n                const keys = Object.keys(obj);\\n                let idValues;\\n\\n                // Filter keys that are likely to be IDs (customize this based on your object structure)\\n                if(type==\\"id_checklist_event\\"){\\n                    const idKeys = keys.filter(key => key.toLowerCase().includes('id_checklist_event'));\\n                    idValues = idKeys.map(key => obj[key]);\\n                }else if(type==\\"mandatory\\"){\\n                    const mandatoryKeys = keys.filter(key => key.toLowerCase().includes('mandatory'));\\n                    // Extract the values corresponding to the identified ID keys\\n                    idValues = mandatoryKeys.map(key => obj[key]);\\n                }else{\\n                    console.error(\\"Tipo de dato no reconocido.\\");\\n                    idValues = false;\\n                }\\n\\n                return idValues;\\n            }\\n        } else {\\n            console.error('Invalid input. Please provide a valid object or array.');\\n            return [];\\n        }\\n    }\\n\\n    const closeOverlay = () => {\\n        modalController.dismiss();\\n        if(driverId){\\n            goto(\`/drivers/\${driverId}\`);\\n        }else{\\n            goto(\`/drivers/me\`)\\n        }\\n    };\\n    const sendEvidence = () => {\\n        if(isLast){\\n            var fin_km = transformFormatValue(km_final,\\"km\\");\\n            var fin_gas = transformFormatValue(gas_final,\\"gas\\");\\n            const formData = new FormData();\\n            formData.append(\`km_final\`,fin_km);\\n            formData.append(\`gas_final\`,fin_gas);\\n            formData.append(\`id_route\`,routeId);\\n            \\n            if(fin_km && fin_gas){\\n                //cerrar modal\\n                closeOverlay();\\n                \\n                fetch('https://app.rutaflow.com/api/admin/checklist/add_evidence.php', {\\n                    method: 'POST',\\n                    body: formData,\\n                    })\\n                    .then(response => response.json())\\n                    .then(data => {\\n                        alertDataSent();\\n                    })\\n                    .catch(error => {\\n                    console.error('Error fetching data:', error);\\n                });\\n            }else{\\n                alertIncompleteChecklist();\\n            }\\n        }else{\\n            var ini_km = transformFormatValue(km_inicial,\\"km\\");\\n            var ini_gas = transformFormatValue(gas_inicial,\\"gas\\");\\n            checklistStore.update(store => {\\n                const itemIds = store.items;\\n                const mandatoryVal = store.mandatory;\\n                \\n                // Check if all expected indices are present in the checkedIndices array\\n                const allChecked = itemIds.every(id => store.checkedIndices.includes(id));\\n\\n                if (allChecked && ini_km && ini_gas) {\\n                    closeOverlay();\\n                    const formData = new FormData();\\n\\n                    // Iterate over the selectedImages object\\n                    for (const key in selectedImages) {\\n                        if (selectedImages.hasOwnProperty(key)) {\\n                            const { img, img_id } = selectedImages[key]; // Destructure img and img_id from the selectedImages[key] object\\n                            formData.append(\`selectedImages[\${key}][img]\`, img); // Append the image URL\\n                            formData.append(\`selectedImages[\${key}][img_id]\`, img_id); // Append the image ID\\n                        }\\n                    }\\n                    formData.append(\`km_inicial\`,ini_km);\\n                    formData.append(\`gas_inicial\`,ini_gas);\\n                    formData.append(\`id_route\`,routeId);\\n                    fetch('https://app.rutaflow.com/api/admin/checklist/add_evidence.php', {\\n                        method: 'POST',\\n                        body: formData,\\n                        })\\n                        .then(response => response.json())\\n                        .then(data => {\\n                            if(mandatoryVal){\\n                                if(mandatoryVal[0]=='1'){\\n                                    changeRouteStatus(routeId, 'checklist-pending');\\n                                }else{\\n                                    changeRouteStatus(routeId, 'enroute');\\n                                }\\n                            }else{\\n                                changeRouteStatus(routeId, 'enroute');\\n                            }\\n                            \\n                        })\\n                        .catch(error => {\\n                        console.error('Error fetching data:', error);\\n                    });\\n                    //goto(\`/drivers/\${driverId}/routes/\${routeId}\`);\\n                    //window.location.reload();\\n                }else if(!mandatoryVal && ini_km && ini_gas){\\n                    var formData = new FormData();\\n                    formData.append(\`km_inicial\`,ini_km);\\n                    formData.append(\`gas_inicial\`,ini_gas);\\n                    fetch('https://app.rutaflow.com/api/admin/checklist/add_evidence.php', {\\n                        method: 'POST',\\n                        body: formData,\\n                        })\\n                        .then(response => response.json())\\n                        .then(data => {\\n                            changeRouteStatus(routeId, 'enroute');\\n                            console.log(\\"Holaaa\\");\\n                        })\\n                        .catch(error => {\\n                        console.error('Error fetching data:', error);\\n                    });\\n                }else {\\n                    alertIncompleteChecklist();\\n                }\\n\\n                return store;\\n            });\\n        }\\n        emptyGasKmStore();\\n    };\\n\\n    const handleFileChange = async (event, checklistItemId) => {\\n        const fileInput = event.target;\\n        const file = fileInput.files[0];\\n        const compressed_file = await compressImage(file);\\n\\n        if (compressed_file) {\\n            const formData = new FormData();\\n            formData.append('fileToUpload', compressed_file);\\n            try {\\n                const response = await fetch('https://app.rutaflow.com/api/admin/manager/upload_img_driver.php', {\\n                    method: 'POST',\\n                    body: formData,\\n                });\\n\\n                if (response.ok) {\\n                    // File uploaded successfully, handle any additional logic\\n                    const result = await response.json();\\n\\n                    selectedImages = {\\n                        ...selectedImages,\\n                        [checklistItemId]: {\\n                            img: result.img, // Store the image URL\\n                            img_id: result.img_id // Store the image ID\\n                        }\\n                    };\\n                    imagesName = {\\n                        ...imagesName,\\n                        [checklistItemId]: result.filename,\\n                    };\\n\\n                    markCheckbox(checklistItemId);\\n                    checkbox_item[checklistItemId].checked =true; \\n                    \\n                } else {\\n                    // Handle error response\\n                    console.error('File upload failed:', response.statusText);\\n                }\\n            } catch (error) {\\n                console.error('Error during file upload:', error);\\n            }\\n        }\\n    };\\n    const compressImage = async (file) => {\\n        return new Promise((resolve) => {\\n            const reader = new FileReader();\\n\\n            reader.onload = (event) => {\\n                const img = new Image();\\n                img.src = event.target.result;\\n\\n                img.onload = () => {\\n                    const canvas = document.createElement('canvas');\\n                    const ctx = canvas.getContext('2d');\\n\\n                    // Set the canvas size to a reasonable value\\n                    const maxWidth = 800;\\n                    const maxHeight = 600;\\n\\n                    let width = img.width;\\n                    let height = img.height;\\n\\n                    if (width > maxWidth) {\\n                        height *= maxWidth / width;\\n                        width = maxWidth;\\n                    }\\n\\n                    if (height > maxHeight) {\\n                        width *= maxHeight / height;\\n                        height = maxHeight;\\n                    }\\n\\n                    canvas.width = width;\\n                    canvas.height = height;\\n\\n                    ctx.drawImage(img, 0, 0, width, height);\\n\\n                    // Get the compressed data as a Blob\\n                    canvas.toBlob((blob) => {\\n                        resolve(blob);\\n                    }, 'image/jpeg', 0.7); // Adjust the quality as needed\\n                };\\n            };\\n\\n            reader.readAsDataURL(file);\\n        });\\n    };\\n\\n    const markCheckbox = (id) => {\\n        checklistStore.update(store => {\\n            const existingIndex = store.checkedIndices.indexOf(id);\\n\\n            if (existingIndex === -1) {\\n                // The ID is not in the array, add it\\n                store.checkedIndices.push(id);\\n            } else {\\n                // The ID is already in the array, you may want to handle this case\\n                console.error(\`ID \${id} is already checked.\`);\\n            }\\n\\n            // Mark the corresponding checkbox in the items array\\n            store.items.forEach(item => {\\n                if (item.id_checklist_event === id) {\\n                    item.checked = true;\\n                }\\n            });\\n\\n            return store;\\n        });\\n    };\\n\\n    function changeRouteStatus(id_route,status){\\n        let requestData = new FormData();\\n        requestData.append('id_route', id_route);\\n        requestData.append('status',status);\\n        fetch('https://app.rutaflow.com/api/admin/route/change_status.php', {\\n                method: 'POST',\\n                body: requestData,\\n                })\\n                .then(response => response.json())\\n                .then(data => {\\n                    //console.log(data);\\n                })\\n                .catch(error => {\\n                console.error('Error fetching data:', error);\\n            });\\n    }\\n\\n    function transformFormatValue(value,u){\\n        // Check if the value contains only numeric characters\\n        if (/^\\\\d+$/.test(value)) {\\n            // Convert the string value to an integer\\n            const intValue = parseInt(value, 10);\\n            return intValue;\\n        } else {\\n            // If the value contains non-numeric characters, return null or handle the error accordingly\\n            alertInitialValues(u);\\n            return null;\\n        }\\n    }\\n\\n    function handleKmGasData(e,r){\\n        updateFlagStore(r);\\n        overlayElement.componentProps.data_type = r;\\n        IonicShowModal(\\"modal-gas-km\\", GasKmModal, {\\n            r\\n        }).then(() => {\\n            gasKmStore.subscribe((result) => {\\n                setButtonTxt(result,r);\\n                \\n            });\\n            \\n         });\\n    }\\n\\n    function updateFlagStore(type){\\n        flagStore.update(store => ({\\n          ...store,\\n          flag: [type]\\n      }));\\n    }\\n\\n    function setButtonTxt(obj,r){\\n        km_inicial = obj.km_inicial? obj.km_inicial: null;\\n        gas_inicial = obj.gas_inicial? obj.gas_inicial : null;\\n        km_final = obj.km_final? obj.km_final: null;\\n        gas_final = obj.gas_final? obj.gas_final : null;\\n        r=='km_inicial'?KmInicial.checked=true:\\"\\";\\n        r=='gas_inicial'?GasInicial.checked=true:\\"\\";\\n        r=='km_final'?KmFinal.checked=true:\\"\\";\\n        r=='gas_final'?GasFinal.checked=true:\\"\\";\\n        let checkbox;\\n    }\\n\\n    function emptyGasKmStore(){\\n        gasKmStore.set({\\n            km_inicial: [],\\n            gas_inicial: [],\\n            km_final: [],\\n            gas_final: []\\n        });\\n    }\\n\\n<\/script>\\n\\n<ion-header translucent>\\n    <ion-toolbar>\\n      <ion-buttons slot=\\"start\\">\\n        <ion-button color=\\"medium\\" on:click={closeOverlay}>Cancelar</ion-button>\\n      </ion-buttons>\\n      <ion-title>Requerimientos de ruta</ion-title>\\n    </ion-toolbar>\\n</ion-header>\\n<ion-content fullscreen>\\n    <ion-list>\\n        {#if isLast}\\n            <ion-item>\\n                <ion-label style=\\"display:flex;\\">\\n                    <input\\n                    id={\`chkbox-km-fin\`}\\n                    style=\\"pointer-events: auto;\\"\\n                    type=\\"checkbox\\"\\n                    bind:group={checkk}\\n                    bind:this = {KmFinal}\\n                    required\\n                    />\\n                    <p style=\\"margin-left:10px;\\">Kilometraje final</p>\\n                </ion-label>\\n                <ion-button fill=\\"outline\\" size=\\"small\\" class=\\"loadKmInicial\\" on:click={(e) => handleKmGasData(e,\\"km_final\\")} aria-selected>\\n                    <!-- <label for=\\"chkbox-km-fin\\" style=\\"padding: 8px 10px\\"> -->\\n                        {km_final?km_final+\\" km.\\":\\"Cargar km\\"}\\n                    <!-- </label> -->\\n                </ion-button>\\n            </ion-item>\\n            <ion-item>\\n                <ion-label style=\\"display:flex;\\">\\n                    <input\\n                    id={\`chkbox-gas-fin\`}\\n                    style=\\"pointer-events: auto;\\"\\n                    type=\\"checkbox\\"\\n                    bind:group={checkk}\\n                    bind:this = {GasFinal}\\n                    required\\n                    />\\n                    <p style=\\"margin-left:10px;\\">Gasolina final (litros)</p>\\n                </ion-label>\\n                <ion-button fill=\\"outline\\" size=\\"small\\" class=\\"loadGasInicial\\" on:click={(e) => handleKmGasData(e,\\"gas_final\\")}>\\n                    <!-- <label for=\\"chklist-gas-fin\\" style=\\"padding: 8px 10px\\"> -->\\n                        {gas_final?gas_final+\\" litros\\":\\"Cargar gas\\"}\\n                    <!-- </label> -->\\n                </ion-button>\\n            </ion-item>\\n        {:else}\\n            <ion-item>\\n                <ion-label style=\\"display:flex;\\">\\n                    <input\\n                    id={\`chkbox-km-ini\`}\\n                    style=\\"pointer-events: auto;\\"\\n                    type=\\"checkbox\\"\\n                    bind:group={checkk}\\n                    bind:this = {KmInicial}\\n                    required\\n                    />\\n                    <p style=\\"margin-left:10px;\\">Kilometraje inicial</p>\\n                </ion-label>\\n                <ion-button fill=\\"outline\\" size=\\"small\\" class=\\"loadKmInicial\\" on:click={(e) => handleKmGasData(e,\\"km_inicial\\")} aria-selected>\\n                    <!-- <label for=\\"chklist-km-ini\\" style=\\"padding: 8px 10px\\"> -->\\n                        {km_inicial?km_inicial+\\" km.\\":\\"Cargar km\\"}\\n                    <!-- </label> -->\\n                </ion-button>\\n            </ion-item>\\n            <ion-item>\\n                <ion-label style=\\"display:flex;\\">\\n                    <input\\n                    id={\`chkbox-gas-ini\`}\\n                    style=\\"pointer-events: auto;\\"\\n                    type=\\"checkbox\\"\\n                    bind:this = {GasInicial}\\n                    bind:group={checkk}\\n                    required\\n                    />\\n                    <p style=\\"margin-left:10px;\\">Gasolina inicial (litros)</p>\\n                </ion-label>\\n                <ion-button fill=\\"outline\\" class=\\"loadGasInicial\\" size=\\"small\\" on:click={(e) => handleKmGasData(e,\\"gas_inicial\\")} style=\\"height: 16px \\">\\n                    <!-- <label for=\\"chklist-gas-ini\\" style=\\"padding: 8px 10px\\"> -->\\n                        {gas_inicial?gas_inicial+\\" litros\\":\\"Cargar gas\\"}\\n                    <!-- </label> -->\\n                </ion-button>\\n            </ion-item>\\n            <!-- <ion-item>\\n                <ion-input class=\\"ini-km\\" type=\\"number\\" label=\\"Kilometraje inicial\\" labelPlacement=\\"stacked\\" placeholder=\\"Ingresa kilometraje actual\\" bind:this={initial_km}  required></ion-input>\\n            </ion-item>\\n            <ion-item>\\n                <ion-input class=\\"gas-km\\" type=\\"number\\" label=\\"Gasolina inicial (litros)\\" labelPlacement=\\"stacked\\" placeholder=\\"Ingresa la gas actual\\"  bind:this={initial_gas} required></ion-input>\\n            </ion-item> -->\\n        {/if}\\n        {#if checklist}\\n            {#each checklist as check (check.id_checklist_event)}\\n                <ion-item>\\n                    <ion-label style=\\"display:flex;\\">\\n                        <input\\n                        id={\`chkbox-\${check.id_checklist_event}\`}\\n                        style=\\"pointer-events: auto;\\"\\n                        type=\\"checkbox\\"\\n                        value={check.id_checklist_event}\\n                        bind:group={checkk}\\n                        bind:this = {checkbox_item[check.id_checklist_event]}\\n                        on:change={() => markCheckbox(check.id_checklist_event)}\\n                        required\\n                        />\\n                        <p style=\\"margin-left:10px;\\">{check.item}</p>\\n                    </ion-label>\\n\\n                    <ion-button fill=\\"outline\\" class=\\"loadEvidence\\" size=\\"small\\">\\n                        <label for=\\"chklist-{check.id_checklist_event}\\">\\n                            {imagesName[check.id_checklist_event] ? imagesName[check.id_checklist_event] : 'Cargar evidencia'}\\n                        </label>\\n                        <input style=\\"display:none;\\" id=\\"chklist-{check.id_checklist_event}\\" name=\\"fileToUpload\\" type=\\"file\\" bind:this={evidenceChecklist} accept=\\"image/*\\" on:change={(e) => handleFileChange(e, check.id_checklist_event)}>\\n                        <!-- <input type=\\"submit\\" value=\\"Upload Image\\" name=\\"submit\\" style=\\"display:none;\\"/> -->\\n                    </ion-button>\\n                </ion-item>\\n            {/each}\\n        {/if}\\n    </ion-list>\\n</ion-content>\\n<ion-footer>\\n    <!-- <ion-buttons style=\\"width: 100%; height: 100%;\\"> -->\\n        <ion-button fill=\\"outline\\" color=\\"tertiary\\" on:click={sendEvidence} strong style=\\"width: 99%; height: auto;\\">\\n            Confirmar\\n        </ion-button>\\n    <!-- </ion-buttons> -->\\n</ion-footer>\\n\\n<style>\\n    .myFakeUploadButton {\\n        border: 1px solid #000; \\n        padding: 6px 10px; \\n        border-radius: 6px;\\n        background-color: #858585;\\n    }\\n    .ini-km,\\n    .ini-gas{\\n        --padding-top: 10px;\\n    }\\n    .loadEvidence {\\n        --background: #93e9be;\\n        --background-hover: #9ce0be;\\n        --background-activated: #88f4be;\\n        --background-focused: #88f4be;\\n\\n        --color: blue;\\n\\n        --border-radius: 0;\\n        --border-color: #000;\\n        --border-style: solid;\\n        --border-width: 1px;\\n\\n        --box-shadow: 0 2px 6px 0 rgb(0, 0, 0, 0.25);\\n\\n        --ripple-color: deeppink;\\n\\n        --padding-top: 10px;\\n        --padding-bottom: 10px;\\n    }\\n</style>"],"names":[],"mappings":"AAoiBI,4BAAc,CACV,YAAY,CAAE,OAAO,CACrB,kBAAkB,CAAE,OAAO,CAC3B,sBAAsB,CAAE,OAAO,CAC/B,oBAAoB,CAAE,OAAO,CAE7B,OAAO,CAAE,IAAI,CAEb,eAAe,CAAE,CAAC,CAClB,cAAc,CAAE,IAAI,CACpB,cAAc,CAAE,KAAK,CACrB,cAAc,CAAE,GAAG,CAEnB,YAAY,CAAE,8BAA8B,CAE5C,cAAc,CAAE,QAAQ,CAExB,aAAa,CAAE,IAAI,CACnB,gBAAgB,CAAE,IACtB"}`
};
const ChecklistControl = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let overlayElement = document.querySelector("ion-modal");
  const checklist = overlayElement.componentProps.checklist;
  overlayElement.componentProps.driverId;
  overlayElement.componentProps.routeId;
  const isLast = overlayElement.componentProps.isLast;
  let checkk = [];
  let checkbox_item = {};
  let KmInicial, GasInicial, KmFinal, GasFinal;
  let imagesName = {};
  $$result.css.add(css$1);
  return `<ion-header translucent><ion-toolbar><ion-buttons slot="start"><ion-button color="medium" data-svelte-h="svelte-1dnmkxs">Cancelar</ion-button></ion-buttons> <ion-title data-svelte-h="svelte-ucox25">Requerimientos de ruta</ion-title></ion-toolbar></ion-header> <ion-content fullscreen><ion-list>${isLast ? `<ion-item><ion-label style="display:flex;"><input${add_attribute("id", `chkbox-km-fin`, 0)} style="pointer-events: auto;" type="checkbox" required${add_attribute("this", KmFinal, 0)}> <p style="margin-left:10px;" data-svelte-h="svelte-ccmu71">Kilometraje final</p></ion-label> <ion-button fill="outline" size="small" class="loadKmInicial" aria-selected> ${escape("Cargar km")} </ion-button></ion-item> <ion-item><ion-label style="display:flex;"><input${add_attribute("id", `chkbox-gas-fin`, 0)} style="pointer-events: auto;" type="checkbox" required${add_attribute("this", GasFinal, 0)}> <p style="margin-left:10px;" data-svelte-h="svelte-wsoyd2">Gasolina final (litros)</p></ion-label> <ion-button fill="outline" size="small" class="loadGasInicial"> ${escape("Cargar gas")} </ion-button></ion-item>` : `<ion-item><ion-label style="display:flex;"><input${add_attribute("id", `chkbox-km-ini`, 0)} style="pointer-events: auto;" type="checkbox" required${add_attribute("this", KmInicial, 0)}> <p style="margin-left:10px;" data-svelte-h="svelte-88twxi">Kilometraje inicial</p></ion-label> <ion-button fill="outline" size="small" class="loadKmInicial" aria-selected> ${escape("Cargar km")} </ion-button></ion-item> <ion-item><ion-label style="display:flex;"><input${add_attribute("id", `chkbox-gas-ini`, 0)} style="pointer-events: auto;" type="checkbox" required${add_attribute("this", GasInicial, 0)}> <p style="margin-left:10px;" data-svelte-h="svelte-1ux30eb">Gasolina inicial (litros)</p></ion-label> <ion-button fill="outline" class="loadGasInicial" size="small" style="height: 16px "> ${escape("Cargar gas")} </ion-button></ion-item> `} ${checklist ? `${each(checklist, (check) => {
    return `<ion-item><ion-label style="display:flex;"><input${add_attribute("id", `chkbox-${check.id_checklist_event}`, 0)} style="pointer-events: auto;" type="checkbox"${add_attribute("value", check.id_checklist_event, 0)} required${~checkk.indexOf(check.id_checklist_event) ? add_attribute("checked", true, 1) : ""}${add_attribute("this", checkbox_item[check.id_checklist_event], 0)}> <p style="margin-left:10px;">${escape(check.item)}</p></ion-label> <ion-button fill="outline" class="loadEvidence svelte-1lh6nay" size="small"><label for="${"chklist-" + escape(check.id_checklist_event, true)}">${escape(imagesName[check.id_checklist_event] ? imagesName[check.id_checklist_event] : "Cargar evidencia")}</label> <input style="display:none;" id="${"chklist-" + escape(check.id_checklist_event, true)}" name="fileToUpload" type="file" accept="image/*"> </ion-button> </ion-item>`;
  })}` : ``}</ion-list></ion-content> <ion-footer> <ion-button fill="outline" color="tertiary" strong style="width: 99%; height: auto;" data-svelte-h="svelte-g82qqw">Confirmar</ion-button>  </ion-footer>`;
});
const css = {
  code: ".sub.svelte-ziybgw{font-size:12px;margin-top:5px}.order-wrapper.svelte-ziybgw{width:100%;height:100%;border-radius:50%;border:1px solid #CBCFDE;text-align:center;display:flex;justify-content:center}.order.svelte-ziybgw{align-self:center}.notes.svelte-ziybgw{background-color:#e0b500;display:inline-block;width:8px;height:8px;border-radius:50%}",
  map: `{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script lang=\\"ts\\">var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\"throw\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\n//import {ready, url, goto} from '@sveltech/routify';\\nexport let routeId;\\nexport let driverId;\\nimport DeliveryInfo from './_DeliveryInfo.svelte';\\nimport IonPage from 'ionic-svelte/components/IonPage.svelte';\\nimport ChecklistControl from './_ChecklistControl.svelte';\\nimport AddExpense from './_AddExpense.svelte';\\nimport ExpenseDetails from './_ExpenseDetails.svelte';\\nimport { onMount } from 'svelte';\\nimport { IonicShowModal } from \\"../../../../../services/IonicControllers\\";\\nimport { alertController } from '@ionic/core';\\nimport { page } from '$app/stores';\\nimport { goto } from '$app/navigation';\\nimport { locationOutline, cashOutline } from \\"ionicons/icons\\";\\nimport { arrowBack } from \\"ionicons/icons\\";\\nlet dataSession = new Object();\\nlet loading = true;\\nlet showChecklist = false;\\nlet deliveries = [];\\nlet stats = {};\\nlet checklist = [];\\nlet expenses = [];\\nlet refresher;\\nconst refresh = () => __awaiter(void 0, void 0, void 0, function* () {\\n    yield loadRoute(routeId);\\n    refresher.complete();\\n});\\nonMount(() => {\\n    refresh();\\n});\\n$: {\\n    ({ routeId, driverId } = $page.params);\\n    dataSession = JSON.parse(localStorage.getItem('userSession'));\\n    if (dataSession) {\\n        if (dataSession.id_user && (dataSession.type == \\"admin\\" || dataSession.type == \\"super\\")) {\\n            loadRoute(routeId);\\n            goto(\`/drivers/me/routes/\${routeId}\`);\\n        }\\n        else if (dataSession.id_user && dataSession.id_driver) {\\n            loadRoute(routeId);\\n            goto(\`/drivers/\${dataSession.id_driver}/routes/\${routeId}\`);\\n        }\\n    }\\n    else {\\n        goto('/');\\n    }\\n}\\nfunction loadRoute(routeId) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const requestData = new FormData();\\n        requestData.append('id_route', routeId);\\n        try {\\n            const response = yield fetch('https://app.rutaflow.com/api/admin/report/seguimiento_list.php', {\\n                method: 'POST',\\n                body: requestData,\\n            });\\n            const data = yield response.json();\\n            stats = data.data.seguimiento_list[0];\\n            deliveries = data.data.event_list;\\n            checklist = data.data.checklist;\\n            expenses = data.data.expenses;\\n            if (stats) {\\n                showChecklist = (stats.km_inicial == '0' && stats.gas_inicial == '0');\\n            }\\n            loading = false; // Data loading complete\\n        }\\n        catch (error) {\\n            loading = false; // Data loading complete\\n            console.error('Error fetching data:', error);\\n        }\\n        ;\\n    });\\n}\\nfunction getDeliveryColor(delivery) {\\n    let color = '#ffffff';\\n    if (delivery.status === 'pending') {\\n        color = '#f2e300';\\n    }\\n    else if (delivery.status === 'completed') {\\n        color = '#44d900';\\n    }\\n    return color;\\n}\\nfunction getStatusTitle(status) {\\n    let state = '';\\n    if (status == \\"pending\\") {\\n        state = 'Pendiente';\\n    }\\n    else if (status == \\"completed\\") {\\n        state = 'Completado';\\n    }\\n    return state;\\n}\\nfunction getContrast(hexColor) {\\n    // If a leading # is provided, remove it\\n    if (hexColor.slice(0, 1) === '#') {\\n        hexColor = hexColor.slice(1);\\n    }\\n    // If a three-character hexcode, make six-character\\n    if (hexColor.length === 3) {\\n        hexColor = hexColor.split('').map(function (hex) {\\n            return hex + hex;\\n        }).join('');\\n    }\\n    // Convert to RGB value\\n    const r = parseInt(hexColor.substr(0, 2), 16);\\n    const g = parseInt(hexColor.substr(2, 2), 16);\\n    const b = parseInt(hexColor.substr(4, 2), 16);\\n    // Get YIQ ratio\\n    const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;\\n    // Check contrast\\n    return (yiq >= 128) ? '#414040' : '#fff';\\n}\\nconst refresh_event_info = (delivery) => {\\n    return new Promise((resolve, reject) => {\\n        const requestData = new FormData();\\n        requestData.append('id_route', delivery.id_route);\\n        requestData.append('id_event', delivery.id_event);\\n        fetch('https://app.rutaflow.com/api/admin/evidence/evidence_by_event.php', {\\n            method: 'POST',\\n            body: requestData,\\n        })\\n            .then(response => response.json())\\n            .then(data => {\\n            resolve(data.data.event_evidence[0]);\\n        })\\n            .catch(error => {\\n            console.error('Error fetching data:', error);\\n            reject(error);\\n        });\\n    });\\n};\\nconst showDeliveryInfoModal = (delivery, isLast) => {\\n    refresh_event_info(delivery)\\n        .then((evidence_data) => {\\n        //delivery.client_name = stats.client_name;\\n        if (evidence_data) {\\n            //update these two fields that could change when user charge info\\n            delivery.img = evidence_data.img;\\n            delivery.driver_comments = evidence_data.driver_comments;\\n            delivery.comments = evidence_data.comments;\\n        }\\n        IonicShowModal(\\"modal-delivery-info\\", DeliveryInfo, {\\n            delivery, isLast\\n        }).then((result) => {\\n            //console.log(result);\\n        });\\n    });\\n};\\nconst showChecklistModal = (checklist, driverId, routeId) => {\\n    var isLast = false;\\n    IonicShowModal(\\"modal-checklist\\", ChecklistControl, {\\n        checklist, driverId, routeId, isLast\\n    }).then((result) => {\\n    });\\n    changeRouteStatus(routeId, 'checklist');\\n    return \\"\\";\\n};\\nconst showExpenseModal = (routeId) => __awaiter(void 0, void 0, void 0, function* () {\\n    yield loadRoute(routeId);\\n    if (expenses.length > 0) {\\n        IonicShowModal(\\"modal-expense-detail\\", ExpenseDetails, {\\n            routeId, expenses\\n        }).then((result) => {\\n        });\\n    }\\n    else {\\n        IonicShowModal(\\"modal-expense\\", AddExpense, {\\n            routeId\\n        }).then((result) => {\\n        });\\n    }\\n    //changeRouteStatus(routeId,'checklist');\\n    return \\"\\";\\n});\\nconst mustCharge = (delivery) => {\\n    if (delivery.tracking_type == 'subscription') {\\n        if (delivery.subscriber_info && delivery.payment_type === 'cash') {\\n            let date = new Date(delivery.subscriber_info.payment_next);\\n            if (date < (new Date())) {\\n                return true;\\n            }\\n        }\\n    }\\n    else if (delivery.tracking_type == 'ecommerce') {\\n        if (Number(delivery.payment_pending) > 0) {\\n            return true;\\n        }\\n    }\\n    return false;\\n};\\nfunction changeRouteStatus(id_route, status) {\\n    let requestData = new FormData();\\n    requestData.append('id_route', id_route);\\n    requestData.append('status', status);\\n    fetch('https://app.rutaflow.com/api/admin/route/change_status.php', {\\n        method: 'POST',\\n        body: requestData,\\n    })\\n        .then(response => response.json())\\n        .then(data => {\\n    })\\n        .catch(error => {\\n        console.error('Error fetching data:', error);\\n    });\\n    return \\"\\";\\n}\\nconst goBack = () => {\\n    // Redirect to backpage\\n    if (dataSession.id_driver) {\\n        goto(\`/drivers/\${dataSession.id_driver}\`);\\n    }\\n    else {\\n        goto(\`/drivers/me\`);\\n    }\\n};\\nconst showAlert = (customHeader, customMessage) => __awaiter(void 0, void 0, void 0, function* () {\\n    const alert = yield alertController.create({\\n        header: customHeader || 'Error', // Use customHeader or default value\\n        message: customMessage || 'Vuelva a intentar', // Use customMessage or default value\\n        buttons: [\\n            {\\n                text: 'Cerrar'\\n            }\\n        ]\\n    });\\n    yield alert.present();\\n});\\nfunction isLastDelivery(index) {\\n    return index === deliveries.length - 1;\\n}\\n<\/script>\\n\\n<style>\\n    .delivery-icon {\\n        width: 20px;\\n        height: 20px;\\n        border-radius: 50%;\\n        position: relative;\\n        display: inline-block;\\n        text-align: center;\\n        line-height: 20px;\\n        font-weight: bold;\\n        margin-right: 5px;\\n        border: 1px solid #CBCFDE;\\n    }\\n\\n    .sub {\\n        font-size: 12px;\\n        margin-top: 5px;\\n    }\\n\\n    .sub .prod {\\n        letter-spacing: 1px;\\n        font-weight: 600;\\n    }\\n\\n    .sub .time {\\n        color: #888;\\n    }\\n\\n    .order-wrapper {\\n        width: 100%;\\n        height: 100%;\\n        border-radius: 50%;\\n        border: 1px solid #CBCFDE;\\n        text-align: center;\\n        display: flex;\\n        justify-content: center;\\n    }\\n\\n    .order {\\n        align-self: center;\\n    }\\n\\n    .notes {\\n        background-color: #e0b500;\\n        display: inline-block;\\n        width: 8px;\\n        height: 8px;\\n        border-radius: 50%;\\n    }\\n</style>\\n\\n<svelte:head>\\n    <title>Rutaflow - Detalles de ruta</title>\\n</svelte:head>\\n\\n{#if dataSession}\\n    <IonPage>\\n        <ion-header translucent>\\n            <ion-toolbar>\\n                <ion-buttons slot=\\"start\\">\\n                    <ion-button title=\\"Atrás\\" alt=\\"Atrás\\" on:click={goBack}><ion-icon icon={arrowBack}></ion-icon></ion-button>\\n                </ion-buttons>\\n                <ion-buttons slot=\\"end\\">\\n                    <ion-button on:click={()=>showExpenseModal(routeId)}><ion-icon icon={cashOutline}></ion-icon></ion-button>\\n                    <!-- <ion-button>{dataSession.name}</ion-button> -->\\n                </ion-buttons>\\n        \\n                <ion-title>{stats.name}</ion-title>\\n        \\n            </ion-toolbar>\\n        </ion-header>\\n\\n        {#if checklist.length > 0}\\n            {#if checklist.every(item => item.img)}\\n                <ion-content>\\n                    <ion-refresher slot=\\"fixed\\" bind:this={refresher} on:ionRefresh={refresh}>\\n                        <ion-refresher-content pulling-icon=\\"arrow-dropdown\\"\\n                                            pulling-text=\\"Jale para actualizar\\"\\n                                            refreshing-spinner=\\"circles\\"\\n                                            refreshing-text=\\"Actualizando...\\"></ion-refresher-content>\\n                    </ion-refresher>\\n                    <ion-list>\\n                        {#each deliveries as delivery, index (delivery.id_event)}\\n                            <ion-item>\\n                                <ion-avatar slot=\\"start\\">\\n                                    <div class=\\"order-wrapper\\" title=\\"{getStatusTitle(delivery.status)}\\" style=\\"background-color: {getDeliveryColor(delivery)}; color: {getContrast(getDeliveryColor(delivery))}\\">\\n                                        <div class=\\"order\\">\\n                                            {parseInt(delivery.pos) + 1}\\n                                        </div>\\n                                    </div>\\n                                </ion-avatar>\\n                                <ion-label button on:click={() => showDeliveryInfoModal(delivery, isLastDelivery(index))}>\\n                                    <ion-text color=\\"#2e2e2e\\">\\n                                        <h3>\\n                                            {delivery.title}\\n                                            {#if (delivery.support_list && delivery.support_list.length) || mustCharge(delivery)}\\n                                                <span class=\\"notes\\"></span>\\n                                            {/if}\\n                                        </h3>\\n                                    </ion-text>\\n                                    <div class=\\"sub\\">\\n                                        <!-- <BoxesCount delivery={delivery} /> -->\\n\\n                                    </div>\\n                                </ion-label>\\n                                <ion-icon icon={locationOutline} slot=\\"end\\"></ion-icon>\\n                            </ion-item>\\n                        {/each}\\n                    </ion-list>\\n                </ion-content>\\n            {:else}\\n                {showChecklistModal(checklist,driverId,routeId)}\\n                <ion-content>\\n                    <ion-refresher slot=\\"fixed\\" bind:this={refresher} on:ionRefresh={refresh}>\\n                        <ion-refresher-content pulling-icon=\\"arrow-dropdown\\"\\n                                            pulling-text=\\"Pull to refresh\\"\\n                                            refreshing-spinner=\\"circles\\"\\n                                            refreshing-text=\\"Refreshing...\\"></ion-refresher-content>\\n                    </ion-refresher>\\n                    <ion-list>\\n                        {#each deliveries as delivery, index (delivery.id_event)}\\n                            <ion-item>\\n                                <ion-avatar slot=\\"start\\">\\n                                    <div class=\\"order-wrapper\\" title=\\"{getStatusTitle(delivery.status)}\\" style=\\"background-color: {getDeliveryColor(delivery)}; color: {getContrast(getDeliveryColor(delivery))}\\">\\n                                        <div class=\\"order\\">\\n                                            {parseInt(delivery.pos) + 1}\\n                                        </div>\\n                                    </div>\\n                                </ion-avatar>\\n                                <ion-label button on:click={() => showDeliveryInfoModal(delivery, isLastDelivery(index))}>\\n                                    <ion-text color=\\"#2e2e2e\\">\\n                                        <h3>\\n                                            {delivery.title}\\n                                            {#if (delivery.support_list && delivery.support_list.length) || mustCharge(delivery)}\\n                                                <span class=\\"notes\\"></span>\\n                                            {/if}\\n                                        </h3>\\n                                    </ion-text>\\n                                    <div class=\\"sub\\">\\n                                        <!-- <BoxesCount delivery={delivery} /> -->\\n\\n                                    </div>\\n                                </ion-label>\\n                                <ion-icon icon={locationOutline} slot=\\"end\\"></ion-icon>\\n                            </ion-item>\\n                        {/each}\\n                    </ion-list>\\n                </ion-content>\\n            {/if}\\n        {:else}\\n            {#if !loading}\\n                {#if showChecklist}\\n                    {showChecklistModal(\\"\\",driverId,routeId)}\\n                {/if}\\n                <ion-content>\\n                    <ion-refresher slot=\\"fixed\\" bind:this={refresher} on:ionRefresh={refresh}>\\n                        <ion-refresher-content pulling-icon=\\"arrow-dropdown\\"\\n                                            pulling-text=\\"Jala para actualizar\\"\\n                                            refreshing-spinner=\\"circles\\"\\n                                            refreshing-text=\\"Actualizando...\\"></ion-refresher-content>\\n                    </ion-refresher>\\n                    <ion-list>\\n                        {#each deliveries as delivery (delivery.id_event)}\\n                            <ion-item>\\n                                <ion-avatar slot=\\"start\\">\\n                                    <div class=\\"order-wrapper\\" title=\\"{getStatusTitle(delivery.status)}\\" style=\\"background-color: {getDeliveryColor(delivery)}; color: {getContrast(getDeliveryColor(delivery))}\\">\\n                                        <div class=\\"order\\">\\n                                            {parseInt(delivery.pos) + 1}\\n                                        </div>\\n                                    </div>\\n                                </ion-avatar>\\n                                <ion-label button on:click={() => {\\n                                    // Get the index of the current delivery in the array\\n                                    const currentIndex = deliveries.findIndex(item => item.id_event === delivery.id_event);\\n                                    \\n                                    // Check if the previous delivery has an image (or if it's the first delivery)\\n                                    const isFirstDelivery = currentIndex === 0;\\n                                    const previousDelivery = currentIndex > 0 ? deliveries[currentIndex - 1] : null;\\n                                    const previousDeliveryHasImage = isFirstDelivery || (previousDelivery && previousDelivery.img !== null);\\n                                    \\n                                    // Check if the current delivery has an image\\n                                    const currentDeliveryHasImage = delivery.img !== null && delivery.img !== '';\\n                                    \\n                                    // Allow showing the modal only if the current delivery has an image\\n                                    // or if it's the first delivery and the current delivery does not have an image\\n                                    if (previousDeliveryHasImage || (isFirstDelivery && !currentDeliveryHasImage)) {\\n                                        showDeliveryInfoModal(delivery);\\n                                    } else {\\n                                        showAlert(\\"Información incompleta\\", \\"No puedes visualizar otras paradas hasta cargar evidencia del destino pasado\\");\\n                                    }\\n                                }}>                            \\n                                    <ion-text color=\\"#2e2e2e\\">\\n                                        <h3>\\n                                            {delivery.title}\\n                                            {#if (delivery.support_list && delivery.support_list.length) || mustCharge(delivery)}\\n                                                <span class=\\"notes\\"></span>\\n                                            {/if}\\n                                        </h3>\\n                                    </ion-text>\\n                                </ion-label>\\n                                <ion-icon icon={locationOutline} slot=\\"end\\" style=\\"color: {getDeliveryColor(delivery)}\\"></ion-icon>\\n                            </ion-item>\\n                        {/each}\\n                    </ion-list>\\n                </ion-content>\\n            {/if}\\n        {/if}\\n    </IonPage>\\n{/if}"],"names":[],"mappings":"AAgQI,kBAAK,CACD,SAAS,CAAE,IAAI,CACf,UAAU,CAAE,GAChB,CAWA,4BAAe,CACX,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,aAAa,CAAE,GAAG,CAClB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,CACzB,UAAU,CAAE,MAAM,CAClB,OAAO,CAAE,IAAI,CACb,eAAe,CAAE,MACrB,CAEA,oBAAO,CACH,UAAU,CAAE,MAChB,CAEA,oBAAO,CACH,gBAAgB,CAAE,OAAO,CACzB,OAAO,CAAE,YAAY,CACrB,KAAK,CAAE,GAAG,CACV,MAAM,CAAE,GAAG,CACX,aAAa,CAAE,GACnB"}`
};
function getDeliveryColor(delivery) {
  let color = "#ffffff";
  if (delivery.status === "pending") {
    color = "#f2e300";
  } else if (delivery.status === "completed") {
    color = "#44d900";
  }
  return color;
}
function getStatusTitle(status) {
  let state = "";
  if (status == "pending") {
    state = "Pendiente";
  } else if (status == "completed") {
    state = "Completado";
  }
  return state;
}
function getContrast(hexColor) {
  if (hexColor.slice(0, 1) === "#") {
    hexColor = hexColor.slice(1);
  }
  if (hexColor.length === 3) {
    hexColor = hexColor.split("").map(function(hex) {
      return hex + hex;
    }).join("");
  }
  const r = parseInt(hexColor.substr(0, 2), 16);
  const g = parseInt(hexColor.substr(2, 2), 16);
  const b = parseInt(hexColor.substr(4, 2), 16);
  const yiq = (r * 299 + g * 587 + b * 114) / 1e3;
  return yiq >= 128 ? "#414040" : "#fff";
}
function changeRouteStatus(id_route, status) {
  let requestData = new FormData();
  requestData.append("id_route", id_route);
  requestData.append("status", status);
  fetch("https://app.rutaflow.com/api/admin/route/change_status.php", { method: "POST", body: requestData }).then((response) => response.json()).then((data) => {
  }).catch((error) => {
    console.error("Error fetching data:", error);
  });
  return "";
}
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $page, $$unsubscribe_page;
  $$unsubscribe_page = subscribe(page, (value) => $page = value);
  var __awaiter = function(thisArg, _arguments, P, generator) {
    function adopt(value) {
      return value instanceof P ? value : new P(function(resolve) {
        resolve(value);
      });
    }
    return new (P || (P = Promise))(function(resolve, reject) {
      function fulfilled(value) {
        try {
          step(generator.next(value));
        } catch (e) {
          reject(e);
        }
      }
      function rejected(value) {
        try {
          step(generator["throw"](value));
        } catch (e) {
          reject(e);
        }
      }
      function step(result) {
        result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
      }
      step((generator = generator.apply(thisArg, [])).next());
    });
  };
  let { routeId } = $$props;
  let { driverId } = $$props;
  let dataSession = new Object();
  let loading = true;
  let showChecklist = false;
  let deliveries = [];
  let stats = {};
  let checklist = [];
  let expenses = [];
  let refresher;
  function loadRoute(routeId2) {
    return __awaiter(this, void 0, void 0, function* () {
      const requestData = new FormData();
      requestData.append("id_route", routeId2);
      try {
        const response = yield fetch("https://app.rutaflow.com/api/admin/report/seguimiento_list.php", { method: "POST", body: requestData });
        const data = yield response.json();
        stats = data.data.seguimiento_list[0];
        deliveries = data.data.event_list;
        checklist = data.data.checklist;
        expenses = data.data.expenses;
        if (stats) {
          showChecklist = stats.km_inicial == "0" && stats.gas_inicial == "0";
        }
        loading = false;
      } catch (error) {
        loading = false;
        console.error("Error fetching data:", error);
      }
    });
  }
  const showChecklistModal = (checklist2, driverId2, routeId2) => {
    var isLast = false;
    IonicShowModal("modal-checklist", ChecklistControl, { checklist: checklist2, driverId: driverId2, routeId: routeId2, isLast }).then((result) => {
    });
    changeRouteStatus(routeId2, "checklist");
    return "";
  };
  const mustCharge = (delivery) => {
    if (delivery.tracking_type == "subscription") {
      if (delivery.subscriber_info && delivery.payment_type === "cash") {
        let date = new Date(delivery.subscriber_info.payment_next);
        if (date < /* @__PURE__ */ new Date()) {
          return true;
        }
      }
    } else if (delivery.tracking_type == "ecommerce") {
      if (Number(delivery.payment_pending) > 0) {
        return true;
      }
    }
    return false;
  };
  if ($$props.routeId === void 0 && $$bindings.routeId && routeId !== void 0) $$bindings.routeId(routeId);
  if ($$props.driverId === void 0 && $$bindings.driverId && driverId !== void 0) $$bindings.driverId(driverId);
  $$result.css.add(css);
  {
    {
      ({ routeId, driverId } = $page.params);
      dataSession = JSON.parse(localStorage.getItem("userSession"));
      if (dataSession) {
        if (dataSession.id_user && (dataSession.type == "admin" || dataSession.type == "super")) {
          loadRoute(routeId);
          goto();
        } else if (dataSession.id_user && dataSession.id_driver) {
          loadRoute(routeId);
          goto(`/drivers/${dataSession.id_driver}/routes/${routeId}`);
        }
      } else {
        goto();
      }
    }
  }
  $$unsubscribe_page();
  return `${$$result.head += `<!-- HEAD_svelte-kn0kph_START -->${$$result.title = `<title>Rutaflow - Detalles de ruta</title>`, ""}<!-- HEAD_svelte-kn0kph_END -->`, ""} ${dataSession ? `${validate_component(IonPage, "IonPage").$$render($$result, {}, {}, {
    default: () => {
      return `<ion-header translucent><ion-toolbar><ion-buttons slot="start"><ion-button title="Atrás" alt="Atrás" data-svelte-h="svelte-7ppz3r"><ion-icon${add_attribute("icon", arrowBack, 0)}></ion-icon></ion-button></ion-buttons> <ion-buttons slot="end"><ion-button data-svelte-h="svelte-nf50hj"><ion-icon${add_attribute("icon", cashOutline, 0)}></ion-icon></ion-button> </ion-buttons> <ion-title>${escape(stats.name)}</ion-title></ion-toolbar></ion-header> ${checklist.length > 0 ? `${checklist.every((item) => item.img) ? `<ion-content><ion-refresher slot="fixed"${add_attribute("this", refresher, 0)} data-svelte-h="svelte-1t1tzpj"><ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content></ion-refresher> <ion-list>${each(deliveries, (delivery, index) => {
        return `<ion-item><ion-avatar slot="start"><div class="order-wrapper svelte-ziybgw"${add_attribute("title", getStatusTitle(delivery.status), 0)} style="${"background-color: " + escape(getDeliveryColor(delivery), true) + "; color: " + escape(getContrast(getDeliveryColor(delivery)), true)}"><div class="order svelte-ziybgw">${escape(parseInt(delivery.pos) + 1)}</div> </div></ion-avatar> <ion-label button><ion-text color="#2e2e2e"><h3>${escape(delivery.title)} ${delivery.support_list && delivery.support_list.length || mustCharge(delivery) ? `<span class="notes svelte-ziybgw"></span>` : ``} </h3></ion-text> <div class="sub svelte-ziybgw" data-svelte-h="svelte-130ohbs"> </div></ion-label> <ion-icon${add_attribute("icon", locationOutline, 0)} slot="end"></ion-icon> </ion-item>`;
      })}</ion-list></ion-content>` : `${escape(showChecklistModal(checklist, driverId, routeId))} <ion-content><ion-refresher slot="fixed"${add_attribute("this", refresher, 0)} data-svelte-h="svelte-1poui8g"><ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content></ion-refresher> <ion-list>${each(deliveries, (delivery, index) => {
        return `<ion-item><ion-avatar slot="start"><div class="order-wrapper svelte-ziybgw"${add_attribute("title", getStatusTitle(delivery.status), 0)} style="${"background-color: " + escape(getDeliveryColor(delivery), true) + "; color: " + escape(getContrast(getDeliveryColor(delivery)), true)}"><div class="order svelte-ziybgw">${escape(parseInt(delivery.pos) + 1)}</div> </div></ion-avatar> <ion-label button><ion-text color="#2e2e2e"><h3>${escape(delivery.title)} ${delivery.support_list && delivery.support_list.length || mustCharge(delivery) ? `<span class="notes svelte-ziybgw"></span>` : ``} </h3></ion-text> <div class="sub svelte-ziybgw" data-svelte-h="svelte-130ohbs"> </div></ion-label> <ion-icon${add_attribute("icon", locationOutline, 0)} slot="end"></ion-icon> </ion-item>`;
      })}</ion-list></ion-content>`}` : `${!loading ? `${showChecklist ? `${escape(showChecklistModal("", driverId, routeId))}` : ``} <ion-content><ion-refresher slot="fixed"${add_attribute("this", refresher, 0)} data-svelte-h="svelte-19e7x43"><ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content></ion-refresher> <ion-list>${each(deliveries, (delivery) => {
        return `<ion-item><ion-avatar slot="start"><div class="order-wrapper svelte-ziybgw"${add_attribute("title", getStatusTitle(delivery.status), 0)} style="${"background-color: " + escape(getDeliveryColor(delivery), true) + "; color: " + escape(getContrast(getDeliveryColor(delivery)), true)}"><div class="order svelte-ziybgw">${escape(parseInt(delivery.pos) + 1)}</div> </div></ion-avatar> <ion-label button><ion-text color="#2e2e2e"><h3>${escape(delivery.title)} ${delivery.support_list && delivery.support_list.length || mustCharge(delivery) ? `<span class="notes svelte-ziybgw"></span>` : ``}</h3> </ion-text></ion-label> <ion-icon${add_attribute("icon", locationOutline, 0)} slot="end" style="${"color: " + escape(getDeliveryColor(delivery), true)}"></ion-icon> </ion-item>`;
      })}</ion-list></ion-content>` : ``}`}`;
    }
  })}` : ``}`;
});

export { Page as default };
//# sourceMappingURL=_page.svelte-CQDbsA2e.js.map
