import{Z as ht,s as Xe,e as c,j as y,b as u,q as E,d as K,h as s,m as w,v as m,i as q,w as l,x as te,n as Ie,z as He,_ as Kt,B as j,o as st,k as Se,$ as pt,t as ae,r as se,f as G,a0 as xt,y as ke,a1 as et,A as ye,a2 as at,l as Wt,p as Xt}from"../chunks/index.BYLndrM5.js";import{S as Je,i as Ye,t as rt,a as ut,c as Jt,b as Yt,d as Zt,m as Qt,e as $t,g as en}from"../chunks/index.BNHbygFo.js";import{e as Be,u as tt,d as nt,a as tn,c as ft,b as qt,f as nn,g as on,i as Ft,h as ln,j as jt,s as mt,k as Ze,m as rn,n as an,o as sn,q as cn,r as un,p as fn}from"../chunks/index.DQyKaSv1.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as ot,a as Ve,I as _n}from"../chunks/IonPage.KvUD72q2.js";import{q as dn,t as hn}from"../chunks/ion-modal.CsJaVgKZ.js";import{g as je}from"../chunks/entry.uawVg834.js";const pn=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},mn=function(i){return document.createElement(i).constructor!==HTMLElement},vn=(i,e)=>{mn(i)||pn(i,e)},Re=async(i,e,t)=>{dn(),hn(),vn(i,e);const o=await ot.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Ke=ht({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Vt=ht({flag:[]});function bn(i){let e,t,o,n,r="Cancelar",h,_,v="Captura de Km/Gas",N,I,f,a="Confirmar",b,d,g,p,C,S,D;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=v,N=y(),I=c("ion-buttons"),f=c("ion-button"),f.textContent=a,b=y(),d=c("ion-content"),g=c("ion-item"),p=c("ion-input"),this.h()},l(M){e=u(M,"ION-HEADER",{translucent:!0});var A=E(e);t=u(A,"ION-TOOLBAR",{});var k=E(t);o=u(k,"ION-BUTTONS",{slot:!0});var L=E(o);n=u(L,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-17pq4f4"&&(n.textContent=r),L.forEach(s),h=w(k),_=u(k,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-1yhkaq7"&&(_.textContent=v),N=w(k),I=u(k,"ION-BUTTONS",{slot:!0});var T=E(I);f=u(T,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),K(f)!=="svelte-cm6j4s"&&(f.textContent=a),T.forEach(s),k.forEach(s),A.forEach(s),b=w(M),d=u(M,"ION-CONTENT",{fullscreen:!0});var O=E(d);g=u(O,"ION-ITEM",{});var P=E(g);p=u(P,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var R=E(p);R.forEach(s),P.forEach(s),O.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(f,"strong",""),m(I,"slot","end"),m(e,"translucent",""),m(p,"class","fin-km"),m(p,"inputmode","numeric"),m(p,"pattern","[0-9]*"),m(p,"type","number"),m(p,"placeholder",C="Ingresa "+i[0]+" actual"),m(p,"value",i[1]),m(p,"required",""),m(d,"fullscreen","")},m(M,A){q(M,e,A),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(t,N),l(t,I),l(I,f),q(M,b,A),q(M,d,A),l(d,g),l(g,p),S||(D=[te(n,"click",i[2]),te(f,"click",i[3]),te(p,"input",i[4])],S=!0)},p(M,[A]){A&1&&C!==(C="Ingresa "+M[0]+" actual")&&m(p,"placeholder",C),A&2&&m(p,"value",M[1])},i:Ie,o:Ie,d(M){M&&(s(e),s(b),s(d)),S=!1,He(D)}}}function gn(i,e,t){const o=Kt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let h;Vt.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,h="kilometraje"):t(0,h="litros de gasolina")});let _=0;function v(){ot.dismiss()}function N(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Ke.update(a=>({...a,km_inicial:[_]})):r=="gas_inicial"?Ke.update(a=>({...a,gas_inicial:[_]})):r=="km_final"?Ke.update(a=>({...a,km_final:[_]})):r=="gas_final"&&Ke.update(a=>({...a,gas_final:[_]})),v()}return[h,_,v,N,f=>t(1,_=f.target.value)]}class En extends Je{constructor(e){super(),Ye(this,e,gn,bn,Xe,{})}}const ct=ht({items:[],checkedIndices:[],mandatory:[]});function Et(i,e,t){const o=i.slice();return o[49]=e[t],o[50]=e,o[51]=t,o}function In(i){let e,t,o,n,r,h="Kilometraje inicial",_,v,N=i[0]?i[0]+" km.":"Cargar km",I,f,a,b,d,g,p,C="Gasolina inicial (litros)",S,D,M=i[1]?i[1]+" litros":"Cargar gas",A,k,L,T;return k=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=y(),r=c("p"),r.textContent=h,_=y(),v=c("ion-button"),I=ae(N),f=y(),a=c("ion-item"),b=c("ion-label"),d=c("input"),g=y(),p=c("p"),p.textContent=C,S=y(),D=c("ion-button"),A=ae(M),this.h()},l(O){e=u(O,"ION-ITEM",{});var P=E(e);t=u(P,"ION-LABEL",{style:!0});var R=E(t);o=u(R,"INPUT",{id:!0,style:!0,type:!0}),n=w(R),r=u(R,"P",{style:!0,"data-svelte-h":!0}),K(r)!=="svelte-88twxi"&&(r.textContent=h),R.forEach(s),_=w(P),v=u(P,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var B=E(v);I=se(B,N),B.forEach(s),P.forEach(s),f=w(O),a=u(O,"ION-ITEM",{});var z=E(a);b=u(z,"ION-LABEL",{style:!0});var V=E(b);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),g=w(V),p=u(V,"P",{style:!0,"data-svelte-h":!0}),K(p)!=="svelte-1ux30eb"&&(p.textContent=C),V.forEach(s),S=w(z),D=u(z,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var X=E(D);A=se(X,M),X.forEach(s),z.forEach(s),this.h()},h(){G(o,"id","chkbox-km-ini"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(v,"fill","outline"),m(v,"size","small"),m(v,"class","loadKmInicial"),m(v,"aria-selected",""),G(d,"id","chkbox-gas-ini"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(p,"margin-left","10px"),j(b,"display","flex"),m(D,"fill","outline"),m(D,"class","loadGasInicial"),m(D,"size","small"),j(D,"height","16px "),k.p(o,d)},m(O,P){q(O,e,P),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[27](o),l(t,n),l(t,r),l(e,_),l(e,v),l(v,I),q(O,f,P),q(O,a,P),l(a,b),l(b,d),i[29](d),d.checked=~(i[4]||[]).indexOf(d.__value),l(b,g),l(b,p),l(a,S),l(a,D),l(D,A),L||(T=[te(o,"change",i[26]),te(v,"click",i[28]),te(d,"change",i[30]),te(D,"click",i[31])],L=!0)},p(O,P){P[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),P[0]&1&&N!==(N=O[0]?O[0]+" km.":"Cargar km")&&ke(I,N),P[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),P[0]&2&&M!==(M=O[1]?O[1]+" litros":"Cargar gas")&&ke(A,M)},d(O){O&&(s(e),s(f),s(a)),i[27](null),i[29](null),k.r(),L=!1,He(T)}}}function On(i){let e,t,o,n,r,h="Kilometraje final",_,v,N=i[2]?i[2]+" km.":"Cargar km",I,f,a,b,d,g,p,C="Gasolina final (litros)",S,D,M=i[3]?i[3]+" litros":"Cargar gas",A,k,L,T;return k=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=y(),r=c("p"),r.textContent=h,_=y(),v=c("ion-button"),I=ae(N),f=y(),a=c("ion-item"),b=c("ion-label"),d=c("input"),g=y(),p=c("p"),p.textContent=C,S=y(),D=c("ion-button"),A=ae(M),this.h()},l(O){e=u(O,"ION-ITEM",{});var P=E(e);t=u(P,"ION-LABEL",{style:!0});var R=E(t);o=u(R,"INPUT",{id:!0,style:!0,type:!0}),n=w(R),r=u(R,"P",{style:!0,"data-svelte-h":!0}),K(r)!=="svelte-ccmu71"&&(r.textContent=h),R.forEach(s),_=w(P),v=u(P,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var B=E(v);I=se(B,N),B.forEach(s),P.forEach(s),f=w(O),a=u(O,"ION-ITEM",{});var z=E(a);b=u(z,"ION-LABEL",{style:!0});var V=E(b);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),g=w(V),p=u(V,"P",{style:!0,"data-svelte-h":!0}),K(p)!=="svelte-wsoyd2"&&(p.textContent=C),V.forEach(s),S=w(z),D=u(z,"ION-BUTTON",{fill:!0,size:!0,class:!0});var X=E(D);A=se(X,M),X.forEach(s),z.forEach(s),this.h()},h(){G(o,"id","chkbox-km-fin"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(v,"fill","outline"),m(v,"size","small"),m(v,"class","loadKmInicial"),m(v,"aria-selected",""),G(d,"id","chkbox-gas-fin"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(p,"margin-left","10px"),j(b,"display","flex"),m(D,"fill","outline"),m(D,"size","small"),m(D,"class","loadGasInicial"),k.p(o,d)},m(O,P){q(O,e,P),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[21](o),l(t,n),l(t,r),l(e,_),l(e,v),l(v,I),q(O,f,P),q(O,a,P),l(a,b),l(b,d),d.checked=~(i[4]||[]).indexOf(d.__value),i[24](d),l(b,g),l(b,p),l(a,S),l(a,D),l(D,A),L||(T=[te(o,"change",i[19]),te(v,"click",i[22]),te(d,"change",i[23]),te(D,"click",i[25])],L=!0)},p(O,P){P[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),P[0]&4&&N!==(N=O[2]?O[2]+" km.":"Cargar km")&&ke(I,N),P[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),P[0]&8&&M!==(M=O[3]?O[3]+" litros":"Cargar gas")&&ke(A,M)},d(O){O&&(s(e),s(f),s(a)),i[21](null),i[24](null),k.r(),L=!1,He(T)}}}function kn(i){let e=[],t=new Map,o,n=Be(i[12]);const r=h=>h[49].id_checklist_event;for(let h=0;h<n.length;h+=1){let _=Et(i,n,h),v=r(_);t.set(v,e[h]=It(v,_))}return{c(){for(let h=0;h<e.length;h+=1)e[h].c();o=Se()},l(h){for(let _=0;_<e.length;_+=1)e[_].l(h);o=Se()},m(h,_){for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(h,_);q(h,o,_)},p(h,_){_[0]&202864&&(n=Be(h[12]),e=tt(e,_,r,1,h,n,t,o.parentNode,nt,It,o,Et))},d(h){h&&s(o);for(let _=0;_<e.length;_+=1)e[_].d(h)}}}function It(i,e){let t,o,n,r=e[49],h,_,v=e[49].item+"",N,I,f,a,b=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"",d,g,p,C,S,D,M;const A=()=>e[33](n,r),k=()=>e[33](null,r);function L(){return e[34](e[49])}function T(...O){return e[36](e[49],...O)}return S=pt(e[20][0]),{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),h=y(),_=c("p"),N=ae(v),I=y(),f=c("ion-button"),a=c("label"),d=ae(b),g=y(),p=c("input"),C=y(),this.h()},l(O){t=u(O,"ION-ITEM",{});var P=E(t);o=u(P,"ION-LABEL",{style:!0});var R=E(o);n=u(R,"INPUT",{id:!0,style:!0,type:!0}),h=w(R),_=u(R,"P",{style:!0});var B=E(_);N=se(B,v),B.forEach(s),R.forEach(s),I=w(P),f=u(P,"ION-BUTTON",{fill:!0,class:!0,size:!0});var z=E(f);a=u(z,"LABEL",{for:!0});var V=E(a);d=se(V,b),V.forEach(s),g=w(z),p=u(z,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),z.forEach(s),C=w(P),P.forEach(s),this.h()},h(){G(n,"id",`chkbox-${e[49].id_checklist_event}`),j(n,"pointer-events","auto"),G(n,"type","checkbox"),n.__value=e[49].id_checklist_event,xt(n,n.__value),n.required=!0,j(_,"margin-left","10px"),j(o,"display","flex"),G(a,"for","chklist-"+e[49].id_checklist_event),j(p,"display","none"),G(p,"id","chklist-"+e[49].id_checklist_event),G(p,"name","fileToUpload"),G(p,"type","file"),G(p,"accept","image/*"),m(f,"fill","outline"),m(f,"class","loadEvidence svelte-1lh6nay"),m(f,"size","small"),S.p(n),this.first=t},m(O,P){q(O,t,P),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),A(),l(o,h),l(o,_),l(_,N),l(t,I),l(t,f),l(f,a),l(a,d),l(f,g),l(f,p),e[35](p),l(t,C),D||(M=[te(n,"change",e[32]),te(n,"change",L),te(p,"change",T)],D=!0)},p(O,P){e=O,P[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[49]&&(k(),r=e[49],A()),P[0]&2048&&b!==(b=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"")&&ke(d,b)},d(O){O&&s(t),k(),e[35](null),S.r(),D=!1,He(M)}}}function Nn(i){let e,t,o,n,r="Cancelar",h,_,v="Requerimientos de ruta",N,I,f,a,b,d,g,p="Confirmar",C,S;function D(L,T){return L[13]?On:In}let A=D(i)(i),k=i[12]&&kn(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=v,N=y(),I=c("ion-content"),f=c("ion-list"),A.c(),a=y(),k&&k.c(),b=y(),d=c("ion-footer"),g=c("ion-button"),g.textContent=p,this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var T=E(e);t=u(T,"ION-TOOLBAR",{});var O=E(t);o=u(O,"ION-BUTTONS",{slot:!0});var P=E(o);n=u(P,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1dnmkxs"&&(n.textContent=r),P.forEach(s),h=w(O),_=u(O,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-ucox25"&&(_.textContent=v),O.forEach(s),T.forEach(s),N=w(L),I=u(L,"ION-CONTENT",{fullscreen:!0});var R=E(I);f=u(R,"ION-LIST",{});var B=E(f);A.l(B),a=w(B),k&&k.l(B),B.forEach(s),R.forEach(s),b=w(L),d=u(L,"ION-FOOTER",{});var z=E(d);g=u(z,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(g)!=="svelte-g82qqw"&&(g.textContent=p),z.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(e,"translucent",""),m(I,"fullscreen",""),m(g,"fill","outline"),m(g,"color","tertiary"),m(g,"strong",""),j(g,"width","99%"),j(g,"height","auto")},m(L,T){q(L,e,T),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(L,N,T),q(L,I,T),l(I,f),A.m(f,null),l(f,a),k&&k.m(f,null),q(L,b,T),q(L,d,T),l(d,g),C||(S=[te(n,"click",i[14]),te(g,"click",i[15])],C=!0)},p(L,T){A.p(L,T),L[12]&&k.p(L,T)},i:Ie,o:Ie,d(L){L&&(s(e),s(N),s(I),s(b),s(d)),A.d(),k&&k.d(),C=!1,He(S)}}}function _t(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>_t(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function it(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function Tn(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,h=o.componentProps.routeId,_=o.componentProps.isLast;let v,N,I,f,a=[],b=null,d={},g,p,C,S,D={},M={};st(()=>{_?console.log("Último checklist"):ct.update(U=>(U.mandatory=_t(n,"mandatory"),U.items=_t(n,"id_checklist_event"),U))});const A=async()=>{await(await Ve.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},k=async()=>{await(await Ve.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},L=async U=>{await(await Ve.create({header:"Datos inválidos",message:U=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},T=()=>{ot.dismiss(),r?je(`/drivers/${r}`):je("/drivers/me")},O=()=>{if(_){var U=z(I,"km"),x=z(f,"gas");const _e=new FormData;_e.append("km_final",U),_e.append("gas_final",x),_e.append("id_route",h),U&&x?(T(),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:_e}).then(be=>be.json()).then(be=>{k()}).catch(be=>{console.error("Error fetching data:",be)})):A()}else{var le=z(v,"km"),fe=z(N,"gas");ct.update(_e=>{const be=_e.items,J=_e.mandatory;if(be.every(ee=>_e.checkedIndices.includes(ee))&&le&&fe){T();const ee=new FormData;for(const oe in D)if(D.hasOwnProperty(oe)){const{img:Oe,img_id:ne}=D[oe];ee.append(`selectedImages[${oe}][img]`,Oe),ee.append(`selectedImages[${oe}][img_id]`,ne)}ee.append("km_inicial",le),ee.append("gas_inicial",fe),ee.append("id_route",h),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ee}).then(oe=>oe.json()).then(oe=>{J&&J[0]=="1"?it(h,"checklist-pending"):it(h,"enroute")}).catch(oe=>{console.error("Error fetching data:",oe)})}else if(!J&&le&&fe){var $=new FormData;$.append("km_inicial",le),$.append("gas_inicial",fe),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:$}).then(ee=>ee.json()).then(ee=>{it(h,"enroute")}).catch(ee=>{console.error("Error fetching data:",ee)})}else A();return _e})}H()},P=async(U,x)=>{const fe=U.target.files[0],_e=await R(fe);if(_e){const be=new FormData;be.append("fileToUpload",_e);try{const J=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:be});if(J.ok){const W=await J.json();D={...D,[x]:{img:W.img,img_id:W.img_id}},t(11,M={...M,[x]:W.filename}),B(x),t(6,d[x].checked=!0,d)}else console.error("File upload failed:",J.statusText)}catch(J){console.error("Error during file upload:",J)}}},R=async U=>new Promise(x=>{const le=new FileReader;le.onload=fe=>{const _e=new Image;_e.src=fe.target.result,_e.onload=()=>{const be=document.createElement("canvas"),J=be.getContext("2d"),W=800,$=600;let ee=_e.width,oe=_e.height;ee>W&&(oe*=W/ee,ee=W),oe>$&&(ee*=$/oe,oe=$),be.width=ee,be.height=oe,J.drawImage(_e,0,0,ee,oe),be.toBlob(Oe=>{x(Oe)},"image/jpeg",.7)}},le.readAsDataURL(U)}),B=U=>{ct.update(x=>(x.checkedIndices.indexOf(U)===-1?x.checkedIndices.push(U):console.error(`ID ${U} is already checked.`),x.items.forEach(fe=>{fe.id_checklist_event===U&&(fe.checked=!0)}),x))};function z(U,x){return/^\d+$/.test(U)?parseInt(U,10):(L(x),null)}function V(U,x){X(x),o.componentProps.data_type=x,Re("modal-gas-km",En,{r:x}).then(()=>{Ke.subscribe(le=>{Y(le,x)})})}function X(U){Vt.update(x=>({...x,flag:[U]}))}function Y(U,x){t(0,v=U.km_inicial?U.km_inicial:null),t(1,N=U.gas_inicial?U.gas_inicial:null),t(2,I=U.km_final?U.km_final:null),t(3,f=U.gas_final?U.gas_final:null),x=="km_inicial"&&t(7,g.checked=!0,g),x=="gas_inicial"&&t(8,p.checked=!0,p),x=="km_final"&&t(9,C.checked=!0,C),x=="gas_final"&&t(10,S.checked=!0,S)}function H(){Ke.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const F=[[]];function Z(){a=et(F[0],this.__value,this.checked),t(4,a)}function ie(U){ye[U?"unshift":"push"](()=>{C=U,t(9,C)})}const pe=U=>V(U,"km_final");function ue(){a=et(F[0],this.__value,this.checked),t(4,a)}function he(U){ye[U?"unshift":"push"](()=>{S=U,t(10,S)})}const Pe=U=>V(U,"gas_final");function ge(){a=et(F[0],this.__value,this.checked),t(4,a)}function Le(U){ye[U?"unshift":"push"](()=>{g=U,t(7,g)})}const me=U=>V(U,"km_inicial");function de(U){ye[U?"unshift":"push"](()=>{p=U,t(8,p)})}function ce(){a=et(F[0],this.__value,this.checked),t(4,a)}const Ee=U=>V(U,"gas_inicial");function Ue(){a=et(F[0],this.__value,this.checked),t(4,a)}function Te(U,x){ye[U?"unshift":"push"](()=>{d[x.id_checklist_event]=U,t(6,d)})}const Ce=U=>B(U.id_checklist_event);function De(U){ye[U?"unshift":"push"](()=>{b=U,t(5,b)})}return[v,N,I,f,a,b,d,g,p,C,S,M,n,_,T,O,P,B,V,Z,F,ie,pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue,Te,Ce,De,(U,x)=>P(x,U.id_checklist_event)]}class Gt extends Je{constructor(e){super(),Ye(this,e,Tn,Nn,Xe,{},null,[-1,-1])}}function Cn(i){let e,t,o,n,r,h="Teléfono de Negocio",_,v,N=i[4].client_phone+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var a=E(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(a),n=u(a,"ION-LABEL",{class:!0});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1u5l7fz"&&(r.textContent=h),_=w(b),v=u(b,"H2",{});var d=E(v);I=se(d,N),d.forEach(s),b.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",nn),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href","tel:"+i[4].client_phone)},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ie,d(f){f&&s(e)}}}function yn(i){let e,t,o,n,r,h="Domicilio Alternativo",_,v,N=i[4].line2+"",I,f,a;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),f=y(),a=c("ion-icon"),this.h()},l(b){e=u(b,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(d),n=u(d,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=w(g),v=u(g,"H2",{});var p=E(v);I=se(p,N),p.forEach(s),g.forEach(s),f=w(d),a=u(d,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ze),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[4].line2)},m(b,d){q(b,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a)},p:Ie,d(b){b&&s(e)}}}function wn(i){let e,t,o,n,r,h="Domicilio",_,v,N=i[4].line1+"",I,f,a,b,d=i[4].line2&&i[4].line2.trim().length,g,p=d&&Ln(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),f=y(),a=c("ion-icon"),b=y(),p&&p.c(),g=Se(),this.h()},l(C){e=u(C,"ION-ITEM",{href:!0});var S=E(e);t=u(S,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(S),n=u(S,"ION-LABEL",{class:!0});var D=E(n);r=u(D,"P",{"data-svelte-h":!0}),K(r)!=="svelte-cbm7q1"&&(r.textContent=h),_=w(D),v=u(D,"H2",{});var M=E(v);I=se(M,N),M.forEach(s),D.forEach(s),f=w(S),a=u(S,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),S.forEach(s),b=w(C),p&&p.l(C),g=Se(),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ze),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line1)},m(C,S){q(C,e,S),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a),q(C,b,S),p&&p.m(C,S),q(C,g,S)},p(C,S){d&&p.p(C,S)},d(C){C&&(s(e),s(b),s(g)),p&&p.d(C)}}}function Ln(i){let e,t,o,n,r,h="Domicilio Alternativo",_,v,N=i[4].line2+"",I,f,a;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),f=y(),a=c("ion-icon"),this.h()},l(b){e=u(b,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(d),n=u(d,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=w(g),v=u(g,"H2",{});var p=E(v);I=se(p,N),p.forEach(s),g.forEach(s),f=w(d),a=u(d,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ze),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line2)},m(b,d){q(b,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a)},p:Ie,d(b){b&&s(e)}}}function Ot(i){let e,t,o,n,r,h="Llamar al Cliente",_,v,N,I,f,a,b=`<ion-icon icon="${rn}" slot="start"></ion-icon>
                Notificar Cliente`,d,g;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),N=ae(i[2]),f=y(),a=c("ion-button"),a.innerHTML=b,this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var C=E(e);t=u(C,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(C),n=u(C,"ION-LABEL",{class:!0});var S=E(n);r=u(S,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1f6ke1o"&&(r.textContent=h),_=w(S),v=u(S,"H2",{});var D=E(v);N=se(D,i[2]),D.forEach(s),S.forEach(s),C.forEach(s),f=w(p),a=u(p,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),K(a)!=="svelte-9ije92"&&(a.innerHTML=b),this.h()},h(){m(t,"icon",on),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href",I="tel:"+i[2]),m(a,"fill","outline"),j(a,"margin-left","16px")},m(p,C){q(p,e,C),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,N),q(p,f,C),q(p,a,C),d||(g=te(a,"click",i[8]),d=!0)},p(p,C){C&4&&ke(N,p[2]),C&4&&I!==(I="tel:"+p[2])&&m(e,"href",I)},d(p){p&&(s(e),s(f),s(a)),d=!1,g()}}}function kt(i){let e,t,o,n,r,h="Notas de ubicación",_,v,N;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),N=ae(i[3]),this.h()},l(I){e=u(I,"ION-ITEM",{});var f=E(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(f),n=u(f,"ION-LABEL",{class:!0});var a=E(n);r=u(a,"P",{"data-svelte-h":!0}),K(r)!=="svelte-nhm2ft"&&(r.textContent=h),_=w(a),v=u(a,"H2",{});var b=E(v);N=se(b,i[3]),b.forEach(s),a.forEach(s),f.forEach(s),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(I,f){q(I,e,f),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,N)},p(I,f){f&8&&ke(N,I[3])},d(I){I&&s(e)}}}function Sn(i){let e,t,o,n,r,h="Horarios",_,v,N=i[4].schedule+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=E(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(a),n=u(a,"ION-LABEL",{});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),K(r)!=="svelte-11q7hm5"&&(r.textContent=h),_=w(b),v=u(b,"H2",{});var d=E(v);I=se(d,N),d.forEach(s),b.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",ln),m(t,"slot","start")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ie,d(f){f&&s(e)}}}function Pn(i){let e,t,o,n,r,h="Notas del operador",_,v,N=i[4].driver_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=E(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(a),n=u(a,"ION-LABEL",{});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1yk9qp4"&&(r.textContent=h),_=w(b),v=u(b,"H2",{});var d=E(v);I=se(d,N),d.forEach(s),b.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",jt),m(t,"slot","start")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ie,d(f){f&&s(e)}}}function Mn(i){let e,t=i[4].logistic_comments!="<br>"&&An(i);return{c(){t&&t.c(),e=Se()},l(o){t&&t.l(o),e=Se()},m(o,n){t&&t.m(o,n),q(o,e,n)},p(o,n){o[4].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&s(e),t&&t.d(o)}}}function An(i){let e,t,o,n,r,h="Comentarios logísticos",_,v,N=i[4].logistic_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),v=c("h2"),I=ae(N),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=E(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=w(a),n=u(a,"ION-LABEL",{class:!0});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),K(r)!=="svelte-1iz85r6"&&(r.textContent=h),_=w(b),v=u(b,"H2",{});var d=E(v);I=se(d,N),d.forEach(s),b.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ie,d(f){f&&s(e)}}}function Nt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(s),r.forEach(s),this.h()},h(){at(t.src,o=i[1])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&2&&!at(t.src,o=n[1])&&m(t,"src",o)},d(n){n&&s(e)}}}function Bn(i){let e,t,o,n,r="Cancelar",h,_,v=i[4].title+"",N,I,f,a,b="Confirmar",d,g,p,C,S,D,M,A,k="Negocio",L,T,O=i[4].client_name+"",P,R,B=i[4].client_phone&&i[4].client_phone.trim().length,z,V,X,Y,H=i[4].schedule&&i[4].schedule.trim().length,F,Z,ie=i[4].logistic_comments&&i[4].logistic_comments.trim().length,pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue,Te,Ce="Subir Evidencia",De,Ne,U,x,le,fe=B&&Cn(i);function _e(Q,ve){if(Q[4].line1&&Q[4].line1.trim().length)return wn;if(Q[4].line2&&Q[4].line2.trim().length)return yn}let be=_e(i),J=be&&be(i),W=i[2]&&Ot(i),$=i[3]&&i[3]!=="<br>"&&kt(i),ee=H&&Sn(i),oe=i[4].driver_comments&&Pn(i),Oe=ie&&Mn(i),ne=i[1]&&Nt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),N=ae(v),I=y(),f=c("ion-buttons"),a=c("ion-button"),a.textContent=b,d=y(),g=c("ion-content"),p=c("ion-list"),C=c("ion-item"),S=c("ion-icon"),D=y(),M=c("ion-label"),A=c("p"),A.textContent=k,L=y(),T=c("h2"),P=ae(O),R=y(),fe&&fe.c(),z=y(),J&&J.c(),V=y(),W&&W.c(),X=y(),$&&$.c(),Y=y(),ee&&ee.c(),F=y(),oe&&oe.c(),Z=y(),Oe&&Oe.c(),pe=y(),ue=c("ion-item"),he=c("ion-icon"),Pe=y(),ge=c("ion-textarea"),Le=y(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("ion-icon"),Ue=y(),Te=c("label"),Te.textContent=Ce,De=y(),Ne=c("input"),U=y(),ne&&ne.c(),this.h()},l(Q){e=u(Q,"ION-HEADER",{translucent:!0});var ve=E(e);t=u(ve,"ION-TOOLBAR",{});var Me=E(t);o=u(Me,"ION-BUTTONS",{slot:!0});var Ae=E(o);n=u(Ae,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Ae.forEach(s),h=w(Me),_=u(Me,"ION-TITLE",{title:!0});var ze=E(_);N=se(ze,v),ze.forEach(s),I=w(Me),f=u(Me,"ION-BUTTONS",{slot:!0});var Qe=E(f);a=u(Qe,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),K(a)!=="svelte-1ida0il"&&(a.textContent=b),Qe.forEach(s),Me.forEach(s),ve.forEach(s),d=w(Q),g=u(Q,"ION-CONTENT",{fullscreen:!0});var $e=E(g);p=u($e,"ION-LIST",{});var re=E(p);C=u(re,"ION-ITEM",{});var qe=E(C);S=u(qe,"ION-ICON",{icon:!0,slot:!0}),E(S).forEach(s),D=w(qe),M=u(qe,"ION-LABEL",{});var Fe=E(M);A=u(Fe,"P",{"data-svelte-h":!0}),K(A)!=="svelte-57b1dg"&&(A.textContent=k),L=w(Fe),T=u(Fe,"H2",{});var vt=E(T);P=se(vt,O),vt.forEach(s),Fe.forEach(s),qe.forEach(s),R=w(re),fe&&fe.l(re),z=w(re),J&&J.l(re),V=w(re),W&&W.l(re),X=w(re),$&&$.l(re),Y=w(re),ee&&ee.l(re),F=w(re),oe&&oe.l(re),Z=w(re),Oe&&Oe.l(re),pe=w(re),ue=u(re,"ION-ITEM",{});var lt=E(ue);he=u(lt,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(s),Pe=w(lt),ge=u(lt,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(s),lt.forEach(s),Le=w(re),me=u(re,"SECTION",{});var bt=E(me);de=u(bt,"LABEL",{for:!0,style:!0});var gt=E(de);ce=u(gt,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ge=E(ce);Ee=u(Ge,"ION-ICON",{icon:!0,slot:!0}),E(Ee).forEach(s),Ue=w(Ge),Te=u(Ge,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),K(Te)!=="svelte-1as0od8"&&(Te.textContent=Ce),De=w(Ge),Ne=u(Ge,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ge.forEach(s),gt.forEach(s),bt.forEach(s),U=w(re),ne&&ne.l(re),re.forEach(s),$e.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",i[4].title),m(a,"strong",""),m(f,"slot","end"),m(e,"translucent",""),m(S,"icon",tn),m(S,"slot","start"),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Notas"),m(ge,"placeholder","Escribe aquí..."),m(Ee,"icon",qt),m(Ee,"slot","start"),G(Te,"for","eventEvidence"),j(Te,"padding","8px 10px"),j(Ne,"display","none"),G(Ne,"id","eventEvidence"),G(Ne,"name","fileToUpload"),G(Ne,"type","file"),G(Ne,"accept","image/*"),m(ce,"fill","outline"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(g,"fullscreen","")},m(Q,ve){q(Q,e,ve),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,N),l(t,I),l(t,f),l(f,a),q(Q,d,ve),q(Q,g,ve),l(g,p),l(p,C),l(C,S),l(C,D),l(C,M),l(M,A),l(M,L),l(M,T),l(T,P),l(p,R),fe&&fe.m(p,null),l(p,z),J&&J.m(p,null),l(p,V),W&&W.m(p,null),l(p,X),$&&$.m(p,null),l(p,Y),ee&&ee.m(p,null),l(p,F),oe&&oe.m(p,null),l(p,Z),Oe&&Oe.m(p,null),l(p,pe),l(p,ue),l(ue,he),l(ue,Pe),l(ue,ge),i[9](ge),l(p,Le),l(p,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Ue),l(ce,Te),l(ce,De),l(ce,Ne),l(p,U),ne&&ne.m(p,null),x||(le=[te(n,"click",i[6]),te(a,"click",i[7]),te(Ne,"change",i[5])],x=!0)},p(Q,[ve]){B&&fe.p(Q,ve),J&&J.p(Q,ve),Q[2]?W?W.p(Q,ve):(W=Ot(Q),W.c(),W.m(p,X)):W&&(W.d(1),W=null),Q[3]&&Q[3]!=="<br>"?$?$.p(Q,ve):($=kt(Q),$.c(),$.m(p,Y)):$&&($.d(1),$=null),H&&ee.p(Q,ve),Q[4].driver_comments&&oe.p(Q,ve),ie&&Oe.p(Q,ve),Q[1]?ne?ne.p(Q,ve):(ne=Nt(Q),ne.c(),ne.m(p,null)):ne&&(ne.d(1),ne=null)},i:Ie,o:Ie,d(Q){Q&&(s(e),s(d),s(g)),fe&&fe.d(),J&&J.d(),W&&W.d(),$&&$.d(),ee&&ee.d(),oe&&oe.d(),Oe&&Oe.d(),i[9](null),ne&&ne.d(),x=!1,He(le)}}}const Tt=/Teléfono:\s*(\d{10,})/;function Dn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,h=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",v="",N={latitude:null,longitude:null},I="",f=n.comments_ext;if(n.comments_ext){const k=n.comments_ext.match(Tt);k&&(I=k[1],f=n.comments_ext.replace(Tt,"").trim())}const a=async()=>{await(await Ve.create({header:"SMS enviado",message:"Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+I,buttons:[{text:"Cerrar"}]})).present()},b=async()=>{await(await Ve.create({header:"SMS no enviado",message:"Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.",buttons:[{text:"Cerrar"}]})).present()},d=async k=>{const T=k.target.files[0],O=await g(T);if(O){const P=new FormData;P.append("fileToUpload",O);try{const R=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:P});if(R.ok){const B=await R.json();t(1,_=B.img),v=B.img_id}else console.error("File upload failed:",R.statusText)}catch(R){console.error("Error during file upload:",R)}}},g=async k=>new Promise(L=>{const T=new FileReader;T.onload=O=>{const P=new Image;P.src=O.target.result,P.onload=()=>{const R=document.createElement("canvas"),B=R.getContext("2d"),z=800,V=600;let X=P.width,Y=P.height;X>z&&(Y*=z/X,X=z),Y>V&&(X*=V/Y,Y=V),R.width=X,R.height=Y,B.drawImage(P,0,0,X,Y),R.toBlob(H=>{L(H)},"image/jpeg",.7)}},T.readAsDataURL(k)}),p=()=>{o.dismiss({data:Date.now()})},C=async()=>{try{if(await D()){const L={id_route:n.id_route,id_event:n.id_event,comments:h.value,img:_,img_id:v,lat:N.latitude,lon:N.longitude},T=new FormData;for(const z in L)T.append(z,L[z]);const P=await(await fetch("https://dev.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:T})).json();p();const R={},B=L.id_route;r&&S("","",B,r)}else console.log("No entré")}catch(k){console.error("Error fetching data:",k)}},S=(k,L,T,O)=>{o.componentProps.routeId=T,o.componentProps.driverId=n.id_driver,Re("modal-km-gas",Gt,{checklist:k,driverId:L,routeId:T,isLast:O}).then(P=>{})},D=async()=>navigator.geolocation?new Promise((k,L)=>{navigator.geolocation.getCurrentPosition(T=>{N.latitude=T.coords.latitude,N.longitude=T.coords.longitude,k(!0)},T=>{console.error("Error getting location:",T),k(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function M(k){k.stopPropagation();const L=new FormData;L.append("client_phone",I),L.append("client_name",n.title),L.append("delivery_phone",n.client_phone),L.append("enterprise_name",n.enterprise_name);try{const T=await fetch("https://dev.rutaflow.com/api/admin/message_central/send_sms.php",{method:"POST",body:L});if(T.ok){const O=await T.json();a()}else b()}catch(T){console.error("Error during file upload:",T)}}function A(k){ye[k?"unshift":"push"](()=>{h=k,t(0,h)})}return[h,_,I,f,n,d,p,C,M,A]}class Hn extends Je{constructor(e){super(),Ye(this,e,Dn,Bn,Xe,{})}}function Ct(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(s),r.forEach(s),this.h()},h(){at(t.src,o=i[0])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&1&&!at(t.src,o=n[0])&&m(t,"src",o)},d(n){n&&s(e)}}}function Un(i){let e,t,o,n,r="Cancelar",h,_,v="Agregar Gasto",N,I,f,a,b,d,g,p,C,S,D,M,A,k,L,T,O,P,R='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',B,z,V="Efectivo",X,Y,H="Tarjeta",F,Z,ie="Transferencia",pe,ue,he,Pe,ge,Le,me,de,ce,Ee,Ue=`<ion-icon icon="${qt}" slot="start"></ion-icon>
                        Subir Evidencia`,Te,Ce,De,Ne,U,x,le,fe="Confirmar",_e,be,J=i[0]&&Ct(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=v,N=y(),I=c("ion-content"),f=c("ion-list"),a=c("ion-item"),b=c("ion-icon"),d=y(),g=c("ion-input"),p=y(),C=c("ion-item"),S=c("ion-icon"),D=y(),M=c("ion-input"),A=y(),k=c("ion-item"),L=c("ion-icon"),T=y(),O=c("ion-select"),P=c("div"),P.innerHTML=R,B=y(),z=c("ion-select-option"),z.textContent=V,X=y(),Y=c("ion-select-option"),Y.textContent=H,F=y(),Z=c("ion-select-option"),Z.textContent=ie,pe=y(),ue=c("ion-item"),he=c("ion-icon"),Pe=y(),ge=c("ion-textarea"),Le=y(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("label"),Ee.innerHTML=Ue,Te=y(),Ce=c("input"),De=y(),J&&J.c(),Ne=y(),U=c("ion-footer"),x=c("ion-toolbar"),le=c("ion-button"),le.textContent=fe,this.h()},l(W){e=u(W,"ION-HEADER",{translucent:!0});var $=E(e);t=u($,"ION-TOOLBAR",{});var ee=E(t);o=u(ee,"ION-BUTTONS",{slot:!0});var oe=E(o);n=u(oe,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-1f8rjcf"&&(n.textContent=r),oe.forEach(s),h=w(ee),_=u(ee,"ION-TITLE",{title:!0,"data-svelte-h":!0}),K(_)!=="svelte-10xvxus"&&(_.textContent=v),ee.forEach(s),$.forEach(s),N=w(W),I=u(W,"ION-CONTENT",{fullscreen:!0});var Oe=E(I);f=u(Oe,"ION-LIST",{});var ne=E(f);a=u(ne,"ION-ITEM",{});var Q=E(a);b=u(Q,"ION-ICON",{icon:!0,slot:!0}),E(b).forEach(s),d=w(Q),g=u(Q,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(g).forEach(s),Q.forEach(s),p=w(ne),C=u(ne,"ION-ITEM",{});var ve=E(C);S=u(ve,"ION-ICON",{icon:!0,slot:!0}),E(S).forEach(s),D=w(ve),M=u(ve,"ION-INPUT",{label:!0,type:!0,value:!0}),E(M).forEach(s),ve.forEach(s),A=w(ne),k=u(ne,"ION-ITEM",{});var Me=E(k);L=u(Me,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(s),T=w(Me),O=u(Me,"ION-SELECT",{placeholder:!0,value:!0});var Ae=E(O);P=u(Ae,"DIV",{slot:!0,"data-svelte-h":!0}),K(P)!=="svelte-wl764p"&&(P.innerHTML=R),B=w(Ae),z=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(z)!=="svelte-i9crym"&&(z.textContent=V),X=w(Ae),Y=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(Y)!=="svelte-fx0z11"&&(Y.textContent=H),F=w(Ae),Z=u(Ae,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),K(Z)!=="svelte-1c24jf2"&&(Z.textContent=ie),Ae.forEach(s),Me.forEach(s),pe=w(ne),ue=u(ne,"ION-ITEM",{});var ze=E(ue);he=u(ze,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(s),Pe=w(ze),ge=u(ze,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(s),ze.forEach(s),Le=w(ne),me=u(ne,"SECTION",{});var Qe=E(me);de=u(Qe,"LABEL",{for:!0,style:!0});var $e=E(de);ce=u($e,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var re=E(ce);Ee=u(re,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),K(Ee)!=="svelte-1m9yw22"&&(Ee.innerHTML=Ue),Te=w(re),Ce=u(re,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),re.forEach(s),$e.forEach(s),Qe.forEach(s),De=w(ne),J&&J.l(ne),ne.forEach(s),Oe.forEach(s),Ne=w(W),U=u(W,"ION-FOOTER",{});var qe=E(U);x=u(qe,"ION-TOOLBAR",{});var Fe=E(x);le=u(Fe,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(le)!=="svelte-1c7dl3f"&&(le.textContent=fe),Fe.forEach(s),qe.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",""),m(e,"translucent",""),m(b,"icon",jt),m(b,"slot","start"),m(g,"label","Concepto"),m(g,"type","text"),m(g,"placeholder","Escribe aquí..."),m(g,"value",i[5]?i[5]:""),m(S,"icon",ft),m(S,"slot","start"),m(M,"label","Cantidad"),m(M,"type","number"),m(M,"value",i[6]?i[6]:""),m(L,"icon",an),m(L,"slot","start"),G(P,"slot","label"),m(z,"value","cash"),m(Y,"value","card"),m(Z,"value","transfer"),m(O,"placeholder","Tipo de pago"),m(O,"value",i[7]?i[7]:""),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Comentarios"),m(ge,"placeholder","Escribe aquí..."),G(Ee,"for","eventEvidence"),j(Ee,"width","100%"),j(Ee,"padding","8px"),j(Ce,"display","none"),G(Ce,"id","eventEvidence"),G(Ce,"name","fileToUpload"),G(Ce,"type","file"),G(Ce,"accept","image/*"),m(ce,"fill","outline"),m(ce,"size","small"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(I,"fullscreen",""),m(le,"fill","outline"),m(le,"color","tertiary"),m(le,"strong",""),j(le,"width","99%"),j(le,"height","auto")},m(W,$){q(W,e,$),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(W,N,$),q(W,I,$),l(I,f),l(f,a),l(a,b),l(a,d),l(a,g),i[11](g),l(f,p),l(f,C),l(C,S),l(C,D),l(C,M),i[12](M),l(f,A),l(f,k),l(k,L),l(k,T),l(k,O),l(O,P),l(O,B),l(O,z),l(O,X),l(O,Y),l(O,F),l(O,Z),i[13](O),l(f,pe),l(f,ue),l(ue,he),l(ue,Pe),l(ue,ge),i[14](ge),l(f,Le),l(f,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Te),l(ce,Ce),l(f,De),J&&J.m(f,null),q(W,Ne,$),q(W,U,$),l(U,x),l(x,le),_e||(be=[te(n,"click",i[9]),te(Ce,"change",i[8]),te(le,"click",i[10])],_e=!0)},p(W,[$]){W[0]?J?J.p(W,$):(J=Ct(W),J.c(),J.m(f,null)):J&&(J.d(1),J=null)},i:Ie,o:Ie,d(W){W&&(s(e),s(N),s(I),s(Ne),s(U)),i[11](null),i[12](null),i[13](null),i[14](null),J&&J.d(),_e=!1,He(be)}}}function Rn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,h=o.componentProps.ex_amount,_=o.componentProps.ex_type,v=o.componentProps.id_expense,N="",I="",f="",a=0,b="",d="";st(()=>{});const g=async(T,O)=>{await(await Ve.create({header:T||"Error",message:O||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},p=async T=>{const P=T.target.files[0],R=await C(P);if(R){const B=new FormData;B.append("fileToUpload",R);try{const z=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:B});if(z.ok){const V=await z.json();t(0,N=V.img),I=V.img_id}else console.error("File upload failed:",z.statusText)}catch(z){console.error("Error during file upload:",z)}}},C=async T=>new Promise(O=>{const P=new FileReader;P.onload=R=>{const B=new Image;B.src=R.target.result,B.onload=()=>{const z=document.createElement("canvas"),V=z.getContext("2d"),X=800,Y=600;let H=B.width,F=B.height;H>X&&(F*=X/H,H=X),F>Y&&(H*=Y/F,F=Y),z.width=H,z.height=F,V.drawImage(B,0,0,H,F),z.toBlob(Z=>{O(Z)},"image/jpeg",.7)}},P.readAsDataURL(T)}),S=()=>{ot.dismiss()},D=()=>{var T=new Object;T.id_route=n,T.comments=b.value,T.type=f.value,T.img=N,T.img_id=I,T.amount=a.value,T.concept=d.value,T.status="done",T.id_expense=v||"null";const O=new FormData;for(const P in T)O.append(P,T[P]);!I||!N||!b.value||!a.value||!d.value?g("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://dev.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:O}).then(P=>P.json()).then(P=>{S()}).catch(P=>{console.error("Error fetching data:",P)})};function M(T){ye[T?"unshift":"push"](()=>{d=T,t(4,d)})}function A(T){ye[T?"unshift":"push"](()=>{a=T,t(2,a)})}function k(T){ye[T?"unshift":"push"](()=>{f=T,t(1,f)})}function L(T){ye[T?"unshift":"push"](()=>{b=T,t(3,b)})}return[N,f,a,b,d,r,h,_,p,S,D,M,A,k,L]}class dt extends Je{constructor(e){super(),Ye(this,e,Rn,Un,Xe,{})}}function yt(i,e,t){const o=i.slice();return o[7]=e[t],o}function zn(i){let e,t="Cargar gasto",o,n;function r(...h){return i[4](i[7],...h)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(h){e=u(h,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),K(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){m(e,"fill","outline"),m(e,"size","small"),m(e,"aria-selected","")},m(h,_){q(h,e,_),o||(n=te(e,"click",r),o=!0)},p(h,_){i=h},d(h){h&&s(e),o=!1,n()}}}function qn(i){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),K(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){m(e,"fill","solid"),m(e,"size","small"),m(e,"aria-selected","")},m(o,n){q(o,e,n)},p:Ie,d(o){o&&s(e)}}}function wt(i,e){let t,o,n,r=e[7].concept+"",h,_,v;function N(a,b){return a[7].status=="done"?qn:zn}let f=N(e)(e);return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),h=ae(r),_=y(),f.c(),v=y(),this.h()},l(a){t=u(a,"ION-ITEM",{});var b=E(t);o=u(b,"ION-LABEL",{style:!0});var d=E(o);n=u(d,"P",{style:!0});var g=E(n);h=se(g,r),g.forEach(s),d.forEach(s),_=w(b),f.l(b),v=w(b),b.forEach(s),this.h()},h(){j(n,"margin-left","10px"),j(o,"display","flex"),this.first=t},m(a,b){q(a,t,b),l(t,o),l(o,n),l(n,h),l(t,_),f.m(t,null),l(t,v)},p(a,b){e=a,f.p(e,b)},d(a){a&&s(t),f.d()}}}function Fn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${sn}"></ion-icon>`,h,_,v="Lista de gastos",N,I,f,a=[],b=new Map,d,g,p,C="Cerrar",S,D,M=Be(i[0]);const A=k=>k[7].id_expenses;for(let k=0;k<M.length;k+=1){let L=yt(i,M,k),T=A(L);b.set(T,a[k]=wt(T,L))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=y(),_=c("ion-title"),_.textContent=v,N=y(),I=c("ion-content"),f=c("ion-list");for(let k=0;k<a.length;k+=1)a[k].c();d=y(),g=c("ion-footer"),p=c("ion-button"),p.textContent=C,this.h()},l(k){e=u(k,"ION-HEADER",{translucent:!0});var L=E(e);t=u(L,"ION-TOOLBAR",{});var T=E(t);o=u(T,"ION-BUTTONS",{slot:!0});var O=E(o);n=u(O,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),K(n)!=="svelte-160xz3i"&&(n.innerHTML=r),O.forEach(s),h=w(T),_=u(T,"ION-TITLE",{"data-svelte-h":!0}),K(_)!=="svelte-e3wnox"&&(_.textContent=v),T.forEach(s),L.forEach(s),N=w(k),I=u(k,"ION-CONTENT",{fullscreen:!0});var P=E(I);f=u(P,"ION-LIST",{});var R=E(f);for(let z=0;z<a.length;z+=1)a[z].l(R);R.forEach(s),P.forEach(s),d=w(k),g=u(k,"ION-FOOTER",{});var B=E(g);p=u(B,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),K(p)!=="svelte-zv7v83"&&(p.textContent=C),B.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","end"),m(e,"translucent",""),m(I,"fullscreen",""),m(p,"fill","outline"),m(p,"color","tertiary"),m(p,"strong",""),j(p,"width","99%"),j(p,"height","auto")},m(k,L){q(k,e,L),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(k,N,L),q(k,I,L),l(I,f);for(let T=0;T<a.length;T+=1)a[T]&&a[T].m(f,null);q(k,d,L),q(k,g,L),l(g,p),S||(D=[te(n,"click",i[3]),te(p,"click",i[1])],S=!0)},p(k,[L]){L&5&&(M=Be(k[0]),a=tt(a,L,A,1,k,M,b,f,nt,wt,null,yt))},i:Ie,o:Ie,d(k){k&&(s(e),s(N),s(I),s(d),s(g));for(let L=0;L<a.length;L+=1)a[L].d();S=!1,He(D)}}}function jn(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;st(()=>{});const o=()=>{ot.dismiss()};function n(_,v,N,I,f){e.componentProps.ex_amount=N,e.componentProps.ex_concept=v,e.componentProps.ex_type=I,e.componentProps.id_expense=f,Re("modal-expense",dt,{amount:N,concept:v,type:I,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{Re("modal-expense",dt,{routeId:_}).then(v=>{}),o()},(_,v)=>n(v,_.concept,_.amount,_.type,_.id_expenses)]}class Vn extends Je{constructor(e){super(),Ye(this,e,jn,Fn,Xe,{})}}function Lt(i,e,t){const o=i.slice();return o[30]=e[t],o}function St(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Pt(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Mt(i){let e,t;return e=new _n({props:{$$slots:{default:[Xn]},$$scope:{ctx:i}}}),{c(){Yt(e.$$.fragment)},l(o){Zt(e.$$.fragment,o)},m(o,n){Qt(e,o,n),t=!0},p(o,n){const r={};n[0]&507|n[1]&32&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(rt(e.$$.fragment,o),t=!0)},o(o){ut(e.$$.fragment,o),t=!1},d(o){$t(e,o)}}}function Gn(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,h,_=[],v=new Map,N,I,f=i[4]&&At(i),a=Be(i[5]);const b=d=>d[30].id_event;for(let d=0;d<a.length;d+=1){let g=Lt(i,a,d),p=b(g);v.set(p,_[d]=Dt(p,g))}return{c(){f&&f.c(),e=y(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=y(),h=c("ion-list");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){f&&f.l(d),e=w(d),t=u(d,"ION-CONTENT",{});var g=E(t);o=u(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(o)!=="svelte-19e7x43"&&(o.innerHTML=n),r=w(g),h=u(g,"ION-LIST",{});var p=E(h);for(let C=0;C<_.length;C+=1)_[C].l(p);p.forEach(s),g.forEach(s),this.h()},h(){m(o,"slot","fixed")},m(d,g){f&&f.m(d,g),q(d,e,g),q(d,t,g),l(t,o),i[23](o),l(t,r),l(t,h);for(let p=0;p<_.length;p+=1)_[p]&&_[p].m(h,null);N||(I=te(o,"ionRefresh",i[9]),N=!0)},p(d,g){d[4]?f?f.p(d,g):(f=At(d),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),g[0]&42016&&(a=Be(d[5]),_=tt(_,g,b,1,d,a,v,h,nt,Dt,null,Lt))},d(d){d&&(s(e),s(t)),f&&f.d(d),i[23](null);for(let g=0;g<_.length;g+=1)_[g].d();N=!1,I()}}}function Kn(i){let e,t;function o(h,_){return _[0]&128&&(e=null),e==null&&(e=!!h[7].every(Zn)),e?Wn:xn}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Se()},l(h){r.l(h),t=Se()},m(h,_){r.m(h,_),q(h,t,_)},p(h,_){n===(n=o(h,_))&&r?r.p(h,_):(r.d(1),r=n(h),r&&(r.c(),r.m(t.parentNode,t)))},d(h){h&&s(t),r.d(h)}}}function At(i){let e=i[11]("",i[1],i[0])+"",t;return{c(){t=ae(e)},l(o){t=se(o,e)},m(o,n){q(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[11]("",o[1],o[0])+"")&&ke(t,e)},d(o){o&&s(t)}}}function Bt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function Dt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,N,I,f,a,b=e[30].title+"",d,g,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),C,S,D,M,A,k=p&&Bt();function L(){return e[24](e[30])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=y(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=ae(b),g=y(),k&&k.c(),C=y(),S=c("ion-icon"),D=y(),this.h()},l(T){t=u(T,"ION-ITEM",{});var O=E(t);o=u(O,"ION-AVATAR",{slot:!0});var P=E(o);n=u(P,"DIV",{class:!0,title:!0,style:!0});var R=E(n);r=u(R,"DIV",{class:!0});var B=E(r);_=se(B,h),B.forEach(s),R.forEach(s),P.forEach(s),N=w(O),I=u(O,"ION-LABEL",{button:!0});var z=E(I);f=u(z,"ION-TEXT",{color:!0});var V=E(f);a=u(V,"H3",{});var X=E(a);d=se(X,b),g=w(X),k&&k.l(X),X.forEach(s),V.forEach(s),z.forEach(s),C=w(O),S=u(O,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(S).forEach(s),D=w(O),O.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",v=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),m(I,"button",""),m(S,"icon",Ze),m(S,"slot","end"),j(S,"color",we(e[30])),this.first=t},m(T,O){q(T,t,O),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),k&&k.m(a,null),l(t,C),l(t,S),l(t,D),M||(A=te(I,"click",L),M=!0)},p(T,O){e=T,O[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),O[0]&32&&v!==(v=xe(e[30].status))&&G(n,"title",v),O[0]&32&&j(n,"background-color",we(e[30])),O[0]&32&&j(n,"color",We(we(e[30]))),O[0]&32&&b!==(b=e[30].title+"")&&ke(d,b),O[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?k||(k=Bt(),k.c(),k.m(a,null)):k&&(k.d(1),k=null),O[0]&32&&j(S,"color",we(e[30]))},d(T){T&&s(t),k&&k.d(),M=!1,A()}}}function xn(i){let e=i[11](i[7],i[1],i[0])+"",t,o,n,r,h='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,v,N=[],I=new Map,f,a,b=Be(i[5]);const d=g=>g[30].id_event;for(let g=0;g<b.length;g+=1){let p=St(i,b,g),C=d(p);I.set(C,N[g]=Ut(C,p))}return{c(){t=ae(e),o=y(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=h,_=y(),v=c("ion-list");for(let g=0;g<N.length;g+=1)N[g].c();this.h()},l(g){t=se(g,e),o=w(g),n=u(g,"ION-CONTENT",{});var p=E(n);r=u(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(r)!=="svelte-1poui8g"&&(r.innerHTML=h),_=w(p),v=u(p,"ION-LIST",{});var C=E(v);for(let S=0;S<N.length;S+=1)N[S].l(C);C.forEach(s),p.forEach(s),this.h()},h(){m(r,"slot","fixed")},m(g,p){q(g,t,p),q(g,o,p),q(g,n,p),l(n,r),i[21](r),l(n,_),l(n,v);for(let C=0;C<N.length;C+=1)N[C]&&N[C].m(v,null);f||(a=te(r,"ionRefresh",i[9]),f=!0)},p(g,p){p[0]&131&&e!==(e=g[11](g[7],g[1],g[0])+"")&&ke(t,e),p[0]&74784&&(b=Be(g[5]),N=tt(N,p,d,1,g,b,I,v,nt,Ut,null,St))},d(g){g&&(s(t),s(o),s(n)),i[21](null);for(let p=0;p<N.length;p+=1)N[p].d();f=!1,a()}}}function Wn(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,h=[],_=new Map,v,N,I=Be(i[5]);const f=a=>a[30].id_event;for(let a=0;a<I.length;a+=1){let b=Pt(i,I,a),d=f(b);_.set(d,h[a]=zt(d,b))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=y(),r=c("ion-list");for(let a=0;a<h.length;a+=1)h[a].c();this.h()},l(a){e=u(a,"ION-CONTENT",{});var b=E(e);t=u(b,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(t)!=="svelte-1t1tzpj"&&(t.innerHTML=o),n=w(b),r=u(b,"ION-LIST",{});var d=E(r);for(let g=0;g<h.length;g+=1)h[g].l(d);d.forEach(s),b.forEach(s),this.h()},h(){m(t,"slot","fixed")},m(a,b){q(a,e,b),l(e,t),i[19](t),l(e,n),l(e,r);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(r,null);v||(N=te(t,"ionRefresh",i[9]),v=!0)},p(a,b){b[0]&74784&&(I=Be(a[5]),h=tt(h,b,f,1,a,I,_,r,nt,zt,null,Pt))},d(a){a&&s(e),i[19](null);for(let b=0;b<h.length;b+=1)h[b].d();v=!1,N()}}}function Ht(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function Ut(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,N,I,f,a,b=e[30].title+"",d,g,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),C,S,D="",M,A,k,L,T,O=p&&Ht();function P(){return e[22](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=y(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=ae(b),g=y(),O&&O.c(),C=y(),S=c("div"),S.innerHTML=D,M=y(),A=c("ion-icon"),k=y(),this.h()},l(R){t=u(R,"ION-ITEM",{});var B=E(t);o=u(B,"ION-AVATAR",{slot:!0});var z=E(o);n=u(z,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var X=E(r);_=se(X,h),X.forEach(s),V.forEach(s),z.forEach(s),N=w(B),I=u(B,"ION-LABEL",{button:!0});var Y=E(I);f=u(Y,"ION-TEXT",{color:!0});var H=E(f);a=u(H,"H3",{});var F=E(a);d=se(F,b),g=w(F),O&&O.l(F),F.forEach(s),H.forEach(s),C=w(Y),S=u(Y,"DIV",{class:!0,"data-svelte-h":!0}),K(S)!=="svelte-130ohbs"&&(S.innerHTML=D),Y.forEach(s),M=w(B),A=u(B,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(s),k=w(B),B.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",v=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(S,"class","sub svelte-ziybgw"),m(I,"button",""),m(A,"icon",Ze),m(A,"slot","end"),this.first=t},m(R,B){q(R,t,B),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,C),l(I,S),l(t,M),l(t,A),l(t,k),L||(T=te(I,"click",P),L=!0)},p(R,B){e=R,B[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),B[0]&32&&v!==(v=xe(e[30].status))&&G(n,"title",v),B[0]&32&&j(n,"background-color",we(e[30])),B[0]&32&&j(n,"color",We(we(e[30]))),B[0]&32&&b!==(b=e[30].title+"")&&ke(d,b),B[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?O||(O=Ht(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(R){R&&s(t),O&&O.d(),L=!1,T()}}}function Rt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function zt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,N,I,f,a,b=e[30].title+"",d,g,p=e[30].support_list&&e[30].support_list.length||e[13](e[30]),C,S,D="",M,A,k,L,T,O=p&&Rt();function P(){return e[20](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),N=y(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=ae(b),g=y(),O&&O.c(),C=y(),S=c("div"),S.innerHTML=D,M=y(),A=c("ion-icon"),k=y(),this.h()},l(R){t=u(R,"ION-ITEM",{});var B=E(t);o=u(B,"ION-AVATAR",{slot:!0});var z=E(o);n=u(z,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var X=E(r);_=se(X,h),X.forEach(s),V.forEach(s),z.forEach(s),N=w(B),I=u(B,"ION-LABEL",{button:!0});var Y=E(I);f=u(Y,"ION-TEXT",{color:!0});var H=E(f);a=u(H,"H3",{});var F=E(a);d=se(F,b),g=w(F),O&&O.l(F),F.forEach(s),H.forEach(s),C=w(Y),S=u(Y,"DIV",{class:!0,"data-svelte-h":!0}),K(S)!=="svelte-130ohbs"&&(S.innerHTML=D),Y.forEach(s),M=w(B),A=u(B,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(s),k=w(B),B.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",v=xe(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(S,"class","sub svelte-ziybgw"),m(I,"button",""),m(A,"icon",Ze),m(A,"slot","end"),this.first=t},m(R,B){q(R,t,B),l(t,o),l(o,n),l(n,r),l(r,_),l(t,N),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,C),l(I,S),l(t,M),l(t,A),l(t,k),L||(T=te(I,"click",P),L=!0)},p(R,B){e=R,B[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),B[0]&32&&v!==(v=xe(e[30].status))&&G(n,"title",v),B[0]&32&&j(n,"background-color",we(e[30])),B[0]&32&&j(n,"color",We(we(e[30]))),B[0]&32&&b!==(b=e[30].title+"")&&ke(d,b),B[0]&32&&(p=e[30].support_list&&e[30].support_list.length||e[13](e[30])),p?O||(O=Rt(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(R){R&&s(t),O&&O.d(),L=!1,T()}}}function Xn(i){let e,t,o,n,r=`<ion-icon icon="${cn}"></ion-icon>`,h,_,v,N=`<ion-icon icon="${un}"></ion-icon>`,I,f,a=i[6].name+"",b,d,g,p,C;function S(A,k){if(A[7].length>0)return Kn;if(!A[3])return Gn}let D=S(i),M=D&&D(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=y(),_=c("ion-buttons"),v=c("ion-button"),v.innerHTML=N,I=y(),f=c("ion-title"),b=ae(a),d=y(),M&&M.c(),g=Se(),this.h()},l(A){e=u(A,"ION-HEADER",{translucent:!0});var k=E(e);t=u(k,"ION-TOOLBAR",{});var L=E(t);o=u(L,"ION-BUTTONS",{slot:!0});var T=E(o);n=u(T,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),K(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),T.forEach(s),h=w(L),_=u(L,"ION-BUTTONS",{slot:!0});var O=E(_);v=u(O,"ION-BUTTON",{"data-svelte-h":!0}),K(v)!=="svelte-nf50hj"&&(v.innerHTML=N),O.forEach(s),I=w(L),f=u(L,"ION-TITLE",{});var P=E(f);b=se(P,a),P.forEach(s),L.forEach(s),k.forEach(s),d=w(A),M&&M.l(A),g=Se(),this.h()},h(){m(n,"title","Atrás"),m(n,"alt","Atrás"),m(o,"slot","start"),m(_,"slot","end"),m(e,"translucent","")},m(A,k){q(A,e,k),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,v),l(t,I),l(t,f),l(f,b),q(A,d,k),M&&M.m(A,k),q(A,g,k),p||(C=[te(n,"click",i[14]),te(v,"click",i[18])],p=!0)},p(A,k){k[0]&64&&a!==(a=A[6].name+"")&&ke(b,a),D===(D=S(A))&&M?M.p(A,k):(M&&M.d(1),M=D&&D(A),M&&(M.c(),M.m(g.parentNode,g)))},d(A){A&&(s(e),s(d),s(g)),M&&M.d(A),p=!1,He(C)}}}function Jn(i){let e,t,o,n=i[2]&&Mt(i);return{c(){e=y(),n&&n.c(),t=Se(),this.h()},l(r){Wt("svelte-kn0kph",document.head).forEach(s),e=w(r),n&&n.l(r),t=Se(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,h){q(r,e,h),n&&n.m(r,h),q(r,t,h),o=!0},p(r,h){r[2]?n?(n.p(r,h),h[0]&4&&rt(n,1)):(n=Mt(r),n.c(),rt(n,1),n.m(t.parentNode,t)):n&&(en(),ut(n,1,1,()=>{n=null}),Jt())},i(r){o||(rt(n),o=!0)},o(r){ut(n),o=!1},d(r){r&&(s(e),s(t)),n&&n.d(r)}}}function we(i){let e="#ffffff";return i.status==="pending"?e="#f2e300":i.status==="completed"&&(e="#44d900"),e}function xe(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function We(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function Yn(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const Zn=i=>i.img;function Qn(i,e,t){let o;Xt(i,fn,H=>t(17,o=H));var n=this&&this.__awaiter||function(H,F,Z,ie){function pe(ue){return ue instanceof Z?ue:new Z(function(he){he(ue)})}return new(Z||(Z=Promise))(function(ue,he){function Pe(me){try{Le(ie.next(me))}catch(de){he(de)}}function ge(me){try{Le(ie.throw(me))}catch(de){he(de)}}function Le(me){me.done?ue(me.value):pe(me.value).then(Pe,ge)}Le((ie=ie.apply(H,F||[])).next())})};let{routeId:r}=e,{driverId:h}=e,_=new Object,v=!0,N=!1,I=[],f={},a=[],b=[],d,g=!1;const p=()=>n(void 0,void 0,void 0,function*(){yield C(r),d.complete()});st(()=>{p()});function C(H){return n(this,void 0,void 0,function*(){const F=new FormData;F.append("id_route",H);try{const ie=yield(yield fetch("https://dev.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:F})).json();t(6,f=ie.data.seguimiento_list[0]),t(5,I=ie.data.event_list),t(7,a=ie.data.checklist),b=ie.data.expenses,f&&t(4,N=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,v=!1)}catch(Z){t(3,v=!1),console.error("Error fetching data:",Z)}})}const S=H=>new Promise((F,Z)=>{const ie=new FormData;ie.append("id_route",H.id_route),ie.append("id_event",H.id_event),fetch("https://dev.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:ie}).then(pe=>pe.json()).then(pe=>{F(pe.data.event_evidence[0])}).catch(pe=>{console.error("Error fetching data:",pe),Z(pe)})}),D=(H,F)=>{S(H).then(Z=>{Z&&(H.img=Z.img,H.driver_comments=Z.driver_comments,H.comments=Z.comments),Re("modal-delivery-info",Hn,{delivery:H,isLast:F}).then(ie=>{})})},M=(H,F,Z)=>{var ie=!1;return g||(g=!0,Re("modal-checklist",Gt,{checklist:H,driverId:F,routeId:Z,isLast:ie}).then(pe=>{g=!1}),Yn(Z,"checklist")),""},A=H=>n(void 0,void 0,void 0,function*(){return yield C(H),b.length>0?Re("modal-expense-detail",Vn,{routeId:H,expenses:b}).then(F=>{}):Re("modal-expense",dt,{routeId:H}).then(F=>{}),""}),k=H=>{if(H.tracking_type=="subscription"){if(H.subscriber_info&&H.payment_type==="cash"&&new Date(H.subscriber_info.payment_next)<new Date)return!0}else if(H.tracking_type=="ecommerce"&&Number(H.payment_pending)>0)return!0;return!1},L=()=>{_.id_driver?je(`/drivers/${_.id_driver}`):je("/drivers/me")},T=(H,F)=>n(void 0,void 0,void 0,function*(){yield(yield Ve.create({header:H||"Error",message:F||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function O(H){return H===I.length-1}const P=()=>A(r);function R(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const B=(H,F)=>D(H,O(F));function z(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const V=(H,F)=>D(H,O(F));function X(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const Y=H=>{const F=I.findIndex(he=>he.id_event===H.id_event),Z=F===0,ie=F>0?I[F-1]:null,pe=Z||ie&&ie.img!==null,ue=H.img!==null&&H.img!=="";pe||Z&&!ue?D(H):T("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=H=>{"routeId"in H&&t(0,r=H.routeId),"driverId"in H&&t(1,h=H.driverId)},i.$$.update=()=>{i.$$.dirty[0]&131077&&(t(0,{routeId:r,driverId:h}=o.params,r,(t(1,h),t(17,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="superadmin")?(C(r),je(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(C(r),je(`/drivers/${_.id_driver}/routes/${r}`)):je("/"))},[r,h,_,v,N,I,f,a,d,p,D,M,A,k,L,T,O,o,P,R,B,z,V,X,Y]}class ro extends Je{constructor(e){super(),Ye(this,e,Qn,Jn,Xe,{routeId:0,driverId:1},null,[-1,-1])}}export{ro as component};
