import{Z as It,s as xe,e as c,j as N,b as u,q as E,d as Y,h as a,m as T,v as p,i as R,w as i,x as ie,n as Oe,z as Ge,_ as sn,B as F,o as it,k as Re,$ as kt,t as fe,r as _e,f as x,a0 as cn,a1 as ot,A as Be,y as Ae,a2 as ht,l as un,p as fn,F as _n}from"../chunks/index.BzUyNcuj.js";import{S as $e,i as et,t as dt,a as vt,c as dn,b as hn,d as pn,m as mn,e as vn,g as gn}from"../chunks/index.D9GPdhpm.js";import{e as qe,u as rt,d as at,a as bn,c as gt,b as on,f as En,g as In,i as ln,h as kn,j as rn,k as On,m as Nn,s as Ot,n as tt,o as Tn,q as Cn,r as yn,t as wn,v as Ln,w as Sn,p as Mn}from"../chunks/index.YJYrd7J3.js";import"../chunks/index-6e05b96e.C_9q9BoX.js";import{m as st,a as Qe,I as Pn}from"../chunks/IonPage.xQ4lM5iK.js";import{q as An,t as Bn}from"../chunks/ion-modal.BYMRzj9z.js";import{g as Ke}from"../chunks/entry.jZYOJi-C.js";const Dn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,zn=(l,e)=>{if(!customElements.get(l)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(l,t)}},Hn=function(l){return document.createElement(l).constructor!==HTMLElement},Rn=(l,e)=>{Hn(l)||zn(l,e)},We=async(l,e,t)=>{An(),Bn(),Rn(l,e);const o=await st.create({component:l,componentProps:t});return o.present(),await o.onWillDismiss()};let Je=It({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),an=It({flag:[]});function Un(l){let e,t,o,n,r="Cancelar",d,_,g="Captura de Km/Gas",O,k,f,s="Confirmar",b,h,v,m,w,y,H;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=g,O=N(),k=c("ion-buttons"),f=c("ion-button"),f.textContent=s,b=N(),h=c("ion-content"),v=c("ion-item"),m=c("ion-input"),this.h()},l(P){e=u(P,"ION-HEADER",{translucent:!0});var z=E(e);t=u(z,"ION-TOOLBAR",{});var C=E(t);o=u(C,"ION-BUTTONS",{slot:!0});var L=E(o);n=u(L,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),Y(n)!=="svelte-17pq4f4"&&(n.textContent=r),L.forEach(a),d=T(C),_=u(C,"ION-TITLE",{"data-svelte-h":!0}),Y(_)!=="svelte-1yhkaq7"&&(_.textContent=g),O=T(C),k=u(C,"ION-BUTTONS",{slot:!0});var S=E(k);f=u(S,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),Y(f)!=="svelte-cm6j4s"&&(f.textContent=s),S.forEach(a),C.forEach(a),z.forEach(a),b=T(P),h=u(P,"ION-CONTENT",{fullscreen:!0});var I=E(h);v=u(I,"ION-ITEM",{});var D=E(v);m=u(D,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var U=E(m);U.forEach(a),D.forEach(a),I.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(f,"strong",""),p(k,"slot","end"),p(e,"translucent",""),p(m,"class","fin-km"),p(m,"inputmode","numeric"),p(m,"pattern","[0-9]*"),p(m,"type","number"),p(m,"placeholder",w="Ingresa "+l[0]+" actual"),p(m,"value",l[1]),p(m,"required",""),p(h,"fullscreen","")},m(P,z){R(P,e,z),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),i(t,O),i(t,k),i(k,f),R(P,b,z),R(P,h,z),i(h,v),i(v,m),y||(H=[ie(n,"click",l[2]),ie(f,"click",l[3]),ie(m,"input",l[4])],y=!0)},p(P,[z]){z&1&&w!==(w="Ingresa "+P[0]+" actual")&&p(m,"placeholder",w),z&2&&p(m,"value",P[1])},i:Oe,o:Oe,d(P){P&&(a(e),a(b),a(h)),y=!1,Ge(H)}}}function Fn(l,e,t){const o=sn();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let d;an.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,d="kilometraje"):t(0,d="litros de gasolina")});let _=0;function g(){st.dismiss()}function O(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Je.update(s=>({...s,km_inicial:[_]})):r=="gas_inicial"?Je.update(s=>({...s,gas_inicial:[_]})):r=="km_final"?Je.update(s=>({...s,km_final:[_]})):r=="gas_final"&&Je.update(s=>({...s,gas_final:[_]})),g()}return[d,_,g,O,f=>t(1,_=f.target.value)]}class qn extends $e{constructor(e){super(),et(this,e,Fn,Un,xe,{})}}const pt=It({items:[],checkedIndices:[],mandatory:[]});function Lt(l,e,t){const o=l.slice();return o[51]=e[t],o[52]=e,o[53]=t,o}function jn(l){let e,t,o,n,r,d="Kilometraje inicial",_,g,O=l[0]?l[0]+" km.":"Cargar km",k,f,s,b,h,v,m,w="Gasolina inicial (litros)",y,H,P=l[1]?l[1]+" litros":"Cargar gas",z,C,L,S;return C=kt(l[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=N(),r=c("p"),r.textContent=d,_=N(),g=c("ion-button"),k=fe(O),f=N(),s=c("ion-item"),b=c("ion-label"),h=c("input"),v=N(),m=c("p"),m.textContent=w,y=N(),H=c("ion-button"),z=fe(P),this.h()},l(I){e=u(I,"ION-ITEM",{});var D=E(e);t=u(D,"ION-LABEL",{style:!0});var U=E(t);o=u(U,"INPUT",{id:!0,style:!0,type:!0}),n=T(U),r=u(U,"P",{style:!0,"data-svelte-h":!0}),Y(r)!=="svelte-88twxi"&&(r.textContent=d),U.forEach(a),_=T(D),g=u(D,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var M=E(g);k=_e(M,O),M.forEach(a),D.forEach(a),f=T(I),s=u(I,"ION-ITEM",{});var q=E(s);b=u(q,"ION-LABEL",{style:!0});var j=E(b);h=u(j,"INPUT",{id:!0,style:!0,type:!0}),v=T(j),m=u(j,"P",{style:!0,"data-svelte-h":!0}),Y(m)!=="svelte-1ux30eb"&&(m.textContent=w),j.forEach(a),y=T(q),H=u(q,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var W=E(H);z=_e(W,P),W.forEach(a),q.forEach(a),this.h()},h(){x(o,"id","chkbox-km-ini"),F(o,"pointer-events","auto"),x(o,"type","checkbox"),o.required=!0,F(r,"margin-left","10px"),F(t,"display","flex"),p(g,"fill","outline"),p(g,"size","small"),p(g,"class","loadKmInicial"),p(g,"aria-selected",""),x(h,"id","chkbox-gas-ini"),F(h,"pointer-events","auto"),x(h,"type","checkbox"),h.required=!0,F(m,"margin-left","10px"),F(b,"display","flex"),p(H,"fill","outline"),p(H,"class","loadGasInicial"),p(H,"size","small"),F(H,"height","16px "),C.p(o,h)},m(I,D){R(I,e,D),i(e,t),i(t,o),o.checked=~(l[4]||[]).indexOf(o.__value),l[28](o),i(t,n),i(t,r),i(e,_),i(e,g),i(g,k),R(I,f,D),R(I,s,D),i(s,b),i(b,h),l[30](h),h.checked=~(l[4]||[]).indexOf(h.__value),i(b,v),i(b,m),i(s,y),i(s,H),i(H,z),L||(S=[ie(o,"change",l[27]),ie(g,"click",l[29]),ie(h,"change",l[31]),ie(H,"click",l[32])],L=!0)},p(I,D){D[0]&16&&(o.checked=~(I[4]||[]).indexOf(o.__value)),D[0]&1&&O!==(O=I[0]?I[0]+" km.":"Cargar km")&&Ae(k,O),D[0]&16&&(h.checked=~(I[4]||[]).indexOf(h.__value)),D[0]&2&&P!==(P=I[1]?I[1]+" litros":"Cargar gas")&&Ae(z,P)},d(I){I&&(a(e),a(f),a(s)),l[28](null),l[30](null),C.r(),L=!1,Ge(S)}}}function Vn(l){let e,t,o,n,r,d="Kilometraje final",_,g,O=l[2]?l[2]+" km.":"Cargar km",k,f,s,b,h,v,m,w="Gasolina final (litros)",y,H,P=l[3]?l[3]+" litros":"Cargar gas",z,C,L,S;return C=kt(l[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=N(),r=c("p"),r.textContent=d,_=N(),g=c("ion-button"),k=fe(O),f=N(),s=c("ion-item"),b=c("ion-label"),h=c("input"),v=N(),m=c("p"),m.textContent=w,y=N(),H=c("ion-button"),z=fe(P),this.h()},l(I){e=u(I,"ION-ITEM",{});var D=E(e);t=u(D,"ION-LABEL",{style:!0});var U=E(t);o=u(U,"INPUT",{id:!0,style:!0,type:!0}),n=T(U),r=u(U,"P",{style:!0,"data-svelte-h":!0}),Y(r)!=="svelte-ccmu71"&&(r.textContent=d),U.forEach(a),_=T(D),g=u(D,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var M=E(g);k=_e(M,O),M.forEach(a),D.forEach(a),f=T(I),s=u(I,"ION-ITEM",{});var q=E(s);b=u(q,"ION-LABEL",{style:!0});var j=E(b);h=u(j,"INPUT",{id:!0,style:!0,type:!0}),v=T(j),m=u(j,"P",{style:!0,"data-svelte-h":!0}),Y(m)!=="svelte-wsoyd2"&&(m.textContent=w),j.forEach(a),y=T(q),H=u(q,"ION-BUTTON",{fill:!0,size:!0,class:!0});var W=E(H);z=_e(W,P),W.forEach(a),q.forEach(a),this.h()},h(){x(o,"id","chkbox-km-fin"),F(o,"pointer-events","auto"),x(o,"type","checkbox"),o.required=!0,F(r,"margin-left","10px"),F(t,"display","flex"),p(g,"fill","outline"),p(g,"size","small"),p(g,"class","loadKmInicial"),p(g,"aria-selected",""),x(h,"id","chkbox-gas-fin"),F(h,"pointer-events","auto"),x(h,"type","checkbox"),h.required=!0,F(m,"margin-left","10px"),F(b,"display","flex"),p(H,"fill","outline"),p(H,"size","small"),p(H,"class","loadGasInicial"),C.p(o,h)},m(I,D){R(I,e,D),i(e,t),i(t,o),o.checked=~(l[4]||[]).indexOf(o.__value),l[22](o),i(t,n),i(t,r),i(e,_),i(e,g),i(g,k),R(I,f,D),R(I,s,D),i(s,b),i(b,h),h.checked=~(l[4]||[]).indexOf(h.__value),l[25](h),i(b,v),i(b,m),i(s,y),i(s,H),i(H,z),L||(S=[ie(o,"change",l[20]),ie(g,"click",l[23]),ie(h,"change",l[24]),ie(H,"click",l[26])],L=!0)},p(I,D){D[0]&16&&(o.checked=~(I[4]||[]).indexOf(o.__value)),D[0]&4&&O!==(O=I[2]?I[2]+" km.":"Cargar km")&&Ae(k,O),D[0]&16&&(h.checked=~(I[4]||[]).indexOf(h.__value)),D[0]&8&&P!==(P=I[3]?I[3]+" litros":"Cargar gas")&&Ae(z,P)},d(I){I&&(a(e),a(f),a(s)),l[22](null),l[25](null),C.r(),L=!1,Ge(S)}}}function Gn(l){let e=[],t=new Map,o,n=qe(l[13]);const r=d=>d[51].id_checklist_event;for(let d=0;d<n.length;d+=1){let _=Lt(l,n,d),g=r(_);t.set(g,e[d]=St(g,_))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();o=Re()},l(d){for(let _=0;_<e.length;_+=1)e[_].l(d);o=Re()},m(d,_){for(let g=0;g<e.length;g+=1)e[g]&&e[g].m(d,_);R(d,o,_)},p(d,_){_[0]&407664&&(n=qe(d[13]),e=rt(e,_,r,1,d,n,t,o.parentNode,at,St,o,Lt))},d(d){d&&a(o);for(let _=0;_<e.length;_+=1)e[_].d(d)}}}function Kn(l){let e,t=(l[12][l[51].id_checklist_event]?l[12][l[51].id_checklist_event]:"Cargar evidencia")+"",o;return{c(){e=c("label"),o=fe(t),this.h()},l(n){e=u(n,"LABEL",{for:!0,class:!0});var r=E(e);o=_e(r,t),r.forEach(a),this.h()},h(){x(e,"for","chklist-"+l[51].id_checklist_event),x(e,"class","button-label svelte-1ruehls")},m(n,r){R(n,e,r),i(e,o)},p(n,r){r[0]&4096&&t!==(t=(n[12][n[51].id_checklist_event]?n[12][n[51].id_checklist_event]:"Cargar evidencia")+"")&&Ae(o,t)},d(n){n&&a(e)}}}function Wn(l){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0,class:!0}),E(e).forEach(a),this.h()},h(){p(e,"name","dots"),p(e,"class","button-spinner svelte-1ruehls")},m(t,o){R(t,e,o)},p:Oe,d(t){t&&a(e)}}}function St(l,e){let t,o,n,r=e[51],d,_,g=e[51].item+"",O,k,f,s=e[51].mandatory=="1"?" * ":"",b,h,v,m,w,y,H,P,z,C;const L=()=>e[34](n,r),S=()=>e[34](null,r);function I(){return e[35](e[51])}function D(j,W){return j[11][j[51].id_checklist_event]?Wn:Kn}let U=D(e),M=U(e);function q(...j){return e[37](e[51],...j)}return P=kt(e[21][0]),{key:l,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),d=N(),_=c("p"),O=fe(g),k=N(),f=c("b"),b=fe(s),h=N(),v=c("ion-button"),m=c("div"),M.c(),w=N(),y=c("input"),H=N(),this.h()},l(j){t=u(j,"ION-ITEM",{});var W=E(t);o=u(W,"ION-LABEL",{style:!0});var ee=E(o);n=u(ee,"INPUT",{id:!0,style:!0,type:!0}),d=T(ee),_=u(ee,"P",{style:!0});var ve=E(_);O=_e(ve,g),k=T(ve),ve.forEach(a),f=u(ee,"B",{style:!0});var V=E(f);b=_e(V,s),V.forEach(a),ee.forEach(a),h=T(W),v=u(W,"ION-BUTTON",{fill:!0,class:!0,size:!0});var Q=E(v);m=u(Q,"DIV",{class:!0});var J=E(m);M.l(J),w=T(J),y=u(J,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),J.forEach(a),Q.forEach(a),H=T(W),W.forEach(a),this.h()},h(){x(n,"id",`chkbox-${e[51].id_checklist_event}`),F(n,"pointer-events","auto"),x(n,"type","checkbox"),n.__value=e[51].id_checklist_event,cn(n,n.__value),n.required=!0,F(_,"margin-left","10px"),F(f,"margin-left","5px"),F(o,"display","flex"),F(y,"display","none"),x(y,"id","chklist-"+e[51].id_checklist_event),x(y,"name","fileToUpload"),x(y,"type","file"),x(y,"accept","image/*"),x(m,"class","button-content svelte-1ruehls"),p(v,"fill","outline"),p(v,"class","loadEvidence svelte-1ruehls"),p(v,"size","small"),P.p(n),this.first=t},m(j,W){R(j,t,W),i(t,o),i(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),L(),i(o,d),i(o,_),i(_,O),i(_,k),i(o,f),i(f,b),i(t,h),i(t,v),i(v,m),M.m(m,null),i(m,w),i(m,y),e[36](y),i(t,H),z||(C=[ie(n,"change",e[33]),ie(n,"change",I),ie(y,"change",q)],z=!0)},p(j,W){e=j,W[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[51]&&(S(),r=e[51],L()),U===(U=D(e))&&M?M.p(e,W):(M.d(1),M=U(e),M&&(M.c(),M.m(m,w)))},d(j){j&&a(t),S(),M.d(),e[36](null),P.r(),z=!1,Ge(C)}}}function Xn(l){let e,t,o,n,r="Cancelar",d,_,g="REQUERIMIENTOS DE RUTA",O,k,f,s,b,h,v,m="Confirmar",w,y;function H(L,S){return L[14]?Vn:jn}let z=H(l)(l),C=l[13]&&Gn(l);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=g,O=N(),k=c("ion-content"),f=c("ion-list"),z.c(),s=N(),C&&C.c(),b=N(),h=c("ion-footer"),v=c("ion-button"),v.textContent=m,this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var S=E(e);t=u(S,"ION-TOOLBAR",{});var I=E(t);o=u(I,"ION-BUTTONS",{slot:!0});var D=E(o);n=u(D,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),Y(n)!=="svelte-1dnmkxs"&&(n.textContent=r),D.forEach(a),d=T(I),_=u(I,"ION-TITLE",{"data-svelte-h":!0}),Y(_)!=="svelte-19bar5p"&&(_.textContent=g),I.forEach(a),S.forEach(a),O=T(L),k=u(L,"ION-CONTENT",{fullscreen:!0});var U=E(k);f=u(U,"ION-LIST",{});var M=E(f);z.l(M),s=T(M),C&&C.l(M),M.forEach(a),U.forEach(a),b=T(L),h=u(L,"ION-FOOTER",{});var q=E(h);v=u(q,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),Y(v)!=="svelte-g82qqw"&&(v.textContent=m),q.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(e,"translucent",""),p(k,"fullscreen",""),p(v,"fill","outline"),p(v,"color","tertiary"),p(v,"strong",""),F(v,"width","99%"),F(v,"height","auto")},m(L,S){R(L,e,S),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),R(L,O,S),R(L,k,S),i(k,f),z.m(f,null),i(f,s),C&&C.m(f,null),R(L,b,S),R(L,h,S),i(h,v),w||(y=[ie(n,"click",l[15]),ie(v,"click",l[16])],w=!0)},p(L,S){z.p(L,S),L[13]&&C.p(L,S)},i:Oe,o:Oe,d(L){L&&(a(e),a(O),a(k),a(b),a(h)),z.d(),C&&C.d(),w=!1,Ge(y)}}}function bt(l,e){if(typeof l=="object"&&l!==null||Array.isArray(l)){if(Array.isArray(l))return l.map(t=>bt(t,e)).flat();{const t=Object.keys(l);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>l[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>l[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function mt(l,e){let t=new FormData;t.append("id_route",l),t.append("status",e),fetch("https://app.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function Jn(l,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,d=o.componentProps.routeId,_=o.componentProps.isLast;let g,O,k,f,s=[],b=null,h={},v,m,w,y,H={},P={},z={};it(()=>{_?console.log("Último checklist"):pt.update(B=>(B.mandatory=bt(n,"mandatory"),B.items=bt(n,"id_checklist_event"),B))});function C(B){t(11,H[B]=!0,H)}const L=async()=>{await(await Qe.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},S=async()=>{await(await Qe.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},I=async B=>{await(await Qe.create({header:"Datos inválidos",message:B=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},D=()=>{st.dismiss(),r?Ke(`/drivers/${r}`):Ke("/drivers/me")},U=()=>{if(_){var B=W(k,"km"),X=W(f,"gas");const pe=new FormData;pe.append("km_final",B),pe.append("gas_final",X),pe.append("id_route",d),B&&X?(D(),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:pe}).then(te=>te.json()).then(te=>{S()}).catch(te=>{console.error("Error fetching data:",te)})):L()}else{var ye=W(g,"km"),Se=W(O,"gas");pt.update(pe=>{pe.items;const te=pe.mandatory;if(pe.items.filter(($,le)=>pe.mandatory[le]==="1").every($=>pe.checkedIndices.includes($))&&ye&&Se){D();const $=new FormData;for(const le in P)if(P.hasOwnProperty(le)){const{img:Pe,img_id:me}=P[le];$.append(`selectedImages[${le}][img]`,Pe),$.append(`selectedImages[${le}][img_id]`,me)}$.append("km_inicial",ye),$.append("gas_inicial",Se),$.append("id_route",d),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:$}).then(le=>le.json()).then(le=>{te&&te.some(Pe=>Pe==="1")?mt(d,"checklist-pending"):mt(d,"enroute")}).catch(le=>{console.error("Error fetching data:",le)})}else if(!te&&ye&&Se){var ue=new FormData;ue.append("km_inicial",ye),ue.append("gas_inicial",Se),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ue}).then($=>$.json()).then($=>{mt(d,"enroute")}).catch($=>{console.error("Error fetching data:",$)})}else L();return pe})}Q()},M=async(B,X)=>{C(X);const Se=B.target.files[0],pe=await q(Se);if(pe){const te=new FormData;te.append("fileToUpload",pe);try{const he=await fetch("https://app.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:te});if(he.ok){const ce=await he.json();P={...P,[X]:{img:ce.img,img_id:ce.img_id}},t(12,z={...z,[X]:ce.filename}),j(X),t(6,h[X].checked=!0,h),t(11,H[X]=!1,H)}else console.error("File upload failed:",he.statusText)}catch(he){console.error("Error during file upload:",he)}}},q=async B=>new Promise(X=>{const ye=new FileReader;ye.onload=Se=>{const pe=new Image;pe.src=Se.target.result,pe.onload=()=>{const te=document.createElement("canvas"),he=te.getContext("2d"),ce=800,ue=600;let $=pe.width,le=pe.height;$>ce&&(le*=ce/$,$=ce),le>ue&&($*=ue/le,le=ue),te.width=$,te.height=le,he.drawImage(pe,0,0,$,le),te.toBlob(Pe=>{X(Pe)},"image/jpeg",.7)}},ye.readAsDataURL(B)}),j=B=>{pt.update(X=>(X.checkedIndices.indexOf(B)===-1?X.checkedIndices.push(B):console.error(`ID ${B} is already checked.`),X.items.forEach(Se=>{Se.id_checklist_event===B&&(Se.checked=!0)}),X))};function W(B,X){return/^\d+$/.test(B)?parseInt(B,10):(I(X),null)}function ee(B,X){ve(X),o.componentProps.data_type=X,We("modal-gas-km",qn,{r:X}).then(()=>{Je.subscribe(ye=>{V(ye,X)})})}function ve(B){an.update(X=>({...X,flag:[B]}))}function V(B,X){t(0,g=B.km_inicial?B.km_inicial:null),t(1,O=B.gas_inicial?B.gas_inicial:null),t(2,k=B.km_final?B.km_final:null),t(3,f=B.gas_final?B.gas_final:null),X=="km_inicial"&&v&&t(7,v.checked=!0,v),X=="gas_inicial"&&m&&t(8,m.checked=!0,m),X=="km_final"&&w&&t(9,w.checked=!0,w),X=="gas_final"&&y&&t(10,y.checked=!0,y)}function Q(){Je.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const J=[[]];function A(){s=ot(J[0],this.__value,this.checked),t(4,s)}function G(B){Be[B?"unshift":"push"](()=>{w=B,t(9,w)})}const K=B=>ee(B,"km_final");function oe(){s=ot(J[0],this.__value,this.checked),t(4,s)}function ae(B){Be[B?"unshift":"push"](()=>{y=B,t(10,y)})}const ne=B=>ee(B,"gas_final");function se(){s=ot(J[0],this.__value,this.checked),t(4,s)}function re(B){Be[B?"unshift":"push"](()=>{v=B,t(7,v)})}const ge=B=>ee(B,"km_inicial");function Ne(B){Be[B?"unshift":"push"](()=>{m=B,t(8,m)})}function ke(){s=ot(J[0],this.__value,this.checked),t(4,s)}const Ee=B=>ee(B,"gas_inicial");function Le(){s=ot(J[0],this.__value,this.checked),t(4,s)}function Fe(B,X){Be[B?"unshift":"push"](()=>{h[X.id_checklist_event]=B,t(6,h)})}const ze=B=>j(B.id_checklist_event);function je(B){Be[B?"unshift":"push"](()=>{b=B,t(5,b)})}return[g,O,k,f,s,b,h,v,m,w,y,H,z,n,_,D,U,M,j,ee,A,J,G,K,oe,ae,ne,se,re,ge,Ne,ke,Ee,Le,Fe,ze,je,(B,X)=>M(X,B.id_checklist_event)]}class Qn extends $e{constructor(e){super(),et(this,e,Jn,Xn,xe,{},null,[-1,-1])}}function Yn(l){let e,t,o,n,r,d="Teléfono de Negocio",_,g,O=l[10].client_phone+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{class:!0});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1u5l7fz"&&(r.textContent=d),_=T(b),g=u(b,"H2",{});var h=E(g);k=_e(h,O),h.forEach(a),b.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",En),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(e,"href","tel:"+l[10].client_phone)},m(f,s){R(f,e,s),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k)},p:Oe,d(f){f&&a(e)}}}function Zn(l){let e,t,o,n,r,d="Domicilio Alternativo",_,g,O=l[10].line2+"",k,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),f=N(),s=c("ion-icon"),this.h()},l(b){e=u(b,"ION-ITEM",{href:!0});var h=E(e);t=u(h,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(h),n=u(h,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1ub9uzw"&&(r.textContent=d),_=T(v),g=u(v,"H2",{});var m=E(g);k=_e(m,O),m.forEach(a),v.forEach(a),f=T(h),s=u(h,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),h.forEach(a),this.h()},h(){p(t,"icon",Ot),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",tt),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/searhc/?api=1&query="+l[10].line2)},m(b,h){R(b,e,h),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k),i(e,f),i(e,s)},p:Oe,d(b){b&&a(e)}}}function xn(l){let e,t,o,n,r,d="Domicilio",_,g,O=l[10].line1+"",k,f,s,b,h=l[10].line2&&l[10].line2.trim().length,v,m=h&&$n(l);return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),f=N(),s=c("ion-icon"),b=N(),m&&m.c(),v=Re(),this.h()},l(w){e=u(w,"ION-ITEM",{href:!0});var y=E(e);t=u(y,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(y),n=u(y,"ION-LABEL",{class:!0});var H=E(n);r=u(H,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-cbm7q1"&&(r.textContent=d),_=T(H),g=u(H,"H2",{});var P=E(g);k=_e(P,O),P.forEach(a),H.forEach(a),f=T(y),s=u(y,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),y.forEach(a),b=T(w),m&&m.l(w),v=Re(),this.h()},h(){p(t,"icon",Ot),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",tt),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/search/?api=1&query="+l[10].line1)},m(w,y){R(w,e,y),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k),i(e,f),i(e,s),R(w,b,y),m&&m.m(w,y),R(w,v,y)},p(w,y){h&&m.p(w,y)},d(w){w&&(a(e),a(b),a(v)),m&&m.d(w)}}}function $n(l){let e,t,o,n,r,d="Domicilio Alternativo",_,g,O=l[10].line2+"",k,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),f=N(),s=c("ion-icon"),this.h()},l(b){e=u(b,"ION-ITEM",{href:!0});var h=E(e);t=u(h,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(h),n=u(h,"ION-LABEL",{class:!0});var v=E(n);r=u(v,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1ub9uzw"&&(r.textContent=d),_=T(v),g=u(v,"H2",{});var m=E(g);k=_e(m,O),m.forEach(a),v.forEach(a),f=T(h),s=u(h,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),h.forEach(a),this.h()},h(){p(t,"icon",Ot),p(t,"slot","start"),p(n,"class","ion-text-wrap"),p(s,"icon",tt),p(s,"slot","end"),p(e,"href","https://www.google.com/maps/search/?api=1&query="+l[10].line2)},m(b,h){R(b,e,h),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k),i(e,f),i(e,s)},p:Oe,d(b){b&&a(e)}}}function Mt(l){let e,t,o,n,r,d="Contacto del Cliente",_,g,O,k,f=l[2]&&l[2]==="1"&&Pt(l);return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),O=fe(l[6]),k=N(),f&&f.c(),this.h()},l(s){e=u(s,"ION-ITEM",{});var b=E(e);t=u(b,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(b),n=u(b,"ION-LABEL",{class:!0});var h=E(n);r=u(h,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1utsyb6"&&(r.textContent=d),_=T(h),g=u(h,"H2",{});var v=E(g);O=_e(v,l[6]),v.forEach(a),h.forEach(a),k=T(b),f&&f.l(b),b.forEach(a),this.h()},h(){p(t,"icon",In),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(s,b){R(s,e,b),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,O),i(e,k),f&&f.m(e,null)},p(s,b){b[0]&64&&Ae(O,s[6]),s[2]&&s[2]==="1"?f?f.p(s,b):(f=Pt(s),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(s){s&&a(e),f&&f.d()}}}function Pt(l){let e,t=`<ion-icon icon="${Tn}" slot="start"></ion-icon>
                        Notificar Cliente`,o,n;return{c(){e=c("ion-button"),e.innerHTML=t,this.h()},l(r){e=u(r,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),Y(e)!=="svelte-w3qtwm"&&(e.innerHTML=t),this.h()},h(){p(e,"fill","outline"),F(e,"margin-left","16px")},m(r,d){R(r,e,d),o||(n=ie(e,"click",l[14]),o=!0)},p:Oe,d(r){r&&a(e),o=!1,n()}}}function At(l){let e,t,o,n,r,d="Notas de ubicación",_,g,O;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),O=fe(l[7]),this.h()},l(k){e=u(k,"ION-ITEM",{});var f=E(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(f),n=u(f,"ION-LABEL",{class:!0});var s=E(n);r=u(s,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-nhm2ft"&&(r.textContent=d),_=T(s),g=u(s,"H2",{});var b=E(g);O=_e(b,l[7]),b.forEach(a),s.forEach(a),f.forEach(a),this.h()},h(){p(t,"icon",ln),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(k,f){R(k,e,f),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,O)},p(k,f){f[0]&128&&Ae(O,k[7])},d(k){k&&a(e)}}}function eo(l){let e,t,o,n,r,d="Horarios",_,g,O=l[10].schedule+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-11q7hm5"&&(r.textContent=d),_=T(b),g=u(b,"H2",{});var h=E(g);k=_e(h,O),h.forEach(a),b.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",kn),p(t,"slot","start")},m(f,s){R(f,e,s),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k)},p:Oe,d(f){f&&a(e)}}}function to(l){let e,t,o,n,r,d="Notas del operador",_,g,O=l[10].driver_comments+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1yk9qp4"&&(r.textContent=d),_=T(b),g=u(b,"H2",{});var h=E(g);k=_e(h,O),h.forEach(a),b.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",rn),p(t,"slot","start")},m(f,s){R(f,e,s),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k)},p:Oe,d(f){f&&a(e)}}}function no(l){let e,t=l[10].logistic_comments!="<br>"&&oo(l);return{c(){t&&t.c(),e=Re()},l(o){t&&t.l(o),e=Re()},m(o,n){t&&t.m(o,n),R(o,e,n)},p(o,n){o[10].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&a(e),t&&t.d(o)}}}function oo(l){let e,t,o,n,r,d="Comentarios logísticos",_,g,O=l[10].logistic_comments+"",k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-label"),r=c("p"),r.textContent=d,_=N(),g=c("h2"),k=fe(O),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(s),n=u(s,"ION-LABEL",{class:!0});var b=E(n);r=u(b,"P",{"data-svelte-h":!0}),Y(r)!=="svelte-1iz85r6"&&(r.textContent=d),_=T(b),g=u(b,"H2",{});var h=E(g);k=_e(h,O),h.forEach(a),b.forEach(a),s.forEach(a),this.h()},h(){p(t,"icon",ln),p(t,"slot","start"),p(n,"class","ion-text-wrap")},m(f,s){R(f,e,s),i(e,t),i(e,o),i(e,n),i(n,r),i(n,_),i(n,g),i(g,k)},p:Oe,d(f){f&&a(e)}}}function Bt(l){let e,t,o,n;return{c(){e=c("ion-item"),t=c("ion-icon"),o=N(),n=c("ion-textarea"),this.h()},l(r){e=u(r,"ION-ITEM",{});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=T(d),n=u(d,"ION-TEXTAREA",{placeholder:!0}),E(n).forEach(a),d.forEach(a),this.h()},h(){p(t,"icon",On),p(t,"slot","start"),p(n,"placeholder","Escribe el motivo...")},m(r,d){R(r,e,d),i(e,t),i(e,o),i(e,n),l[17](n)},p:Oe,d(r){r&&a(e),l[17](null)}}}function Dt(l){let e,t=`<ion-icon icon="${Cn}" slot="start"></ion-icon>
                    Ingreso`,o,n;return{c(){e=c("ion-button"),e.innerHTML=t,this.h()},l(r){e=u(r,"ION-BUTTON",{id:!0,style:!0,"data-svelte-h":!0}),Y(e)!=="svelte-151bg1z"&&(e.innerHTML=t),this.h()},h(){p(e,"id","checkInBtn"),F(e,"flex","1")},m(r,d){R(r,e,d),o||(n=ie(e,"click",l[15]),o=!0)},p:Oe,d(r){r&&a(e),o=!1,n()}}}function zt(l){let e,t,o,n,r,d;return{c(){e=c("ion-button"),t=c("ion-icon"),o=fe(`
                    Salida`),this.h()},l(_){e=u(_,"ION-BUTTON",{id:!0,style:!0,disabled:!0});var g=E(e);t=u(g,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=_e(g,`
                    Salida`),g.forEach(a),this.h()},h(){p(t,"icon",Nn),p(t,"slot","start"),p(e,"id","checkOutBtn"),F(e,"flex","1"),p(e,"disabled",n=l[5]===!1)},m(_,g){R(_,e,g),i(e,t),i(e,o),r||(d=ie(e,"click",l[16]),r=!0)},p(_,g){g[0]&32&&n!==(n=_[5]===!1)&&p(e,"disabled",n)},d(_){_&&a(e),r=!1,d()}}}function Ht(l){let e,t='<ion-spinner name="dots"></ion-spinner>';return{c(){e=c("section"),e.innerHTML=t,this.h()},l(o){e=u(o,"SECTION",{style:!0,"data-svelte-h":!0}),Y(e)!=="svelte-1sj3e0"&&(e.innerHTML=t),this.h()},h(){F(e,"text-align","center")},m(o,n){R(o,e,n)},d(o){o&&a(e)}}}function Rt(l){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){ht(t.src,o=l[1])||p(t,"src",o),p(t,"alt","Evidencia fotográfica"),F(t,"max-width","100%"),F(t,"margin-top","16px")},m(n,r){R(n,e,r),i(e,t)},p(n,r){r[0]&2&&!ht(t.src,o=n[1])&&p(t,"src",o)},d(n){n&&a(e)}}}function lo(l){let e,t,o,n,r="Cancelar",d,_,g=l[10].title+"",O,k,f,s,b="Confirmar",h,v,m,w,y,H,P,z,C="Negocio",L,S,I=l[10].client_name+"",D,U,M=l[10].client_phone&&l[10].client_phone.trim().length,q,j,W,ee,ve=l[10].schedule&&l[10].schedule.trim().length,V,Q,J=l[10].logistic_comments&&l[10].logistic_comments.trim().length,A,G,K,oe,ae,ne,se,re,ge,Ne,ke,Ee,Le,Fe,ze,je="Subir Evidencia",Ue,B,X,ye,Se,pe,te=M&&Yn(l);function he(Z,Ie){if(Z[10].line1&&Z[10].line1.trim().length)return xn;if(Z[10].line2&&Z[10].line2.trim().length)return Zn}let ce=he(l),ue=ce&&ce(l),$=l[6]&&Mt(l),le=l[7]&&l[7]!=="<br>"&&At(l),Pe=ve&&eo(l),me=l[10].driver_comments&&to(l),He=J&&no(l),Te=l[8]&&Bt(l),Ce=l[4]===!0&&Dt(l),be=(l[5]===!0||l[5]===!1&&l[4]===!1)&&zt(l),we=l[3]&&Ht(),Me=l[1]&&Rt(l);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),O=fe(g),k=N(),f=c("ion-buttons"),s=c("ion-button"),s.textContent=b,h=N(),v=c("ion-content"),m=c("ion-list"),w=c("ion-item"),y=c("ion-icon"),H=N(),P=c("ion-label"),z=c("p"),z.textContent=C,L=N(),S=c("h2"),D=fe(I),U=N(),te&&te.c(),q=N(),ue&&ue.c(),j=N(),$&&$.c(),W=N(),le&&le.c(),ee=N(),Pe&&Pe.c(),V=N(),me&&me.c(),Q=N(),He&&He.c(),A=N(),Te&&Te.c(),G=N(),K=c("ion-item"),oe=c("ion-icon"),ae=N(),ne=c("ion-textarea"),se=N(),re=c("section"),Ce&&Ce.c(),ge=N(),be&&be.c(),Ne=N(),ke=c("section"),Ee=c("ion-button"),Le=c("ion-icon"),Fe=N(),ze=c("label"),ze.textContent=je,Ue=N(),B=c("input"),X=N(),we&&we.c(),ye=N(),Me&&Me.c(),this.h()},l(Z){e=u(Z,"ION-HEADER",{translucent:!0});var Ie=E(e);t=u(Ie,"ION-TOOLBAR",{});var Ve=E(t);o=u(Ve,"ION-BUTTONS",{slot:!0});var nt=E(o);n=u(nt,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),Y(n)!=="svelte-1f8rjcf"&&(n.textContent=r),nt.forEach(a),d=T(Ve),_=u(Ve,"ION-TITLE",{style:!0,title:!0});var Nt=E(_);O=_e(Nt,g),Nt.forEach(a),k=T(Ve),f=u(Ve,"ION-BUTTONS",{slot:!0});var Tt=E(f);s=u(Tt,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),Y(s)!=="svelte-1ida0il"&&(s.textContent=b),Tt.forEach(a),Ve.forEach(a),Ie.forEach(a),h=T(Z),v=u(Z,"ION-CONTENT",{fullscreen:!0});var Ct=E(v);m=u(Ct,"ION-LIST",{});var de=E(m);w=u(de,"ION-ITEM",{});var ct=E(w);y=u(ct,"ION-ICON",{icon:!0,slot:!0}),E(y).forEach(a),H=T(ct),P=u(ct,"ION-LABEL",{});var ut=E(P);z=u(ut,"P",{"data-svelte-h":!0}),Y(z)!=="svelte-57b1dg"&&(z.textContent=C),L=T(ut),S=u(ut,"H2",{});var yt=E(S);D=_e(yt,I),yt.forEach(a),ut.forEach(a),ct.forEach(a),U=T(de),te&&te.l(de),q=T(de),ue&&ue.l(de),j=T(de),$&&$.l(de),W=T(de),le&&le.l(de),ee=T(de),Pe&&Pe.l(de),V=T(de),me&&me.l(de),Q=T(de),He&&He.l(de),A=T(de),Te&&Te.l(de),G=T(de),K=u(de,"ION-ITEM",{});var ft=E(K);oe=u(ft,"ION-ICON",{icon:!0,slot:!0}),E(oe).forEach(a),ae=T(ft),ne=u(ft,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ne).forEach(a),ft.forEach(a),se=T(de),re=u(de,"SECTION",{style:!0});var _t=E(re);Ce&&Ce.l(_t),ge=T(_t),be&&be.l(_t),_t.forEach(a),Ne=T(de),ke=u(de,"SECTION",{style:!0});var wt=E(ke);Ee=u(wt,"ION-BUTTON",{fill:!0,class:!0,style:!0});var Xe=E(Ee);Le=u(Xe,"ION-ICON",{icon:!0,slot:!0}),E(Le).forEach(a),Fe=T(Xe),ze=u(Xe,"LABEL",{for:!0,"data-svelte-h":!0}),Y(ze)!=="svelte-7lscau"&&(ze.textContent=je),Ue=T(Xe),B=u(Xe,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Xe.forEach(a),wt.forEach(a),X=T(de),we&&we.l(de),ye=T(de),Me&&Me.l(de),de.forEach(a),Ct.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),F(_,"text-align","center"),p(_,"title",l[10].title),p(s,"strong",""),p(f,"slot","end"),p(e,"translucent",""),p(y,"icon",bn),p(y,"slot","start"),p(oe,"icon",gt),p(oe,"slot","start"),p(ne,"label","Notas"),p(ne,"placeholder","Escribe aquí..."),F(re,"display","flex"),F(re,"gap","8px"),F(re,"padding","16px 16px 6px"),p(Le,"icon",on),p(Le,"slot","start"),x(ze,"for","eventEvidence"),F(B,"display","none"),x(B,"id","eventEvidence"),x(B,"name","fileToUpload"),x(B,"type","file"),x(B,"accept","image/*"),p(Ee,"fill","outline"),p(Ee,"class","loadEvidence"),F(Ee,"flex","1"),F(ke,"display","flex"),F(ke,"gap","8px"),F(ke,"padding","0px 16px"),p(v,"fullscreen","")},m(Z,Ie){R(Z,e,Ie),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),i(_,O),i(t,k),i(t,f),i(f,s),R(Z,h,Ie),R(Z,v,Ie),i(v,m),i(m,w),i(w,y),i(w,H),i(w,P),i(P,z),i(P,L),i(P,S),i(S,D),i(m,U),te&&te.m(m,null),i(m,q),ue&&ue.m(m,null),i(m,j),$&&$.m(m,null),i(m,W),le&&le.m(m,null),i(m,ee),Pe&&Pe.m(m,null),i(m,V),me&&me.m(m,null),i(m,Q),He&&He.m(m,null),i(m,A),Te&&Te.m(m,null),i(m,G),i(m,K),i(K,oe),i(K,ae),i(K,ne),l[18](ne),i(m,se),i(m,re),Ce&&Ce.m(re,null),i(re,ge),be&&be.m(re,null),i(m,Ne),i(m,ke),i(ke,Ee),i(Ee,Le),i(Ee,Fe),i(Ee,ze),i(Ee,Ue),i(Ee,B),i(m,X),we&&we.m(m,null),i(m,ye),Me&&Me.m(m,null),Se||(pe=[ie(n,"click",l[12]),ie(s,"click",l[13]),ie(B,"change",l[11])],Se=!0)},p(Z,Ie){M&&te.p(Z,Ie),ue&&ue.p(Z,Ie),Z[6]?$?$.p(Z,Ie):($=Mt(Z),$.c(),$.m(m,W)):$&&($.d(1),$=null),Z[7]&&Z[7]!=="<br>"?le?le.p(Z,Ie):(le=At(Z),le.c(),le.m(m,ee)):le&&(le.d(1),le=null),ve&&Pe.p(Z,Ie),Z[10].driver_comments&&me.p(Z,Ie),J&&He.p(Z,Ie),Z[8]?Te?Te.p(Z,Ie):(Te=Bt(Z),Te.c(),Te.m(m,G)):Te&&(Te.d(1),Te=null),Z[4]===!0?Ce?Ce.p(Z,Ie):(Ce=Dt(Z),Ce.c(),Ce.m(re,ge)):Ce&&(Ce.d(1),Ce=null),Z[5]===!0||Z[5]===!1&&Z[4]===!1?be?be.p(Z,Ie):(be=zt(Z),be.c(),be.m(re,null)):be&&(be.d(1),be=null),Z[3]?we||(we=Ht(),we.c(),we.m(m,ye)):we&&(we.d(1),we=null),Z[1]?Me?Me.p(Z,Ie):(Me=Rt(Z),Me.c(),Me.m(m,null)):Me&&(Me.d(1),Me=null)},i:Oe,o:Oe,d(Z){Z&&(a(e),a(h),a(v)),te&&te.d(),ue&&ue.d(),$&&$.d(),le&&le.d(),Pe&&Pe.d(),me&&me.d(),He&&He.d(),Te&&Te.d(),l[18](null),Ce&&Ce.d(),be&&be.d(),we&&we.d(),Me&&Me.d(),Se=!1,Ge(pe)}}}let lt="https://app.rutaflow.com/";const Ut=/Teléfono:\s*(\d{10,})/;function Ft(l,e){for(let t=0;t<e.length;t++)if(e[t].alias===l)return e[t].val;return""}function io(l,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,d=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",g="",O={latitude:null,longitude:null},k=new Object,f="",s="",b=!1,h=!0,v=!1,m="",w=n.comments_ext,y=!1,H="";it(()=>{M(),P()});function P(){n.date_service?n.date_service&&!n.date_completed&&!n.service_time?(t(4,h=!1),t(5,v=!0)):n.date_service&&n.date_completed&&n.service_time&&(t(4,h=!1),t(5,v=!1)):(t(4,h=!0),t(5,v=!1))}if(n.comments_ext){const V=n.comments_ext.match(Ut);V&&(m=V[1],w=n.comments_ext.replace(Ut,"").trim())}const z=async(V,Q)=>{await(await Qe.create({header:V||"Error",message:Q||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},C=async V=>{t(3,b=!0);const J=V.target.files[0],A=await L(J);if(A){const G=new FormData;G.append("fileToUpload",A);try{const K=await fetch(lt+"api/admin/manager/upload_img_driver.php",{method:"POST",body:G});if(K.ok){const oe=await K.json();t(1,_=oe.img),g=oe.img_id}else console.error("File upload failed:",K.statusText)}catch(K){console.error("Error during file upload:",K)}finally{t(3,b=!1)}}},L=async V=>new Promise(Q=>{const J=new FileReader;J.onload=A=>{const G=new Image;G.src=A.target.result,G.onload=()=>{const K=document.createElement("canvas"),oe=K.getContext("2d"),ae=800,ne=600;let se=G.width,re=G.height;se>ae&&(re*=ae/se,se=ae),re>ne&&(se*=ne/re,re=ne),K.width=se,K.height=re,oe.drawImage(G,0,0,se,re),K.toBlob(ge=>{Q(ge)},"image/jpeg",.7)}},J.readAsDataURL(V)}),S=()=>{o.dismiss({data:Date.now()})},I=async()=>{try{if(await D()){const Q={id_route:n.id_route,id_event:n.id_event,comments:d.value,img:_,img_id:g,lat:O.latitude,lon:O.longitude,...f==="0"&&{approve:"0"},...r&&{isLast:!0}},J=new FormData;for(const A in Q)J.append(A,Q[A]);if(Q.img&&Q.img_id){const A=await fetch(lt+"api/admin/evidence/send_evidence.php",{method:"POST",body:J})}else z("Información incompleta","Cargar evidencia fotográfica faltante para completar parada.")}}catch(V){console.error("Error fetching data:",V)}},D=async()=>navigator.geolocation?new Promise((V,Q)=>{navigator.geolocation.getCurrentPosition(J=>{O.latitude=J.coords.latitude,O.longitude=J.coords.longitude,V(!0)},J=>{console.error("Error getting location:",J),V(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function U(V){V.stopPropagation();const Q=new FormData;Q.append("client_phone",m),Q.append("client_name",n.title),Q.append("delivery_phone",n.client_phone),Q.append("enterprise_name",n.enterprise_name);try{const J=await fetch(lt+"api/admin/message_central/send_sms.php",{method:"POST",body:Q});if(J.ok){const A=await J.json();z("SMS enviado","Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+m)}else z("SMS no enviado","Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.")}catch(J){console.error("Error during file upload:",J)}}const M=async V=>{if(n.id_enterprise){const Q=new FormData;Q.append("id_enterprise",n.id_enterprise);try{const J=await fetch(lt+"api/admin/enterprise/enterprise_settings.php",{method:"POST",body:Q});J.ok?(k=(await J.json()).nodos,f=Ft("stops_wait_approval",k),t(2,s=Ft("sms_active",k))):console.error("File upload failed:",J.statusText)}catch(J){console.error("Error during file upload:",J)}}};function q(){t(4,h=!1),t(5,v=!0),W(n.id_event,"checkin")}function j(){t(5,v=!1),t(4,h=!1),W(n.id_event,"checkout")}async function W(V,Q){if(Q){const J=new FormData;J.append("type",Q),J.append("id_event",V);try{const A=await fetch(lt+"api/admin/route/record_check_date.php",{method:"POST",body:J});if(A.ok){const G=await A.json();G.minutes&&z("Tiempo por parada","Completaste la parada en "+G.minutes+" minutos.")}else console.error("File upload failed:",A.statusText)}catch(A){console.error("Error during file upload:",A)}finally{}}}function ee(V){Be[V?"unshift":"push"](()=>{H=V,t(9,H)})}function ve(V){Be[V?"unshift":"push"](()=>{d=V,t(0,d)})}return[d,_,s,b,h,v,m,w,y,H,n,C,S,I,U,q,j,ee,ve]}class ro extends $e{constructor(e){super(),et(this,e,io,lo,xe,{},null,[-1,-1])}}function qt(l){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0}),E(e).forEach(a),this.h()},h(){p(e,"name","dots")},m(t,o){R(t,e,o)},d(t){t&&a(e)}}}function jt(l){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){ht(t.src,o=l[0])||p(t,"src",o),p(t,"alt","Evidencia fotográfica"),F(t,"max-width","100%"),F(t,"margin-top","16px")},m(n,r){R(n,e,r),i(e,t)},p(n,r){r&1&&!ht(t.src,o=n[0])&&p(t,"src",o)},d(n){n&&a(e)}}}function ao(l){let e,t,o,n,r="Cancelar",d,_,g="AGREGAR GASTO",O,k,f,s,b,h,v,m,w,y,H,P,z,C,L,S,I,D,U='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',M,q,j="Efectivo",W,ee,ve="Tarjeta",V,Q,J="Transferencia",A,G,K,oe,ae,ne,se,re,ge,Ne,ke=`<ion-icon icon="${on}" slot="start"></ion-icon>
                        Subir Evidencia`,Ee,Le,Fe,ze,je,Ue,B,X,ye="Confirmar",Se,pe,te=l[5]&&qt(),he=l[0]&&jt(l);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,d=N(),_=c("ion-title"),_.textContent=g,O=N(),k=c("ion-content"),f=c("ion-list"),s=c("ion-item"),b=c("ion-icon"),h=N(),v=c("ion-input"),m=N(),w=c("ion-item"),y=c("ion-icon"),H=N(),P=c("ion-input"),z=N(),C=c("ion-item"),L=c("ion-icon"),S=N(),I=c("ion-select"),D=c("div"),D.innerHTML=U,M=N(),q=c("ion-select-option"),q.textContent=j,W=N(),ee=c("ion-select-option"),ee.textContent=ve,V=N(),Q=c("ion-select-option"),Q.textContent=J,A=N(),G=c("ion-item"),K=c("ion-icon"),oe=N(),ae=c("ion-textarea"),ne=N(),se=c("section"),re=c("label"),ge=c("ion-button"),Ne=c("label"),Ne.innerHTML=ke,Ee=N(),Le=c("input"),Fe=N(),te&&te.c(),ze=N(),he&&he.c(),je=N(),Ue=c("ion-footer"),B=c("ion-toolbar"),X=c("ion-button"),X.textContent=ye,this.h()},l(ce){e=u(ce,"ION-HEADER",{translucent:!0});var ue=E(e);t=u(ue,"ION-TOOLBAR",{});var $=E(t);o=u($,"ION-BUTTONS",{slot:!0});var le=E(o);n=u(le,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),Y(n)!=="svelte-1f8rjcf"&&(n.textContent=r),le.forEach(a),d=T($),_=u($,"ION-TITLE",{title:!0,"data-svelte-h":!0}),Y(_)!=="svelte-efps2s"&&(_.textContent=g),$.forEach(a),ue.forEach(a),O=T(ce),k=u(ce,"ION-CONTENT",{fullscreen:!0});var Pe=E(k);f=u(Pe,"ION-LIST",{});var me=E(f);s=u(me,"ION-ITEM",{});var He=E(s);b=u(He,"ION-ICON",{icon:!0,slot:!0}),E(b).forEach(a),h=T(He),v=u(He,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(v).forEach(a),He.forEach(a),m=T(me),w=u(me,"ION-ITEM",{});var Te=E(w);y=u(Te,"ION-ICON",{icon:!0,slot:!0}),E(y).forEach(a),H=T(Te),P=u(Te,"ION-INPUT",{label:!0,type:!0,value:!0}),E(P).forEach(a),Te.forEach(a),z=T(me),C=u(me,"ION-ITEM",{});var Ce=E(C);L=u(Ce,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(a),S=T(Ce),I=u(Ce,"ION-SELECT",{placeholder:!0,value:!0});var be=E(I);D=u(be,"DIV",{slot:!0,"data-svelte-h":!0}),Y(D)!=="svelte-wl764p"&&(D.innerHTML=U),M=T(be),q=u(be,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),Y(q)!=="svelte-i9crym"&&(q.textContent=j),W=T(be),ee=u(be,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),Y(ee)!=="svelte-fx0z11"&&(ee.textContent=ve),V=T(be),Q=u(be,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),Y(Q)!=="svelte-1c24jf2"&&(Q.textContent=J),be.forEach(a),Ce.forEach(a),A=T(me),G=u(me,"ION-ITEM",{});var we=E(G);K=u(we,"ION-ICON",{icon:!0,slot:!0}),E(K).forEach(a),oe=T(we),ae=u(we,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ae).forEach(a),we.forEach(a),ne=T(me),se=u(me,"SECTION",{});var Me=E(se);re=u(Me,"LABEL",{for:!0,style:!0});var Z=E(re);ge=u(Z,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var Ie=E(ge);Ne=u(Ie,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),Y(Ne)!=="svelte-1m9yw22"&&(Ne.innerHTML=ke),Ee=T(Ie),Le=u(Ie,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ie.forEach(a),Z.forEach(a),Me.forEach(a),Fe=T(me),te&&te.l(me),ze=T(me),he&&he.l(me),me.forEach(a),Pe.forEach(a),je=T(ce),Ue=u(ce,"ION-FOOTER",{});var Ve=E(Ue);B=u(Ve,"ION-TOOLBAR",{});var nt=E(B);X=u(nt,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),Y(X)!=="svelte-1c7dl3f"&&(X.textContent=ye),nt.forEach(a),Ve.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","start"),p(_,"title",""),p(e,"translucent",""),p(b,"icon",rn),p(b,"slot","start"),p(v,"label","Concepto"),p(v,"type","text"),p(v,"placeholder","Escribe aquí..."),p(v,"value",l[6]?l[6]:""),p(y,"icon",gt),p(y,"slot","start"),p(P,"label","Cantidad"),p(P,"type","number"),p(P,"value",l[7]?l[7]:""),p(L,"icon",yn),p(L,"slot","start"),x(D,"slot","label"),p(q,"value","cash"),p(ee,"value","card"),p(Q,"value","transfer"),p(I,"placeholder","Tipo de pago"),p(I,"value",l[8]?l[8]:""),p(K,"icon",gt),p(K,"slot","start"),p(ae,"label","Comentarios"),p(ae,"placeholder","Escribe aquí..."),x(Ne,"for","eventEvidence"),F(Ne,"width","100%"),F(Ne,"padding","8px"),F(Le,"display","none"),x(Le,"id","eventEvidence"),x(Le,"name","fileToUpload"),x(Le,"type","file"),x(Le,"accept","image/*"),p(ge,"fill","outline"),p(ge,"size","small"),p(ge,"class","loadEvidence"),p(ge,"expand","block"),x(re,"for","eventEvidence"),F(re,"display","block"),F(re,"width","100%"),p(k,"fullscreen",""),p(X,"fill","outline"),p(X,"color","tertiary"),p(X,"strong",""),F(X,"width","99%"),F(X,"height","auto")},m(ce,ue){R(ce,e,ue),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),R(ce,O,ue),R(ce,k,ue),i(k,f),i(f,s),i(s,b),i(s,h),i(s,v),l[12](v),i(f,m),i(f,w),i(w,y),i(w,H),i(w,P),l[13](P),i(f,z),i(f,C),i(C,L),i(C,S),i(C,I),i(I,D),i(I,M),i(I,q),i(I,W),i(I,ee),i(I,V),i(I,Q),l[14](I),i(f,A),i(f,G),i(G,K),i(G,oe),i(G,ae),l[15](ae),i(f,ne),i(f,se),i(se,re),i(re,ge),i(ge,Ne),i(ge,Ee),i(ge,Le),i(f,Fe),te&&te.m(f,null),i(f,ze),he&&he.m(f,null),R(ce,je,ue),R(ce,Ue,ue),i(Ue,B),i(B,X),Se||(pe=[ie(n,"click",l[10]),ie(Le,"change",l[9]),ie(X,"click",l[11])],Se=!0)},p(ce,[ue]){ce[5]?te||(te=qt(),te.c(),te.m(f,ze)):te&&(te.d(1),te=null),ce[0]?he?he.p(ce,ue):(he=jt(ce),he.c(),he.m(f,null)):he&&(he.d(1),he=null)},i:Oe,o:Oe,d(ce){ce&&(a(e),a(O),a(k),a(je),a(Ue)),l[12](null),l[13](null),l[14](null),l[15](null),te&&te.d(),he&&he.d(),Se=!1,Ge(pe)}}}function so(l,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,d=o.componentProps.ex_amount,_=o.componentProps.ex_type,g=o.componentProps.id_expense,O="",k="",f="",s=0,b="",h="",v=!1;it(()=>{});const m=async(I,D)=>{await(await Qe.create({header:I,message:D,buttons:[{text:"Cerrar"}]})).present()},w=async I=>{t(5,v=!0);const U=I.target.files[0],M=await y(U);if(M){const q=new FormData;q.append("fileToUpload",M);try{const j=await fetch("https://app.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:q});if(j.ok){const W=await j.json();t(0,O=W.img),k=W.img_id}else console.error("File upload failed:",j.statusText)}catch(j){console.error("Error during file upload:",j)}finally{t(5,v=!1)}}},y=async I=>new Promise(D=>{const U=new FileReader;U.onload=M=>{const q=new Image;q.src=M.target.result,q.onload=()=>{const j=document.createElement("canvas"),W=j.getContext("2d"),ee=800,ve=600;let V=q.width,Q=q.height;V>ee&&(Q*=ee/V,V=ee),Q>ve&&(V*=ve/Q,Q=ve),j.width=V,j.height=Q,W.drawImage(q,0,0,V,Q),j.toBlob(J=>{D(J)},"image/jpeg",.7)}},U.readAsDataURL(I)}),H=()=>{st.dismiss()},P=()=>{var I=new Object;I.id_route=n,I.comments=b.value,I.type=f.value,I.img=O,I.img_id=k,I.amount=s.value,I.concept=h.value,I.status="done",I.id_expense=g||"null";const D=new FormData;for(const U in I)D.append(U,I[U]);!k||!O||!b.value||!s.value||!h.value?m("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://app.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:D}).then(U=>U.json()).then(U=>{H()}).catch(U=>{console.error("Error fetching data:",U)})};function z(I){Be[I?"unshift":"push"](()=>{h=I,t(4,h)})}function C(I){Be[I?"unshift":"push"](()=>{s=I,t(2,s)})}function L(I){Be[I?"unshift":"push"](()=>{f=I,t(1,f)})}function S(I){Be[I?"unshift":"push"](()=>{b=I,t(3,b)})}return[O,f,s,b,h,v,r,d,_,w,H,P,z,C,L,S]}class Et extends $e{constructor(e){super(),et(this,e,so,ao,xe,{})}}function Vt(l,e,t){const o=l.slice();return o[7]=e[t],o}function co(l){let e,t="Cargar gasto",o,n;function r(...d){return l[4](l[7],...d)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(d){e=u(d,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),Y(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){p(e,"fill","outline"),p(e,"size","small"),p(e,"aria-selected","")},m(d,_){R(d,e,_),o||(n=ie(e,"click",r),o=!0)},p(d,_){l=d},d(d){d&&a(e),o=!1,n()}}}function uo(l){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),Y(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){p(e,"fill","solid"),p(e,"size","small"),p(e,"aria-selected","")},m(o,n){R(o,e,n)},p:Oe,d(o){o&&a(e)}}}function Gt(l,e){let t,o,n,r=e[7].concept+"",d,_,g;function O(s,b){return s[7].status=="done"?uo:co}let f=O(e)(e);return{key:l,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),d=fe(r),_=N(),f.c(),g=N(),this.h()},l(s){t=u(s,"ION-ITEM",{});var b=E(t);o=u(b,"ION-LABEL",{style:!0});var h=E(o);n=u(h,"P",{style:!0});var v=E(n);d=_e(v,r),v.forEach(a),h.forEach(a),_=T(b),f.l(b),g=T(b),b.forEach(a),this.h()},h(){F(n,"margin-left","10px"),F(o,"display","flex"),this.first=t},m(s,b){R(s,t,b),i(t,o),i(o,n),i(n,d),i(t,_),f.m(t,null),i(t,g)},p(s,b){e=s,f.p(e,b)},d(s){s&&a(t),f.d()}}}function fo(l){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${wn}"></ion-icon>`,d,_,g="LISTA DE GASTOS",O,k,f,s=[],b=new Map,h,v,m,w="Cerrar",y,H,P=qe(l[0]);const z=C=>C[7].id_expenses;for(let C=0;C<P.length;C+=1){let L=Vt(l,P,C),S=z(L);b.set(S,s[C]=Gt(S,L))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,d=N(),_=c("ion-title"),_.textContent=g,O=N(),k=c("ion-content"),f=c("ion-list");for(let C=0;C<s.length;C+=1)s[C].c();h=N(),v=c("ion-footer"),m=c("ion-button"),m.textContent=w,this.h()},l(C){e=u(C,"ION-HEADER",{translucent:!0});var L=E(e);t=u(L,"ION-TOOLBAR",{});var S=E(t);o=u(S,"ION-BUTTONS",{slot:!0});var I=E(o);n=u(I,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),Y(n)!=="svelte-160xz3i"&&(n.innerHTML=r),I.forEach(a),d=T(S),_=u(S,"ION-TITLE",{"data-svelte-h":!0}),Y(_)!=="svelte-1phn90x"&&(_.textContent=g),S.forEach(a),L.forEach(a),O=T(C),k=u(C,"ION-CONTENT",{fullscreen:!0});var D=E(k);f=u(D,"ION-LIST",{});var U=E(f);for(let q=0;q<s.length;q+=1)s[q].l(U);U.forEach(a),D.forEach(a),h=T(C),v=u(C,"ION-FOOTER",{});var M=E(v);m=u(M,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),Y(m)!=="svelte-zv7v83"&&(m.textContent=w),M.forEach(a),this.h()},h(){p(n,"color","medium"),p(o,"slot","end"),p(e,"translucent",""),p(k,"fullscreen",""),p(m,"fill","outline"),p(m,"color","tertiary"),p(m,"strong",""),F(m,"width","99%"),F(m,"height","auto")},m(C,L){R(C,e,L),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),R(C,O,L),R(C,k,L),i(k,f);for(let S=0;S<s.length;S+=1)s[S]&&s[S].m(f,null);R(C,h,L),R(C,v,L),i(v,m),y||(H=[ie(n,"click",l[3]),ie(m,"click",l[1])],y=!0)},p(C,[L]){L&5&&(P=qe(C[0]),s=rt(s,L,z,1,C,P,b,f,at,Gt,null,Vt))},i:Oe,o:Oe,d(C){C&&(a(e),a(O),a(k),a(h),a(v));for(let L=0;L<s.length;L+=1)s[L].d();y=!1,Ge(H)}}}function _o(l){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;it(()=>{});const o=()=>{st.dismiss()};function n(_,g,O,k,f){e.componentProps.ex_amount=O,e.componentProps.ex_concept=g,e.componentProps.ex_type=k,e.componentProps.id_expense=f,We("modal-expense",Et,{amount:O,concept:g,type:k,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{We("modal-expense",Et,{routeId:_}).then(g=>{}),o()},(_,g)=>n(g,_.concept,_.amount,_.type,_.id_expenses)]}class ho extends $e{constructor(e){super(),et(this,e,_o,fo,xe,{})}}const{document:Kt}=Dn;function Wt(l,e,t){const o=l.slice();return o[34]=e[t],o}function Xt(l,e,t){const o=l.slice();return o[34]=e[t],o[36]=t,o}function Jt(l,e,t){const o=l.slice();return o[34]=e[t],o[36]=t,o}function Qt(l){let e,t;return e=new Pn({props:{$$slots:{default:[Io]},$$scope:{ctx:l}}}),{c(){hn(e.$$.fragment)},l(o){pn(e.$$.fragment,o)},m(o,n){mn(e,o,n),t=!0},p(o,n){const r={};n[0]&1019|n[1]&512&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(dt(e.$$.fragment,o),t=!0)},o(o){vt(e.$$.fragment,o),t=!1},d(o){vn(e,o)}}}function po(l){let e,t='<div id="g_map" style="width: 100%; height: 100vh;"></div>';return{c(){e=c("ion-content"),e.innerHTML=t},l(o){e=u(o,"ION-CONTENT",{"data-svelte-h":!0}),Y(e)!=="svelte-1ydw6i9"&&(e.innerHTML=t)},m(o,n){R(o,e,n)},p:Oe,d(o){o&&a(e)}}}function mo(l){let e;function t(r,d){if(r[7].length>0)return go;if(!r[3])return vo}let o=t(l),n=o&&o(l);return{c(){n&&n.c(),e=Re()},l(r){n&&n.l(r),e=Re()},m(r,d){n&&n.m(r,d),R(r,e,d)},p(r,d){o===(o=t(r))&&n?n.p(r,d):(n&&n.d(1),n=o&&o(r),n&&(n.c(),n.m(e.parentNode,e)))},d(r){r&&a(e),n&&n.d(r)}}}function vo(l){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,d,_=[],g=new Map,O,k,f=l[4]&&Yt(l),s=qe(l[5]);const b=h=>h[34].id_event;for(let h=0;h<s.length;h+=1){let v=Wt(l,s,h),m=b(v);g.set(m,_[h]=xt(m,v))}return{c(){f&&f.c(),e=N(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=N(),d=c("ion-list");for(let h=0;h<_.length;h+=1)_[h].c();this.h()},l(h){f&&f.l(h),e=T(h),t=u(h,"ION-CONTENT",{});var v=E(t);o=u(v,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),Y(o)!=="svelte-1srnbs3"&&(o.innerHTML=n),r=T(v),d=u(v,"ION-LIST",{});var m=E(d);for(let w=0;w<_.length;w+=1)_[w].l(m);m.forEach(a),v.forEach(a),this.h()},h(){p(o,"slot","fixed")},m(h,v){f&&f.m(h,v),R(h,e,v),R(h,t,v),i(t,o),l[26](o),i(t,r),i(t,d);for(let m=0;m<_.length;m+=1)_[m]&&_[m].m(d,null);O||(k=ie(o,"ionRefresh",l[10]),O=!0)},p(h,v){h[4]?f?f.p(h,v):(f=Yt(h),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),v[0]&167968&&(s=qe(h[5]),_=rt(_,v,b,1,h,s,g,d,at,xt,null,Wt))},d(h){h&&(a(e),a(t)),f&&f.d(h),l[26](null);for(let v=0;v<_.length;v+=1)_[v].d();O=!1,k()}}}function go(l){let e,t;function o(d,_){return _[0]&144&&(e=null),e==null&&(e=!!(d[7].filter(No).every(To)&&!d[4])),e?Eo:bo}let n=o(l,[-1,-1]),r=n(l);return{c(){r.c(),t=Re()},l(d){r.l(d),t=Re()},m(d,_){r.m(d,_),R(d,t,_)},p(d,_){n===(n=o(d,_))&&r?r.p(d,_):(r.d(1),r=n(d),r&&(r.c(),r.m(t.parentNode,t)))},d(d){d&&a(t),r.d(d)}}}function Yt(l){let e=l[13]("",l[1],l[0])+"",t;return{c(){t=fe(e)},l(o){t=_e(o,e)},m(o,n){R(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[13]("",o[1],o[0])+"")&&Ae(t,e)},d(o){o&&a(t)}}}function Zt(l){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){x(e,"class","notes svelte-egzizz")},m(t,o){R(t,e,o)},d(t){t&&a(e)}}}function xt(l,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,g,O,k,f,s,b=e[34].title+"",h,v,m=e[34].support_list&&e[34].support_list.length||e[15](e[34]),w,y,H,P,z,C=m&&Zt();function L(){return e[27](e[34])}return{key:l,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=fe(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=fe(b),v=N(),C&&C.c(),w=N(),y=c("ion-icon"),H=N(),this.h()},l(S){t=u(S,"ION-ITEM",{});var I=E(t);o=u(I,"ION-AVATAR",{slot:!0});var D=E(o);n=u(D,"DIV",{class:!0,title:!0,style:!0});var U=E(n);r=u(U,"DIV",{class:!0});var M=E(r);_=_e(M,d),M.forEach(a),U.forEach(a),D.forEach(a),O=T(I),k=u(I,"ION-LABEL",{button:!0});var q=E(k);f=u(q,"ION-TEXT",{color:!0});var j=E(f);s=u(j,"H3",{});var W=E(s);h=_e(W,b),v=T(W),C&&C.l(W),W.forEach(a),j.forEach(a),q.forEach(a),w=T(I),y=u(I,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(y).forEach(a),H=T(I),I.forEach(a),this.h()},h(){x(r,"class","order svelte-egzizz"),x(n,"class","order-wrapper svelte-egzizz"),x(n,"title",g=Ye(e[34].status)),F(n,"background-color",De(e[34].status,e[34].date_service)),F(n,"color",Ze(De(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),p(k,"button",""),p(y,"icon",tt),p(y,"slot","end"),F(y,"color",De(e[34].status,e[34].date_service)),this.first=t},m(S,I){R(S,t,I),i(t,o),i(o,n),i(n,r),i(r,_),i(t,O),i(t,k),i(k,f),i(f,s),i(s,h),i(s,v),C&&C.m(s,null),i(t,w),i(t,y),i(t,H),P||(z=ie(k,"click",L),P=!0)},p(S,I){e=S,I[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&Ae(_,d),I[0]&32&&g!==(g=Ye(e[34].status))&&x(n,"title",g),I[0]&32&&F(n,"background-color",De(e[34].status,e[34].date_service)),I[0]&32&&F(n,"color",Ze(De(e[34].status))),I[0]&32&&b!==(b=e[34].title+"")&&Ae(h,b),I[0]&32&&(m=e[34].support_list&&e[34].support_list.length||e[15](e[34])),m?C||(C=Zt(),C.c(),C.m(s,null)):C&&(C.d(1),C=null),I[0]&32&&F(y,"color",De(e[34].status,e[34].date_service))},d(S){S&&a(t),C&&C.d(),P=!1,z()}}}function bo(l){let e=l[13](l[7],l[1],l[0])+"",t,o,n,r,d='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,g,O=[],k=new Map,f,s,b=qe(l[5]);const h=v=>v[34].id_event;for(let v=0;v<b.length;v+=1){let m=Xt(l,b,v),w=h(m);k.set(w,O[v]=en(w,m))}return{c(){t=fe(e),o=N(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=d,_=N(),g=c("ion-list");for(let v=0;v<O.length;v+=1)O[v].c();this.h()},l(v){t=_e(v,e),o=T(v),n=u(v,"ION-CONTENT",{});var m=E(n);r=u(m,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),Y(r)!=="svelte-dvt1s"&&(r.innerHTML=d),_=T(m),g=u(m,"ION-LIST",{});var w=E(g);for(let y=0;y<O.length;y+=1)O[y].l(w);w.forEach(a),m.forEach(a),this.h()},h(){p(r,"slot","fixed")},m(v,m){R(v,t,m),R(v,o,m),R(v,n,m),i(n,r),l[24](r),i(n,_),i(n,g);for(let w=0;w<O.length;w+=1)O[w]&&O[w].m(g,null);f||(s=ie(r,"ionRefresh",l[10]),f=!0)},p(v,m){m[0]&131&&e!==(e=v[13](v[7],v[1],v[0])+"")&&Ae(t,e),m[0]&299040&&(b=qe(v[5]),O=rt(O,m,h,1,v,b,k,g,at,en,null,Xt))},d(v){v&&(a(t),a(o),a(n)),l[24](null);for(let m=0;m<O.length;m+=1)O[m].d();f=!1,s()}}}function Eo(l){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,d=[],_=new Map,g,O,k=qe(l[5]);const f=s=>s[34].id_event;for(let s=0;s<k.length;s+=1){let b=Jt(l,k,s),h=f(b);_.set(h,d[s]=nn(h,b))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=N(),r=c("ion-list");for(let s=0;s<d.length;s+=1)d[s].c();this.h()},l(s){e=u(s,"ION-CONTENT",{});var b=E(e);t=u(b,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),Y(t)!=="svelte-15ukrgn"&&(t.innerHTML=o),n=T(b),r=u(b,"ION-LIST",{});var h=E(r);for(let v=0;v<d.length;v+=1)d[v].l(h);h.forEach(a),b.forEach(a),this.h()},h(){p(t,"slot","fixed")},m(s,b){R(s,e,b),i(e,t),l[22](t),i(e,n),i(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(r,null);g||(O=ie(t,"ionRefresh",l[10]),g=!0)},p(s,b){b[0]&299040&&(k=qe(s[5]),d=rt(d,b,f,1,s,k,_,r,at,nn,null,Jt))},d(s){s&&a(e),l[22](null);for(let b=0;b<d.length;b+=1)d[b].d();g=!1,O()}}}function $t(l){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){x(e,"class","notes svelte-egzizz")},m(t,o){R(t,e,o)},d(t){t&&a(e)}}}function en(l,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,g,O,k,f,s,b=e[34].title+"",h,v,m=e[34].support_list&&e[34].support_list.length||e[15](e[34]),w,y,H="",P,z,C,L,S,I=m&&$t();function D(){return e[25](e[34],e[36])}return{key:l,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=fe(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=fe(b),v=N(),I&&I.c(),w=N(),y=c("div"),y.innerHTML=H,P=N(),z=c("ion-icon"),C=N(),this.h()},l(U){t=u(U,"ION-ITEM",{});var M=E(t);o=u(M,"ION-AVATAR",{slot:!0});var q=E(o);n=u(q,"DIV",{class:!0,title:!0,style:!0});var j=E(n);r=u(j,"DIV",{class:!0});var W=E(r);_=_e(W,d),W.forEach(a),j.forEach(a),q.forEach(a),O=T(M),k=u(M,"ION-LABEL",{button:!0});var ee=E(k);f=u(ee,"ION-TEXT",{color:!0});var ve=E(f);s=u(ve,"H3",{});var V=E(s);h=_e(V,b),v=T(V),I&&I.l(V),V.forEach(a),ve.forEach(a),w=T(ee),y=u(ee,"DIV",{class:!0,"data-svelte-h":!0}),Y(y)!=="svelte-qaecoo"&&(y.innerHTML=H),ee.forEach(a),P=T(M),z=u(M,"ION-ICON",{icon:!0,slot:!0}),E(z).forEach(a),C=T(M),M.forEach(a),this.h()},h(){x(r,"class","order svelte-egzizz"),x(n,"class","order-wrapper svelte-egzizz"),x(n,"title",g=Ye(e[34].status)),F(n,"background-color",De(e[34].status,e[34].date_service)),F(n,"color",Ze(De(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),x(y,"class","sub svelte-egzizz"),p(k,"button",""),p(z,"icon",tt),p(z,"slot","end"),this.first=t},m(U,M){R(U,t,M),i(t,o),i(o,n),i(n,r),i(r,_),i(t,O),i(t,k),i(k,f),i(f,s),i(s,h),i(s,v),I&&I.m(s,null),i(k,w),i(k,y),i(t,P),i(t,z),i(t,C),L||(S=ie(k,"click",D),L=!0)},p(U,M){e=U,M[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&Ae(_,d),M[0]&32&&g!==(g=Ye(e[34].status))&&x(n,"title",g),M[0]&32&&F(n,"background-color",De(e[34].status,e[34].date_service)),M[0]&32&&F(n,"color",Ze(De(e[34].status))),M[0]&32&&b!==(b=e[34].title+"")&&Ae(h,b),M[0]&32&&(m=e[34].support_list&&e[34].support_list.length||e[15](e[34])),m?I||(I=$t(),I.c(),I.m(s,null)):I&&(I.d(1),I=null)},d(U){U&&a(t),I&&I.d(),L=!1,S()}}}function tn(l){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){x(e,"class","notes svelte-egzizz")},m(t,o){R(t,e,o)},d(t){t&&a(e)}}}function nn(l,e){let t,o,n,r,d=parseInt(e[34].pos)+1+"",_,g,O,k,f,s,b=e[34].title+"",h,v,m=e[34].support_list&&e[34].support_list.length||e[15](e[34]),w,y,H="",P,z,C,L,S,I=m&&tn();function D(){return e[23](e[34],e[36])}return{key:l,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=fe(d),O=N(),k=c("ion-label"),f=c("ion-text"),s=c("h3"),h=fe(b),v=N(),I&&I.c(),w=N(),y=c("div"),y.innerHTML=H,P=N(),z=c("ion-icon"),C=N(),this.h()},l(U){t=u(U,"ION-ITEM",{});var M=E(t);o=u(M,"ION-AVATAR",{slot:!0});var q=E(o);n=u(q,"DIV",{class:!0,title:!0,style:!0});var j=E(n);r=u(j,"DIV",{class:!0});var W=E(r);_=_e(W,d),W.forEach(a),j.forEach(a),q.forEach(a),O=T(M),k=u(M,"ION-LABEL",{button:!0});var ee=E(k);f=u(ee,"ION-TEXT",{color:!0});var ve=E(f);s=u(ve,"H3",{});var V=E(s);h=_e(V,b),v=T(V),I&&I.l(V),V.forEach(a),ve.forEach(a),w=T(ee),y=u(ee,"DIV",{class:!0,"data-svelte-h":!0}),Y(y)!=="svelte-qaecoo"&&(y.innerHTML=H),ee.forEach(a),P=T(M),z=u(M,"ION-ICON",{icon:!0,slot:!0}),E(z).forEach(a),C=T(M),M.forEach(a),this.h()},h(){x(r,"class","order svelte-egzizz"),x(n,"class","order-wrapper svelte-egzizz"),x(n,"title",g=Ye(e[34].status)),F(n,"background-color",De(e[34].status,e[34].date_service)),F(n,"color",Ze(De(e[34].status))),p(o,"slot","start"),p(f,"color","#2e2e2e"),x(y,"class","sub svelte-egzizz"),p(k,"button",""),p(z,"icon",tt),p(z,"slot","end"),this.first=t},m(U,M){R(U,t,M),i(t,o),i(o,n),i(n,r),i(r,_),i(t,O),i(t,k),i(k,f),i(f,s),i(s,h),i(s,v),I&&I.m(s,null),i(k,w),i(k,y),i(t,P),i(t,z),i(t,C),L||(S=ie(k,"click",D),L=!0)},p(U,M){e=U,M[0]&32&&d!==(d=parseInt(e[34].pos)+1+"")&&Ae(_,d),M[0]&32&&g!==(g=Ye(e[34].status))&&x(n,"title",g),M[0]&32&&F(n,"background-color",De(e[34].status,e[34].date_service)),M[0]&32&&F(n,"color",Ze(De(e[34].status))),M[0]&32&&b!==(b=e[34].title+"")&&Ae(h,b),M[0]&32&&(m=e[34].support_list&&e[34].support_list.length||e[15](e[34])),m?I||(I=tn(),I.c(),I.m(s,null)):I&&(I.d(1),I=null)},d(U){U&&a(t),I&&I.d(),L=!1,S()}}}function Io(l){let e,t,o,n,r=`<ion-icon icon="${Ln}"></ion-icon>`,d,_,g,O=`<ion-icon icon="${Sn}"></ion-icon>`,k,f,s=(l[6].name?l[6].name.toUpperCase():"")+"",b,h,v,m='<ion-segment-button value="list"><ion-label>Paradas</ion-label></ion-segment-button> <ion-segment-button value="map"><ion-label>Mapa</ion-label></ion-segment-button>',w,y,H,P;function z(S,I){if(S[9]==="list")return mo;if(S[9]==="map")return po}let C=z(l),L=C&&C(l);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,d=N(),_=c("ion-buttons"),g=c("ion-button"),g.innerHTML=O,k=N(),f=c("ion-title"),b=fe(s),h=N(),v=c("ion-segment"),v.innerHTML=m,w=N(),L&&L.c(),y=Re(),this.h()},l(S){e=u(S,"ION-HEADER",{translucent:!0});var I=E(e);t=u(I,"ION-TOOLBAR",{});var D=E(t);o=u(D,"ION-BUTTONS",{slot:!0});var U=E(o);n=u(U,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),Y(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),U.forEach(a),d=T(D),_=u(D,"ION-BUTTONS",{slot:!0});var M=E(_);g=u(M,"ION-BUTTON",{"data-svelte-h":!0}),Y(g)!=="svelte-nf50hj"&&(g.innerHTML=O),M.forEach(a),k=T(D),f=u(D,"ION-TITLE",{});var q=E(f);b=_e(q,s),q.forEach(a),D.forEach(a),h=T(I),v=u(I,"ION-SEGMENT",{value:!0,"data-svelte-h":!0}),Y(v)!=="svelte-lue4c9"&&(v.innerHTML=m),I.forEach(a),w=T(S),L&&L.l(S),y=Re(),this.h()},h(){p(n,"title","Atrás"),p(n,"alt","Atrás"),p(o,"slot","start"),p(_,"slot","end"),p(v,"value","list"),p(e,"translucent","")},m(S,I){R(S,e,I),i(e,t),i(t,o),i(o,n),i(t,d),i(t,_),i(_,g),i(t,k),i(t,f),i(f,b),i(e,h),i(e,v),R(S,w,I),L&&L.m(S,I),R(S,y,I),H||(P=[ie(n,"click",l[16]),ie(g,"click",l[20]),ie(v,"ionChange",l[21])],H=!0)},p(S,I){I[0]&64&&s!==(s=(S[6].name?S[6].name.toUpperCase():"")+"")&&Ae(b,s),C===(C=z(S))&&L?L.p(S,I):(L&&L.d(1),L=C&&C(S),L&&(L.c(),L.m(y.parentNode,y)))},d(S){S&&(a(e),a(w),a(y)),L&&L.d(S),H=!1,Ge(P)}}}function ko(l){let e,t,o,n=l[2]&&Qt(l);return{c(){e=N(),n&&n.c(),t=Re(),this.h()},l(r){un("svelte-kn0kph",Kt.head).forEach(a),e=T(r),n&&n.l(r),t=Re(),this.h()},h(){Kt.title="Rutaflow - Detalles de ruta"},m(r,d){R(r,e,d),n&&n.m(r,d),R(r,t,d),o=!0},p(r,d){r[2]?n?(n.p(r,d),d[0]&4&&dt(n,1)):(n=Qt(r),n.c(),dt(n,1),n.m(t.parentNode,t)):n&&(gn(),vt(n,1,1,()=>{n=null}),dn())},i(r){o||(dt(n),o=!0)},o(r){vt(n),o=!1},d(r){r&&(a(e),a(t)),n&&n.d(r)}}}function De(l,e=""){let t="#ffffff";return l==="pending"&&!e?t="#f2e300":l=="pending"&&e?t="#F6A833":l==="completed"&&(t="#44d900"),t}function Ye(l){let e="";return l=="pending"?e="Pendiente":l=="completed"&&(e="Completado"),e}function Ze(l){l.slice(0,1)==="#"&&(l=l.slice(1)),l.length===3&&(l=l.split("").map(function(r){return r+r}).join(""));const e=parseInt(l.substr(0,2),16),t=parseInt(l.substr(2,2),16),o=parseInt(l.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function Oo(l,e){let t=new FormData;return t.append("id_route",l),t.append("status",e),fetch("https://app.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const No=l=>l.mandatory==="1",To=l=>l.img;function Co(l,e,t){let o;fn(l,Mn,A=>t(19,o=A));var n=this&&this.__awaiter||function(A,G,K,oe){function ae(ne){return ne instanceof K?ne:new K(function(se){se(ne)})}return new(K||(K=Promise))(function(ne,se){function re(ke){try{Ne(oe.next(ke))}catch(Ee){se(Ee)}}function ge(ke){try{Ne(oe.throw(ke))}catch(Ee){se(Ee)}}function Ne(ke){ke.done?ne(ke.value):ae(ke.value).then(re,ge)}Ne((oe=oe.apply(A,G||[])).next())})};let{routeId:r}=e,{driverId:d}=e,_=new Object,g=!0,O=!1,k=[],f={},s=[],b=[],h,v=!1,m="list",w;const y=()=>n(void 0,void 0,void 0,function*(){yield P(r),h.complete()});it(()=>n(void 0,void 0,void 0,function*(){d=="41"&&(localStorage.clear(),console.log("Cleared session from localStorage")),yield P(r)}));function H(A){return n(this,void 0,void 0,function*(){if(t(9,m=A),m==="map"){yield _n(),w=document.getElementById("g_map");const G=new google.maps.Map(w,{zoom:8,center:{lat:20.6745683,lng:-103.3986104},mapId:"4504f8b37365c3d0"}),K=new google.maps.LatLngBounds,{AdvancedMarkerElement:oe,PinElement:ae}=yield google.maps.importLibrary("marker");navigator.geolocation?navigator.geolocation.getCurrentPosition(function(ne){const se=new google.maps.LatLng(ne.coords.latitude,ne.coords.longitude);new google.maps.Marker({position:se,map:G,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"#0062ff",fillOpacity:1,scale:6,strokeColor:"#ffffff",strokeWeight:2}}),new google.maps.Circle({strokeColor:"#00BFFF",strokeOpacity:.5,strokeWeight:1,fillColor:"#00BFFF",fillOpacity:.2,map:G,center:se,radius:ne.coords.accuracy}),K.extend(se)},function(ne){console.error("Error retrieving location:",ne)}):console.error("Geolocation not supported by this browser."),k.forEach((ne,se)=>{const re=parseFloat(ne.lat),ge=parseFloat(ne.lon),Ne=new google.maps.LatLng(re,ge),ke=new google.maps.Marker({position:{lat:re,lng:ge},map:G,title:ne.title}),Ee=new ae({background:De(ne.status,ne.date_service),borderColor:"#000",glyphColor:"#000",glyph:(parseInt(ne.pos)+1).toString()});new oe({map:G,position:Ne,content:Ee.element,title:"Parada "+(parseInt(ne.pos)+1).toString()+": "+ne.title}).addListener("click",function(Fe){C(ne,M(se))}),K.extend(ke.getPosition())}),G.fitBounds(K)}})}function P(A){return n(this,void 0,void 0,function*(){const G=new FormData;G.append("id_route",A);try{const oe=yield(yield fetch("https://app.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:G})).json();t(6,f=oe.data.seguimiento_list[0]),t(5,k=oe.data.event_list),t(7,s=oe.data.checklist),b=oe.data.expenses,f&&t(4,O=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,g=!1)}catch(K){t(3,g=!1),console.error("Error fetching data:",K)}})}const z=A=>new Promise((G,K)=>{const oe=new FormData;oe.append("id_route",A.id_route),oe.append("id_event",A.id_event),fetch("https://app.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:oe}).then(ae=>ae.json()).then(ae=>{G(ae.data.event_evidence[0])}).catch(ae=>{console.error("Error fetching data:",ae),K(ae)})}),C=(A,G)=>{z(A).then(K=>{K&&(A.img=K.img,A.driver_comments=K.driver_comments,A.comments=K.comments),We("modal-delivery-info",ro,{delivery:A,isLast:G}).then(oe=>{}).finally(()=>{P(r)})})},L=(A,G,K)=>{var oe=!1;return v||(v=!0,We("modal-checklist",Qn,{checklist:A,driverId:G,routeId:K,isLast:oe}).then(ae=>{v=!1}),Oo(K,"checklist")),""},S=A=>n(void 0,void 0,void 0,function*(){return yield P(A),b.length>0?We("modal-expense-detail",ho,{routeId:A,expenses:b}).then(G=>{}):We("modal-expense",Et,{routeId:A}).then(G=>{}),""}),I=A=>{if(A.tracking_type=="subscription"){if(A.subscriber_info&&A.payment_type==="cash"&&new Date(A.subscriber_info.payment_next)<new Date)return!0}else if(A.tracking_type=="ecommerce"&&Number(A.payment_pending)>0)return!0;return!1},D=()=>{_.type=="super"||_.type=="admin"?Ke("/drivers/me"):_.id_driver&&Ke(`/drivers/${_.id_driver}`)},U=(A,G)=>n(void 0,void 0,void 0,function*(){yield(yield Qe.create({header:A||"Error",message:G||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function M(A){return A===k.length-1}const q=()=>S(r),j=A=>H(A.detail.value);function W(A){Be[A?"unshift":"push"](()=>{h=A,t(8,h)})}const ee=(A,G)=>C(A,M(G));function ve(A){Be[A?"unshift":"push"](()=>{h=A,t(8,h)})}const V=(A,G)=>C(A,M(G));function Q(A){Be[A?"unshift":"push"](()=>{h=A,t(8,h)})}const J=A=>{const G=k.findIndex(se=>se.id_event===A.id_event),K=G===0,oe=G>0?k[G-1]:null,ae=K||oe&&oe.img!==null,ne=A.img!==null&&A.img!=="";ae||K&&!ne?C(A):U("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return l.$$set=A=>{"routeId"in A&&t(0,r=A.routeId),"driverId"in A&&t(1,d=A.driverId)},l.$$.update=()=>{l.$$.dirty[0]&524293&&(t(0,{routeId:r,driverId:d}=o.params,r,(t(1,d),t(19,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="super")?(P(r),Ke(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(P(r),Ke(`/drivers/${_.id_driver}/routes/${r}`)):Ke("/"))},[r,d,_,g,O,k,f,s,h,m,y,H,C,L,S,I,D,U,M,o,q,j,W,ee,ve,V,Q,J]}class Bo extends $e{constructor(e){super(),et(this,e,Co,ko,xe,{routeId:0,driverId:1},null,[-1,-1])}}export{Bo as component};
