import{Z as mt,s as We,e as u,j as T,b as f,q as E,d as W,h as s,m as C,v as m,i as q,w as l,x as te,n as Oe,z as Ue,_ as Yt,B as j,o as tt,k as Ae,$ as vt,t as ce,r as ue,f as G,a0 as Zt,y as Te,a1 as et,A as Le,a2 as ut,l as Qt,p as $t}from"../chunks/index.BYLndrM5.js";import{S as Xe,i as Je,t as ct,a as _t,c as en,b as tn,d as nn,m as on,e as ln,g as rn}from"../chunks/index.BNHbygFo.js";import{e as Be,u as nt,d as ot,a as an,c as dt,b as Kt,f as sn,g as cn,i as xt,h as un,j as Wt,s as bt,k as Ye,m as fn,n as _n,o as dn,q as hn,r as pn,p as mn}from"../chunks/index.D_B0Ekdt.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as lt,a as je,I as vn}from"../chunks/IonPage.KvUD72q2.js";import{q as bn,t as gn}from"../chunks/ion-modal.CsJaVgKZ.js";import{g as Fe}from"../chunks/entry.CUF_41Lp.js";const En=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},In=function(i){return document.createElement(i).constructor!==HTMLElement},On=(i,e)=>{In(i)||En(i,e)},ze=async(i,e,t)=>{bn(),gn(),On(i,e);const o=await lt.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Ge=mt({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Xt=mt({flag:[]});function kn(i){let e,t,o,n,r="Cancelar",h,_,b="Captura de Km/Gas",k,I,c,a="Confirmar",p,d,g,v,w,L,R;return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.textContent=r,h=T(),_=u("ion-title"),_.textContent=b,k=T(),I=u("ion-buttons"),c=u("ion-button"),c.textContent=a,p=T(),d=u("ion-content"),g=u("ion-item"),v=u("ion-input"),this.h()},l(P){e=f(P,"ION-HEADER",{translucent:!0});var M=E(e);t=f(M,"ION-TOOLBAR",{});var N=E(t);o=f(N,"ION-BUTTONS",{slot:!0});var D=E(o);n=f(D,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-17pq4f4"&&(n.textContent=r),D.forEach(s),h=C(N),_=f(N,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-1yhkaq7"&&(_.textContent=b),k=C(N),I=f(N,"ION-BUTTONS",{slot:!0});var y=E(I);c=f(y,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),W(c)!=="svelte-cm6j4s"&&(c.textContent=a),y.forEach(s),N.forEach(s),M.forEach(s),p=C(P),d=f(P,"ION-CONTENT",{fullscreen:!0});var O=E(d);g=f(O,"ION-ITEM",{});var A=E(g);v=f(A,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var U=E(v);U.forEach(s),A.forEach(s),O.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(c,"strong",""),m(I,"slot","end"),m(e,"translucent",""),m(v,"class","fin-km"),m(v,"inputmode","numeric"),m(v,"pattern","[0-9]*"),m(v,"type","number"),m(v,"placeholder",w="Ingresa "+i[0]+" actual"),m(v,"value",i[1]),m(v,"required",""),m(d,"fullscreen","")},m(P,M){q(P,e,M),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(t,k),l(t,I),l(I,c),q(P,p,M),q(P,d,M),l(d,g),l(g,v),L||(R=[te(n,"click",i[2]),te(c,"click",i[3]),te(v,"input",i[4])],L=!0)},p(P,[M]){M&1&&w!==(w="Ingresa "+P[0]+" actual")&&m(v,"placeholder",w),M&2&&m(v,"value",P[1])},i:Oe,o:Oe,d(P){P&&(s(e),s(p),s(d)),L=!1,Ue(R)}}}function Nn(i,e,t){const o=Yt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let h;Xt.subscribe(c=>{r=c.flag[0],r=="km_final"||r=="km_inicial"?t(0,h="kilometraje"):t(0,h="litros de gasolina")});let _=0;function b(){lt.dismiss()}function k(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Ge.update(a=>({...a,km_inicial:[_]})):r=="gas_inicial"?Ge.update(a=>({...a,gas_inicial:[_]})):r=="km_final"?Ge.update(a=>({...a,km_final:[_]})):r=="gas_final"&&Ge.update(a=>({...a,gas_final:[_]})),b()}return[h,_,b,k,c=>t(1,_=c.target.value)]}class Tn extends Xe{constructor(e){super(),Je(this,e,Nn,kn,We,{})}}const ft=mt({items:[],checkedIndices:[],mandatory:[]});function Ot(i,e,t){const o=i.slice();return o[49]=e[t],o[50]=e,o[51]=t,o}function Cn(i){let e,t,o,n,r,h="Kilometraje inicial",_,b,k=i[0]?i[0]+" km.":"Cargar km",I,c,a,p,d,g,v,w="Gasolina inicial (litros)",L,R,P=i[1]?i[1]+" litros":"Cargar gas",M,N,D,y;return N=vt(i[20][0]),{c(){e=u("ion-item"),t=u("ion-label"),o=u("input"),n=T(),r=u("p"),r.textContent=h,_=T(),b=u("ion-button"),I=ce(k),c=T(),a=u("ion-item"),p=u("ion-label"),d=u("input"),g=T(),v=u("p"),v.textContent=w,L=T(),R=u("ion-button"),M=ce(P),this.h()},l(O){e=f(O,"ION-ITEM",{});var A=E(e);t=f(A,"ION-LABEL",{style:!0});var U=E(t);o=f(U,"INPUT",{id:!0,style:!0,type:!0}),n=C(U),r=f(U,"P",{style:!0,"data-svelte-h":!0}),W(r)!=="svelte-88twxi"&&(r.textContent=h),U.forEach(s),_=C(A),b=f(A,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var S=E(b);I=ue(S,k),S.forEach(s),A.forEach(s),c=C(O),a=f(O,"ION-ITEM",{});var B=E(a);p=f(B,"ION-LABEL",{style:!0});var V=E(p);d=f(V,"INPUT",{id:!0,style:!0,type:!0}),g=C(V),v=f(V,"P",{style:!0,"data-svelte-h":!0}),W(v)!=="svelte-1ux30eb"&&(v.textContent=w),V.forEach(s),L=C(B),R=f(B,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var K=E(R);M=ue(K,P),K.forEach(s),B.forEach(s),this.h()},h(){G(o,"id","chkbox-km-ini"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-ini"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(v,"margin-left","10px"),j(p,"display","flex"),m(R,"fill","outline"),m(R,"class","loadGasInicial"),m(R,"size","small"),j(R,"height","16px "),N.p(o,d)},m(O,A){q(O,e,A),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[27](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,c,A),q(O,a,A),l(a,p),l(p,d),i[29](d),d.checked=~(i[4]||[]).indexOf(d.__value),l(p,g),l(p,v),l(a,L),l(a,R),l(R,M),D||(y=[te(o,"change",i[26]),te(b,"click",i[28]),te(d,"change",i[30]),te(R,"click",i[31])],D=!0)},p(O,A){A[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),A[0]&1&&k!==(k=O[0]?O[0]+" km.":"Cargar km")&&Te(I,k),A[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),A[0]&2&&P!==(P=O[1]?O[1]+" litros":"Cargar gas")&&Te(M,P)},d(O){O&&(s(e),s(c),s(a)),i[27](null),i[29](null),N.r(),D=!1,Ue(y)}}}function yn(i){let e,t,o,n,r,h="Kilometraje final",_,b,k=i[2]?i[2]+" km.":"Cargar km",I,c,a,p,d,g,v,w="Gasolina final (litros)",L,R,P=i[3]?i[3]+" litros":"Cargar gas",M,N,D,y;return N=vt(i[20][0]),{c(){e=u("ion-item"),t=u("ion-label"),o=u("input"),n=T(),r=u("p"),r.textContent=h,_=T(),b=u("ion-button"),I=ce(k),c=T(),a=u("ion-item"),p=u("ion-label"),d=u("input"),g=T(),v=u("p"),v.textContent=w,L=T(),R=u("ion-button"),M=ce(P),this.h()},l(O){e=f(O,"ION-ITEM",{});var A=E(e);t=f(A,"ION-LABEL",{style:!0});var U=E(t);o=f(U,"INPUT",{id:!0,style:!0,type:!0}),n=C(U),r=f(U,"P",{style:!0,"data-svelte-h":!0}),W(r)!=="svelte-ccmu71"&&(r.textContent=h),U.forEach(s),_=C(A),b=f(A,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var S=E(b);I=ue(S,k),S.forEach(s),A.forEach(s),c=C(O),a=f(O,"ION-ITEM",{});var B=E(a);p=f(B,"ION-LABEL",{style:!0});var V=E(p);d=f(V,"INPUT",{id:!0,style:!0,type:!0}),g=C(V),v=f(V,"P",{style:!0,"data-svelte-h":!0}),W(v)!=="svelte-wsoyd2"&&(v.textContent=w),V.forEach(s),L=C(B),R=f(B,"ION-BUTTON",{fill:!0,size:!0,class:!0});var K=E(R);M=ue(K,P),K.forEach(s),B.forEach(s),this.h()},h(){G(o,"id","chkbox-km-fin"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-fin"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(v,"margin-left","10px"),j(p,"display","flex"),m(R,"fill","outline"),m(R,"size","small"),m(R,"class","loadGasInicial"),N.p(o,d)},m(O,A){q(O,e,A),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[21](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,c,A),q(O,a,A),l(a,p),l(p,d),d.checked=~(i[4]||[]).indexOf(d.__value),i[24](d),l(p,g),l(p,v),l(a,L),l(a,R),l(R,M),D||(y=[te(o,"change",i[19]),te(b,"click",i[22]),te(d,"change",i[23]),te(R,"click",i[25])],D=!0)},p(O,A){A[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),A[0]&4&&k!==(k=O[2]?O[2]+" km.":"Cargar km")&&Te(I,k),A[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),A[0]&8&&P!==(P=O[3]?O[3]+" litros":"Cargar gas")&&Te(M,P)},d(O){O&&(s(e),s(c),s(a)),i[21](null),i[24](null),N.r(),D=!1,Ue(y)}}}function wn(i){let e=[],t=new Map,o,n=Be(i[12]);const r=h=>h[49].id_checklist_event;for(let h=0;h<n.length;h+=1){let _=Ot(i,n,h),b=r(_);t.set(b,e[h]=kt(b,_))}return{c(){for(let h=0;h<e.length;h+=1)e[h].c();o=Ae()},l(h){for(let _=0;_<e.length;_+=1)e[_].l(h);o=Ae()},m(h,_){for(let b=0;b<e.length;b+=1)e[b]&&e[b].m(h,_);q(h,o,_)},p(h,_){_[0]&202864&&(n=Be(h[12]),e=nt(e,_,r,1,h,n,t,o.parentNode,ot,kt,o,Ot))},d(h){h&&s(o);for(let _=0;_<e.length;_+=1)e[_].d(h)}}}function kt(i,e){let t,o,n,r=e[49],h,_,b=e[49].item+"",k,I,c,a,p=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"",d,g,v,w,L,R,P;const M=()=>e[33](n,r),N=()=>e[33](null,r);function D(){return e[34](e[49])}function y(...O){return e[36](e[49],...O)}return L=vt(e[20][0]),{key:i,first:null,c(){t=u("ion-item"),o=u("ion-label"),n=u("input"),h=T(),_=u("p"),k=ce(b),I=T(),c=u("ion-button"),a=u("label"),d=ce(p),g=T(),v=u("input"),w=T(),this.h()},l(O){t=f(O,"ION-ITEM",{});var A=E(t);o=f(A,"ION-LABEL",{style:!0});var U=E(o);n=f(U,"INPUT",{id:!0,style:!0,type:!0}),h=C(U),_=f(U,"P",{style:!0});var S=E(_);k=ue(S,b),S.forEach(s),U.forEach(s),I=C(A),c=f(A,"ION-BUTTON",{fill:!0,class:!0,size:!0});var B=E(c);a=f(B,"LABEL",{for:!0});var V=E(a);d=ue(V,p),V.forEach(s),g=C(B),v=f(B,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),B.forEach(s),w=C(A),A.forEach(s),this.h()},h(){G(n,"id",`chkbox-${e[49].id_checklist_event}`),j(n,"pointer-events","auto"),G(n,"type","checkbox"),n.__value=e[49].id_checklist_event,Zt(n,n.__value),n.required=!0,j(_,"margin-left","10px"),j(o,"display","flex"),G(a,"for","chklist-"+e[49].id_checklist_event),j(v,"display","none"),G(v,"id","chklist-"+e[49].id_checklist_event),G(v,"name","fileToUpload"),G(v,"type","file"),G(v,"accept","image/*"),m(c,"fill","outline"),m(c,"class","loadEvidence svelte-1lh6nay"),m(c,"size","small"),L.p(n),this.first=t},m(O,A){q(O,t,A),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),M(),l(o,h),l(o,_),l(_,k),l(t,I),l(t,c),l(c,a),l(a,d),l(c,g),l(c,v),e[35](v),l(t,w),R||(P=[te(n,"change",e[32]),te(n,"change",D),te(v,"change",y)],R=!0)},p(O,A){e=O,A[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[49]&&(N(),r=e[49],M()),A[0]&2048&&p!==(p=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"")&&Te(d,p)},d(O){O&&s(t),N(),e[35](null),L.r(),R=!1,Ue(P)}}}function Ln(i){let e,t,o,n,r="Cancelar",h,_,b="Requerimientos de ruta",k,I,c,a,p,d,g,v="Confirmar",w,L;function R(D,y){return D[13]?yn:Cn}let M=R(i)(i),N=i[12]&&wn(i);return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.textContent=r,h=T(),_=u("ion-title"),_.textContent=b,k=T(),I=u("ion-content"),c=u("ion-list"),M.c(),a=T(),N&&N.c(),p=T(),d=u("ion-footer"),g=u("ion-button"),g.textContent=v,this.h()},l(D){e=f(D,"ION-HEADER",{translucent:!0});var y=E(e);t=f(y,"ION-TOOLBAR",{});var O=E(t);o=f(O,"ION-BUTTONS",{slot:!0});var A=E(o);n=f(A,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1dnmkxs"&&(n.textContent=r),A.forEach(s),h=C(O),_=f(O,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-ucox25"&&(_.textContent=b),O.forEach(s),y.forEach(s),k=C(D),I=f(D,"ION-CONTENT",{fullscreen:!0});var U=E(I);c=f(U,"ION-LIST",{});var S=E(c);M.l(S),a=C(S),N&&N.l(S),S.forEach(s),U.forEach(s),p=C(D),d=f(D,"ION-FOOTER",{});var B=E(d);g=f(B,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(g)!=="svelte-g82qqw"&&(g.textContent=v),B.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(e,"translucent",""),m(I,"fullscreen",""),m(g,"fill","outline"),m(g,"color","tertiary"),m(g,"strong",""),j(g,"width","99%"),j(g,"height","auto")},m(D,y){q(D,e,y),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(D,k,y),q(D,I,y),l(I,c),M.m(c,null),l(c,a),N&&N.m(c,null),q(D,p,y),q(D,d,y),l(d,g),w||(L=[te(n,"click",i[14]),te(g,"click",i[15])],w=!0)},p(D,y){M.p(D,y),D[12]&&N.p(D,y)},i:Oe,o:Oe,d(D){D&&(s(e),s(k),s(I),s(p),s(d)),M.d(),N&&N.d(),w=!1,Ue(L)}}}function ht(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>ht(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function st(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function Sn(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,h=o.componentProps.routeId,_=o.componentProps.isLast;let b,k,I,c,a=[],p=null,d={},g,v,w,L,R={},P={};tt(()=>{_?console.log("Último checklist"):ft.update(z=>(z.mandatory=ht(n,"mandatory"),z.items=ht(n,"id_checklist_event"),z))});const M=async()=>{await(await je.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},N=async()=>{await(await je.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},D=async z=>{await(await je.create({header:"Datos inválidos",message:z=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},y=()=>{lt.dismiss(),r?Fe(`/drivers/${r}`):Fe("/drivers/me")},O=()=>{if(_){var z=B(I,"km"),x=B(c,"gas");const ne=new FormData;ne.append("km_final",z),ne.append("gas_final",x),ne.append("id_route",h),z&&x?(y(),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ne}).then(Ee=>Ee.json()).then(Ee=>{N()}).catch(Ee=>{console.error("Error fetching data:",Ee)})):M()}else{var le=B(b,"km"),ke=B(k,"gas");ft.update(ne=>{const Ee=ne.items,oe=ne.mandatory;if(Ee.every(J=>ne.checkedIndices.includes(J))&&le&&ke){y();const J=new FormData;for(const ie in R)if(R.hasOwnProperty(ie)){const{img:Ne,img_id:de}=R[ie];J.append(`selectedImages[${ie}][img]`,Ne),J.append(`selectedImages[${ie}][img_id]`,de)}J.append("km_inicial",le),J.append("gas_inicial",ke),J.append("id_route",h),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:J}).then(ie=>ie.json()).then(ie=>{oe&&oe[0]=="1"?st(h,"checklist-pending"):st(h,"enroute")}).catch(ie=>{console.error("Error fetching data:",ie)})}else if(!oe&&le&&ke){var $=new FormData;$.append("km_inicial",le),$.append("gas_inicial",ke),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:$}).then(J=>J.json()).then(J=>{st(h,"enroute")}).catch(J=>{console.error("Error fetching data:",J)})}else M();return ne})}H()},A=async(z,x)=>{const ke=z.target.files[0],ne=await U(ke);if(ne){const Ee=new FormData;Ee.append("fileToUpload",ne);try{const oe=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:Ee});if(oe.ok){const Z=await oe.json();R={...R,[x]:{img:Z.img,img_id:Z.img_id}},t(11,P={...P,[x]:Z.filename}),S(x),t(6,d[x].checked=!0,d)}else console.error("File upload failed:",oe.statusText)}catch(oe){console.error("Error during file upload:",oe)}}},U=async z=>new Promise(x=>{const le=new FileReader;le.onload=ke=>{const ne=new Image;ne.src=ke.target.result,ne.onload=()=>{const Ee=document.createElement("canvas"),oe=Ee.getContext("2d"),Z=800,$=600;let J=ne.width,ie=ne.height;J>Z&&(ie*=Z/J,J=Z),ie>$&&(J*=$/ie,ie=$),Ee.width=J,Ee.height=ie,oe.drawImage(ne,0,0,J,ie),Ee.toBlob(Ne=>{x(Ne)},"image/jpeg",.7)}},le.readAsDataURL(z)}),S=z=>{ft.update(x=>(x.checkedIndices.indexOf(z)===-1?x.checkedIndices.push(z):console.error(`ID ${z} is already checked.`),x.items.forEach(ke=>{ke.id_checklist_event===z&&(ke.checked=!0)}),x))};function B(z,x){return/^\d+$/.test(z)?parseInt(z,10):(D(x),null)}function V(z,x){K(x),o.componentProps.data_type=x,ze("modal-gas-km",Tn,{r:x}).then(()=>{Ge.subscribe(le=>{X(le,x)})})}function K(z){Xt.update(x=>({...x,flag:[z]}))}function X(z,x){t(0,b=z.km_inicial?z.km_inicial:null),t(1,k=z.gas_inicial?z.gas_inicial:null),t(2,I=z.km_final?z.km_final:null),t(3,c=z.gas_final?z.gas_final:null),x=="km_inicial"&&t(7,g.checked=!0,g),x=="gas_inicial"&&t(8,v.checked=!0,v),x=="km_final"&&t(9,w.checked=!0,w),x=="gas_final"&&t(10,L.checked=!0,L)}function H(){Ge.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const F=[[]];function Y(){a=et(F[0],this.__value,this.checked),t(4,a)}function ee(z){Le[z?"unshift":"push"](()=>{w=z,t(9,w)})}const re=z=>V(z,"km_final");function ae(){a=et(F[0],this.__value,this.checked),t(4,a)}function pe(z){Le[z?"unshift":"push"](()=>{L=z,t(10,L)})}const Me=z=>V(z,"gas_final");function ge(){a=et(F[0],this.__value,this.checked),t(4,a)}function Pe(z){Le[z?"unshift":"push"](()=>{g=z,t(7,g)})}const me=z=>V(z,"km_inicial");function he(z){Le[z?"unshift":"push"](()=>{v=z,t(8,v)})}function fe(){a=et(F[0],this.__value,this.checked),t(4,a)}const Ie=z=>V(z,"gas_inicial");function Re(){a=et(F[0],this.__value,this.checked),t(4,a)}function ye(z,x){Le[z?"unshift":"push"](()=>{d[x.id_checklist_event]=z,t(6,d)})}const we=z=>S(z.id_checklist_event);function He(z){Le[z?"unshift":"push"](()=>{p=z,t(5,p)})}return[b,k,I,c,a,p,d,g,v,w,L,P,n,_,y,O,A,S,V,Y,F,ee,re,ae,pe,Me,ge,Pe,me,he,fe,Ie,Re,ye,we,He,(z,x)=>A(x,z.id_checklist_event)]}class Jt extends Xe{constructor(e){super(),Je(this,e,Sn,Ln,We,{},null,[-1,-1])}}function Pn(i){let e,t,o,n,r,h="Teléfono de Negocio",_,b,k=i[6].client_phone+"",I;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),this.h()},l(c){e=f(c,"ION-ITEM",{href:!0});var a=E(e);t=f(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(a),n=f(a,"ION-LABEL",{class:!0});var p=E(n);r=f(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1u5l7fz"&&(r.textContent=h),_=C(p),b=f(p,"H2",{});var d=E(b);I=ue(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",sn),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href","tel:"+i[6].client_phone)},m(c,a){q(c,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Oe,d(c){c&&s(e)}}}function An(i){let e,t,o,n,r,h="Domicilio Alternativo",_,b,k=i[6].line2+"",I,c,a;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),c=T(),a=u("ion-icon"),this.h()},l(p){e=f(p,"ION-ITEM",{href:!0});var d=E(e);t=f(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(d),n=f(d,"ION-LABEL",{class:!0});var g=E(n);r=f(g,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=C(g),b=f(g,"H2",{});var v=E(b);I=ue(v,k),v.forEach(s),g.forEach(s),c=C(d),a=f(d,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[6].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,c),l(e,a)},p:Oe,d(p){p&&s(e)}}}function Mn(i){let e,t,o,n,r,h="Domicilio",_,b,k=i[6].line1+"",I,c,a,p,d=i[6].line2&&i[6].line2.trim().length,g,v=d&&Dn(i);return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),c=T(),a=u("ion-icon"),p=T(),v&&v.c(),g=Ae(),this.h()},l(w){e=f(w,"ION-ITEM",{href:!0});var L=E(e);t=f(L,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(L),n=f(L,"ION-LABEL",{class:!0});var R=E(n);r=f(R,"P",{"data-svelte-h":!0}),W(r)!=="svelte-cbm7q1"&&(r.textContent=h),_=C(R),b=f(R,"H2",{});var P=E(b);I=ue(P,k),P.forEach(s),R.forEach(s),c=C(L),a=f(L,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),L.forEach(s),p=C(w),v&&v.l(w),g=Ae(),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line1)},m(w,L){q(w,e,L),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,c),l(e,a),q(w,p,L),v&&v.m(w,L),q(w,g,L)},p(w,L){d&&v.p(w,L)},d(w){w&&(s(e),s(p),s(g)),v&&v.d(w)}}}function Dn(i){let e,t,o,n,r,h="Domicilio Alternativo",_,b,k=i[6].line2+"",I,c,a;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),c=T(),a=u("ion-icon"),this.h()},l(p){e=f(p,"ION-ITEM",{href:!0});var d=E(e);t=f(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(d),n=f(d,"ION-LABEL",{class:!0});var g=E(n);r=f(g,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=C(g),b=f(g,"H2",{});var v=E(b);I=ue(v,k),v.forEach(s),g.forEach(s),c=C(d),a=f(d,"ION-ICON",{icon:!0,slot:!0}),E(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,c),l(e,a)},p:Oe,d(p){p&&s(e)}}}function Nt(i){let e,t,o,n,r,h="Contacto del Cliente",_,b,k,I,c=i[2]&&i[2]==="1"&&Tt(i);return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),k=ce(i[4]),I=T(),c&&c.c(),this.h()},l(a){e=f(a,"ION-ITEM",{});var p=E(e);t=f(p,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(p),n=f(p,"ION-LABEL",{class:!0});var d=E(n);r=f(d,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1utsyb6"&&(r.textContent=h),_=C(d),b=f(d,"H2",{});var g=E(b);k=ue(g,i[4]),g.forEach(s),d.forEach(s),I=C(p),c&&c.l(p),p.forEach(s),this.h()},h(){m(t,"icon",cn),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(a,p){q(a,e,p),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k),l(e,I),c&&c.m(e,null)},p(a,p){p&16&&Te(k,a[4]),a[2]&&a[2]==="1"?c?c.p(a,p):(c=Tt(a),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(a){a&&s(e),c&&c.d()}}}function Tt(i){let e,t=`<ion-icon icon="${fn}" slot="start"></ion-icon>
                        Notificar Cliente`,o,n;return{c(){e=u("ion-button"),e.innerHTML=t,this.h()},l(r){e=f(r,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),W(e)!=="svelte-w3qtwm"&&(e.innerHTML=t),this.h()},h(){m(e,"fill","outline"),j(e,"margin-left","16px")},m(r,h){q(r,e,h),o||(n=te(e,"click",i[10]),o=!0)},p:Oe,d(r){r&&s(e),o=!1,n()}}}function Ct(i){let e,t,o,n,r,h="Notas de ubicación",_,b,k;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),k=ce(i[5]),this.h()},l(I){e=f(I,"ION-ITEM",{});var c=E(e);t=f(c,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(c),n=f(c,"ION-LABEL",{class:!0});var a=E(n);r=f(a,"P",{"data-svelte-h":!0}),W(r)!=="svelte-nhm2ft"&&(r.textContent=h),_=C(a),b=f(a,"H2",{});var p=E(b);k=ue(p,i[5]),p.forEach(s),a.forEach(s),c.forEach(s),this.h()},h(){m(t,"icon",xt),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(I,c){q(I,e,c),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p(I,c){c&32&&Te(k,I[5])},d(I){I&&s(e)}}}function Bn(i){let e,t,o,n,r,h="Horarios",_,b,k=i[6].schedule+"",I;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),this.h()},l(c){e=f(c,"ION-ITEM",{});var a=E(e);t=f(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(a),n=f(a,"ION-LABEL",{});var p=E(n);r=f(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-11q7hm5"&&(r.textContent=h),_=C(p),b=f(p,"H2",{});var d=E(b);I=ue(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",un),m(t,"slot","start")},m(c,a){q(c,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Oe,d(c){c&&s(e)}}}function Hn(i){let e,t,o,n,r,h="Notas del operador",_,b,k=i[6].driver_comments+"",I;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),this.h()},l(c){e=f(c,"ION-ITEM",{});var a=E(e);t=f(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(a),n=f(a,"ION-LABEL",{});var p=E(n);r=f(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1yk9qp4"&&(r.textContent=h),_=C(p),b=f(p,"H2",{});var d=E(b);I=ue(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",Wt),m(t,"slot","start")},m(c,a){q(c,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Oe,d(c){c&&s(e)}}}function Un(i){let e,t=i[6].logistic_comments!="<br>"&&Rn(i);return{c(){t&&t.c(),e=Ae()},l(o){t&&t.l(o),e=Ae()},m(o,n){t&&t.m(o,n),q(o,e,n)},p(o,n){o[6].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&s(e),t&&t.d(o)}}}function Rn(i){let e,t,o,n,r,h="Comentarios logísticos",_,b,k=i[6].logistic_comments+"",I;return{c(){e=u("ion-item"),t=u("ion-icon"),o=T(),n=u("ion-label"),r=u("p"),r.textContent=h,_=T(),b=u("h2"),I=ce(k),this.h()},l(c){e=f(c,"ION-ITEM",{});var a=E(e);t=f(a,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(s),o=C(a),n=f(a,"ION-LABEL",{class:!0});var p=E(n);r=f(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1iz85r6"&&(r.textContent=h),_=C(p),b=f(p,"H2",{});var d=E(b);I=ue(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",xt),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(c,a){q(c,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Oe,d(c){c&&s(e)}}}function yt(i){let e;return{c(){e=u("ion-spinner"),this.h()},l(t){e=f(t,"ION-SPINNER",{name:!0}),E(e).forEach(s),this.h()},h(){m(e,"name","dots")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function wt(i){let e,t,o;return{c(){e=u("section"),t=u("ion-img"),this.h()},l(n){e=f(n,"SECTION",{});var r=E(e);t=f(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(s),r.forEach(s),this.h()},h(){ut(t.src,o=i[1])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&2&&!ut(t.src,o=n[1])&&m(t,"src",o)},d(n){n&&s(e)}}}function zn(i){let e,t,o,n,r="Cancelar",h,_,b=i[6].title+"",k,I,c,a,p="Confirmar",d,g,v,w,L,R,P,M,N="Negocio",D,y,O=i[6].client_name+"",A,U,S=i[6].client_phone&&i[6].client_phone.trim().length,B,V,K,X,H=i[6].schedule&&i[6].schedule.trim().length,F,Y,ee=i[6].logistic_comments&&i[6].logistic_comments.trim().length,re,ae,pe,Me,ge,Pe,me,he,fe,Ie,Re,ye,we="Subir Evidencia",He,Ce,z,x,le,ke,ne=S&&Pn(i);function Ee(Q,_e){if(Q[6].line1&&Q[6].line1.trim().length)return Mn;if(Q[6].line2&&Q[6].line2.trim().length)return An}let oe=Ee(i),Z=oe&&oe(i),$=i[4]&&Nt(i),J=i[5]&&i[5]!=="<br>"&&Ct(i),ie=H&&Bn(i),Ne=i[6].driver_comments&&Hn(i),de=ee&&Un(i),be=i[3]&&yt(),ve=i[1]&&wt(i);return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.textContent=r,h=T(),_=u("ion-title"),k=ce(b),I=T(),c=u("ion-buttons"),a=u("ion-button"),a.textContent=p,d=T(),g=u("ion-content"),v=u("ion-list"),w=u("ion-item"),L=u("ion-icon"),R=T(),P=u("ion-label"),M=u("p"),M.textContent=N,D=T(),y=u("h2"),A=ce(O),U=T(),ne&&ne.c(),B=T(),Z&&Z.c(),V=T(),$&&$.c(),K=T(),J&&J.c(),X=T(),ie&&ie.c(),F=T(),Ne&&Ne.c(),Y=T(),de&&de.c(),re=T(),ae=u("ion-item"),pe=u("ion-icon"),Me=T(),ge=u("ion-textarea"),Pe=T(),me=u("section"),he=u("label"),fe=u("ion-button"),Ie=u("ion-icon"),Re=T(),ye=u("label"),ye.textContent=we,He=T(),Ce=u("input"),z=T(),be&&be.c(),x=T(),ve&&ve.c(),this.h()},l(Q){e=f(Q,"ION-HEADER",{translucent:!0});var _e=E(e);t=f(_e,"ION-TOOLBAR",{});var De=E(t);o=f(De,"ION-BUTTONS",{slot:!0});var Ze=E(o);n=f(Ze,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Ze.forEach(s),h=C(De),_=f(De,"ION-TITLE",{title:!0});var Qe=E(_);k=ue(Qe,b),Qe.forEach(s),I=C(De),c=f(De,"ION-BUTTONS",{slot:!0});var qe=E(c);a=f(qe,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),W(a)!=="svelte-1ida0il"&&(a.textContent=p),qe.forEach(s),De.forEach(s),_e.forEach(s),d=C(Q),g=f(Q,"ION-CONTENT",{fullscreen:!0});var $e=E(g);v=f($e,"ION-LIST",{});var se=E(v);w=f(se,"ION-ITEM",{});var it=E(w);L=f(it,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(s),R=C(it),P=f(it,"ION-LABEL",{});var rt=E(P);M=f(rt,"P",{"data-svelte-h":!0}),W(M)!=="svelte-57b1dg"&&(M.textContent=N),D=C(rt),y=f(rt,"H2",{});var gt=E(y);A=ue(gt,O),gt.forEach(s),rt.forEach(s),it.forEach(s),U=C(se),ne&&ne.l(se),B=C(se),Z&&Z.l(se),V=C(se),$&&$.l(se),K=C(se),J&&J.l(se),X=C(se),ie&&ie.l(se),F=C(se),Ne&&Ne.l(se),Y=C(se),de&&de.l(se),re=C(se),ae=f(se,"ION-ITEM",{});var at=E(ae);pe=f(at,"ION-ICON",{icon:!0,slot:!0}),E(pe).forEach(s),Me=C(at),ge=f(at,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(s),at.forEach(s),Pe=C(se),me=f(se,"SECTION",{});var Et=E(me);he=f(Et,"LABEL",{for:!0,style:!0});var It=E(he);fe=f(It,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ve=E(fe);Ie=f(Ve,"ION-ICON",{icon:!0,slot:!0}),E(Ie).forEach(s),Re=C(Ve),ye=f(Ve,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),W(ye)!=="svelte-1as0od8"&&(ye.textContent=we),He=C(Ve),Ce=f(Ve,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ve.forEach(s),It.forEach(s),Et.forEach(s),z=C(se),be&&be.l(se),x=C(se),ve&&ve.l(se),se.forEach(s),$e.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",i[6].title),m(a,"strong",""),m(c,"slot","end"),m(e,"translucent",""),m(L,"icon",an),m(L,"slot","start"),m(pe,"icon",dt),m(pe,"slot","start"),m(ge,"label","Notas"),m(ge,"placeholder","Escribe aquí..."),m(Ie,"icon",Kt),m(Ie,"slot","start"),G(ye,"for","eventEvidence"),j(ye,"padding","8px 10px"),j(Ce,"display","none"),G(Ce,"id","eventEvidence"),G(Ce,"name","fileToUpload"),G(Ce,"type","file"),G(Ce,"accept","image/*"),m(fe,"fill","outline"),m(fe,"class","loadEvidence"),m(fe,"expand","block"),G(he,"for","eventEvidence"),j(he,"display","block"),j(he,"width","100%"),m(g,"fullscreen","")},m(Q,_e){q(Q,e,_e),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,k),l(t,I),l(t,c),l(c,a),q(Q,d,_e),q(Q,g,_e),l(g,v),l(v,w),l(w,L),l(w,R),l(w,P),l(P,M),l(P,D),l(P,y),l(y,A),l(v,U),ne&&ne.m(v,null),l(v,B),Z&&Z.m(v,null),l(v,V),$&&$.m(v,null),l(v,K),J&&J.m(v,null),l(v,X),ie&&ie.m(v,null),l(v,F),Ne&&Ne.m(v,null),l(v,Y),de&&de.m(v,null),l(v,re),l(v,ae),l(ae,pe),l(ae,Me),l(ae,ge),i[11](ge),l(v,Pe),l(v,me),l(me,he),l(he,fe),l(fe,Ie),l(fe,Re),l(fe,ye),l(fe,He),l(fe,Ce),l(v,z),be&&be.m(v,null),l(v,x),ve&&ve.m(v,null),le||(ke=[te(n,"click",i[8]),te(a,"click",i[9]),te(Ce,"change",i[7])],le=!0)},p(Q,[_e]){S&&ne.p(Q,_e),Z&&Z.p(Q,_e),Q[4]?$?$.p(Q,_e):($=Nt(Q),$.c(),$.m(v,K)):$&&($.d(1),$=null),Q[5]&&Q[5]!=="<br>"?J?J.p(Q,_e):(J=Ct(Q),J.c(),J.m(v,X)):J&&(J.d(1),J=null),H&&ie.p(Q,_e),Q[6].driver_comments&&Ne.p(Q,_e),ee&&de.p(Q,_e),Q[3]?be||(be=yt(),be.c(),be.m(v,x)):be&&(be.d(1),be=null),Q[1]?ve?ve.p(Q,_e):(ve=wt(Q),ve.c(),ve.m(v,null)):ve&&(ve.d(1),ve=null)},i:Oe,o:Oe,d(Q){Q&&(s(e),s(d),s(g)),ne&&ne.d(),Z&&Z.d(),$&&$.d(),J&&J.d(),ie&&ie.d(),Ne&&Ne.d(),de&&de.d(),i[11](null),be&&be.d(),ve&&ve.d(),le=!1,Ue(ke)}}}const Lt=/Teléfono:\s*(\d{10,})/;function St(i,e){for(let t=0;t<e.length;t++)if(e[t].alias===i)return e[t].val;return""}function qn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,h=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",b="",k={latitude:null,longitude:null},I=new Object,c="",a="",p=!1,d="",g=n.comments_ext;if(tt(()=>{O()}),n.comments_ext){const U=n.comments_ext.match(Lt);U&&(d=U[1],g=n.comments_ext.replace(Lt,"").trim())}const v=async()=>{await(await je.create({header:"SMS enviado",message:"Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+d,buttons:[{text:"Cerrar"}]})).present()},w=async()=>{await(await je.create({header:"SMS no enviado",message:"Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.",buttons:[{text:"Cerrar"}]})).present()},L=async U=>{t(3,p=!0);const B=U.target.files[0],V=await R(B);if(V){const K=new FormData;K.append("fileToUpload",V);try{const X=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:K});if(X.ok){const H=await X.json();t(1,_=H.img),b=H.img_id}else console.error("File upload failed:",X.statusText)}catch(X){console.error("Error during file upload:",X)}finally{t(3,p=!1)}}},R=async U=>new Promise(S=>{const B=new FileReader;B.onload=V=>{const K=new Image;K.src=V.target.result,K.onload=()=>{const X=document.createElement("canvas"),H=X.getContext("2d"),F=800,Y=600;let ee=K.width,re=K.height;ee>F&&(re*=F/ee,ee=F),re>Y&&(ee*=Y/re,re=Y),X.width=ee,X.height=re,H.drawImage(K,0,0,ee,re),X.toBlob(ae=>{S(ae)},"image/jpeg",.7)}},B.readAsDataURL(U)}),P=()=>{o.dismiss({data:Date.now()})},M=async()=>{try{if(await D()){const S={id_route:n.id_route,id_event:n.id_event,comments:h.value,img:_,img_id:b,lat:k.latitude,lon:k.longitude,...c==="0"&&{approve:"0"},...r&&{isLast:!0}},B=new FormData;for(const F in S)B.append(F,S[F]);const K=await(await fetch("https://dev.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:B})).json();P();const X={},H=S.id_route;r&&N("","",H,r)}else console.log("No entré")}catch(U){console.error("Error fetching data:",U)}},N=(U,S,B,V)=>{o.componentProps.routeId=B,o.componentProps.driverId=n.id_driver,ze("modal-km-gas",Jt,{checklist:U,driverId:S,routeId:B,isLast:V}).then(K=>{})},D=async()=>navigator.geolocation?new Promise((U,S)=>{navigator.geolocation.getCurrentPosition(B=>{k.latitude=B.coords.latitude,k.longitude=B.coords.longitude,U(!0)},B=>{console.error("Error getting location:",B),U(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function y(U){U.stopPropagation();const S=new FormData;S.append("client_phone",d),S.append("client_name",n.title),S.append("delivery_phone",n.client_phone),S.append("enterprise_name",n.enterprise_name);try{const B=await fetch("https://dev.rutaflow.com/api/admin/message_central/send_sms.php",{method:"POST",body:S});if(B.ok){const V=await B.json();v()}else w()}catch(B){console.error("Error during file upload:",B)}}const O=async U=>{if(n.id_enterprise){const S=new FormData;S.append("id_enterprise",n.id_enterprise);try{const B=await fetch("https://dev.rutaflow.com/api/admin/enterprise/enterprise_settings.php",{method:"POST",body:S});B.ok?(I=(await B.json()).nodos,c=St("stops_wait_approval",I),t(2,a=St("sms_active",I))):console.error("File upload failed:",B.statusText)}catch(B){console.error("Error during file upload:",B)}}};function A(U){Le[U?"unshift":"push"](()=>{h=U,t(0,h)})}return[h,_,a,p,d,g,n,L,P,M,y,A]}class Fn extends Xe{constructor(e){super(),Je(this,e,qn,zn,We,{})}}function Pt(i){let e,t,o;return{c(){e=u("section"),t=u("ion-img"),this.h()},l(n){e=f(n,"SECTION",{});var r=E(e);t=f(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(s),r.forEach(s),this.h()},h(){ut(t.src,o=i[0])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&1&&!ut(t.src,o=n[0])&&m(t,"src",o)},d(n){n&&s(e)}}}function jn(i){let e,t,o,n,r="Cancelar",h,_,b="Agregar Gasto",k,I,c,a,p,d,g,v,w,L,R,P,M,N,D,y,O,A,U='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',S,B,V="Efectivo",K,X,H="Tarjeta",F,Y,ee="Transferencia",re,ae,pe,Me,ge,Pe,me,he,fe,Ie,Re=`<ion-icon icon="${Kt}" slot="start"></ion-icon>
                        Subir Evidencia`,ye,we,He,Ce,z,x,le,ke="Confirmar",ne,Ee,oe=i[0]&&Pt(i);return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.textContent=r,h=T(),_=u("ion-title"),_.textContent=b,k=T(),I=u("ion-content"),c=u("ion-list"),a=u("ion-item"),p=u("ion-icon"),d=T(),g=u("ion-input"),v=T(),w=u("ion-item"),L=u("ion-icon"),R=T(),P=u("ion-input"),M=T(),N=u("ion-item"),D=u("ion-icon"),y=T(),O=u("ion-select"),A=u("div"),A.innerHTML=U,S=T(),B=u("ion-select-option"),B.textContent=V,K=T(),X=u("ion-select-option"),X.textContent=H,F=T(),Y=u("ion-select-option"),Y.textContent=ee,re=T(),ae=u("ion-item"),pe=u("ion-icon"),Me=T(),ge=u("ion-textarea"),Pe=T(),me=u("section"),he=u("label"),fe=u("ion-button"),Ie=u("label"),Ie.innerHTML=Re,ye=T(),we=u("input"),He=T(),oe&&oe.c(),Ce=T(),z=u("ion-footer"),x=u("ion-toolbar"),le=u("ion-button"),le.textContent=ke,this.h()},l(Z){e=f(Z,"ION-HEADER",{translucent:!0});var $=E(e);t=f($,"ION-TOOLBAR",{});var J=E(t);o=f(J,"ION-BUTTONS",{slot:!0});var ie=E(o);n=f(ie,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1f8rjcf"&&(n.textContent=r),ie.forEach(s),h=C(J),_=f(J,"ION-TITLE",{title:!0,"data-svelte-h":!0}),W(_)!=="svelte-10xvxus"&&(_.textContent=b),J.forEach(s),$.forEach(s),k=C(Z),I=f(Z,"ION-CONTENT",{fullscreen:!0});var Ne=E(I);c=f(Ne,"ION-LIST",{});var de=E(c);a=f(de,"ION-ITEM",{});var be=E(a);p=f(be,"ION-ICON",{icon:!0,slot:!0}),E(p).forEach(s),d=C(be),g=f(be,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(g).forEach(s),be.forEach(s),v=C(de),w=f(de,"ION-ITEM",{});var ve=E(w);L=f(ve,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(s),R=C(ve),P=f(ve,"ION-INPUT",{label:!0,type:!0,value:!0}),E(P).forEach(s),ve.forEach(s),M=C(de),N=f(de,"ION-ITEM",{});var Q=E(N);D=f(Q,"ION-ICON",{icon:!0,slot:!0}),E(D).forEach(s),y=C(Q),O=f(Q,"ION-SELECT",{placeholder:!0,value:!0});var _e=E(O);A=f(_e,"DIV",{slot:!0,"data-svelte-h":!0}),W(A)!=="svelte-wl764p"&&(A.innerHTML=U),S=C(_e),B=f(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(B)!=="svelte-i9crym"&&(B.textContent=V),K=C(_e),X=f(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(X)!=="svelte-fx0z11"&&(X.textContent=H),F=C(_e),Y=f(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(Y)!=="svelte-1c24jf2"&&(Y.textContent=ee),_e.forEach(s),Q.forEach(s),re=C(de),ae=f(de,"ION-ITEM",{});var De=E(ae);pe=f(De,"ION-ICON",{icon:!0,slot:!0}),E(pe).forEach(s),Me=C(De),ge=f(De,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(s),De.forEach(s),Pe=C(de),me=f(de,"SECTION",{});var Ze=E(me);he=f(Ze,"LABEL",{for:!0,style:!0});var Qe=E(he);fe=f(Qe,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var qe=E(fe);Ie=f(qe,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),W(Ie)!=="svelte-1m9yw22"&&(Ie.innerHTML=Re),ye=C(qe),we=f(qe,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),qe.forEach(s),Qe.forEach(s),Ze.forEach(s),He=C(de),oe&&oe.l(de),de.forEach(s),Ne.forEach(s),Ce=C(Z),z=f(Z,"ION-FOOTER",{});var $e=E(z);x=f($e,"ION-TOOLBAR",{});var se=E(x);le=f(se,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(le)!=="svelte-1c7dl3f"&&(le.textContent=ke),se.forEach(s),$e.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",""),m(e,"translucent",""),m(p,"icon",Wt),m(p,"slot","start"),m(g,"label","Concepto"),m(g,"type","text"),m(g,"placeholder","Escribe aquí..."),m(g,"value",i[5]?i[5]:""),m(L,"icon",dt),m(L,"slot","start"),m(P,"label","Cantidad"),m(P,"type","number"),m(P,"value",i[6]?i[6]:""),m(D,"icon",_n),m(D,"slot","start"),G(A,"slot","label"),m(B,"value","cash"),m(X,"value","card"),m(Y,"value","transfer"),m(O,"placeholder","Tipo de pago"),m(O,"value",i[7]?i[7]:""),m(pe,"icon",dt),m(pe,"slot","start"),m(ge,"label","Comentarios"),m(ge,"placeholder","Escribe aquí..."),G(Ie,"for","eventEvidence"),j(Ie,"width","100%"),j(Ie,"padding","8px"),j(we,"display","none"),G(we,"id","eventEvidence"),G(we,"name","fileToUpload"),G(we,"type","file"),G(we,"accept","image/*"),m(fe,"fill","outline"),m(fe,"size","small"),m(fe,"class","loadEvidence"),m(fe,"expand","block"),G(he,"for","eventEvidence"),j(he,"display","block"),j(he,"width","100%"),m(I,"fullscreen",""),m(le,"fill","outline"),m(le,"color","tertiary"),m(le,"strong",""),j(le,"width","99%"),j(le,"height","auto")},m(Z,$){q(Z,e,$),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(Z,k,$),q(Z,I,$),l(I,c),l(c,a),l(a,p),l(a,d),l(a,g),i[11](g),l(c,v),l(c,w),l(w,L),l(w,R),l(w,P),i[12](P),l(c,M),l(c,N),l(N,D),l(N,y),l(N,O),l(O,A),l(O,S),l(O,B),l(O,K),l(O,X),l(O,F),l(O,Y),i[13](O),l(c,re),l(c,ae),l(ae,pe),l(ae,Me),l(ae,ge),i[14](ge),l(c,Pe),l(c,me),l(me,he),l(he,fe),l(fe,Ie),l(fe,ye),l(fe,we),l(c,He),oe&&oe.m(c,null),q(Z,Ce,$),q(Z,z,$),l(z,x),l(x,le),ne||(Ee=[te(n,"click",i[9]),te(we,"change",i[8]),te(le,"click",i[10])],ne=!0)},p(Z,[$]){Z[0]?oe?oe.p(Z,$):(oe=Pt(Z),oe.c(),oe.m(c,null)):oe&&(oe.d(1),oe=null)},i:Oe,o:Oe,d(Z){Z&&(s(e),s(k),s(I),s(Ce),s(z)),i[11](null),i[12](null),i[13](null),i[14](null),oe&&oe.d(),ne=!1,Ue(Ee)}}}function Vn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,h=o.componentProps.ex_amount,_=o.componentProps.ex_type,b=o.componentProps.id_expense,k="",I="",c="",a=0,p="",d="";tt(()=>{});const g=async(y,O)=>{await(await je.create({header:y||"Error",message:O||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},v=async y=>{const A=y.target.files[0],U=await w(A);if(U){const S=new FormData;S.append("fileToUpload",U);try{const B=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:S});if(B.ok){const V=await B.json();t(0,k=V.img),I=V.img_id}else console.error("File upload failed:",B.statusText)}catch(B){console.error("Error during file upload:",B)}}},w=async y=>new Promise(O=>{const A=new FileReader;A.onload=U=>{const S=new Image;S.src=U.target.result,S.onload=()=>{const B=document.createElement("canvas"),V=B.getContext("2d"),K=800,X=600;let H=S.width,F=S.height;H>K&&(F*=K/H,H=K),F>X&&(H*=X/F,F=X),B.width=H,B.height=F,V.drawImage(S,0,0,H,F),B.toBlob(Y=>{O(Y)},"image/jpeg",.7)}},A.readAsDataURL(y)}),L=()=>{lt.dismiss()},R=()=>{var y=new Object;y.id_route=n,y.comments=p.value,y.type=c.value,y.img=k,y.img_id=I,y.amount=a.value,y.concept=d.value,y.status="done",y.id_expense=b||"null";const O=new FormData;for(const A in y)O.append(A,y[A]);!I||!k||!p.value||!a.value||!d.value?g("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://dev.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:O}).then(A=>A.json()).then(A=>{L()}).catch(A=>{console.error("Error fetching data:",A)})};function P(y){Le[y?"unshift":"push"](()=>{d=y,t(4,d)})}function M(y){Le[y?"unshift":"push"](()=>{a=y,t(2,a)})}function N(y){Le[y?"unshift":"push"](()=>{c=y,t(1,c)})}function D(y){Le[y?"unshift":"push"](()=>{p=y,t(3,p)})}return[k,c,a,p,d,r,h,_,v,L,R,P,M,N,D]}class pt extends Xe{constructor(e){super(),Je(this,e,Vn,jn,We,{})}}function At(i,e,t){const o=i.slice();return o[7]=e[t],o}function Gn(i){let e,t="Cargar gasto",o,n;function r(...h){return i[4](i[7],...h)}return{c(){e=u("ion-button"),e.textContent=t,this.h()},l(h){e=f(h,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),W(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){m(e,"fill","outline"),m(e,"size","small"),m(e,"aria-selected","")},m(h,_){q(h,e,_),o||(n=te(e,"click",r),o=!0)},p(h,_){i=h},d(h){h&&s(e),o=!1,n()}}}function Kn(i){let e,t="Gasto completado";return{c(){e=u("ion-button"),e.textContent=t,this.h()},l(o){e=f(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),W(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){m(e,"fill","solid"),m(e,"size","small"),m(e,"aria-selected","")},m(o,n){q(o,e,n)},p:Oe,d(o){o&&s(e)}}}function Mt(i,e){let t,o,n,r=e[7].concept+"",h,_,b;function k(a,p){return a[7].status=="done"?Kn:Gn}let c=k(e)(e);return{key:i,first:null,c(){t=u("ion-item"),o=u("ion-label"),n=u("p"),h=ce(r),_=T(),c.c(),b=T(),this.h()},l(a){t=f(a,"ION-ITEM",{});var p=E(t);o=f(p,"ION-LABEL",{style:!0});var d=E(o);n=f(d,"P",{style:!0});var g=E(n);h=ue(g,r),g.forEach(s),d.forEach(s),_=C(p),c.l(p),b=C(p),p.forEach(s),this.h()},h(){j(n,"margin-left","10px"),j(o,"display","flex"),this.first=t},m(a,p){q(a,t,p),l(t,o),l(o,n),l(n,h),l(t,_),c.m(t,null),l(t,b)},p(a,p){e=a,c.p(e,p)},d(a){a&&s(t),c.d()}}}function xn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${dn}"></ion-icon>`,h,_,b="Lista de gastos",k,I,c,a=[],p=new Map,d,g,v,w="Cerrar",L,R,P=Be(i[0]);const M=N=>N[7].id_expenses;for(let N=0;N<P.length;N+=1){let D=At(i,P,N),y=M(D);p.set(y,a[N]=Mt(y,D))}return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.innerHTML=r,h=T(),_=u("ion-title"),_.textContent=b,k=T(),I=u("ion-content"),c=u("ion-list");for(let N=0;N<a.length;N+=1)a[N].c();d=T(),g=u("ion-footer"),v=u("ion-button"),v.textContent=w,this.h()},l(N){e=f(N,"ION-HEADER",{translucent:!0});var D=E(e);t=f(D,"ION-TOOLBAR",{});var y=E(t);o=f(y,"ION-BUTTONS",{slot:!0});var O=E(o);n=f(O,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-160xz3i"&&(n.innerHTML=r),O.forEach(s),h=C(y),_=f(y,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-e3wnox"&&(_.textContent=b),y.forEach(s),D.forEach(s),k=C(N),I=f(N,"ION-CONTENT",{fullscreen:!0});var A=E(I);c=f(A,"ION-LIST",{});var U=E(c);for(let B=0;B<a.length;B+=1)a[B].l(U);U.forEach(s),A.forEach(s),d=C(N),g=f(N,"ION-FOOTER",{});var S=E(g);v=f(S,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(v)!=="svelte-zv7v83"&&(v.textContent=w),S.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","end"),m(e,"translucent",""),m(I,"fullscreen",""),m(v,"fill","outline"),m(v,"color","tertiary"),m(v,"strong",""),j(v,"width","99%"),j(v,"height","auto")},m(N,D){q(N,e,D),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(N,k,D),q(N,I,D),l(I,c);for(let y=0;y<a.length;y+=1)a[y]&&a[y].m(c,null);q(N,d,D),q(N,g,D),l(g,v),L||(R=[te(n,"click",i[3]),te(v,"click",i[1])],L=!0)},p(N,[D]){D&5&&(P=Be(N[0]),a=nt(a,D,M,1,N,P,p,c,ot,Mt,null,At))},i:Oe,o:Oe,d(N){N&&(s(e),s(k),s(I),s(d),s(g));for(let D=0;D<a.length;D+=1)a[D].d();L=!1,Ue(R)}}}function Wn(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;tt(()=>{});const o=()=>{lt.dismiss()};function n(_,b,k,I,c){e.componentProps.ex_amount=k,e.componentProps.ex_concept=b,e.componentProps.ex_type=I,e.componentProps.id_expense=c,ze("modal-expense",pt,{amount:k,concept:b,type:I,id_expense:c}).then(()=>{}),o()}return[t,o,n,_=>{ze("modal-expense",pt,{routeId:_}).then(b=>{}),o()},(_,b)=>n(b,_.concept,_.amount,_.type,_.id_expenses)]}class Xn extends Xe{constructor(e){super(),Je(this,e,Wn,xn,We,{})}}function Dt(i,e,t){const o=i.slice();return o[30]=e[t],o}function Bt(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Ht(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Ut(i){let e,t;return e=new vn({props:{$$slots:{default:[$n]},$$scope:{ctx:i}}}),{c(){tn(e.$$.fragment)},l(o){nn(e.$$.fragment,o)},m(o,n){on(e,o,n),t=!0},p(o,n){const r={};n[0]&507|n[1]&32&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(ct(e.$$.fragment,o),t=!0)},o(o){_t(e.$$.fragment,o),t=!1},d(o){ln(e,o)}}}function Jn(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,h,_=[],b=new Map,k,I,c=i[4]&&Rt(i),a=Be(i[5]);const p=d=>d[30].id_event;for(let d=0;d<a.length;d+=1){let g=Dt(i,a,d),v=p(g);b.set(v,_[d]=qt(v,g))}return{c(){c&&c.c(),e=T(),t=u("ion-content"),o=u("ion-refresher"),o.innerHTML=n,r=T(),h=u("ion-list");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){c&&c.l(d),e=C(d),t=f(d,"ION-CONTENT",{});var g=E(t);o=f(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(o)!=="svelte-19e7x43"&&(o.innerHTML=n),r=C(g),h=f(g,"ION-LIST",{});var v=E(h);for(let w=0;w<_.length;w+=1)_[w].l(v);v.forEach(s),g.forEach(s),this.h()},h(){m(o,"slot","fixed")},m(d,g){c&&c.m(d,g),q(d,e,g),q(d,t,g),l(t,o),i[23](o),l(t,r),l(t,h);for(let v=0;v<_.length;v+=1)_[v]&&_[v].m(h,null);k||(I=te(o,"ionRefresh",i[9]),k=!0)},p(d,g){d[4]?c?c.p(d,g):(c=Rt(d),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),g[0]&42016&&(a=Be(d[5]),_=nt(_,g,p,1,d,a,b,h,ot,qt,null,Dt))},d(d){d&&(s(e),s(t)),c&&c.d(d),i[23](null);for(let g=0;g<_.length;g+=1)_[g].d();k=!1,I()}}}function Yn(i){let e,t;function o(h,_){return _[0]&128&&(e=null),e==null&&(e=!!h[7].every(no)),e?Qn:Zn}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Ae()},l(h){r.l(h),t=Ae()},m(h,_){r.m(h,_),q(h,t,_)},p(h,_){n===(n=o(h,_))&&r?r.p(h,_):(r.d(1),r=n(h),r&&(r.c(),r.m(t.parentNode,t)))},d(h){h&&s(t),r.d(h)}}}function Rt(i){let e=i[11]("",i[1],i[0])+"",t;return{c(){t=ce(e)},l(o){t=ue(o,e)},m(o,n){q(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[11]("",o[1],o[0])+"")&&Te(t,e)},d(o){o&&s(t)}}}function zt(i){let e;return{c(){e=u("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function qt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,c,a,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,L,R,P,M,N=v&&zt();function D(){return e[24](e[30])}return{key:i,first:null,c(){t=u("ion-item"),o=u("ion-avatar"),n=u("div"),r=u("div"),_=ce(h),k=T(),I=u("ion-label"),c=u("ion-text"),a=u("h3"),d=ce(p),g=T(),N&&N.c(),w=T(),L=u("ion-icon"),R=T(),this.h()},l(y){t=f(y,"ION-ITEM",{});var O=E(t);o=f(O,"ION-AVATAR",{slot:!0});var A=E(o);n=f(A,"DIV",{class:!0,title:!0,style:!0});var U=E(n);r=f(U,"DIV",{class:!0});var S=E(r);_=ue(S,h),S.forEach(s),U.forEach(s),A.forEach(s),k=C(O),I=f(O,"ION-LABEL",{button:!0});var B=E(I);c=f(B,"ION-TEXT",{color:!0});var V=E(c);a=f(V,"H3",{});var K=E(a);d=ue(K,p),g=C(K),N&&N.l(K),K.forEach(s),V.forEach(s),B.forEach(s),w=C(O),L=f(O,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(L).forEach(s),R=C(O),O.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",Se(e[30])),j(n,"color",xe(Se(e[30]))),m(o,"slot","start"),m(c,"color","#2e2e2e"),m(I,"button",""),m(L,"icon",Ye),m(L,"slot","end"),j(L,"color",Se(e[30])),this.first=t},m(y,O){q(y,t,O),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,c),l(c,a),l(a,d),l(a,g),N&&N.m(a,null),l(t,w),l(t,L),l(t,R),P||(M=te(I,"click",D),P=!0)},p(y,O){e=y,O[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Te(_,h),O[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),O[0]&32&&j(n,"background-color",Se(e[30])),O[0]&32&&j(n,"color",xe(Se(e[30]))),O[0]&32&&p!==(p=e[30].title+"")&&Te(d,p),O[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?N||(N=zt(),N.c(),N.m(a,null)):N&&(N.d(1),N=null),O[0]&32&&j(L,"color",Se(e[30]))},d(y){y&&s(t),N&&N.d(),P=!1,M()}}}function Zn(i){let e=i[11](i[7],i[1],i[0])+"",t,o,n,r,h='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,b,k=[],I=new Map,c,a,p=Be(i[5]);const d=g=>g[30].id_event;for(let g=0;g<p.length;g+=1){let v=Bt(i,p,g),w=d(v);I.set(w,k[g]=jt(w,v))}return{c(){t=ce(e),o=T(),n=u("ion-content"),r=u("ion-refresher"),r.innerHTML=h,_=T(),b=u("ion-list");for(let g=0;g<k.length;g+=1)k[g].c();this.h()},l(g){t=ue(g,e),o=C(g),n=f(g,"ION-CONTENT",{});var v=E(n);r=f(v,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(r)!=="svelte-1poui8g"&&(r.innerHTML=h),_=C(v),b=f(v,"ION-LIST",{});var w=E(b);for(let L=0;L<k.length;L+=1)k[L].l(w);w.forEach(s),v.forEach(s),this.h()},h(){m(r,"slot","fixed")},m(g,v){q(g,t,v),q(g,o,v),q(g,n,v),l(n,r),i[21](r),l(n,_),l(n,b);for(let w=0;w<k.length;w+=1)k[w]&&k[w].m(b,null);c||(a=te(r,"ionRefresh",i[9]),c=!0)},p(g,v){v[0]&131&&e!==(e=g[11](g[7],g[1],g[0])+"")&&Te(t,e),v[0]&74784&&(p=Be(g[5]),k=nt(k,v,d,1,g,p,I,b,ot,jt,null,Bt))},d(g){g&&(s(t),s(o),s(n)),i[21](null);for(let v=0;v<k.length;v+=1)k[v].d();c=!1,a()}}}function Qn(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,h=[],_=new Map,b,k,I=Be(i[5]);const c=a=>a[30].id_event;for(let a=0;a<I.length;a+=1){let p=Ht(i,I,a),d=c(p);_.set(d,h[a]=Gt(d,p))}return{c(){e=u("ion-content"),t=u("ion-refresher"),t.innerHTML=o,n=T(),r=u("ion-list");for(let a=0;a<h.length;a+=1)h[a].c();this.h()},l(a){e=f(a,"ION-CONTENT",{});var p=E(e);t=f(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(t)!=="svelte-1t1tzpj"&&(t.innerHTML=o),n=C(p),r=f(p,"ION-LIST",{});var d=E(r);for(let g=0;g<h.length;g+=1)h[g].l(d);d.forEach(s),p.forEach(s),this.h()},h(){m(t,"slot","fixed")},m(a,p){q(a,e,p),l(e,t),i[19](t),l(e,n),l(e,r);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(r,null);b||(k=te(t,"ionRefresh",i[9]),b=!0)},p(a,p){p[0]&74784&&(I=Be(a[5]),h=nt(h,p,c,1,a,I,_,r,ot,Gt,null,Ht))},d(a){a&&s(e),i[19](null);for(let p=0;p<h.length;p+=1)h[p].d();b=!1,k()}}}function Ft(i){let e;return{c(){e=u("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function jt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,c,a,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,L,R="",P,M,N,D,y,O=v&&Ft();function A(){return e[22](e[30],e[32])}return{key:i,first:null,c(){t=u("ion-item"),o=u("ion-avatar"),n=u("div"),r=u("div"),_=ce(h),k=T(),I=u("ion-label"),c=u("ion-text"),a=u("h3"),d=ce(p),g=T(),O&&O.c(),w=T(),L=u("div"),L.innerHTML=R,P=T(),M=u("ion-icon"),N=T(),this.h()},l(U){t=f(U,"ION-ITEM",{});var S=E(t);o=f(S,"ION-AVATAR",{slot:!0});var B=E(o);n=f(B,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=f(V,"DIV",{class:!0});var K=E(r);_=ue(K,h),K.forEach(s),V.forEach(s),B.forEach(s),k=C(S),I=f(S,"ION-LABEL",{button:!0});var X=E(I);c=f(X,"ION-TEXT",{color:!0});var H=E(c);a=f(H,"H3",{});var F=E(a);d=ue(F,p),g=C(F),O&&O.l(F),F.forEach(s),H.forEach(s),w=C(X),L=f(X,"DIV",{class:!0,"data-svelte-h":!0}),W(L)!=="svelte-130ohbs"&&(L.innerHTML=R),X.forEach(s),P=C(S),M=f(S,"ION-ICON",{icon:!0,slot:!0}),E(M).forEach(s),N=C(S),S.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",Se(e[30])),j(n,"color",xe(Se(e[30]))),m(o,"slot","start"),m(c,"color","#2e2e2e"),G(L,"class","sub svelte-ziybgw"),m(I,"button",""),m(M,"icon",Ye),m(M,"slot","end"),this.first=t},m(U,S){q(U,t,S),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,c),l(c,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,w),l(I,L),l(t,P),l(t,M),l(t,N),D||(y=te(I,"click",A),D=!0)},p(U,S){e=U,S[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Te(_,h),S[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),S[0]&32&&j(n,"background-color",Se(e[30])),S[0]&32&&j(n,"color",xe(Se(e[30]))),S[0]&32&&p!==(p=e[30].title+"")&&Te(d,p),S[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?O||(O=Ft(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(U){U&&s(t),O&&O.d(),D=!1,y()}}}function Vt(i){let e;return{c(){e=u("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0}),E(e).forEach(s),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function Gt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,c,a,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,L,R="",P,M,N,D,y,O=v&&Vt();function A(){return e[20](e[30],e[32])}return{key:i,first:null,c(){t=u("ion-item"),o=u("ion-avatar"),n=u("div"),r=u("div"),_=ce(h),k=T(),I=u("ion-label"),c=u("ion-text"),a=u("h3"),d=ce(p),g=T(),O&&O.c(),w=T(),L=u("div"),L.innerHTML=R,P=T(),M=u("ion-icon"),N=T(),this.h()},l(U){t=f(U,"ION-ITEM",{});var S=E(t);o=f(S,"ION-AVATAR",{slot:!0});var B=E(o);n=f(B,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=f(V,"DIV",{class:!0});var K=E(r);_=ue(K,h),K.forEach(s),V.forEach(s),B.forEach(s),k=C(S),I=f(S,"ION-LABEL",{button:!0});var X=E(I);c=f(X,"ION-TEXT",{color:!0});var H=E(c);a=f(H,"H3",{});var F=E(a);d=ue(F,p),g=C(F),O&&O.l(F),F.forEach(s),H.forEach(s),w=C(X),L=f(X,"DIV",{class:!0,"data-svelte-h":!0}),W(L)!=="svelte-130ohbs"&&(L.innerHTML=R),X.forEach(s),P=C(S),M=f(S,"ION-ICON",{icon:!0,slot:!0}),E(M).forEach(s),N=C(S),S.forEach(s),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",Se(e[30])),j(n,"color",xe(Se(e[30]))),m(o,"slot","start"),m(c,"color","#2e2e2e"),G(L,"class","sub svelte-ziybgw"),m(I,"button",""),m(M,"icon",Ye),m(M,"slot","end"),this.first=t},m(U,S){q(U,t,S),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,c),l(c,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,w),l(I,L),l(t,P),l(t,M),l(t,N),D||(y=te(I,"click",A),D=!0)},p(U,S){e=U,S[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Te(_,h),S[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),S[0]&32&&j(n,"background-color",Se(e[30])),S[0]&32&&j(n,"color",xe(Se(e[30]))),S[0]&32&&p!==(p=e[30].title+"")&&Te(d,p),S[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?O||(O=Vt(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(U){U&&s(t),O&&O.d(),D=!1,y()}}}function $n(i){let e,t,o,n,r=`<ion-icon icon="${hn}"></ion-icon>`,h,_,b,k=`<ion-icon icon="${pn}"></ion-icon>`,I,c,a=i[6].name+"",p,d,g,v,w;function L(M,N){if(M[7].length>0)return Yn;if(!M[3])return Jn}let R=L(i),P=R&&R(i);return{c(){e=u("ion-header"),t=u("ion-toolbar"),o=u("ion-buttons"),n=u("ion-button"),n.innerHTML=r,h=T(),_=u("ion-buttons"),b=u("ion-button"),b.innerHTML=k,I=T(),c=u("ion-title"),p=ce(a),d=T(),P&&P.c(),g=Ae(),this.h()},l(M){e=f(M,"ION-HEADER",{translucent:!0});var N=E(e);t=f(N,"ION-TOOLBAR",{});var D=E(t);o=f(D,"ION-BUTTONS",{slot:!0});var y=E(o);n=f(y,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),W(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),y.forEach(s),h=C(D),_=f(D,"ION-BUTTONS",{slot:!0});var O=E(_);b=f(O,"ION-BUTTON",{"data-svelte-h":!0}),W(b)!=="svelte-nf50hj"&&(b.innerHTML=k),O.forEach(s),I=C(D),c=f(D,"ION-TITLE",{});var A=E(c);p=ue(A,a),A.forEach(s),D.forEach(s),N.forEach(s),d=C(M),P&&P.l(M),g=Ae(),this.h()},h(){m(n,"title","Atrás"),m(n,"alt","Atrás"),m(o,"slot","start"),m(_,"slot","end"),m(e,"translucent","")},m(M,N){q(M,e,N),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,b),l(t,I),l(t,c),l(c,p),q(M,d,N),P&&P.m(M,N),q(M,g,N),v||(w=[te(n,"click",i[14]),te(b,"click",i[18])],v=!0)},p(M,N){N[0]&64&&a!==(a=M[6].name+"")&&Te(p,a),R===(R=L(M))&&P?P.p(M,N):(P&&P.d(1),P=R&&R(M),P&&(P.c(),P.m(g.parentNode,g)))},d(M){M&&(s(e),s(d),s(g)),P&&P.d(M),v=!1,Ue(w)}}}function eo(i){let e,t,o,n=i[2]&&Ut(i);return{c(){e=T(),n&&n.c(),t=Ae(),this.h()},l(r){Qt("svelte-kn0kph",document.head).forEach(s),e=C(r),n&&n.l(r),t=Ae(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,h){q(r,e,h),n&&n.m(r,h),q(r,t,h),o=!0},p(r,h){r[2]?n?(n.p(r,h),h[0]&4&&ct(n,1)):(n=Ut(r),n.c(),ct(n,1),n.m(t.parentNode,t)):n&&(rn(),_t(n,1,1,()=>{n=null}),en())},i(r){o||(ct(n),o=!0)},o(r){_t(n),o=!1},d(r){r&&(s(e),s(t)),n&&n.d(r)}}}function Se(i){let e="#ffffff";return i.status==="pending"?e="#f2e300":i.status==="completed"&&(e="#44d900"),e}function Ke(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function xe(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function to(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const no=i=>i.img;function oo(i,e,t){let o;$t(i,mn,H=>t(17,o=H));var n=this&&this.__awaiter||function(H,F,Y,ee){function re(ae){return ae instanceof Y?ae:new Y(function(pe){pe(ae)})}return new(Y||(Y=Promise))(function(ae,pe){function Me(me){try{Pe(ee.next(me))}catch(he){pe(he)}}function ge(me){try{Pe(ee.throw(me))}catch(he){pe(he)}}function Pe(me){me.done?ae(me.value):re(me.value).then(Me,ge)}Pe((ee=ee.apply(H,F||[])).next())})};let{routeId:r}=e,{driverId:h}=e,_=new Object,b=!0,k=!1,I=[],c={},a=[],p=[],d,g=!1;const v=()=>n(void 0,void 0,void 0,function*(){yield w(r),d.complete()});tt(()=>{v()});function w(H){return n(this,void 0,void 0,function*(){const F=new FormData;F.append("id_route",H);try{const ee=yield(yield fetch("https://dev.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:F})).json();t(6,c=ee.data.seguimiento_list[0]),t(5,I=ee.data.event_list),t(7,a=ee.data.checklist),p=ee.data.expenses,c&&t(4,k=c.km_inicial=="0"&&c.gas_inicial=="0"),t(3,b=!1)}catch(Y){t(3,b=!1),console.error("Error fetching data:",Y)}})}const L=H=>new Promise((F,Y)=>{const ee=new FormData;ee.append("id_route",H.id_route),ee.append("id_event",H.id_event),fetch("https://dev.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:ee}).then(re=>re.json()).then(re=>{F(re.data.event_evidence[0])}).catch(re=>{console.error("Error fetching data:",re),Y(re)})}),R=(H,F)=>{L(H).then(Y=>{Y&&(H.img=Y.img,H.driver_comments=Y.driver_comments,H.comments=Y.comments),ze("modal-delivery-info",Fn,{delivery:H,isLast:F}).then(ee=>{})})},P=(H,F,Y)=>{var ee=!1;return g||(g=!0,ze("modal-checklist",Jt,{checklist:H,driverId:F,routeId:Y,isLast:ee}).then(re=>{g=!1}),to(Y,"checklist")),""},M=H=>n(void 0,void 0,void 0,function*(){return yield w(H),p.length>0?ze("modal-expense-detail",Xn,{routeId:H,expenses:p}).then(F=>{}):ze("modal-expense",pt,{routeId:H}).then(F=>{}),""}),N=H=>{if(H.tracking_type=="subscription"){if(H.subscriber_info&&H.payment_type==="cash"&&new Date(H.subscriber_info.payment_next)<new Date)return!0}else if(H.tracking_type=="ecommerce"&&Number(H.payment_pending)>0)return!0;return!1},D=()=>{_.id_driver?Fe(`/drivers/${_.id_driver}`):Fe("/drivers/me")},y=(H,F)=>n(void 0,void 0,void 0,function*(){yield(yield je.create({header:H||"Error",message:F||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function O(H){return H===I.length-1}const A=()=>M(r);function U(H){Le[H?"unshift":"push"](()=>{d=H,t(8,d)})}const S=(H,F)=>R(H,O(F));function B(H){Le[H?"unshift":"push"](()=>{d=H,t(8,d)})}const V=(H,F)=>R(H,O(F));function K(H){Le[H?"unshift":"push"](()=>{d=H,t(8,d)})}const X=H=>{const F=I.findIndex(pe=>pe.id_event===H.id_event),Y=F===0,ee=F>0?I[F-1]:null,re=Y||ee&&ee.img!==null,ae=H.img!==null&&H.img!=="";re||Y&&!ae?R(H):y("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=H=>{"routeId"in H&&t(0,r=H.routeId),"driverId"in H&&t(1,h=H.driverId)},i.$$.update=()=>{i.$$.dirty[0]&131077&&(t(0,{routeId:r,driverId:h}=o.params,r,(t(1,h),t(17,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="superadmin")?(w(r),Fe(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(w(r),Fe(`/drivers/${_.id_driver}/routes/${r}`)):Fe("/"))},[r,h,_,b,k,I,c,a,d,v,R,P,M,N,D,y,O,o,A,U,S,B,V,K,X]}class fo extends Xe{constructor(e){super(),Je(this,e,oo,eo,We,{routeId:0,driverId:1},null,[-1,-1])}}export{fo as component};
