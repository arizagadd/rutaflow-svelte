import{Z as it,s as Xe,e as f,j as L,b as _,q as k,d as J,h as a,m as D,v as E,i as U,w as o,x as Y,n as pe,z as Ae,_ as At,B as F,p as Ct,o as Pt,k as _e,$ as ot,t as Q,r as $,f as V,a0 as St,y as ce,a1 as qe,A as be,a2 as ht,l as Bt}from"../chunks/index.BYLndrM5.js";import{S as Je,i as Ye,t as je,a as et,c as Mt,b as Rt,d as Ht,m as qt,e as Ut,g as zt}from"../chunks/index.BNHbygFo.js";import{e as Oe,u as Ze,d as Qe,a as Ft,c as Vt,b as Kt,i as wt,f as jt,g as Gt,s as lt,h as Pe,j as Wt,p as Xt}from"../chunks/index.DAE8tzcC.js";import{g as ye}from"../chunks/entry.BxVh0qv0.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as rt,a as Ge,I as Jt}from"../chunks/IonPage.KvUD72q2.js";import{q as Yt,t as Zt}from"../chunks/ion-modal.CsJaVgKZ.js";const Qt=(l,e)=>{if(!customElements.get(l)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(l,t)}},$t=function(l){return document.createElement(l).constructor!==HTMLElement},xt=(l,e)=>{$t(l)||Qt(l,e)},We=async(l,e,t)=>{Yt(),Zt(),xt(l,e);const i=await rt.create({component:l,componentProps:t});return i.present(),await i.onWillDismiss()};let we=it({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Lt=it({flag:[]});function en(l){let e,t,i,n,r="Cancelar",d,h,m="Captura de Km/Gas",O,I,v,s="Confirmar",p,g,u,c,N,T,S;return{c(){e=f("ion-header"),t=f("ion-toolbar"),i=f("ion-buttons"),n=f("ion-button"),n.textContent=r,d=L(),h=f("ion-title"),h.textContent=m,O=L(),I=f("ion-buttons"),v=f("ion-button"),v.textContent=s,p=L(),g=f("ion-content"),u=f("ion-item"),c=f("ion-input"),this.h()},l(A){e=_(A,"ION-HEADER",{translucent:!0});var P=k(e);t=_(P,"ION-TOOLBAR",{});var C=k(t);i=_(C,"ION-BUTTONS",{slot:!0});var M=k(i);n=_(M,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-17pq4f4"&&(n.textContent=r),M.forEach(a),d=D(C),h=_(C,"ION-TITLE",{"data-svelte-h":!0}),J(h)!=="svelte-1yhkaq7"&&(h.textContent=m),O=D(C),I=_(C,"ION-BUTTONS",{slot:!0});var H=k(I);v=_(H,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),J(v)!=="svelte-cm6j4s"&&(v.textContent=s),H.forEach(a),C.forEach(a),P.forEach(a),p=D(A),g=_(A,"ION-CONTENT",{fullscreen:!0});var b=k(g);u=_(b,"ION-ITEM",{});var R=k(u);c=_(R,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var y=k(c);y.forEach(a),R.forEach(a),b.forEach(a),this.h()},h(){E(n,"color","medium"),E(i,"slot","start"),E(v,"strong",""),E(I,"slot","end"),E(e,"translucent",""),E(c,"class","fin-km"),E(c,"inputmode","numeric"),E(c,"pattern","[0-9]*"),E(c,"type","number"),E(c,"placeholder",N="Ingresa "+l[0]+" actual"),E(c,"value",l[1]),E(c,"required",""),E(g,"fullscreen","")},m(A,P){U(A,e,P),o(e,t),o(t,i),o(i,n),o(t,d),o(t,h),o(t,O),o(t,I),o(I,v),U(A,p,P),U(A,g,P),o(g,u),o(u,c),T||(S=[Y(n,"click",l[2]),Y(v,"click",l[3]),Y(c,"input",l[4])],T=!0)},p(A,[P]){P&1&&N!==(N="Ingresa "+A[0]+" actual")&&E(c,"placeholder",N),P&2&&E(c,"value",A[1])},i:pe,o:pe,d(A){A&&(a(e),a(p),a(g)),T=!1,Ae(S)}}}function tn(l,e,t){const i=At();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let d;Lt.subscribe(v=>{r=v.flag[0],r=="km_final"||r=="km_inicial"?t(0,d="kilometraje"):t(0,d="litros de gasolina")});let h=0;function m(){rt.dismiss()}function O(){i("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?we.update(s=>({...s,km_inicial:[h]})):r=="gas_inicial"?we.update(s=>({...s,gas_inicial:[h]})):r=="km_final"?we.update(s=>({...s,km_final:[h]})):r=="gas_final"&&we.update(s=>({...s,gas_final:[h]})),m()}return[d,h,m,O,v=>t(1,h=v.target.value)]}class nn extends Je{constructor(e){super(),Ye(this,e,tn,en,Xe,{})}}const Ke=it({items:[],checkedIndices:[],mandatory:[]});function dt(l,e,t){const i=l.slice();return i[50]=e[t],i[51]=e,i[52]=t,i}function on(l){let e,t,i,n,r,d="Kilometraje inicial",h,m,O=l[0]?l[0]+" km.":"Cargar km",I,v,s,p,g,u,c,N="Gasolina inicial (litros)",T,S,A=l[1]?l[1]+" litros":"Cargar gas",P,C,M,H;return C=ot(l[20][0]),{c(){e=f("ion-item"),t=f("ion-label"),i=f("input"),n=L(),r=f("p"),r.textContent=d,h=L(),m=f("ion-button"),I=Q(O),v=L(),s=f("ion-item"),p=f("ion-label"),g=f("input"),u=L(),c=f("p"),c.textContent=N,T=L(),S=f("ion-button"),P=Q(A),this.h()},l(b){e=_(b,"ION-ITEM",{});var R=k(e);t=_(R,"ION-LABEL",{style:!0});var y=k(t);i=_(y,"INPUT",{id:!0,style:!0,type:!0}),n=D(y),r=_(y,"P",{style:!0,"data-svelte-h":!0}),J(r)!=="svelte-88twxi"&&(r.textContent=d),y.forEach(a),h=D(R),m=_(R,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var w=k(m);I=$(w,O),w.forEach(a),R.forEach(a),v=D(b),s=_(b,"ION-ITEM",{});var q=k(s);p=_(q,"ION-LABEL",{style:!0});var z=k(p);g=_(z,"INPUT",{id:!0,style:!0,type:!0}),u=D(z),c=_(z,"P",{style:!0,"data-svelte-h":!0}),J(c)!=="svelte-1ux30eb"&&(c.textContent=N),z.forEach(a),T=D(q),S=_(q,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var K=k(S);P=$(K,A),K.forEach(a),q.forEach(a),this.h()},h(){V(i,"id","chkbox-km-ini"),F(i,"pointer-events","auto"),V(i,"type","checkbox"),i.required=!0,F(r,"margin-left","10px"),F(t,"display","flex"),E(m,"fill","outline"),E(m,"size","small"),E(m,"class","loadKmInicial"),E(m,"aria-selected",""),V(g,"id","chkbox-gas-ini"),F(g,"pointer-events","auto"),V(g,"type","checkbox"),g.required=!0,F(c,"margin-left","10px"),F(p,"display","flex"),E(S,"fill","outline"),E(S,"class","loadGasInicial"),E(S,"size","small"),F(S,"height","16px "),C.p(i,g)},m(b,R){U(b,e,R),o(e,t),o(t,i),i.checked=~(l[4]||[]).indexOf(i.__value),l[27](i),o(t,n),o(t,r),o(e,h),o(e,m),o(m,I),U(b,v,R),U(b,s,R),o(s,p),o(p,g),l[29](g),g.checked=~(l[4]||[]).indexOf(g.__value),o(p,u),o(p,c),o(s,T),o(s,S),o(S,P),M||(H=[Y(i,"change",l[26]),Y(m,"click",l[28]),Y(g,"change",l[30]),Y(S,"click",l[31])],M=!0)},p(b,R){R[0]&16&&(i.checked=~(b[4]||[]).indexOf(i.__value)),R[0]&1&&O!==(O=b[0]?b[0]+" km.":"Cargar km")&&ce(I,O),R[0]&16&&(g.checked=~(b[4]||[]).indexOf(g.__value)),R[0]&2&&A!==(A=b[1]?b[1]+" litros":"Cargar gas")&&ce(P,A)},d(b){b&&(a(e),a(v),a(s)),l[27](null),l[29](null),C.r(),M=!1,Ae(H)}}}function ln(l){let e,t,i,n,r,d="Kilometraje final",h,m,O=l[2]?l[2]+" km.":"Cargar km",I,v,s,p,g,u,c,N="Gasolina final (litros)",T,S,A=l[3]?l[3]+" litros":"Cargar gas",P,C,M,H;return C=ot(l[20][0]),{c(){e=f("ion-item"),t=f("ion-label"),i=f("input"),n=L(),r=f("p"),r.textContent=d,h=L(),m=f("ion-button"),I=Q(O),v=L(),s=f("ion-item"),p=f("ion-label"),g=f("input"),u=L(),c=f("p"),c.textContent=N,T=L(),S=f("ion-button"),P=Q(A),this.h()},l(b){e=_(b,"ION-ITEM",{});var R=k(e);t=_(R,"ION-LABEL",{style:!0});var y=k(t);i=_(y,"INPUT",{id:!0,style:!0,type:!0}),n=D(y),r=_(y,"P",{style:!0,"data-svelte-h":!0}),J(r)!=="svelte-ccmu71"&&(r.textContent=d),y.forEach(a),h=D(R),m=_(R,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var w=k(m);I=$(w,O),w.forEach(a),R.forEach(a),v=D(b),s=_(b,"ION-ITEM",{});var q=k(s);p=_(q,"ION-LABEL",{style:!0});var z=k(p);g=_(z,"INPUT",{id:!0,style:!0,type:!0}),u=D(z),c=_(z,"P",{style:!0,"data-svelte-h":!0}),J(c)!=="svelte-wsoyd2"&&(c.textContent=N),z.forEach(a),T=D(q),S=_(q,"ION-BUTTON",{fill:!0,size:!0,class:!0});var K=k(S);P=$(K,A),K.forEach(a),q.forEach(a),this.h()},h(){V(i,"id","chkbox-km-fin"),F(i,"pointer-events","auto"),V(i,"type","checkbox"),i.required=!0,F(r,"margin-left","10px"),F(t,"display","flex"),E(m,"fill","outline"),E(m,"size","small"),E(m,"class","loadKmInicial"),E(m,"aria-selected",""),V(g,"id","chkbox-gas-fin"),F(g,"pointer-events","auto"),V(g,"type","checkbox"),g.required=!0,F(c,"margin-left","10px"),F(p,"display","flex"),E(S,"fill","outline"),E(S,"size","small"),E(S,"class","loadGasInicial"),C.p(i,g)},m(b,R){U(b,e,R),o(e,t),o(t,i),i.checked=~(l[4]||[]).indexOf(i.__value),l[21](i),o(t,n),o(t,r),o(e,h),o(e,m),o(m,I),U(b,v,R),U(b,s,R),o(s,p),o(p,g),g.checked=~(l[4]||[]).indexOf(g.__value),l[24](g),o(p,u),o(p,c),o(s,T),o(s,S),o(S,P),M||(H=[Y(i,"change",l[19]),Y(m,"click",l[22]),Y(g,"change",l[23]),Y(S,"click",l[25])],M=!0)},p(b,R){R[0]&16&&(i.checked=~(b[4]||[]).indexOf(i.__value)),R[0]&4&&O!==(O=b[2]?b[2]+" km.":"Cargar km")&&ce(I,O),R[0]&16&&(g.checked=~(b[4]||[]).indexOf(g.__value)),R[0]&8&&A!==(A=b[3]?b[3]+" litros":"Cargar gas")&&ce(P,A)},d(b){b&&(a(e),a(v),a(s)),l[21](null),l[24](null),C.r(),M=!1,Ae(H)}}}function rn(l){let e=[],t=new Map,i,n=Oe(l[12]);const r=d=>d[50].id_checklist_event;for(let d=0;d<n.length;d+=1){let h=dt(l,n,d),m=r(h);t.set(m,e[d]=pt(m,h))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();i=_e()},l(d){for(let h=0;h<e.length;h+=1)e[h].l(d);i=_e()},m(d,h){for(let m=0;m<e.length;m+=1)e[m]&&e[m].m(d,h);U(d,i,h)},p(d,h){h[0]&202864&&(n=Oe(d[12]),e=Ze(e,h,r,1,d,n,t,i.parentNode,Qe,pt,i,dt))},d(d){d&&a(i);for(let h=0;h<e.length;h+=1)e[h].d(d)}}}function pt(l,e){let t,i,n,r=e[50],d,h,m=e[50].item+"",O,I,v,s,p=(e[11][e[50].id_checklist_event]?e[11][e[50].id_checklist_event]:"Cargar evidencia")+"",g,u,c,N,T,S,A;const P=()=>e[33](n,r),C=()=>e[33](null,r);function M(){return e[34](e[50])}function H(...b){return e[36](e[50],...b)}return T=ot(e[20][0]),{key:l,first:null,c(){t=f("ion-item"),i=f("ion-label"),n=f("input"),d=L(),h=f("p"),O=Q(m),I=L(),v=f("ion-button"),s=f("label"),g=Q(p),u=L(),c=f("input"),N=L(),this.h()},l(b){t=_(b,"ION-ITEM",{});var R=k(t);i=_(R,"ION-LABEL",{style:!0});var y=k(i);n=_(y,"INPUT",{id:!0,style:!0,type:!0}),d=D(y),h=_(y,"P",{style:!0});var w=k(h);O=$(w,m),w.forEach(a),y.forEach(a),I=D(R),v=_(R,"ION-BUTTON",{fill:!0,class:!0,size:!0});var q=k(v);s=_(q,"LABEL",{for:!0});var z=k(s);g=$(z,p),z.forEach(a),u=D(q),c=_(q,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),q.forEach(a),N=D(R),R.forEach(a),this.h()},h(){V(n,"id",`chkbox-${e[50].id_checklist_event}`),F(n,"pointer-events","auto"),V(n,"type","checkbox"),n.__value=e[50].id_checklist_event,St(n,n.__value),n.required=!0,F(h,"margin-left","10px"),F(i,"display","flex"),V(s,"for","chklist-"+e[50].id_checklist_event),F(c,"display","none"),V(c,"id","chklist-"+e[50].id_checklist_event),V(c,"name","fileToUpload"),V(c,"type","file"),V(c,"accept","image/*"),E(v,"fill","outline"),E(v,"class","loadEvidence svelte-1lh6nay"),E(v,"size","small"),T.p(n),this.first=t},m(b,R){U(b,t,R),o(t,i),o(i,n),n.checked=~(e[4]||[]).indexOf(n.__value),P(),o(i,d),o(i,h),o(h,O),o(t,I),o(t,v),o(v,s),o(s,g),o(v,u),o(v,c),e[35](c),o(t,N),S||(A=[Y(n,"change",e[32]),Y(n,"change",M),Y(c,"change",H)],S=!0)},p(b,R){e=b,R[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[50]&&(C(),r=e[50],P()),R[0]&2048&&p!==(p=(e[11][e[50].id_checklist_event]?e[11][e[50].id_checklist_event]:"Cargar evidencia")+"")&&ce(g,p)},d(b){b&&a(t),C(),e[35](null),T.r(),S=!1,Ae(A)}}}function an(l){let e,t,i,n,r="Cancelar",d,h,m="Requerimientos de ruta",O,I,v,s,p,g,u,c="Confirmar",N,T;function S(M,H){return M[13]?ln:on}let P=S(l)(l),C=l[12]&&rn(l);return{c(){e=f("ion-header"),t=f("ion-toolbar"),i=f("ion-buttons"),n=f("ion-button"),n.textContent=r,d=L(),h=f("ion-title"),h.textContent=m,O=L(),I=f("ion-content"),v=f("ion-list"),P.c(),s=L(),C&&C.c(),p=L(),g=f("ion-footer"),u=f("ion-button"),u.textContent=c,this.h()},l(M){e=_(M,"ION-HEADER",{translucent:!0});var H=k(e);t=_(H,"ION-TOOLBAR",{});var b=k(t);i=_(b,"ION-BUTTONS",{slot:!0});var R=k(i);n=_(R,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-1dnmkxs"&&(n.textContent=r),R.forEach(a),d=D(b),h=_(b,"ION-TITLE",{"data-svelte-h":!0}),J(h)!=="svelte-ucox25"&&(h.textContent=m),b.forEach(a),H.forEach(a),O=D(M),I=_(M,"ION-CONTENT",{fullscreen:!0});var y=k(I);v=_(y,"ION-LIST",{});var w=k(v);P.l(w),s=D(w),C&&C.l(w),w.forEach(a),y.forEach(a),p=D(M),g=_(M,"ION-FOOTER",{});var q=k(g);u=_(q,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),J(u)!=="svelte-g82qqw"&&(u.textContent=c),q.forEach(a),this.h()},h(){E(n,"color","medium"),E(i,"slot","start"),E(e,"translucent",""),E(I,"fullscreen",""),E(u,"fill","outline"),E(u,"color","tertiary"),E(u,"strong",""),F(u,"width","99%"),F(u,"height","auto")},m(M,H){U(M,e,H),o(e,t),o(t,i),o(i,n),o(t,d),o(t,h),U(M,O,H),U(M,I,H),o(I,v),P.m(v,null),o(v,s),C&&C.m(v,null),U(M,p,H),U(M,g,H),o(g,u),N||(T=[Y(n,"click",l[14]),Y(u,"click",l[15])],N=!0)},p(M,H){P.p(M,H),M[12]&&C.p(M,H)},i:pe,o:pe,d(M){M&&(a(e),a(O),a(I),a(p),a(g)),P.d(),C&&C.d(),N=!1,Ae(T)}}}function tt(l,e){if(typeof l=="object"&&l!==null||Array.isArray(l)){if(Array.isArray(l))return l.map(t=>tt(t,e)).flat();{const t=Object.keys(l);let i;return e=="id_checklist_event"?i=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>l[r]):e=="mandatory"?i=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>l[r]):(console.error("Tipo de dato no reconocido."),i=!1),i}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function xe(l,e){let t=new FormData;t.append("id_route",l),t.append("status",e),fetch("https://rutaflow-app-development.up.railway.app/api/admin/route/change_status.php",{method:"POST",body:t}).then(i=>i.json()).then(i=>{}).catch(i=>{console.error("Error fetching data:",i)})}function sn(l,e,t){let i;Ct(l,Ke,B=>t(39,i=B));let n=document.querySelector("ion-modal");const r=n.componentProps.checklist,d=n.componentProps.driverId,h=n.componentProps.routeId,m=n.componentProps.isLast;let O,I,v,s,p=[],g=null,u={},c,N,T,S,A={},P={};Pt(()=>{m?console.log("Último checklist"):(Ke.update(B=>(B.mandatory=tt(r,"mandatory"),B.items=tt(r,"id_checklist_event"),B)),console.log(i))});const C=async()=>{await(await Ge.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},M=async()=>{await(await Ge.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},H=async B=>{await(await Ge.create({header:"Datos inválidos",message:B=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},b=()=>{rt.dismiss(),d?ye(`/drivers/${d}`):ye("/drivers/me")},R=()=>{if(m){var B=z(v,"km"),G=z(s,"gas");const X=new FormData;X.append("km_final",B),X.append("gas_final",G),X.append("id_route",h),B&&G?(b(),fetch("https://rutaflow-app-development.up.railway.app/api/admin/checklist/add_evidence.php",{method:"POST",body:X}).then(x=>x.json()).then(x=>{M()}).catch(x=>{console.error("Error fetching data:",x)})):C()}else{var te=z(O,"km"),ie=z(I,"gas");Ke.update(X=>{const x=X.items,ne=X.mandatory;if(x.every(j=>X.checkedIndices.includes(j))&&te&&ie){b();const j=new FormData;for(const W in A)if(A.hasOwnProperty(W)){const{img:se,img_id:Te}=A[W];j.append(`selectedImages[${W}][img]`,se),j.append(`selectedImages[${W}][img_id]`,Te)}j.append("km_inicial",te),j.append("gas_inicial",ie),j.append("id_route",h),fetch("https://rutaflow-app-development.up.railway.app/api/admin/checklist/add_evidence.php",{method:"POST",body:j}).then(W=>W.json()).then(W=>{ne&&ne[0]=="1"?xe(h,"checklist-pending"):xe(h,"enroute")}).catch(W=>{console.error("Error fetching data:",W)})}else C();return X})}re()},y=async(B,G)=>{const ie=B.target.files[0],X=await w(ie);if(X){const x=new FormData;x.append("fileToUpload",X);try{const ne=await fetch("https://rutaflow-app-development.up.railway.app/api/admin/manager/upload_img_driver.php",{method:"POST",body:x});if(ne.ok){const Z=await ne.json();A={...A,[G]:{img:Z.img,img_id:Z.img_id}},t(11,P={...P,[G]:Z.filename}),q(G),t(6,u[G].checked=!0,u)}else console.error("File upload failed:",ne.statusText)}catch(ne){console.error("Error during file upload:",ne)}}},w=async B=>new Promise(G=>{const te=new FileReader;te.onload=ie=>{const X=new Image;X.src=ie.target.result,X.onload=()=>{const x=document.createElement("canvas"),ne=x.getContext("2d"),Z=800,j=600;let W=X.width,se=X.height;W>Z&&(se*=Z/W,W=Z),se>j&&(W*=j/se,se=j),x.width=W,x.height=se,ne.drawImage(X,0,0,W,se),x.toBlob(Te=>{G(Te)},"image/jpeg",.7)}},te.readAsDataURL(B)}),q=B=>{Ke.update(G=>(G.checkedIndices.indexOf(B)===-1?G.checkedIndices.push(B):console.error(`ID ${B} is already checked.`),G.items.forEach(ie=>{ie.id_checklist_event===B&&(ie.checked=!0)}),G))};function z(B,G){return/^\d+$/.test(B)?parseInt(B,10):(H(G),null)}function K(B,G){ee(G),n.componentProps.data_type=G,We("modal-gas-km",nn,{r:G}).then(()=>{we.subscribe(te=>{oe(te,G)})})}function ee(B){Lt.update(G=>({...G,flag:[B]}))}function oe(B,G){t(0,O=B.km_inicial?B.km_inicial:null),t(1,I=B.gas_inicial?B.gas_inicial:null),t(2,v=B.km_final?B.km_final:null),t(3,s=B.gas_final?B.gas_final:null),G=="km_inicial"&&t(7,c.checked=!0,c),G=="gas_inicial"&&t(8,N.checked=!0,N),G=="km_final"&&t(9,T.checked=!0,T),G=="gas_final"&&t(10,S.checked=!0,S)}function re(){we.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const de=[[]];function he(){p=qe(de[0],this.__value,this.checked),t(4,p)}function ae(B){be[B?"unshift":"push"](()=>{T=B,t(9,T)})}const ke=B=>K(B,"km_final");function Ie(){p=qe(de[0],this.__value,this.checked),t(4,p)}function Se(B){be[B?"unshift":"push"](()=>{S=B,t(10,S)})}const Ne=B=>K(B,"gas_final");function ve(){p=qe(de[0],this.__value,this.checked),t(4,p)}function ue(B){be[B?"unshift":"push"](()=>{c=B,t(7,c)})}const Ee=B=>K(B,"km_inicial");function Be(B){be[B?"unshift":"push"](()=>{N=B,t(8,N)})}function ge(){p=qe(de[0],this.__value,this.checked),t(4,p)}const Ue=B=>K(B,"gas_inicial");function Me(){p=qe(de[0],this.__value,this.checked),t(4,p)}function me(B,G){be[B?"unshift":"push"](()=>{u[G.id_checklist_event]=B,t(6,u)})}const Re=B=>q(B.id_checklist_event);function He(B){be[B?"unshift":"push"](()=>{g=B,t(5,g)})}return[O,I,v,s,p,g,u,c,N,T,S,P,r,m,b,R,y,q,K,he,de,ae,ke,Ie,Se,Ne,ve,ue,Ee,Be,ge,Ue,Me,me,Re,He,(B,G)=>y(G,B.id_checklist_event)]}class Dt extends Je{constructor(e){super(),Ye(this,e,sn,an,Xe,{},null,[-1,-1])}}function cn(l){let e,t,i,n,r,d="Domicilio 2",h,m,O=l[2].line2+"",I,v,s;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),v=L(),s=f("ion-icon"),this.h()},l(p){e=_(p,"ION-ITEM",{href:!0});var g=k(e);t=_(g,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(g),n=_(g,"ION-LABEL",{class:!0});var u=k(n);r=_(u,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1qy148r"&&(r.textContent=d),h=D(u),m=_(u,"H2",{});var c=k(m);I=$(c,O),c.forEach(a),u.forEach(a),v=D(g),s=_(g,"ION-ICON",{icon:!0,slot:!0}),k(s).forEach(a),g.forEach(a),this.h()},h(){E(t,"icon",lt),E(t,"slot","start"),E(n,"class","ion-text-wrap"),E(s,"icon",Pe),E(s,"slot","end"),E(e,"href","https://www.google.com/maps/searhc/?api=1&query="+l[2].line2)},m(p,g){U(p,e,g),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I),o(e,v),o(e,s)},p:pe,d(p){p&&a(e)}}}function un(l){let e,t,i,n,r,d="Domicilio 1",h,m,O=l[2].line1+"",I,v,s,p,g=l[2].line2&&l[2].line2.trim().length,u,c=g&&fn(l);return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),v=L(),s=f("ion-icon"),p=L(),c&&c.c(),u=_e(),this.h()},l(N){e=_(N,"ION-ITEM",{href:!0});var T=k(e);t=_(T,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(T),n=_(T,"ION-LABEL",{class:!0});var S=k(n);r=_(S,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1ehcrdm"&&(r.textContent=d),h=D(S),m=_(S,"H2",{});var A=k(m);I=$(A,O),A.forEach(a),S.forEach(a),v=D(T),s=_(T,"ION-ICON",{icon:!0,slot:!0}),k(s).forEach(a),T.forEach(a),p=D(N),c&&c.l(N),u=_e(),this.h()},h(){E(t,"icon",lt),E(t,"slot","start"),E(n,"class","ion-text-wrap"),E(s,"icon",Pe),E(s,"slot","end"),E(e,"href","https://www.google.com/maps/search/?api=1&query="+l[2].line1)},m(N,T){U(N,e,T),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I),o(e,v),o(e,s),U(N,p,T),c&&c.m(N,T),U(N,u,T)},p(N,T){g&&c.p(N,T)},d(N){N&&(a(e),a(p),a(u)),c&&c.d(N)}}}function fn(l){let e,t,i,n,r,d="Domicilio 2",h,m,O=l[2].line2+"",I,v,s;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),v=L(),s=f("ion-icon"),this.h()},l(p){e=_(p,"ION-ITEM",{href:!0});var g=k(e);t=_(g,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(g),n=_(g,"ION-LABEL",{class:!0});var u=k(n);r=_(u,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1qy148r"&&(r.textContent=d),h=D(u),m=_(u,"H2",{});var c=k(m);I=$(c,O),c.forEach(a),u.forEach(a),v=D(g),s=_(g,"ION-ICON",{icon:!0,slot:!0}),k(s).forEach(a),g.forEach(a),this.h()},h(){E(t,"icon",lt),E(t,"slot","start"),E(n,"class","ion-text-wrap"),E(s,"icon",Pe),E(s,"slot","end"),E(e,"href","https://www.google.com/maps/search/?api=1&query="+l[2].line2)},m(p,g){U(p,e,g),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I),o(e,v),o(e,s)},p:pe,d(p){p&&a(e)}}}function _n(l){let e,t=l[2].comments!="<br>"&&hn(l);return{c(){t&&t.c(),e=_e()},l(i){t&&t.l(i),e=_e()},m(i,n){t&&t.m(i,n),U(i,e,n)},p(i,n){i[2].comments!="<br>"&&t.p(i,n)},d(i){i&&a(e),t&&t.d(i)}}}function hn(l){let e,t,i,n,r,d="Notas de ubicación",h,m,O=l[2].comments+"",I;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),this.h()},l(v){e=_(v,"ION-ITEM",{});var s=k(e);t=_(s,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(s),n=_(s,"ION-LABEL",{class:!0});var p=k(n);r=_(p,"P",{"data-svelte-h":!0}),J(r)!=="svelte-nhm2ft"&&(r.textContent=d),h=D(p),m=_(p,"H2",{});var g=k(m);I=$(g,O),g.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){E(t,"icon",wt),E(t,"slot","start"),E(n,"class","ion-text-wrap")},m(v,s){U(v,e,s),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I)},p:pe,d(v){v&&a(e)}}}function dn(l){let e,t,i,n,r,d="Horarios",h,m,O=l[2].schedule+"",I;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),this.h()},l(v){e=_(v,"ION-ITEM",{});var s=k(e);t=_(s,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(s),n=_(s,"ION-LABEL",{});var p=k(n);r=_(p,"P",{"data-svelte-h":!0}),J(r)!=="svelte-11q7hm5"&&(r.textContent=d),h=D(p),m=_(p,"H2",{});var g=k(m);I=$(g,O),g.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){E(t,"icon",jt),E(t,"slot","start")},m(v,s){U(v,e,s),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I)},p:pe,d(v){v&&a(e)}}}function pn(l){let e,t,i,n,r,d="Notas del operador",h,m,O=l[2].driver_comments+"",I;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),this.h()},l(v){e=_(v,"ION-ITEM",{});var s=k(e);t=_(s,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(s),n=_(s,"ION-LABEL",{});var p=k(n);r=_(p,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1yk9qp4"&&(r.textContent=d),h=D(p),m=_(p,"H2",{});var g=k(m);I=$(g,O),g.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){E(t,"icon",Gt),E(t,"slot","start")},m(v,s){U(v,e,s),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I)},p:pe,d(v){v&&a(e)}}}function mn(l){let e,t=l[2].logistic_comments!="<br>"&&vn(l);return{c(){t&&t.c(),e=_e()},l(i){t&&t.l(i),e=_e()},m(i,n){t&&t.m(i,n),U(i,e,n)},p(i,n){i[2].logistic_comments!="<br>"&&t.p(i,n)},d(i){i&&a(e),t&&t.d(i)}}}function vn(l){let e,t,i,n,r,d="Comentarios logísticos",h,m,O=l[2].logistic_comments+"",I;return{c(){e=f("ion-item"),t=f("ion-icon"),i=L(),n=f("ion-label"),r=f("p"),r.textContent=d,h=L(),m=f("h2"),I=Q(O),this.h()},l(v){e=_(v,"ION-ITEM",{});var s=k(e);t=_(s,"ION-ICON",{icon:!0,slot:!0}),k(t).forEach(a),i=D(s),n=_(s,"ION-LABEL",{class:!0});var p=k(n);r=_(p,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1iz85r6"&&(r.textContent=d),h=D(p),m=_(p,"H2",{});var g=k(m);I=$(g,O),g.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){E(t,"icon",wt),E(t,"slot","start"),E(n,"class","ion-text-wrap")},m(v,s){U(v,e,s),o(e,t),o(e,i),o(e,n),o(n,r),o(n,h),o(n,m),o(m,I)},p:pe,d(v){v&&a(e)}}}function mt(l){let e,t,i;return{c(){e=f("section"),t=f("ion-img"),this.h()},l(n){e=_(n,"SECTION",{});var r=k(e);t=_(r,"ION-IMG",{src:!0,alt:!0,style:!0}),k(t).forEach(a),r.forEach(a),this.h()},h(){ht(t.src,i=l[1])||E(t,"src",i),E(t,"alt","Evidencia fotográfica"),F(t,"max-width","100%"),F(t,"margin-top","16px")},m(n,r){U(n,e,r),o(e,t)},p(n,r){r&2&&!ht(t.src,i=n[1])&&E(t,"src",i)},d(n){n&&a(e)}}}function gn(l){let e,t,i,n,r="Cancelar",d,h,m=l[2].title+"",O,I,v,s,p="Confirmar",g,u,c,N,T,S,A,P,C="Cliente",M,H,b=l[2].client_name+"",R,y,w,q=l[2].comments&&l[2].comments.trim().length,z,K=l[2].schedule&&l[2].schedule.trim().length,ee,oe,re=l[2].logistic_comments&&l[2].logistic_comments.trim().length,de,he,ae,ke,Ie,Se,Ne,ve,ue,Ee,Be,ge,Ue="Subir Evidencia",Me,me,Re,He,$e;function B(j,W){if(j[2].line1&&j[2].line1.trim().length)return un;if(j[2].line2&&j[2].line2.trim().length)return cn}let G=B(l),te=G&&G(l),ie=q&&_n(l),X=K&&dn(l),x=l[2].driver_comments&&pn(l),ne=re&&mn(l),Z=l[1]&&mt(l);return{c(){e=f("ion-header"),t=f("ion-toolbar"),i=f("ion-buttons"),n=f("ion-button"),n.textContent=r,d=L(),h=f("ion-title"),O=Q(m),I=L(),v=f("ion-buttons"),s=f("ion-button"),s.textContent=p,g=L(),u=f("ion-content"),c=f("ion-list"),N=f("ion-item"),T=f("ion-icon"),S=L(),A=f("ion-label"),P=f("p"),P.textContent=C,M=L(),H=f("h2"),R=Q(b),y=L(),te&&te.c(),w=L(),ie&&ie.c(),z=L(),X&&X.c(),ee=L(),x&&x.c(),oe=L(),ne&&ne.c(),de=L(),he=f("ion-item"),ae=f("ion-icon"),ke=L(),Ie=f("ion-textarea"),Se=L(),Ne=f("section"),ve=f("label"),ue=f("ion-button"),Ee=f("ion-icon"),Be=L(),ge=f("label"),ge.textContent=Ue,Me=L(),me=f("input"),Re=L(),Z&&Z.c(),this.h()},l(j){e=_(j,"ION-HEADER",{translucent:!0});var W=k(e);t=_(W,"ION-TOOLBAR",{});var se=k(t);i=_(se,"ION-BUTTONS",{slot:!0});var Te=k(i);n=_(Te,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),J(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Te.forEach(a),d=D(se),h=_(se,"ION-TITLE",{title:!0});var at=k(h);O=$(at,m),at.forEach(a),I=D(se),v=_(se,"ION-BUTTONS",{slot:!0});var st=k(v);s=_(st,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),J(s)!=="svelte-1ida0il"&&(s.textContent=p),st.forEach(a),se.forEach(a),W.forEach(a),g=D(j),u=_(j,"ION-CONTENT",{fullscreen:!0});var ct=k(u);c=_(ct,"ION-LIST",{});var le=k(c);N=_(le,"ION-ITEM",{});var ze=k(N);T=_(ze,"ION-ICON",{icon:!0,slot:!0}),k(T).forEach(a),S=D(ze),A=_(ze,"ION-LABEL",{});var Fe=k(A);P=_(Fe,"P",{"data-svelte-h":!0}),J(P)!=="svelte-jrq7ei"&&(P.textContent=C),M=D(Fe),H=_(Fe,"H2",{});var ut=k(H);R=$(ut,b),ut.forEach(a),Fe.forEach(a),ze.forEach(a),y=D(le),te&&te.l(le),w=D(le),ie&&ie.l(le),z=D(le),X&&X.l(le),ee=D(le),x&&x.l(le),oe=D(le),ne&&ne.l(le),de=D(le),he=_(le,"ION-ITEM",{});var Ve=k(he);ae=_(Ve,"ION-ICON",{icon:!0,slot:!0}),k(ae).forEach(a),ke=D(Ve),Ie=_(Ve,"ION-TEXTAREA",{label:!0,placeholder:!0}),k(Ie).forEach(a),Ve.forEach(a),Se=D(le),Ne=_(le,"SECTION",{});var ft=k(Ne);ve=_(ft,"LABEL",{for:!0,style:!0});var _t=k(ve);ue=_(_t,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ce=k(ue);Ee=_(Ce,"ION-ICON",{icon:!0,slot:!0}),k(Ee).forEach(a),Be=D(Ce),ge=_(Ce,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),J(ge)!=="svelte-1as0od8"&&(ge.textContent=Ue),Me=D(Ce),me=_(Ce,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ce.forEach(a),_t.forEach(a),ft.forEach(a),Re=D(le),Z&&Z.l(le),le.forEach(a),ct.forEach(a),this.h()},h(){E(n,"color","medium"),E(i,"slot","start"),E(h,"title",l[2].title),E(s,"strong",""),E(v,"slot","end"),E(e,"translucent",""),E(T,"icon",Ft),E(T,"slot","start"),E(ae,"icon",Vt),E(ae,"slot","start"),E(Ie,"label","Notas"),E(Ie,"placeholder","Escribe aquí..."),E(Ee,"icon",Kt),E(Ee,"slot","start"),V(ge,"for","eventEvidence"),F(ge,"padding","8px 10px"),F(me,"display","none"),V(me,"id","eventEvidence"),V(me,"name","fileToUpload"),V(me,"type","file"),V(me,"accept","image/*"),E(ue,"fill","outline"),E(ue,"class","loadEvidence"),E(ue,"expand","block"),V(ve,"for","eventEvidence"),F(ve,"display","block"),F(ve,"width","100%"),E(u,"fullscreen","")},m(j,W){U(j,e,W),o(e,t),o(t,i),o(i,n),o(t,d),o(t,h),o(h,O),o(t,I),o(t,v),o(v,s),U(j,g,W),U(j,u,W),o(u,c),o(c,N),o(N,T),o(N,S),o(N,A),o(A,P),o(A,M),o(A,H),o(H,R),o(c,y),te&&te.m(c,null),o(c,w),ie&&ie.m(c,null),o(c,z),X&&X.m(c,null),o(c,ee),x&&x.m(c,null),o(c,oe),ne&&ne.m(c,null),o(c,de),o(c,he),o(he,ae),o(he,ke),o(he,Ie),l[6](Ie),o(c,Se),o(c,Ne),o(Ne,ve),o(ve,ue),o(ue,Ee),o(ue,Be),o(ue,ge),o(ue,Me),o(ue,me),o(c,Re),Z&&Z.m(c,null),He||($e=[Y(n,"click",l[4]),Y(s,"click",l[5]),Y(me,"change",l[3])],He=!0)},p(j,[W]){te&&te.p(j,W),q&&ie.p(j,W),K&&X.p(j,W),j[2].driver_comments&&x.p(j,W),re&&ne.p(j,W),j[1]?Z?Z.p(j,W):(Z=mt(j),Z.c(),Z.m(c,null)):Z&&(Z.d(1),Z=null)},i:pe,o:pe,d(j){j&&(a(e),a(g),a(u)),te&&te.d(),ie&&ie.d(),X&&X.d(),x&&x.d(),ne&&ne.d(),l[6](null),Z&&Z.d(),He=!1,Ae($e)}}}function bn(l,e,t){let i=document.querySelector("ion-modal"),n=i.componentProps.delivery,r=i.componentProps.isLast,d=n.driver_comments?n.driver_comments:"",h=n.img?n.img:"",m="";const O=async u=>{const N=u.target.files[0],T=await I(N);if(T){const S=new FormData;S.append("fileToUpload",T);try{const A=await fetch("https://rutaflow-app-development.up.railway.app/api/admin/manager/upload_img_driver.php",{method:"POST",body:S});if(A.ok){const P=await A.json();t(1,h=P.img),m=P.img_id}else console.error("File upload failed:",A.statusText)}catch(A){console.error("Error during file upload:",A)}}},I=async u=>new Promise(c=>{const N=new FileReader;N.onload=T=>{const S=new Image;S.src=T.target.result,S.onload=()=>{const A=document.createElement("canvas"),P=A.getContext("2d"),C=800,M=600;let H=S.width,b=S.height;H>C&&(b*=C/H,H=C),b>M&&(H*=M/b,b=M),A.width=H,A.height=b,P.drawImage(S,0,0,H,b),A.toBlob(R=>{c(R)},"image/jpeg",.7)}},N.readAsDataURL(u)}),v=()=>{i.dismiss({data:Date.now()})},s=()=>{var u=new Object;u.id_route=n.id_route,u.id_event=n.id_event,u.comments=d.value,u.img=h,u.img_id=m;const c=new FormData;for(const N in u)c.append(N,u[N]);fetch("https://rutaflow-app-development.up.railway.app/api/admin/evidence/send_evidence.php",{method:"POST",body:c}).then(N=>N.json()).then(N=>{v();var T=u.id_route;r&&p("","",T,r)}).catch(N=>{console.error("Error fetching data:",N)})},p=(u,c,N,T)=>{i.componentProps.routeId=N,i.componentProps.driverId=n.id_driver,We("modal-km-gas",Dt,{checklist:u,driverId:c,routeId:N,isLast:T}).then(S=>{})};function g(u){be[u?"unshift":"push"](()=>{d=u,t(0,d)})}return[d,h,n,O,v,s,g]}class kn extends Je{constructor(e){super(),Ye(this,e,bn,gn,Xe,{})}}function vt(l,e,t){const i=l.slice();return i[26]=e[t],i}function gt(l,e,t){const i=l.slice();return i[26]=e[t],i[28]=t,i}function bt(l,e,t){const i=l.slice();return i[26]=e[t],i[28]=t,i}function kt(l){let e,t;return e=new Jt({props:{$$slots:{default:[yn]},$$scope:{ctx:l}}}),{c(){Rt(e.$$.fragment)},l(i){Ht(e.$$.fragment,i)},m(i,n){qt(e,i,n),t=!0},p(i,n){const r={};n[0]&127|n[1]&2&&(r.$$scope={dirty:n,ctx:i}),e.$set(r)},i(i){t||(je(e.$$.fragment,i),t=!0)},o(i){et(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}function In(l){let e=nt(l[0],"enroute")+"",t,i,n,r,d='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',h,m,O=[],I=new Map,v,s,p=Oe(l[3]);const g=u=>u[26].id_event;for(let u=0;u<p.length;u+=1){let c=vt(l,p,u),N=g(c);I.set(N,O[u]=Et(N,c))}return{c(){t=Q(e),i=L(),n=f("ion-content"),r=f("ion-refresher"),r.innerHTML=d,h=L(),m=f("ion-list");for(let u=0;u<O.length;u+=1)O[u].c();this.h()},l(u){t=$(u,e),i=D(u),n=_(u,"ION-CONTENT",{});var c=k(n);r=_(c,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(r)!=="svelte-1jkndk3"&&(r.innerHTML=d),h=D(c),m=_(c,"ION-LIST",{});var N=k(m);for(let T=0;T<O.length;T+=1)O[T].l(N);N.forEach(a),c.forEach(a),this.h()},h(){E(r,"slot","fixed")},m(u,c){U(u,t,c),U(u,i,c),U(u,n,c),o(n,r),l[19](r),o(n,h),o(n,m);for(let N=0;N<O.length;N+=1)O[N]&&O[N].m(m,null);v||(s=Y(r,"ionRefresh",l[7]),v=!0)},p(u,c){c[0]&1&&e!==(e=nt(u[0],"enroute")+"")&&ce(t,e),c[0]&5384&&(p=Oe(u[3]),O=Ze(O,c,g,1,u,p,I,m,Qe,Et,null,vt))},d(u){u&&(a(t),a(i),a(n)),l[19](null);for(let c=0;c<O.length;c+=1)O[c].d();v=!1,s()}}}function En(l){let e,t;function i(d,h){return h[0]&32&&(e=null),e==null&&(e=!!d[5].every(Cn)),e?Nn:On}let n=i(l,[-1,-1]),r=n(l);return{c(){r.c(),t=_e()},l(d){r.l(d),t=_e()},m(d,h){r.m(d,h),U(d,t,h)},p(d,h){n===(n=i(d,h))&&r?r.p(d,h):(r.d(1),r=n(d),r&&(r.c(),r.m(t.parentNode,t)))},d(d){d&&a(t),r.d(d)}}}function It(l){let e;return{c(){e=f("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),k(e).forEach(a),this.h()},h(){V(e,"class","notes svelte-ziybgw")},m(t,i){U(t,e,i)},d(t){t&&a(e)}}}function Et(l,e){let t,i,n,r,d=parseInt(e[26].pos)+1+"",h,m,O,I,v,s,p=e[26].title+"",g,u,c=e[26].support_list&&e[26].support_list.length||e[10](e[26]),N,T,S,A,P,C=c&&It();function M(){return e[20](e[26])}return{key:l,first:null,c(){t=f("ion-item"),i=f("ion-avatar"),n=f("div"),r=f("div"),h=Q(d),O=L(),I=f("ion-label"),v=f("ion-text"),s=f("h3"),g=Q(p),u=L(),C&&C.c(),N=L(),T=f("ion-icon"),S=L(),this.h()},l(H){t=_(H,"ION-ITEM",{});var b=k(t);i=_(b,"ION-AVATAR",{slot:!0});var R=k(i);n=_(R,"DIV",{class:!0,title:!0,style:!0});var y=k(n);r=_(y,"DIV",{class:!0});var w=k(r);h=$(w,d),w.forEach(a),y.forEach(a),R.forEach(a),O=D(b),I=_(b,"ION-LABEL",{button:!0});var q=k(I);v=_(q,"ION-TEXT",{color:!0});var z=k(v);s=_(z,"H3",{});var K=k(s);g=$(K,p),u=D(K),C&&C.l(K),K.forEach(a),z.forEach(a),q.forEach(a),N=D(b),T=_(b,"ION-ICON",{icon:!0,slot:!0,style:!0}),k(T).forEach(a),S=D(b),b.forEach(a),this.h()},h(){V(r,"class","order svelte-ziybgw"),V(n,"class","order-wrapper svelte-ziybgw"),V(n,"title",m=Le(e[26].status)),F(n,"background-color",fe(e[26])),F(n,"color",De(fe(e[26]))),E(i,"slot","start"),E(v,"color","#2e2e2e"),E(I,"button",""),E(T,"icon",Pe),E(T,"slot","end"),F(T,"color",fe(e[26])),this.first=t},m(H,b){U(H,t,b),o(t,i),o(i,n),o(n,r),o(r,h),o(t,O),o(t,I),o(I,v),o(v,s),o(s,g),o(s,u),C&&C.m(s,null),o(t,N),o(t,T),o(t,S),A||(P=Y(I,"click",M),A=!0)},p(H,b){e=H,b[0]&8&&d!==(d=parseInt(e[26].pos)+1+"")&&ce(h,d),b[0]&8&&m!==(m=Le(e[26].status))&&V(n,"title",m),b[0]&8&&F(n,"background-color",fe(e[26])),b[0]&8&&F(n,"color",De(fe(e[26]))),b[0]&8&&p!==(p=e[26].title+"")&&ce(g,p),b[0]&8&&(c=e[26].support_list&&e[26].support_list.length||e[10](e[26])),c?C||(C=It(),C.c(),C.m(s,null)):C&&(C.d(1),C=null),b[0]&8&&F(T,"color",fe(e[26]))},d(H){H&&a(t),C&&C.d(),A=!1,P()}}}function On(l){let e=l[9](l[5],l[1],l[0])+"",t,i,n,r,d='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',h,m,O=[],I=new Map,v,s,p=Oe(l[3]);const g=u=>u[26].id_event;for(let u=0;u<p.length;u+=1){let c=gt(l,p,u),N=g(c);I.set(N,O[u]=Nt(N,c))}return{c(){t=Q(e),i=L(),n=f("ion-content"),r=f("ion-refresher"),r.innerHTML=d,h=L(),m=f("ion-list");for(let u=0;u<O.length;u+=1)O[u].c();this.h()},l(u){t=$(u,e),i=D(u),n=_(u,"ION-CONTENT",{});var c=k(n);r=_(c,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(r)!=="svelte-1poui8g"&&(r.innerHTML=d),h=D(c),m=_(c,"ION-LIST",{});var N=k(m);for(let T=0;T<O.length;T+=1)O[T].l(N);N.forEach(a),c.forEach(a),this.h()},h(){E(r,"slot","fixed")},m(u,c){U(u,t,c),U(u,i,c),U(u,n,c),o(n,r),l[17](r),o(n,h),o(n,m);for(let N=0;N<O.length;N+=1)O[N]&&O[N].m(m,null);v||(s=Y(r,"ionRefresh",l[7]),v=!0)},p(u,c){c[0]&35&&e!==(e=u[9](u[5],u[1],u[0])+"")&&ce(t,e),c[0]&9480&&(p=Oe(u[3]),O=Ze(O,c,g,1,u,p,I,m,Qe,Nt,null,gt))},d(u){u&&(a(t),a(i),a(n)),l[17](null);for(let c=0;c<O.length;c+=1)O[c].d();v=!1,s()}}}function Nn(l){let e,t,i='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',n,r,d=[],h=new Map,m,O,I=Oe(l[3]);const v=s=>s[26].id_event;for(let s=0;s<I.length;s+=1){let p=bt(l,I,s),g=v(p);h.set(g,d[s]=Tt(g,p))}return{c(){e=f("ion-content"),t=f("ion-refresher"),t.innerHTML=i,n=L(),r=f("ion-list");for(let s=0;s<d.length;s+=1)d[s].c();this.h()},l(s){e=_(s,"ION-CONTENT",{});var p=k(e);t=_(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),J(t)!=="svelte-1poui8g"&&(t.innerHTML=i),n=D(p),r=_(p,"ION-LIST",{});var g=k(r);for(let u=0;u<d.length;u+=1)d[u].l(g);g.forEach(a),p.forEach(a),this.h()},h(){E(t,"slot","fixed")},m(s,p){U(s,e,p),o(e,t),l[15](t),o(e,n),o(e,r);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(r,null);m||(O=Y(t,"ionRefresh",l[7]),m=!0)},p(s,p){p[0]&9480&&(I=Oe(s[3]),d=Ze(d,p,v,1,s,I,h,r,Qe,Tt,null,bt))},d(s){s&&a(e),l[15](null);for(let p=0;p<d.length;p+=1)d[p].d();m=!1,O()}}}function Ot(l){let e;return{c(){e=f("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),k(e).forEach(a),this.h()},h(){V(e,"class","notes svelte-ziybgw")},m(t,i){U(t,e,i)},d(t){t&&a(e)}}}function Nt(l,e){let t,i,n,r,d=parseInt(e[26].pos)+1+"",h,m,O,I,v,s,p=e[26].title+"",g,u,c=e[26].support_list&&e[26].support_list.length||e[10](e[26]),N,T,S="",A,P,C,M,H,b=c&&Ot();function R(){return e[18](e[26],e[28])}return{key:l,first:null,c(){t=f("ion-item"),i=f("ion-avatar"),n=f("div"),r=f("div"),h=Q(d),O=L(),I=f("ion-label"),v=f("ion-text"),s=f("h3"),g=Q(p),u=L(),b&&b.c(),N=L(),T=f("div"),T.innerHTML=S,A=L(),P=f("ion-icon"),C=L(),this.h()},l(y){t=_(y,"ION-ITEM",{});var w=k(t);i=_(w,"ION-AVATAR",{slot:!0});var q=k(i);n=_(q,"DIV",{class:!0,title:!0,style:!0});var z=k(n);r=_(z,"DIV",{class:!0});var K=k(r);h=$(K,d),K.forEach(a),z.forEach(a),q.forEach(a),O=D(w),I=_(w,"ION-LABEL",{button:!0});var ee=k(I);v=_(ee,"ION-TEXT",{color:!0});var oe=k(v);s=_(oe,"H3",{});var re=k(s);g=$(re,p),u=D(re),b&&b.l(re),re.forEach(a),oe.forEach(a),N=D(ee),T=_(ee,"DIV",{class:!0,"data-svelte-h":!0}),J(T)!=="svelte-130ohbs"&&(T.innerHTML=S),ee.forEach(a),A=D(w),P=_(w,"ION-ICON",{icon:!0,slot:!0}),k(P).forEach(a),C=D(w),w.forEach(a),this.h()},h(){V(r,"class","order svelte-ziybgw"),V(n,"class","order-wrapper svelte-ziybgw"),V(n,"title",m=Le(e[26].status)),F(n,"background-color",fe(e[26])),F(n,"color",De(fe(e[26]))),E(i,"slot","start"),E(v,"color","#2e2e2e"),V(T,"class","sub svelte-ziybgw"),E(I,"button",""),E(P,"icon",Pe),E(P,"slot","end"),this.first=t},m(y,w){U(y,t,w),o(t,i),o(i,n),o(n,r),o(r,h),o(t,O),o(t,I),o(I,v),o(v,s),o(s,g),o(s,u),b&&b.m(s,null),o(I,N),o(I,T),o(t,A),o(t,P),o(t,C),M||(H=Y(I,"click",R),M=!0)},p(y,w){e=y,w[0]&8&&d!==(d=parseInt(e[26].pos)+1+"")&&ce(h,d),w[0]&8&&m!==(m=Le(e[26].status))&&V(n,"title",m),w[0]&8&&F(n,"background-color",fe(e[26])),w[0]&8&&F(n,"color",De(fe(e[26]))),w[0]&8&&p!==(p=e[26].title+"")&&ce(g,p),w[0]&8&&(c=e[26].support_list&&e[26].support_list.length||e[10](e[26])),c?b||(b=Ot(),b.c(),b.m(s,null)):b&&(b.d(1),b=null)},d(y){y&&a(t),b&&b.d(),M=!1,H()}}}function yt(l){let e;return{c(){e=f("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),k(e).forEach(a),this.h()},h(){V(e,"class","notes svelte-ziybgw")},m(t,i){U(t,e,i)},d(t){t&&a(e)}}}function Tt(l,e){let t,i,n,r,d=parseInt(e[26].pos)+1+"",h,m,O,I,v,s,p=e[26].title+"",g,u,c=e[26].support_list&&e[26].support_list.length||e[10](e[26]),N,T,S="",A,P,C,M,H,b=c&&yt();function R(){return e[16](e[26],e[28])}return{key:l,first:null,c(){t=f("ion-item"),i=f("ion-avatar"),n=f("div"),r=f("div"),h=Q(d),O=L(),I=f("ion-label"),v=f("ion-text"),s=f("h3"),g=Q(p),u=L(),b&&b.c(),N=L(),T=f("div"),T.innerHTML=S,A=L(),P=f("ion-icon"),C=L(),this.h()},l(y){t=_(y,"ION-ITEM",{});var w=k(t);i=_(w,"ION-AVATAR",{slot:!0});var q=k(i);n=_(q,"DIV",{class:!0,title:!0,style:!0});var z=k(n);r=_(z,"DIV",{class:!0});var K=k(r);h=$(K,d),K.forEach(a),z.forEach(a),q.forEach(a),O=D(w),I=_(w,"ION-LABEL",{button:!0});var ee=k(I);v=_(ee,"ION-TEXT",{color:!0});var oe=k(v);s=_(oe,"H3",{});var re=k(s);g=$(re,p),u=D(re),b&&b.l(re),re.forEach(a),oe.forEach(a),N=D(ee),T=_(ee,"DIV",{class:!0,"data-svelte-h":!0}),J(T)!=="svelte-130ohbs"&&(T.innerHTML=S),ee.forEach(a),A=D(w),P=_(w,"ION-ICON",{icon:!0,slot:!0}),k(P).forEach(a),C=D(w),w.forEach(a),this.h()},h(){V(r,"class","order svelte-ziybgw"),V(n,"class","order-wrapper svelte-ziybgw"),V(n,"title",m=Le(e[26].status)),F(n,"background-color",fe(e[26])),F(n,"color",De(fe(e[26]))),E(i,"slot","start"),E(v,"color","#2e2e2e"),V(T,"class","sub svelte-ziybgw"),E(I,"button",""),E(P,"icon",Pe),E(P,"slot","end"),this.first=t},m(y,w){U(y,t,w),o(t,i),o(i,n),o(n,r),o(r,h),o(t,O),o(t,I),o(I,v),o(v,s),o(s,g),o(s,u),b&&b.m(s,null),o(I,N),o(I,T),o(t,A),o(t,P),o(t,C),M||(H=Y(I,"click",R),M=!0)},p(y,w){e=y,w[0]&8&&d!==(d=parseInt(e[26].pos)+1+"")&&ce(h,d),w[0]&8&&m!==(m=Le(e[26].status))&&V(n,"title",m),w[0]&8&&F(n,"background-color",fe(e[26])),w[0]&8&&F(n,"color",De(fe(e[26]))),w[0]&8&&p!==(p=e[26].title+"")&&ce(g,p),w[0]&8&&(c=e[26].support_list&&e[26].support_list.length||e[10](e[26])),c?b||(b=yt(),b.c(),b.m(s,null)):b&&(b.d(1),b=null)},d(y){y&&a(t),b&&b.d(),M=!1,H()}}}function yn(l){let e,t,i,n,r=`<ion-icon icon="${Wt}"></ion-icon>`,d,h,m,O=l[2].name+"",I,v,s,p=l[4].name+"",g,u,c,N,T;function S(C,M){return C[5].length>0?En:In}let A=S(l),P=A(l);return{c(){e=f("ion-header"),t=f("ion-toolbar"),i=f("ion-buttons"),n=f("ion-button"),n.innerHTML=r,d=L(),h=f("ion-buttons"),m=f("ion-button"),I=Q(O),v=L(),s=f("ion-title"),g=Q(p),u=L(),P.c(),c=_e(),this.h()},l(C){e=_(C,"ION-HEADER",{translucent:!0});var M=k(e);t=_(M,"ION-TOOLBAR",{});var H=k(t);i=_(H,"ION-BUTTONS",{slot:!0});var b=k(i);n=_(b,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),J(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),b.forEach(a),d=D(H),h=_(H,"ION-BUTTONS",{slot:!0});var R=k(h);m=_(R,"ION-BUTTON",{});var y=k(m);I=$(y,O),y.forEach(a),R.forEach(a),v=D(H),s=_(H,"ION-TITLE",{});var w=k(s);g=$(w,p),w.forEach(a),H.forEach(a),M.forEach(a),u=D(C),P.l(C),c=_e(),this.h()},h(){E(n,"title","Atrás"),E(n,"alt","Atrás"),E(i,"slot","start"),E(h,"slot","secondary"),E(e,"translucent","")},m(C,M){U(C,e,M),o(e,t),o(t,i),o(i,n),o(t,d),o(t,h),o(h,m),o(m,I),o(t,v),o(t,s),o(s,g),U(C,u,M),P.m(C,M),U(C,c,M),N||(T=Y(n,"click",l[11]),N=!0)},p(C,M){M[0]&4&&O!==(O=C[2].name+"")&&ce(I,O),M[0]&16&&p!==(p=C[4].name+"")&&ce(g,p),A===(A=S(C))&&P?P.p(C,M):(P.d(1),P=A(C),P&&(P.c(),P.m(c.parentNode,c)))},d(C){C&&(a(e),a(u),a(c)),P.d(C),N=!1,T()}}}function Tn(l){let e,t,i,n=l[2]&&kt(l);return{c(){e=L(),n&&n.c(),t=_e(),this.h()},l(r){Bt("svelte-kn0kph",document.head).forEach(a),e=D(r),n&&n.l(r),t=_e(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,d){U(r,e,d),n&&n.m(r,d),U(r,t,d),i=!0},p(r,d){r[2]?n?(n.p(r,d),d[0]&4&&je(n,1)):(n=kt(r),n.c(),je(n,1),n.m(t.parentNode,t)):n&&(zt(),et(n,1,1,()=>{n=null}),Mt())},i(r){i||(je(n),i=!0)},o(r){et(n),i=!1},d(r){r&&(a(e),a(t)),n&&n.d(r)}}}function fe(l){let e="#ffffff";return l.status==="pending"?e="#f2e300":l.status==="completed"&&(e="#44d900"),e}function Le(l){let e="";return l=="pending"?e="Pendiente":l=="completed"&&(e="Completado"),e}function De(l){l.slice(0,1)==="#"&&(l=l.slice(1)),l.length===3&&(l=l.split("").map(function(r){return r+r}).join(""));const e=parseInt(l.substr(0,2),16),t=parseInt(l.substr(2,2),16),i=parseInt(l.substr(4,2),16);return(e*299+t*587+i*114)/1e3>=128?"#414040":"#fff"}function nt(l,e){let t=new FormData;return t.append("id_route",l),t.append("status",e),fetch("https://rutaflow-app-development.up.railway.app/api/admin/route/change_status.php",{method:"POST",body:t}).then(i=>i.json()).then(i=>{}).catch(i=>{console.error("Error fetching data:",i)}),""}const Cn=l=>l.img;function wn(l,e,t){let i;Ct(l,Xt,y=>t(14,i=y));var n=this&&this.__awaiter||function(y,w,q,z){function K(ee){return ee instanceof q?ee:new q(function(oe){oe(ee)})}return new(q||(q=Promise))(function(ee,oe){function re(ae){try{he(z.next(ae))}catch(ke){oe(ke)}}function de(ae){try{he(z.throw(ae))}catch(ke){oe(ke)}}function he(ae){ae.done?ee(ae.value):K(ae.value).then(re,de)}he((z=z.apply(y,w||[])).next())})};let{routeId:r}=e,{driverId:d}=e,h=new Object,m=[],O={},I={},v;const s=()=>n(void 0,void 0,void 0,function*(){yield p(r),v.complete()});function p(y){const w=new FormData;w.append("id_route",y),fetch("https://rutaflow-app-development.up.railway.app/api/admin/report/seguimiento_list.php",{method:"POST",body:w}).then(q=>q.json()).then(q=>{t(4,O=q.data.seguimiento_list[0]),t(3,m=q.data.event_list),t(5,I=q.data.checklist)}).catch(q=>{console.error("Error fetching data:",q)})}const g=y=>new Promise((w,q)=>{const z=new FormData;z.append("id_route",y.id_route),z.append("id_event",y.id_event),fetch("https://rutaflow-app-development.up.railway.app/api/admin/evidence/evidence_by_event.php",{method:"POST",body:z}).then(K=>K.json()).then(K=>{w(K.data.event_evidence[0])}).catch(K=>{console.error("Error fetching data:",K),q(K)})}),u=(y,w)=>{g(y).then(q=>{y.client_name=O.client_name,q&&(y.img=q.img,y.driver_comments=q.driver_comments,y.comments=q.comments),We("modal-delivery-info",kn,{delivery:y,isLast:w}).then(z=>{})})},c=(y,w,q)=>{var z=!1;return We("modal-checklist",Dt,{checklist:y,driverId:w,routeId:q,isLast:z}).then(K=>{}),nt(q,"checklist"),""},N=y=>{if(y.tracking_type=="subscription"){if(y.subscriber_info&&y.payment_type==="cash"&&new Date(y.subscriber_info.payment_next)<new Date)return!0}else if(y.tracking_type=="ecommerce"&&Number(y.payment_pending)>0)return!0;return!1},T=()=>{h.id_driver?ye(`/drivers/${h.id_driver}`):ye("/drivers/me")},S=(y,w)=>n(void 0,void 0,void 0,function*(){yield(yield Ge.create({header:y||"Error",message:w||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function A(y){return y===m.length-1}function P(y){be[y?"unshift":"push"](()=>{v=y,t(6,v)})}const C=(y,w)=>u(y,A(w));function M(y){be[y?"unshift":"push"](()=>{v=y,t(6,v)})}const H=(y,w)=>u(y,A(w));function b(y){be[y?"unshift":"push"](()=>{v=y,t(6,v)})}const R=y=>{const w=m.findIndex(oe=>oe.id_event===y.id_event),q=w===0,z=w>0?m[w-1]:null,K=q||z&&z.img!==null,ee=y.img!==null&&y.img!=="";K||q&&!ee?u(y):S("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return l.$$set=y=>{"routeId"in y&&t(0,r=y.routeId),"driverId"in y&&t(1,d=y.driverId)},l.$$.update=()=>{l.$$.dirty[0]&16389&&(t(0,{routeId:r,driverId:d}=i.params,r,(t(1,d),t(14,i),t(2,h),t(0,r))),t(2,h=JSON.parse(localStorage.getItem("userSession"))),h?h.id_user&&(h.type=="admin"||h.type=="superadmin")?(ye(`/drivers/me/routes/${r}`),p(r)):h.id_user&&h.id_driver&&(p(r),ye(`/drivers/${h.id_driver}/routes/${r}`)):ye("/"))},[r,d,h,m,O,I,v,s,u,c,N,T,S,A,i,P,C,M,H,b,R]}class Rn extends Je{constructor(e){super(),Ye(this,e,wn,Tn,Xe,{routeId:0,driverId:1},null,[-1,-1])}}export{Rn as component};
