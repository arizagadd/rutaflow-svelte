import{s as ue,j as H,k as Z,l as ce,h as p,m as B,i as M,p as fe,e as b,t as j,b as k,q as E,r as J,d as K,v as w,w as f,x as Q,y as W,z as de,A as ne,n as _e,f as F,B as Y,C as pe}from"../chunks/index.CdEBkEwf.js";import{S as he,i as me,t as X,a as x,c as ve,b as ge,d as be,m as ke,e as ye,g as Ie}from"../chunks/index.c2pjNB5R.js";import{g as Ee,l as Te,p as Oe,e as oe,u as Ne,d as Se}from"../chunks/index.aopo_RoW.js";import"../chunks/index-48209844.IIRtDZyg.js";import{I as Re,a as we,D as De}from"../chunks/IonPage.CBfnZD4Y.js";import{g as P}from"../chunks/entry.Bc598OuY.js";function ae(n,e,o){const a=n.slice();return a[20]=e[o],a}function se(n){let e,o;return e=new Re({props:{$$slots:{default:[Ce]},$$scope:{ctx:n}}}),{c(){ge(e.$$.fragment)},l(a){be(e.$$.fragment,a)},m(a,t){ke(e,a,t),o=!0},p(a,t){const i={};t&8388639&&(i.$$scope={dirty:t,ctx:a}),e.$set(i)},i(a){o||(X(e.$$.fragment,a),o=!0)},o(a){x(e.$$.fragment,a),o=!1},d(a){ye(e,a)}}}function Ae(n){let e,o='<ion-row class="h-full items-center"><ion-col class="text-center"><h2 class="text-3xl text-muted mb-4 svelte-1xh3ip">No hay rutas pendientes para hoy</h2> <p class="text-muted svelte-1xh3ip">Espere indicaciones de su supervisor</p></ion-col></ion-row>';return{c(){e=b("ion-grid"),e.innerHTML=o,this.h()},l(a){e=k(a,"ION-GRID",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-3d9uou"&&(e.innerHTML=o),this.h()},h(){w(e,"class","ion-text-center h-full")},m(a,t){M(a,e,t)},p:_e,d(a){a&&p(e)}}}function Le(n){let e=[],o=new Map,a,t=oe(n[1]);const i=s=>s[20].id_route;for(let s=0;s<t.length;s+=1){let c=ae(n,t,s),h=i(c);o.set(h,e[s]=ie(h,c))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();a=Z()},l(s){for(let c=0;c<e.length;c+=1)e[c].l(s);a=Z()},m(s,c){for(let h=0;h<e.length;h+=1)e[h]&&e[h].m(s,c);M(s,a,c)},p(s,c){c&386&&(t=oe(s[1]),e=Ne(e,c,i,1,s,t,o,a.parentNode,Se,ie,a,ae))},d(s){s&&p(a);for(let c=0;c<e.length;c+=1)e[c].d(s)}}}function ie(n,e){var z,u;let o,a,t,i,s=e[8]((z=e[20].name)==null?void 0:z.charAt(0))+"",c,h,v,N,S,d=((u=e[20].name)==null?void 0:u.toUpperCase())+"",g,T,O,y,I=e[20].date_start+"",A,D,R,C;return{key:n,first:null,c(){o=b("ion-item"),a=b("ion-avatar"),t=b("div"),i=b("div"),c=j(s),v=H(),N=b("ion-label"),S=b("h2"),g=j(d),T=H(),O=b("h3"),y=j("Inicio: "),A=j(I),D=H(),this.h()},l(m){o=k(m,"ION-ITEM",{button:!0});var l=E(o);a=k(l,"ION-AVATAR",{slot:!0});var r=E(a);t=k(r,"DIV",{class:!0,style:!0,title:!0});var _=E(t);i=k(_,"DIV",{class:!0});var L=E(i);c=J(L,s),L.forEach(p),_.forEach(p),r.forEach(p),v=B(l),N=k(l,"ION-LABEL",{});var U=E(N);S=k(U,"H2",{});var V=E(S);g=J(V,d),V.forEach(p),T=B(U),O=k(U,"H3",{class:!0});var q=E(O);y=J(q,"Inicio: "),A=J(q,I),q.forEach(p),U.forEach(p),D=B(l),l.forEach(p),this.h()},h(){F(i,"class","route-symbol svelte-1xh3ip"),F(t,"class","route-color svelte-1xh3ip"),Y(t,"background-color",$(e[20].status)),Y(t,"color",re($(e[20].status))),F(t,"title",h=le(e[20].status)),w(a,"slot","start"),F(O,"class","text-muted svelte-1xh3ip"),w(o,"button",""),this.first=o},m(m,l){M(m,o,l),f(o,a),f(a,t),f(t,i),f(i,c),f(o,v),f(o,N),f(N,S),f(S,g),f(N,T),f(N,O),f(O,y),f(O,A),f(o,D),R||(C=Q(o,"click",function(){pe(e[7](e[20].id_route,e[20].status))&&e[7](e[20].id_route,e[20].status).apply(this,arguments)}),R=!0)},p(m,l){var r,_;e=m,l&2&&s!==(s=e[8]((r=e[20].name)==null?void 0:r.charAt(0))+"")&&W(c,s),l&2&&Y(t,"background-color",$(e[20].status)),l&2&&Y(t,"color",re($(e[20].status))),l&2&&h!==(h=le(e[20].status))&&F(t,"title",h),l&2&&d!==(d=((_=e[20].name)==null?void 0:_.toUpperCase())+"")&&W(g,d),l&2&&I!==(I=e[20].date_start+"")&&W(A,I)},d(m){m&&p(o),R=!1,C()}}}function Ce(n){let e,o,a,t,i=n[0].name+"",s,c,h,v,N='<ion-select-option value="enroute">Rutas en curso</ion-select-option> <ion-select-option value="routes-of-day">Rutas del día</ion-select-option> <ion-select-option value="yesterday-routes">Rutas de ayer</ion-select-option> <ion-select-option value="week-routes">Rutas de la semana</ion-select-option>',S,d,g,T=`<ion-icon icon="${Te}"></ion-icon>`,O,y,I,A='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',D,R,C,z;function u(r,_){return r[2]?Le:Ae}let m=u(n),l=m(n);return{c(){e=b("ion-header"),o=b("ion-toolbar"),a=b("ion-buttons"),t=b("ion-button"),s=j(i),c=H(),h=b("ion-title"),v=b("ion-select"),v.innerHTML=N,S=H(),d=b("ion-buttons"),g=b("ion-button"),g.innerHTML=T,O=H(),y=b("ion-content"),I=b("ion-refresher"),I.innerHTML=A,D=H(),R=b("ion-list"),l.c(),this.h()},l(r){e=k(r,"ION-HEADER",{translucent:!0});var _=E(e);o=k(_,"ION-TOOLBAR",{});var L=E(o);a=k(L,"ION-BUTTONS",{slot:!0});var U=E(a);t=k(U,"ION-BUTTON",{});var V=E(t);s=J(V,i),V.forEach(p),U.forEach(p),c=B(L),h=k(L,"ION-TITLE",{});var q=E(h);v=k(q,"ION-SELECT",{id:!0,interface:!0,value:!0,"data-svelte-h":!0}),K(v)!=="svelte-znqezo"&&(v.innerHTML=N),q.forEach(p),S=B(L),d=k(L,"ION-BUTTONS",{slot:!0});var ee=E(d);g=k(ee,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),K(g)!=="svelte-83ekyc"&&(g.innerHTML=T),ee.forEach(p),L.forEach(p),_.forEach(p),O=B(r),y=k(r,"ION-CONTENT",{});var G=E(y);I=k(G,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),K(I)!=="svelte-1wkherr"&&(I.innerHTML=A),D=B(G),R=k(G,"ION-LIST",{});var te=E(R);l.l(te),te.forEach(p),G.forEach(p),this.h()},h(){w(a,"slot","start"),w(v,"id","quick-filter"),w(v,"interface","action-sheet"),w(v,"value","routes-of-day"),w(g,"title","Salir"),w(g,"alt","Salir"),w(d,"slot","end"),w(e,"translucent",""),w(I,"slot","fixed")},m(r,_){M(r,e,_),f(e,o),f(o,a),f(a,t),f(t,s),f(o,c),f(o,h),f(h,v),n[12](v),f(o,S),f(o,d),f(d,g),M(r,O,_),M(r,y,_),f(y,I),n[13](I),f(y,D),f(y,R),l.m(R,null),C||(z=[Q(v,"ionChange",n[6]),Q(g,"click",n[9]),Q(I,"ionRefresh",n[5])],C=!0)},p(r,_){_&1&&i!==(i=r[0].name+"")&&W(s,i),m===(m=u(r))&&l?l.p(r,_):(l.d(1),l=m(r),l&&(l.c(),l.m(R,null)))},d(r){r&&(p(e),p(O),p(y)),n[12](null),n[13](null),l.d(),C=!1,de(z)}}}function He(n){let e,o,a,t=n[0]&&se(n);return{c(){e=H(),t&&t.c(),o=Z(),this.h()},l(i){ce("svelte-qavk4j",document.head).forEach(p),e=B(i),t&&t.l(i),o=Z(),this.h()},h(){document.title="Rutas - Rutaflow"},m(i,s){M(i,e,s),t&&t.m(i,s),M(i,o,s),a=!0},p(i,[s]){i[0]?t?(t.p(i,s),s&1&&X(t,1)):(t=se(i),t.c(),X(t,1),t.m(o.parentNode,o)):t&&(Ie(),x(t,1,1,()=>{t=null}),ve())},i(i){a||(X(t),a=!0)},o(i){x(t),a=!1},d(i){i&&(p(e),p(o)),t&&t.d(i)}}}function $(n){let e="#ffffff";return n==="pending"?e="#FAD733":n==="completed"?e="#27C24C":n=="enroute"?e="#3BBAC2":n=="paused"?e="#949DB9":n=="cancelled"?e="#F05050":n=="checklist"?e="#F6A833":n=="checklist-pending"&&(e="#E98C00"),e}function le(n){let e="";return n==="pending"?e="Pendiente":n==="completed"?e="Completado":n=="enroute"?e="En ruta":n=="paused"?e="Pausado":n=="cancelled"?e="Cancelado":n=="checklist"?e="En checklist":n=="checklist-pending"&&(e="Pendiente de aprobar checklist"),e}function re(n){n.slice(0,1)==="#"&&(n=n.slice(1)),n.length===3&&(n=n.split("").map(function(i){return i+i}).join(""));const e=parseInt(n.substr(0,2),16),o=parseInt(n.substr(2,2),16),a=parseInt(n.substr(4,2),16);return(e*299+o*587+a*114)/1e3>=128?"#414040":"#fff"}function Be(){var n=new Date,e=n.getDate(),o=n.getMonth()+1,a=n.getFullYear(),t=a+"-"+o+"-"+e;return{today:t,year:a,month:o,date:n,day:e}}function Me(n,e,o){let a;fe(n,Oe,u=>o(11,a=u));let{driverId:t}=e,i=De,s=[],c=[],h=[],v=[],N=!1,S=!1,d=new Object,g,T="routes-of-day";const O=async()=>{await y(),g.complete()};function y(){const u={id_enterprise:d.id_enterprise||"null",id_user_over:d.id_user,token:d.token},m=(T==null?void 0:T.value)||T,l=Be();if(m==="enroute")u.status="enroute";else if(m==="routes-of-day")u.actual_date=l.today;else if(m==="yesterday-routes"){let r=new Date(l.date);r.setDate(r.getDate()-1),u.actual_date=r.toISOString().split("T")[0]}else if(m==="week-routes"){let r=new Date(l.date),_=l.date.getDay()===0?6:l.date.getDay()-1;r.setDate(l.date.getDate()-_),u.actual_date=r.toISOString().split("T")[0],u.actual_date2=l.today}Ee(`${i}api/admin/report/seguimiento_list.php`,function(r){s=r.data.seguimiento_list,c=r.data.event_list,t==="me"&&S?h=s:h=s.filter(_=>_.id_driver===t),o(1,v=h.filter(_=>_.status!=="completed"&&_.status!=="cancelled"&&_.status!=="finished")),o(2,N=v.length>0)},u)}function I(u,m){m=="checklist-pending"?D("Checklist Pendiente de Autorizar","La lista de requerimientos de ruta está en revisión, podrás inciar la ruta una vez autorizado el checklist."):P(`/drivers/${t}/routes/${u}`)}const A=u=>u.charAt(0).toUpperCase()+u.slice(1),D=async(u,m)=>{await(await we.create({header:u||"Error",message:m||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},R=()=>{P("/"),S=!1,localStorage.removeItem("userSession")};function C(u){ne[u?"unshift":"push"](()=>{T=u,o(4,T)})}function z(u){ne[u?"unshift":"push"](()=>{g=u,o(3,g)})}return n.$$set=u=>{"driverId"in u&&o(10,t=u.driverId)},n.$$.update=()=>{n.$$.dirty&3073&&(o(10,{driverId:t}=a.params,t),o(0,d=JSON.parse(localStorage.getItem("userSession"))),d?t=="me"&&d.id_user?d.type=="admin"||d.type=="super"?(P("/drivers/me"),y(),S=!0):(D("Usuario no autorizado","Este usuario no tiene acceso a la app de Rutaflow, entrar en contacto con soporte"),P("/")):d&&t&&(P(`/drivers/${d.id_driver}`),y(),console.log("Volví a entrar 2")):(D("Sesión cerrada","Será redireccionado para volver a ingresar"),P("/")))},[d,v,N,g,T,O,y,I,A,R,t,a,C,z]}class je extends he{constructor(e){super(),me(this,e,Me,He,ue,{driverId:10})}}export{je as component};
