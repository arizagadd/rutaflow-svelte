import{Z as ht,s as We,e as c,j as y,b as u,q as E,d as W,h as a,m as w,v as m,i as q,w as l,x as ee,n as Ie,z as He,_ as Kt,B as j,o as st,k as Pe,$ as pt,t as ae,r as se,f as G,a0 as xt,y as ke,a1 as $e,A as ye,a2 as at,l as Wt,p as Xt}from"../chunks/index.BzUyNcuj.js";import{S as Xe,i as Je,t as rt,a as ut,c as Jt,b as Yt,d as Zt,m as Qt,e as $t,g as en}from"../chunks/index.D9GPdhpm.js";import{e as De,u as tt,d as nt,a as tn,c as ft,b as zt,f as nn,g as on,i as Ft,h as ln,j as jt,s as mt,k as Ye,m as rn,n as an,o as sn,q as cn,p as un}from"../chunks/index.e_B4Tu42.js";import{g as je}from"../chunks/entry.CdckLQ9Z.js";import"../chunks/index-6e05b96e.C_9q9BoX.js";import{m as ot,a as et,I as fn}from"../chunks/IonPage.xQ4lM5iK.js";import{q as _n,t as dn}from"../chunks/ion-modal.BYMRzj9z.js";const hn=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},pn=function(i){return document.createElement(i).constructor!==HTMLElement},mn=(i,e)=>{pn(i)||hn(i,e)},Re=async(i,e,t)=>{_n(),dn(),mn(i,e);const o=await ot.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Ge=ht({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),Vt=ht({flag:[]});function vn(i){let e,t,o,n,r="Cancelar",h,_,b="Captura de Km/Gas",k,I,f,s="Confirmar",p,d,g,v,P,A,M;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=b,k=y(),I=c("ion-buttons"),f=c("ion-button"),f.textContent=s,p=y(),d=c("ion-content"),g=c("ion-item"),v=c("ion-input"),this.h()},l(C){e=u(C,"ION-HEADER",{translucent:!0});var L=E(e);t=u(L,"ION-TOOLBAR",{});var N=E(t);o=u(N,"ION-BUTTONS",{slot:!0});var S=E(o);n=u(S,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-17pq4f4"&&(n.textContent=r),S.forEach(a),h=w(N),_=u(N,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-1yhkaq7"&&(_.textContent=b),k=w(N),I=u(N,"ION-BUTTONS",{slot:!0});var T=E(I);f=u(T,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),W(f)!=="svelte-cm6j4s"&&(f.textContent=s),T.forEach(a),N.forEach(a),L.forEach(a),p=w(C),d=u(C,"ION-CONTENT",{fullscreen:!0});var O=E(d);g=u(O,"ION-ITEM",{});var B=E(g);v=u(B,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var z=E(v);z.forEach(a),B.forEach(a),O.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(f,"strong",""),m(I,"slot","end"),m(e,"translucent",""),m(v,"class","fin-km"),m(v,"inputmode","numeric"),m(v,"pattern","[0-9]*"),m(v,"type","number"),m(v,"placeholder",P="Ingresa "+i[0]+" actual"),m(v,"value",i[1]),m(v,"required",""),m(d,"fullscreen","")},m(C,L){q(C,e,L),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(t,k),l(t,I),l(I,f),q(C,p,L),q(C,d,L),l(d,g),l(g,v),A||(M=[ee(n,"click",i[2]),ee(f,"click",i[3]),ee(v,"input",i[4])],A=!0)},p(C,[L]){L&1&&P!==(P="Ingresa "+C[0]+" actual")&&m(v,"placeholder",P),L&2&&m(v,"value",C[1])},i:Ie,o:Ie,d(C){C&&(a(e),a(p),a(d)),A=!1,He(M)}}}function bn(i,e,t){const o=Kt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let h;Vt.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,h="kilometraje"):t(0,h="litros de gasolina")});let _=0;function b(){ot.dismiss()}function k(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Ge.update(s=>({...s,km_inicial:[_]})):r=="gas_inicial"?Ge.update(s=>({...s,gas_inicial:[_]})):r=="km_final"?Ge.update(s=>({...s,km_final:[_]})):r=="gas_final"&&Ge.update(s=>({...s,gas_final:[_]})),b()}return[h,_,b,k,f=>t(1,_=f.target.value)]}class gn extends Xe{constructor(e){super(),Je(this,e,bn,vn,We,{})}}const ct=ht({items:[],checkedIndices:[],mandatory:[]});function Et(i,e,t){const o=i.slice();return o[49]=e[t],o[50]=e,o[51]=t,o}function En(i){let e,t,o,n,r,h="Kilometraje inicial",_,b,k=i[0]?i[0]+" km.":"Cargar km",I,f,s,p,d,g,v,P="Gasolina inicial (litros)",A,M,C=i[1]?i[1]+" litros":"Cargar gas",L,N,S,T;return N=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=y(),r=c("p"),r.textContent=h,_=y(),b=c("ion-button"),I=ae(k),f=y(),s=c("ion-item"),p=c("ion-label"),d=c("input"),g=y(),v=c("p"),v.textContent=P,A=y(),M=c("ion-button"),L=ae(C),this.h()},l(O){e=u(O,"ION-ITEM",{});var B=E(e);t=u(B,"ION-LABEL",{style:!0});var z=E(t);o=u(z,"INPUT",{id:!0,style:!0,type:!0}),n=w(z),r=u(z,"P",{style:!0,"data-svelte-h":!0}),W(r)!=="svelte-88twxi"&&(r.textContent=h),z.forEach(a),_=w(B),b=u(B,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var D=E(b);I=se(D,k),D.forEach(a),B.forEach(a),f=w(O),s=u(O,"ION-ITEM",{});var R=E(s);p=u(R,"ION-LABEL",{style:!0});var V=E(p);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),g=w(V),v=u(V,"P",{style:!0,"data-svelte-h":!0}),W(v)!=="svelte-1ux30eb"&&(v.textContent=P),V.forEach(a),A=w(R),M=u(R,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var Z=E(M);L=se(Z,C),Z.forEach(a),R.forEach(a),this.h()},h(){G(o,"id","chkbox-km-ini"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-ini"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(v,"margin-left","10px"),j(p,"display","flex"),m(M,"fill","outline"),m(M,"class","loadGasInicial"),m(M,"size","small"),j(M,"height","16px "),N.p(o,d)},m(O,B){q(O,e,B),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[27](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,f,B),q(O,s,B),l(s,p),l(p,d),i[29](d),d.checked=~(i[4]||[]).indexOf(d.__value),l(p,g),l(p,v),l(s,A),l(s,M),l(M,L),S||(T=[ee(o,"change",i[26]),ee(b,"click",i[28]),ee(d,"change",i[30]),ee(M,"click",i[31])],S=!0)},p(O,B){B[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),B[0]&1&&k!==(k=O[0]?O[0]+" km.":"Cargar km")&&ke(I,k),B[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),B[0]&2&&C!==(C=O[1]?O[1]+" litros":"Cargar gas")&&ke(L,C)},d(O){O&&(a(e),a(f),a(s)),i[27](null),i[29](null),N.r(),S=!1,He(T)}}}function In(i){let e,t,o,n,r,h="Kilometraje final",_,b,k=i[2]?i[2]+" km.":"Cargar km",I,f,s,p,d,g,v,P="Gasolina final (litros)",A,M,C=i[3]?i[3]+" litros":"Cargar gas",L,N,S,T;return N=pt(i[20][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=y(),r=c("p"),r.textContent=h,_=y(),b=c("ion-button"),I=ae(k),f=y(),s=c("ion-item"),p=c("ion-label"),d=c("input"),g=y(),v=c("p"),v.textContent=P,A=y(),M=c("ion-button"),L=ae(C),this.h()},l(O){e=u(O,"ION-ITEM",{});var B=E(e);t=u(B,"ION-LABEL",{style:!0});var z=E(t);o=u(z,"INPUT",{id:!0,style:!0,type:!0}),n=w(z),r=u(z,"P",{style:!0,"data-svelte-h":!0}),W(r)!=="svelte-ccmu71"&&(r.textContent=h),z.forEach(a),_=w(B),b=u(B,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var D=E(b);I=se(D,k),D.forEach(a),B.forEach(a),f=w(O),s=u(O,"ION-ITEM",{});var R=E(s);p=u(R,"ION-LABEL",{style:!0});var V=E(p);d=u(V,"INPUT",{id:!0,style:!0,type:!0}),g=w(V),v=u(V,"P",{style:!0,"data-svelte-h":!0}),W(v)!=="svelte-wsoyd2"&&(v.textContent=P),V.forEach(a),A=w(R),M=u(R,"ION-BUTTON",{fill:!0,size:!0,class:!0});var Z=E(M);L=se(Z,C),Z.forEach(a),R.forEach(a),this.h()},h(){G(o,"id","chkbox-km-fin"),j(o,"pointer-events","auto"),G(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(b,"fill","outline"),m(b,"size","small"),m(b,"class","loadKmInicial"),m(b,"aria-selected",""),G(d,"id","chkbox-gas-fin"),j(d,"pointer-events","auto"),G(d,"type","checkbox"),d.required=!0,j(v,"margin-left","10px"),j(p,"display","flex"),m(M,"fill","outline"),m(M,"size","small"),m(M,"class","loadGasInicial"),N.p(o,d)},m(O,B){q(O,e,B),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[21](o),l(t,n),l(t,r),l(e,_),l(e,b),l(b,I),q(O,f,B),q(O,s,B),l(s,p),l(p,d),d.checked=~(i[4]||[]).indexOf(d.__value),i[24](d),l(p,g),l(p,v),l(s,A),l(s,M),l(M,L),S||(T=[ee(o,"change",i[19]),ee(b,"click",i[22]),ee(d,"change",i[23]),ee(M,"click",i[25])],S=!0)},p(O,B){B[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),B[0]&4&&k!==(k=O[2]?O[2]+" km.":"Cargar km")&&ke(I,k),B[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),B[0]&8&&C!==(C=O[3]?O[3]+" litros":"Cargar gas")&&ke(L,C)},d(O){O&&(a(e),a(f),a(s)),i[21](null),i[24](null),N.r(),S=!1,He(T)}}}function On(i){let e=[],t=new Map,o,n=De(i[12]);const r=h=>h[49].id_checklist_event;for(let h=0;h<n.length;h+=1){let _=Et(i,n,h),b=r(_);t.set(b,e[h]=It(b,_))}return{c(){for(let h=0;h<e.length;h+=1)e[h].c();o=Pe()},l(h){for(let _=0;_<e.length;_+=1)e[_].l(h);o=Pe()},m(h,_){for(let b=0;b<e.length;b+=1)e[b]&&e[b].m(h,_);q(h,o,_)},p(h,_){_[0]&202864&&(n=De(h[12]),e=tt(e,_,r,1,h,n,t,o.parentNode,nt,It,o,Et))},d(h){h&&a(o);for(let _=0;_<e.length;_+=1)e[_].d(h)}}}function It(i,e){let t,o,n,r=e[49],h,_,b=e[49].item+"",k,I,f,s,p=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"",d,g,v,P,A,M,C;const L=()=>e[33](n,r),N=()=>e[33](null,r);function S(){return e[34](e[49])}function T(...O){return e[36](e[49],...O)}return A=pt(e[20][0]),{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),h=y(),_=c("p"),k=ae(b),I=y(),f=c("ion-button"),s=c("label"),d=ae(p),g=y(),v=c("input"),P=y(),this.h()},l(O){t=u(O,"ION-ITEM",{});var B=E(t);o=u(B,"ION-LABEL",{style:!0});var z=E(o);n=u(z,"INPUT",{id:!0,style:!0,type:!0}),h=w(z),_=u(z,"P",{style:!0});var D=E(_);k=se(D,b),D.forEach(a),z.forEach(a),I=w(B),f=u(B,"ION-BUTTON",{fill:!0,class:!0,size:!0});var R=E(f);s=u(R,"LABEL",{for:!0});var V=E(s);d=se(V,p),V.forEach(a),g=w(R),v=u(R,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),R.forEach(a),P=w(B),B.forEach(a),this.h()},h(){G(n,"id",`chkbox-${e[49].id_checklist_event}`),j(n,"pointer-events","auto"),G(n,"type","checkbox"),n.__value=e[49].id_checklist_event,xt(n,n.__value),n.required=!0,j(_,"margin-left","10px"),j(o,"display","flex"),G(s,"for","chklist-"+e[49].id_checklist_event),j(v,"display","none"),G(v,"id","chklist-"+e[49].id_checklist_event),G(v,"name","fileToUpload"),G(v,"type","file"),G(v,"accept","image/*"),m(f,"fill","outline"),m(f,"class","loadEvidence svelte-1lh6nay"),m(f,"size","small"),A.p(n),this.first=t},m(O,B){q(O,t,B),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),L(),l(o,h),l(o,_),l(_,k),l(t,I),l(t,f),l(f,s),l(s,d),l(f,g),l(f,v),e[35](v),l(t,P),M||(C=[ee(n,"change",e[32]),ee(n,"change",S),ee(v,"change",T)],M=!0)},p(O,B){e=O,B[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[49]&&(N(),r=e[49],L()),B[0]&2048&&p!==(p=(e[11][e[49].id_checklist_event]?e[11][e[49].id_checklist_event]:"Cargar evidencia")+"")&&ke(d,p)},d(O){O&&a(t),N(),e[35](null),A.r(),M=!1,He(C)}}}function kn(i){let e,t,o,n,r="Cancelar",h,_,b="Requerimientos de ruta",k,I,f,s,p,d,g,v="Confirmar",P,A;function M(S,T){return S[13]?In:En}let L=M(i)(i),N=i[12]&&On(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=b,k=y(),I=c("ion-content"),f=c("ion-list"),L.c(),s=y(),N&&N.c(),p=y(),d=c("ion-footer"),g=c("ion-button"),g.textContent=v,this.h()},l(S){e=u(S,"ION-HEADER",{translucent:!0});var T=E(e);t=u(T,"ION-TOOLBAR",{});var O=E(t);o=u(O,"ION-BUTTONS",{slot:!0});var B=E(o);n=u(B,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1dnmkxs"&&(n.textContent=r),B.forEach(a),h=w(O),_=u(O,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-ucox25"&&(_.textContent=b),O.forEach(a),T.forEach(a),k=w(S),I=u(S,"ION-CONTENT",{fullscreen:!0});var z=E(I);f=u(z,"ION-LIST",{});var D=E(f);L.l(D),s=w(D),N&&N.l(D),D.forEach(a),z.forEach(a),p=w(S),d=u(S,"ION-FOOTER",{});var R=E(d);g=u(R,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(g)!=="svelte-g82qqw"&&(g.textContent=v),R.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(e,"translucent",""),m(I,"fullscreen",""),m(g,"fill","outline"),m(g,"color","tertiary"),m(g,"strong",""),j(g,"width","99%"),j(g,"height","auto")},m(S,T){q(S,e,T),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(S,k,T),q(S,I,T),l(I,f),L.m(f,null),l(f,s),N&&N.m(f,null),q(S,p,T),q(S,d,T),l(d,g),P||(A=[ee(n,"click",i[14]),ee(g,"click",i[15])],P=!0)},p(S,T){L.p(S,T),S[12]&&N.p(S,T)},i:Ie,o:Ie,d(S){S&&(a(e),a(k),a(I),a(p),a(d)),L.d(),N&&N.d(),P=!1,He(A)}}}function _t(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>_t(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function it(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://app.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function Nn(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,h=o.componentProps.routeId,_=o.componentProps.isLast;let b,k,I,f,s=[],p=null,d={},g,v,P,A,M={},C={};st(()=>{_?console.log("Último checklist"):ct.update(U=>(U.mandatory=_t(n,"mandatory"),U.items=_t(n,"id_checklist_event"),U))});const L=async()=>{await(await et.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},N=async()=>{await(await et.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},S=async U=>{await(await et.create({header:"Datos inválidos",message:U=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},T=()=>{ot.dismiss(),r?je(`/drivers/${r}`):je("/drivers/me")},O=()=>{if(_){var U=R(I,"km"),K=R(f,"gas");const _e=new FormData;_e.append("km_final",U),_e.append("gas_final",K),_e.append("id_route",h),U&&K?(T(),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:_e}).then(be=>be.json()).then(be=>{N()}).catch(be=>{console.error("Error fetching data:",be)})):L()}else{var le=R(b,"km"),fe=R(k,"gas");ct.update(_e=>{const be=_e.items,X=_e.mandatory;if(be.every($=>_e.checkedIndices.includes($))&&le&&fe){T();const $=new FormData;for(const oe in M)if(M.hasOwnProperty(oe)){const{img:Oe,img_id:te}=M[oe];$.append(`selectedImages[${oe}][img]`,Oe),$.append(`selectedImages[${oe}][img_id]`,te)}$.append("km_inicial",le),$.append("gas_inicial",fe),$.append("id_route",h),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:$}).then(oe=>oe.json()).then(oe=>{X&&X[0]=="1"?it(h,"checklist-pending"):it(h,"enroute")}).catch(oe=>{console.error("Error fetching data:",oe)})}else if(!X&&le&&fe){var Q=new FormData;Q.append("km_inicial",le),Q.append("gas_inicial",fe),fetch("https://app.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:Q}).then($=>$.json()).then($=>{it(h,"enroute"),console.log("Holaaa")}).catch($=>{console.error("Error fetching data:",$)})}else L();return _e})}H()},B=async(U,K)=>{const fe=U.target.files[0],_e=await z(fe);if(_e){const be=new FormData;be.append("fileToUpload",_e);try{const X=await fetch("https://app.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:be});if(X.ok){const x=await X.json();M={...M,[K]:{img:x.img,img_id:x.img_id}},t(11,C={...C,[K]:x.filename}),D(K),t(6,d[K].checked=!0,d)}else console.error("File upload failed:",X.statusText)}catch(X){console.error("Error during file upload:",X)}}},z=async U=>new Promise(K=>{const le=new FileReader;le.onload=fe=>{const _e=new Image;_e.src=fe.target.result,_e.onload=()=>{const be=document.createElement("canvas"),X=be.getContext("2d"),x=800,Q=600;let $=_e.width,oe=_e.height;$>x&&(oe*=x/$,$=x),oe>Q&&($*=Q/oe,oe=Q),be.width=$,be.height=oe,X.drawImage(_e,0,0,$,oe),be.toBlob(Oe=>{K(Oe)},"image/jpeg",.7)}},le.readAsDataURL(U)}),D=U=>{ct.update(K=>(K.checkedIndices.indexOf(U)===-1?K.checkedIndices.push(U):console.error(`ID ${U} is already checked.`),K.items.forEach(fe=>{fe.id_checklist_event===U&&(fe.checked=!0)}),K))};function R(U,K){return/^\d+$/.test(U)?parseInt(U,10):(S(K),null)}function V(U,K){Z(K),o.componentProps.data_type=K,Re("modal-gas-km",gn,{r:K}).then(()=>{Ge.subscribe(le=>{ne(le,K)})})}function Z(U){Vt.update(K=>({...K,flag:[U]}))}function ne(U,K){t(0,b=U.km_inicial?U.km_inicial:null),t(1,k=U.gas_inicial?U.gas_inicial:null),t(2,I=U.km_final?U.km_final:null),t(3,f=U.gas_final?U.gas_final:null),K=="km_inicial"&&t(7,g.checked=!0,g),K=="gas_inicial"&&t(8,v.checked=!0,v),K=="km_final"&&t(9,P.checked=!0,P),K=="gas_final"&&t(10,A.checked=!0,A)}function H(){Ge.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const F=[[]];function J(){s=$e(F[0],this.__value,this.checked),t(4,s)}function ie(U){ye[U?"unshift":"push"](()=>{P=U,t(9,P)})}const pe=U=>V(U,"km_final");function ue(){s=$e(F[0],this.__value,this.checked),t(4,s)}function he(U){ye[U?"unshift":"push"](()=>{A=U,t(10,A)})}const Ae=U=>V(U,"gas_final");function ge(){s=$e(F[0],this.__value,this.checked),t(4,s)}function Le(U){ye[U?"unshift":"push"](()=>{g=U,t(7,g)})}const me=U=>V(U,"km_inicial");function de(U){ye[U?"unshift":"push"](()=>{v=U,t(8,v)})}function ce(){s=$e(F[0],this.__value,this.checked),t(4,s)}const Ee=U=>V(U,"gas_inicial");function Ue(){s=$e(F[0],this.__value,this.checked),t(4,s)}function Te(U,K){ye[U?"unshift":"push"](()=>{d[K.id_checklist_event]=U,t(6,d)})}const Ce=U=>D(U.id_checklist_event);function Me(U){ye[U?"unshift":"push"](()=>{p=U,t(5,p)})}return[b,k,I,f,s,p,d,g,v,P,A,C,n,_,T,O,B,D,V,J,F,ie,pe,ue,he,Ae,ge,Le,me,de,ce,Ee,Ue,Te,Ce,Me,(U,K)=>B(K,U.id_checklist_event)]}class Gt extends Xe{constructor(e){super(),Je(this,e,Nn,kn,We,{},null,[-1,-1])}}function Tn(i){let e,t,o,n,r,h="Teléfono de cliente",_,b,k=i[4].client_phone+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(s),n=u(s,"ION-LABEL",{class:!0});var p=E(n);r=u(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1lg6bb9"&&(r.textContent=h),_=w(p),b=u(p,"H2",{});var d=E(b);I=se(d,k),d.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",nn),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href","tel:"+i[4].client_phone)},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Cn(i){let e,t,o,n,r,h="Domicilio 2",_,b,k=i[4].line2+"",I,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),f=y(),s=c("ion-icon"),this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(d),n=u(d,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1qy148r"&&(r.textContent=h),_=w(g),b=u(g,"H2",{});var v=E(b);I=se(v,k),v.forEach(a),g.forEach(a),f=w(d),s=u(d,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),d.forEach(a),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ye),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[4].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s)},p:Ie,d(p){p&&a(e)}}}function yn(i){let e,t,o,n,r,h="Domicilio 1",_,b,k=i[4].line1+"",I,f,s,p,d=i[4].line2&&i[4].line2.trim().length,g,v=d&&wn(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),f=y(),s=c("ion-icon"),p=y(),v&&v.c(),g=Pe(),this.h()},l(P){e=u(P,"ION-ITEM",{href:!0});var A=E(e);t=u(A,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(A),n=u(A,"ION-LABEL",{class:!0});var M=E(n);r=u(M,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1ehcrdm"&&(r.textContent=h),_=w(M),b=u(M,"H2",{});var C=E(b);I=se(C,k),C.forEach(a),M.forEach(a),f=w(A),s=u(A,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),A.forEach(a),p=w(P),v&&v.l(P),g=Pe(),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ye),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line1)},m(P,A){q(P,e,A),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s),q(P,p,A),v&&v.m(P,A),q(P,g,A)},p(P,A){d&&v.p(P,A)},d(P){P&&(a(e),a(p),a(g)),v&&v.d(P)}}}function wn(i){let e,t,o,n,r,h="Domicilio 2",_,b,k=i[4].line2+"",I,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),f=y(),s=c("ion-icon"),this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(d),n=u(d,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1qy148r"&&(r.textContent=h),_=w(g),b=u(g,"H2",{});var v=E(b);I=se(v,k),v.forEach(a),g.forEach(a),f=w(d),s=u(d,"ION-ICON",{icon:!0,slot:!0}),E(s).forEach(a),d.forEach(a),this.h()},h(){m(t,"icon",mt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(s,"icon",Ye),m(s,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[4].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I),l(e,f),l(e,s)},p:Ie,d(p){p&&a(e)}}}function Ot(i){let e,t,o,n,r,h="Llamar a",_,b,k,I,f,s;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),k=ae(i[2]),this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var d=E(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(d),n=u(d,"ION-LABEL",{class:!0});var g=E(n);r=u(g,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1jz4pau"&&(r.textContent=h),_=w(g),b=u(g,"H2",{});var v=E(b);k=se(v,i[2]),v.forEach(a),g.forEach(a),d.forEach(a),this.h()},h(){m(t,"icon",on),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href",I="tel:"+i[2])},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k),f||(s=ee(e,"click",i[5]),f=!0)},p(p,d){d&4&&ke(k,p[2]),d&4&&I!==(I="tel:"+p[2])&&m(e,"href",I)},d(p){p&&a(e),f=!1,s()}}}function kt(i){let e,t,o,n,r,h="Notas de ubicación",_,b,k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),k=ae(i[3]),this.h()},l(I){e=u(I,"ION-ITEM",{});var f=E(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(f),n=u(f,"ION-LABEL",{class:!0});var s=E(n);r=u(s,"P",{"data-svelte-h":!0}),W(r)!=="svelte-nhm2ft"&&(r.textContent=h),_=w(s),b=u(s,"H2",{});var p=E(b);k=se(p,i[3]),p.forEach(a),s.forEach(a),f.forEach(a),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(I,f){q(I,e,f),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,k)},p(I,f){f&8&&ke(k,I[3])},d(I){I&&a(e)}}}function Ln(i){let e,t,o,n,r,h="Horarios",_,b,k=i[4].schedule+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(s),n=u(s,"ION-LABEL",{});var p=E(n);r=u(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-11q7hm5"&&(r.textContent=h),_=w(p),b=u(p,"H2",{});var d=E(b);I=se(d,k),d.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",ln),m(t,"slot","start")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Pn(i){let e,t,o,n,r,h="Notas del operador",_,b,k=i[4].driver_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(s),n=u(s,"ION-LABEL",{});var p=E(n);r=u(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1yk9qp4"&&(r.textContent=h),_=w(p),b=u(p,"H2",{});var d=E(b);I=se(d,k),d.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",jt),m(t,"slot","start")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function An(i){let e,t=i[4].logistic_comments!="<br>"&&Bn(i);return{c(){t&&t.c(),e=Pe()},l(o){t&&t.l(o),e=Pe()},m(o,n){t&&t.m(o,n),q(o,e,n)},p(o,n){o[4].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&a(e),t&&t.d(o)}}}function Bn(i){let e,t,o,n,r,h="Comentarios logísticos",_,b,k=i[4].logistic_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=y(),n=c("ion-label"),r=c("p"),r.textContent=h,_=y(),b=c("h2"),I=ae(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var s=E(e);t=u(s,"ION-ICON",{icon:!0,slot:!0}),E(t).forEach(a),o=w(s),n=u(s,"ION-LABEL",{class:!0});var p=E(n);r=u(p,"P",{"data-svelte-h":!0}),W(r)!=="svelte-1iz85r6"&&(r.textContent=h),_=w(p),b=u(p,"H2",{});var d=E(b);I=se(d,k),d.forEach(a),p.forEach(a),s.forEach(a),this.h()},h(){m(t,"icon",Ft),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(f,s){q(f,e,s),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,b),l(b,I)},p:Ie,d(f){f&&a(e)}}}function Nt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){at(t.src,o=i[1])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&2&&!at(t.src,o=n[1])&&m(t,"src",o)},d(n){n&&a(e)}}}function Sn(i){let e,t,o,n,r="Cancelar",h,_,b=i[4].title+"",k,I,f,s,p="Confirmar",d,g,v,P,A,M,C,L,N="Cliente",S,T,O=i[4].client_name+"",B,z,D=i[4].client_phone&&i[4].client_phone.trim().length,R,V,Z,ne,H=i[4].schedule&&i[4].schedule.trim().length,F,J,ie=i[4].logistic_comments&&i[4].logistic_comments.trim().length,pe,ue,he,Ae,ge,Le,me,de,ce,Ee,Ue,Te,Ce="Subir Evidencia",Me,Ne,U,K,le,fe=D&&Tn(i);function _e(Y,ve){if(Y[4].line1&&Y[4].line1.trim().length)return yn;if(Y[4].line2&&Y[4].line2.trim().length)return Cn}let be=_e(i),X=be&&be(i),x=i[2]&&Ot(i),Q=i[3]&&i[3]!=="<br>"&&kt(i),$=H&&Ln(i),oe=i[4].driver_comments&&Pn(i),Oe=ie&&An(i),te=i[1]&&Nt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),k=ae(b),I=y(),f=c("ion-buttons"),s=c("ion-button"),s.textContent=p,d=y(),g=c("ion-content"),v=c("ion-list"),P=c("ion-item"),A=c("ion-icon"),M=y(),C=c("ion-label"),L=c("p"),L.textContent=N,S=y(),T=c("h2"),B=ae(O),z=y(),fe&&fe.c(),R=y(),X&&X.c(),V=y(),x&&x.c(),Z=y(),Q&&Q.c(),ne=y(),$&&$.c(),F=y(),oe&&oe.c(),J=y(),Oe&&Oe.c(),pe=y(),ue=c("ion-item"),he=c("ion-icon"),Ae=y(),ge=c("ion-textarea"),Le=y(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("ion-icon"),Ue=y(),Te=c("label"),Te.textContent=Ce,Me=y(),Ne=c("input"),U=y(),te&&te.c(),this.h()},l(Y){e=u(Y,"ION-HEADER",{translucent:!0});var ve=E(e);t=u(ve,"ION-TOOLBAR",{});var Be=E(t);o=u(Be,"ION-BUTTONS",{slot:!0});var Se=E(o);n=u(Se,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Se.forEach(a),h=w(Be),_=u(Be,"ION-TITLE",{title:!0});var qe=E(_);k=se(qe,b),qe.forEach(a),I=w(Be),f=u(Be,"ION-BUTTONS",{slot:!0});var Ze=E(f);s=u(Ze,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),W(s)!=="svelte-1ida0il"&&(s.textContent=p),Ze.forEach(a),Be.forEach(a),ve.forEach(a),d=w(Y),g=u(Y,"ION-CONTENT",{fullscreen:!0});var Qe=E(g);v=u(Qe,"ION-LIST",{});var re=E(v);P=u(re,"ION-ITEM",{});var ze=E(P);A=u(ze,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(a),M=w(ze),C=u(ze,"ION-LABEL",{});var Fe=E(C);L=u(Fe,"P",{"data-svelte-h":!0}),W(L)!=="svelte-jrq7ei"&&(L.textContent=N),S=w(Fe),T=u(Fe,"H2",{});var vt=E(T);B=se(vt,O),vt.forEach(a),Fe.forEach(a),ze.forEach(a),z=w(re),fe&&fe.l(re),R=w(re),X&&X.l(re),V=w(re),x&&x.l(re),Z=w(re),Q&&Q.l(re),ne=w(re),$&&$.l(re),F=w(re),oe&&oe.l(re),J=w(re),Oe&&Oe.l(re),pe=w(re),ue=u(re,"ION-ITEM",{});var lt=E(ue);he=u(lt,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(a),Ae=w(lt),ge=u(lt,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(a),lt.forEach(a),Le=w(re),me=u(re,"SECTION",{});var bt=E(me);de=u(bt,"LABEL",{for:!0,style:!0});var gt=E(de);ce=u(gt,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ve=E(ce);Ee=u(Ve,"ION-ICON",{icon:!0,slot:!0}),E(Ee).forEach(a),Ue=w(Ve),Te=u(Ve,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),W(Te)!=="svelte-1as0od8"&&(Te.textContent=Ce),Me=w(Ve),Ne=u(Ve,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ve.forEach(a),gt.forEach(a),bt.forEach(a),U=w(re),te&&te.l(re),re.forEach(a),Qe.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",i[4].title),m(s,"strong",""),m(f,"slot","end"),m(e,"translucent",""),m(A,"icon",tn),m(A,"slot","start"),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Notas"),m(ge,"placeholder","Escribe aquí..."),m(Ee,"icon",zt),m(Ee,"slot","start"),G(Te,"for","eventEvidence"),j(Te,"padding","8px 10px"),j(Ne,"display","none"),G(Ne,"id","eventEvidence"),G(Ne,"name","fileToUpload"),G(Ne,"type","file"),G(Ne,"accept","image/*"),m(ce,"fill","outline"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(g,"fullscreen","")},m(Y,ve){q(Y,e,ve),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,k),l(t,I),l(t,f),l(f,s),q(Y,d,ve),q(Y,g,ve),l(g,v),l(v,P),l(P,A),l(P,M),l(P,C),l(C,L),l(C,S),l(C,T),l(T,B),l(v,z),fe&&fe.m(v,null),l(v,R),X&&X.m(v,null),l(v,V),x&&x.m(v,null),l(v,Z),Q&&Q.m(v,null),l(v,ne),$&&$.m(v,null),l(v,F),oe&&oe.m(v,null),l(v,J),Oe&&Oe.m(v,null),l(v,pe),l(v,ue),l(ue,he),l(ue,Ae),l(ue,ge),i[9](ge),l(v,Le),l(v,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Ue),l(ce,Te),l(ce,Me),l(ce,Ne),l(v,U),te&&te.m(v,null),K||(le=[ee(n,"click",i[7]),ee(s,"click",i[8]),ee(Ne,"change",i[6])],K=!0)},p(Y,[ve]){D&&fe.p(Y,ve),X&&X.p(Y,ve),Y[2]?x?x.p(Y,ve):(x=Ot(Y),x.c(),x.m(v,Z)):x&&(x.d(1),x=null),Y[3]&&Y[3]!=="<br>"?Q?Q.p(Y,ve):(Q=kt(Y),Q.c(),Q.m(v,ne)):Q&&(Q.d(1),Q=null),H&&$.p(Y,ve),Y[4].driver_comments&&oe.p(Y,ve),ie&&Oe.p(Y,ve),Y[1]?te?te.p(Y,ve):(te=Nt(Y),te.c(),te.m(v,null)):te&&(te.d(1),te=null)},i:Ie,o:Ie,d(Y){Y&&(a(e),a(d),a(g)),fe&&fe.d(),X&&X.d(),x&&x.d(),Q&&Q.d(),$&&$.d(),oe&&oe.d(),Oe&&Oe.d(),i[9](null),te&&te.d(),K=!1,He(le)}}}const Tt=/Teléfono:\s*(\d{10,})/;function Dn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,h=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",b="",k={latitude:null,longitude:null},I="",f=n.comments_ext;if(n.comments_ext){const C=n.comments_ext.match(Tt);C&&(I=C[1],f=n.comments_ext.replace(Tt,"").trim())}function s(){I&&(window.location.href=`tel:${I}`)}const p=async C=>{const N=C.target.files[0],S=await d(N);if(S){const T=new FormData;T.append("fileToUpload",S);try{const O=await fetch("https://app.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:T});if(O.ok){const B=await O.json();t(1,_=B.img),b=B.img_id}else console.error("File upload failed:",O.statusText)}catch(O){console.error("Error during file upload:",O)}}},d=async C=>new Promise(L=>{const N=new FileReader;N.onload=S=>{const T=new Image;T.src=S.target.result,T.onload=()=>{const O=document.createElement("canvas"),B=O.getContext("2d"),z=800,D=600;let R=T.width,V=T.height;R>z&&(V*=z/R,R=z),V>D&&(R*=D/V,V=D),O.width=R,O.height=V,B.drawImage(T,0,0,R,V),O.toBlob(Z=>{L(Z)},"image/jpeg",.7)}},N.readAsDataURL(C)}),g=()=>{o.dismiss({data:Date.now()})},v=async()=>{try{const C=await A();if(console.log(C),C){const L={id_route:n.id_route,id_event:n.id_event,comments:h.value,img:_,img_id:b,lat:k.latitude,lon:k.longitude},N=new FormData;for(const z in L)N.append(z,L[z]);console.log(N);const T=await(await fetch("https://app.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:N})).json();g();const O={},B=L.id_route;r&&P("","",B,r)}else console.log("No entré")}catch(C){console.error("Error fetching data:",C)}},P=(C,L,N,S)=>{o.componentProps.routeId=N,o.componentProps.driverId=n.id_driver,Re("modal-km-gas",Gt,{checklist:C,driverId:L,routeId:N,isLast:S}).then(T=>{})},A=async()=>navigator.geolocation?new Promise((C,L)=>{navigator.geolocation.getCurrentPosition(N=>{k.latitude=N.coords.latitude,k.longitude=N.coords.longitude,C(!0)},N=>{console.error("Error getting location:",N),C(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);function M(C){ye[C?"unshift":"push"](()=>{h=C,t(0,h)})}return[h,_,I,f,n,s,p,g,v,M]}class Mn extends Xe{constructor(e){super(),Je(this,e,Dn,Sn,We,{})}}function Ct(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=E(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),E(t).forEach(a),r.forEach(a),this.h()},h(){at(t.src,o=i[0])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&1&&!at(t.src,o=n[0])&&m(t,"src",o)},d(n){n&&a(e)}}}function Hn(i){let e,t,o,n,r="Cancelar",h,_,b="Agregar Gasto",k,I,f,s,p,d,g,v,P,A,M,C,L,N,S,T,O,B,z='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',D,R,V="Efectivo",Z,ne,H="Tarjeta",F,J,ie="Transferencia",pe,ue,he,Ae,ge,Le,me,de,ce,Ee,Ue=`<ion-icon icon="${zt}" slot="start"></ion-icon>
                        Subir Evidencia`,Te,Ce,Me,Ne,U,K,le,fe="Confirmar",_e,be,X=i[0]&&Ct(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=y(),_=c("ion-title"),_.textContent=b,k=y(),I=c("ion-content"),f=c("ion-list"),s=c("ion-item"),p=c("ion-icon"),d=y(),g=c("ion-input"),v=y(),P=c("ion-item"),A=c("ion-icon"),M=y(),C=c("ion-input"),L=y(),N=c("ion-item"),S=c("ion-icon"),T=y(),O=c("ion-select"),B=c("div"),B.innerHTML=z,D=y(),R=c("ion-select-option"),R.textContent=V,Z=y(),ne=c("ion-select-option"),ne.textContent=H,F=y(),J=c("ion-select-option"),J.textContent=ie,pe=y(),ue=c("ion-item"),he=c("ion-icon"),Ae=y(),ge=c("ion-textarea"),Le=y(),me=c("section"),de=c("label"),ce=c("ion-button"),Ee=c("label"),Ee.innerHTML=Ue,Te=y(),Ce=c("input"),Me=y(),X&&X.c(),Ne=y(),U=c("ion-footer"),K=c("ion-toolbar"),le=c("ion-button"),le.textContent=fe,this.h()},l(x){e=u(x,"ION-HEADER",{translucent:!0});var Q=E(e);t=u(Q,"ION-TOOLBAR",{});var $=E(t);o=u($,"ION-BUTTONS",{slot:!0});var oe=E(o);n=u(oe,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-1f8rjcf"&&(n.textContent=r),oe.forEach(a),h=w($),_=u($,"ION-TITLE",{title:!0,"data-svelte-h":!0}),W(_)!=="svelte-10xvxus"&&(_.textContent=b),$.forEach(a),Q.forEach(a),k=w(x),I=u(x,"ION-CONTENT",{fullscreen:!0});var Oe=E(I);f=u(Oe,"ION-LIST",{});var te=E(f);s=u(te,"ION-ITEM",{});var Y=E(s);p=u(Y,"ION-ICON",{icon:!0,slot:!0}),E(p).forEach(a),d=w(Y),g=u(Y,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),E(g).forEach(a),Y.forEach(a),v=w(te),P=u(te,"ION-ITEM",{});var ve=E(P);A=u(ve,"ION-ICON",{icon:!0,slot:!0}),E(A).forEach(a),M=w(ve),C=u(ve,"ION-INPUT",{label:!0,type:!0,value:!0}),E(C).forEach(a),ve.forEach(a),L=w(te),N=u(te,"ION-ITEM",{});var Be=E(N);S=u(Be,"ION-ICON",{icon:!0,slot:!0}),E(S).forEach(a),T=w(Be),O=u(Be,"ION-SELECT",{placeholder:!0,value:!0});var Se=E(O);B=u(Se,"DIV",{slot:!0,"data-svelte-h":!0}),W(B)!=="svelte-wl764p"&&(B.innerHTML=z),D=w(Se),R=u(Se,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(R)!=="svelte-i9crym"&&(R.textContent=V),Z=w(Se),ne=u(Se,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(ne)!=="svelte-fx0z11"&&(ne.textContent=H),F=w(Se),J=u(Se,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),W(J)!=="svelte-1c24jf2"&&(J.textContent=ie),Se.forEach(a),Be.forEach(a),pe=w(te),ue=u(te,"ION-ITEM",{});var qe=E(ue);he=u(qe,"ION-ICON",{icon:!0,slot:!0}),E(he).forEach(a),Ae=w(qe),ge=u(qe,"ION-TEXTAREA",{label:!0,placeholder:!0}),E(ge).forEach(a),qe.forEach(a),Le=w(te),me=u(te,"SECTION",{});var Ze=E(me);de=u(Ze,"LABEL",{for:!0,style:!0});var Qe=E(de);ce=u(Qe,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var re=E(ce);Ee=u(re,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),W(Ee)!=="svelte-1m9yw22"&&(Ee.innerHTML=Ue),Te=w(re),Ce=u(re,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),re.forEach(a),Qe.forEach(a),Ze.forEach(a),Me=w(te),X&&X.l(te),te.forEach(a),Oe.forEach(a),Ne=w(x),U=u(x,"ION-FOOTER",{});var ze=E(U);K=u(ze,"ION-TOOLBAR",{});var Fe=E(K);le=u(Fe,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(le)!=="svelte-1c7dl3f"&&(le.textContent=fe),Fe.forEach(a),ze.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",""),m(e,"translucent",""),m(p,"icon",jt),m(p,"slot","start"),m(g,"label","Concepto"),m(g,"type","text"),m(g,"placeholder","Escribe aquí..."),m(g,"value",i[5]?i[5]:""),m(A,"icon",ft),m(A,"slot","start"),m(C,"label","Cantidad"),m(C,"type","number"),m(C,"value",i[6]?i[6]:""),m(S,"icon",rn),m(S,"slot","start"),G(B,"slot","label"),m(R,"value","cash"),m(ne,"value","card"),m(J,"value","transfer"),m(O,"placeholder","Tipo de pago"),m(O,"value",i[7]?i[7]:""),m(he,"icon",ft),m(he,"slot","start"),m(ge,"label","Comentarios"),m(ge,"placeholder","Escribe aquí..."),G(Ee,"for","eventEvidence"),j(Ee,"width","100%"),j(Ee,"padding","8px"),j(Ce,"display","none"),G(Ce,"id","eventEvidence"),G(Ce,"name","fileToUpload"),G(Ce,"type","file"),G(Ce,"accept","image/*"),m(ce,"fill","outline"),m(ce,"size","small"),m(ce,"class","loadEvidence"),m(ce,"expand","block"),G(de,"for","eventEvidence"),j(de,"display","block"),j(de,"width","100%"),m(I,"fullscreen",""),m(le,"fill","outline"),m(le,"color","tertiary"),m(le,"strong",""),j(le,"width","99%"),j(le,"height","auto")},m(x,Q){q(x,e,Q),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(x,k,Q),q(x,I,Q),l(I,f),l(f,s),l(s,p),l(s,d),l(s,g),i[11](g),l(f,v),l(f,P),l(P,A),l(P,M),l(P,C),i[12](C),l(f,L),l(f,N),l(N,S),l(N,T),l(N,O),l(O,B),l(O,D),l(O,R),l(O,Z),l(O,ne),l(O,F),l(O,J),i[13](O),l(f,pe),l(f,ue),l(ue,he),l(ue,Ae),l(ue,ge),i[14](ge),l(f,Le),l(f,me),l(me,de),l(de,ce),l(ce,Ee),l(ce,Te),l(ce,Ce),l(f,Me),X&&X.m(f,null),q(x,Ne,Q),q(x,U,Q),l(U,K),l(K,le),_e||(be=[ee(n,"click",i[9]),ee(Ce,"change",i[8]),ee(le,"click",i[10])],_e=!0)},p(x,[Q]){x[0]?X?X.p(x,Q):(X=Ct(x),X.c(),X.m(f,null)):X&&(X.d(1),X=null)},i:Ie,o:Ie,d(x){x&&(a(e),a(k),a(I),a(Ne),a(U)),i[11](null),i[12](null),i[13](null),i[14](null),X&&X.d(),_e=!1,He(be)}}}function Un(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,h=o.componentProps.ex_amount,_=o.componentProps.ex_type,b=o.componentProps.id_expense,k="",I="",f="",s=0,p="",d="";st(()=>{});const g=async(T,O)=>{await(await et.create({header:T,message:O,buttons:[{text:"Cerrar"}]})).present()},v=async T=>{const B=T.target.files[0],z=await P(B);if(z){const D=new FormData;D.append("fileToUpload",z);try{const R=await fetch("https://app.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:D});if(R.ok){const V=await R.json();t(0,k=V.img),I=V.img_id}else console.error("File upload failed:",R.statusText)}catch(R){console.error("Error during file upload:",R)}}},P=async T=>new Promise(O=>{const B=new FileReader;B.onload=z=>{const D=new Image;D.src=z.target.result,D.onload=()=>{const R=document.createElement("canvas"),V=R.getContext("2d"),Z=800,ne=600;let H=D.width,F=D.height;H>Z&&(F*=Z/H,H=Z),F>ne&&(H*=ne/F,F=ne),R.width=H,R.height=F,V.drawImage(D,0,0,H,F),R.toBlob(J=>{O(J)},"image/jpeg",.7)}},B.readAsDataURL(T)}),A=()=>{ot.dismiss()},M=()=>{var T=new Object;T.id_route=n,T.comments=p.value,T.type=f.value,T.img=k,T.img_id=I,T.amount=s.value,T.concept=d.value,T.status="done",T.id_expense=b||"null";const O=new FormData;for(const B in T)O.append(B,T[B]);!I||!k||!p.value||!s.value||!d.value?g("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://app.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:O}).then(B=>B.json()).then(B=>{A()}).catch(B=>{console.error("Error fetching data:",B)})};function C(T){ye[T?"unshift":"push"](()=>{d=T,t(4,d)})}function L(T){ye[T?"unshift":"push"](()=>{s=T,t(2,s)})}function N(T){ye[T?"unshift":"push"](()=>{f=T,t(1,f)})}function S(T){ye[T?"unshift":"push"](()=>{p=T,t(3,p)})}return[k,f,s,p,d,r,h,_,v,A,M,C,L,N,S]}class dt extends Xe{constructor(e){super(),Je(this,e,Un,Hn,We,{})}}function yt(i,e,t){const o=i.slice();return o[7]=e[t],o}function Rn(i){let e,t="Cargar gasto",o,n;function r(...h){return i[4](i[7],...h)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(h){e=u(h,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),W(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){m(e,"fill","outline"),m(e,"size","small"),m(e,"aria-selected","")},m(h,_){q(h,e,_),o||(n=ee(e,"click",r),o=!0)},p(h,_){i=h},d(h){h&&a(e),o=!1,n()}}}function qn(i){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),W(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){m(e,"fill","solid"),m(e,"size","small"),m(e,"aria-selected","")},m(o,n){q(o,e,n)},p:Ie,d(o){o&&a(e)}}}function wt(i,e){let t,o,n,r=e[7].concept+"",h,_,b;function k(s,p){return s[7].status=="done"?qn:Rn}let f=k(e)(e);return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),h=ae(r),_=y(),f.c(),b=y(),this.h()},l(s){t=u(s,"ION-ITEM",{});var p=E(t);o=u(p,"ION-LABEL",{style:!0});var d=E(o);n=u(d,"P",{style:!0});var g=E(n);h=se(g,r),g.forEach(a),d.forEach(a),_=w(p),f.l(p),b=w(p),p.forEach(a),this.h()},h(){j(n,"margin-left","10px"),j(o,"display","flex"),this.first=t},m(s,p){q(s,t,p),l(t,o),l(o,n),l(n,h),l(t,_),f.m(t,null),l(t,b)},p(s,p){e=s,f.p(e,p)},d(s){s&&a(t),f.d()}}}function zn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${an}"></ion-icon>`,h,_,b="Lista de gastos",k,I,f,s=[],p=new Map,d,g,v,P="Cerrar",A,M,C=De(i[0]);const L=N=>N[7].id_expenses;for(let N=0;N<C.length;N+=1){let S=yt(i,C,N),T=L(S);p.set(T,s[N]=wt(T,S))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=y(),_=c("ion-title"),_.textContent=b,k=y(),I=c("ion-content"),f=c("ion-list");for(let N=0;N<s.length;N+=1)s[N].c();d=y(),g=c("ion-footer"),v=c("ion-button"),v.textContent=P,this.h()},l(N){e=u(N,"ION-HEADER",{translucent:!0});var S=E(e);t=u(S,"ION-TOOLBAR",{});var T=E(t);o=u(T,"ION-BUTTONS",{slot:!0});var O=E(o);n=u(O,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),W(n)!=="svelte-160xz3i"&&(n.innerHTML=r),O.forEach(a),h=w(T),_=u(T,"ION-TITLE",{"data-svelte-h":!0}),W(_)!=="svelte-e3wnox"&&(_.textContent=b),T.forEach(a),S.forEach(a),k=w(N),I=u(N,"ION-CONTENT",{fullscreen:!0});var B=E(I);f=u(B,"ION-LIST",{});var z=E(f);for(let R=0;R<s.length;R+=1)s[R].l(z);z.forEach(a),B.forEach(a),d=w(N),g=u(N,"ION-FOOTER",{});var D=E(g);v=u(D,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),W(v)!=="svelte-zv7v83"&&(v.textContent=P),D.forEach(a),this.h()},h(){m(n,"color","medium"),m(o,"slot","end"),m(e,"translucent",""),m(I,"fullscreen",""),m(v,"fill","outline"),m(v,"color","tertiary"),m(v,"strong",""),j(v,"width","99%"),j(v,"height","auto")},m(N,S){q(N,e,S),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(N,k,S),q(N,I,S),l(I,f);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(f,null);q(N,d,S),q(N,g,S),l(g,v),A||(M=[ee(n,"click",i[3]),ee(v,"click",i[1])],A=!0)},p(N,[S]){S&5&&(C=De(N[0]),s=tt(s,S,L,1,N,C,p,f,nt,wt,null,yt))},i:Ie,o:Ie,d(N){N&&(a(e),a(k),a(I),a(d),a(g));for(let S=0;S<s.length;S+=1)s[S].d();A=!1,He(M)}}}function Fn(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;st(()=>{});const o=()=>{ot.dismiss()};function n(_,b,k,I,f){e.componentProps.ex_amount=k,e.componentProps.ex_concept=b,e.componentProps.ex_type=I,e.componentProps.id_expense=f,Re("modal-expense",dt,{amount:k,concept:b,type:I,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{Re("modal-expense",dt,{routeId:_}).then(b=>{}),o()},(_,b)=>n(b,_.concept,_.amount,_.type,_.id_expenses)]}class jn extends Xe{constructor(e){super(),Je(this,e,Fn,zn,We,{})}}function Lt(i,e,t){const o=i.slice();return o[30]=e[t],o}function Pt(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function At(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Bt(i){let e,t;return e=new fn({props:{$$slots:{default:[Wn]},$$scope:{ctx:i}}}),{c(){Yt(e.$$.fragment)},l(o){Zt(e.$$.fragment,o)},m(o,n){Qt(e,o,n),t=!0},p(o,n){const r={};n[0]&507|n[1]&32&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(rt(e.$$.fragment,o),t=!0)},o(o){ut(e.$$.fragment,o),t=!1},d(o){$t(e,o)}}}function Vn(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,h,_=[],b=new Map,k,I,f=i[4]&&St(i),s=De(i[5]);const p=d=>d[30].id_event;for(let d=0;d<s.length;d+=1){let g=Lt(i,s,d),v=p(g);b.set(v,_[d]=Mt(v,g))}return{c(){f&&f.c(),e=y(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=y(),h=c("ion-list");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){f&&f.l(d),e=w(d),t=u(d,"ION-CONTENT",{});var g=E(t);o=u(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(o)!=="svelte-19e7x43"&&(o.innerHTML=n),r=w(g),h=u(g,"ION-LIST",{});var v=E(h);for(let P=0;P<_.length;P+=1)_[P].l(v);v.forEach(a),g.forEach(a),this.h()},h(){m(o,"slot","fixed")},m(d,g){f&&f.m(d,g),q(d,e,g),q(d,t,g),l(t,o),i[23](o),l(t,r),l(t,h);for(let v=0;v<_.length;v+=1)_[v]&&_[v].m(h,null);k||(I=ee(o,"ionRefresh",i[9]),k=!0)},p(d,g){d[4]?f?f.p(d,g):(f=St(d),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),g[0]&42016&&(s=De(d[5]),_=tt(_,g,p,1,d,s,b,h,nt,Mt,null,Lt))},d(d){d&&(a(e),a(t)),f&&f.d(d),i[23](null);for(let g=0;g<_.length;g+=1)_[g].d();k=!1,I()}}}function Gn(i){let e,t;function o(h,_){return _[0]&128&&(e=null),e==null&&(e=!!h[7].every(Yn)),e?xn:Kn}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Pe()},l(h){r.l(h),t=Pe()},m(h,_){r.m(h,_),q(h,t,_)},p(h,_){n===(n=o(h,_))&&r?r.p(h,_):(r.d(1),r=n(h),r&&(r.c(),r.m(t.parentNode,t)))},d(h){h&&a(t),r.d(h)}}}function St(i){let e=i[11]("",i[1],i[0])+"",t;return{c(){t=ae(e)},l(o){t=se(o,e)},m(o,n){q(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[11]("",o[1],o[0])+"")&&ke(t,e)},d(o){o&&a(t)}}}function Dt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function Mt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,f,s,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),P,A,M,C,L,N=v&&Dt();function S(){return e[24](e[30])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),k=y(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(p),g=y(),N&&N.c(),P=y(),A=c("ion-icon"),M=y(),this.h()},l(T){t=u(T,"ION-ITEM",{});var O=E(t);o=u(O,"ION-AVATAR",{slot:!0});var B=E(o);n=u(B,"DIV",{class:!0,title:!0,style:!0});var z=E(n);r=u(z,"DIV",{class:!0});var D=E(r);_=se(D,h),D.forEach(a),z.forEach(a),B.forEach(a),k=w(O),I=u(O,"ION-LABEL",{button:!0});var R=E(I);f=u(R,"ION-TEXT",{color:!0});var V=E(f);s=u(V,"H3",{});var Z=E(s);d=se(Z,p),g=w(Z),N&&N.l(Z),Z.forEach(a),V.forEach(a),R.forEach(a),P=w(O),A=u(O,"ION-ICON",{icon:!0,slot:!0,style:!0}),E(A).forEach(a),M=w(O),O.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",xe(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),m(I,"button",""),m(A,"icon",Ye),m(A,"slot","end"),j(A,"color",we(e[30])),this.first=t},m(T,O){q(T,t,O),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,s),l(s,d),l(s,g),N&&N.m(s,null),l(t,P),l(t,A),l(t,M),C||(L=ee(I,"click",S),C=!0)},p(T,O){e=T,O[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),O[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),O[0]&32&&j(n,"background-color",we(e[30])),O[0]&32&&j(n,"color",xe(we(e[30]))),O[0]&32&&p!==(p=e[30].title+"")&&ke(d,p),O[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?N||(N=Dt(),N.c(),N.m(s,null)):N&&(N.d(1),N=null),O[0]&32&&j(A,"color",we(e[30]))},d(T){T&&a(t),N&&N.d(),C=!1,L()}}}function Kn(i){let e=i[11](i[7],i[1],i[0])+"",t,o,n,r,h='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,b,k=[],I=new Map,f,s,p=De(i[5]);const d=g=>g[30].id_event;for(let g=0;g<p.length;g+=1){let v=Pt(i,p,g),P=d(v);I.set(P,k[g]=Ut(P,v))}return{c(){t=ae(e),o=y(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=h,_=y(),b=c("ion-list");for(let g=0;g<k.length;g+=1)k[g].c();this.h()},l(g){t=se(g,e),o=w(g),n=u(g,"ION-CONTENT",{});var v=E(n);r=u(v,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(r)!=="svelte-1poui8g"&&(r.innerHTML=h),_=w(v),b=u(v,"ION-LIST",{});var P=E(b);for(let A=0;A<k.length;A+=1)k[A].l(P);P.forEach(a),v.forEach(a),this.h()},h(){m(r,"slot","fixed")},m(g,v){q(g,t,v),q(g,o,v),q(g,n,v),l(n,r),i[21](r),l(n,_),l(n,b);for(let P=0;P<k.length;P+=1)k[P]&&k[P].m(b,null);f||(s=ee(r,"ionRefresh",i[9]),f=!0)},p(g,v){v[0]&131&&e!==(e=g[11](g[7],g[1],g[0])+"")&&ke(t,e),v[0]&74784&&(p=De(g[5]),k=tt(k,v,d,1,g,p,I,b,nt,Ut,null,Pt))},d(g){g&&(a(t),a(o),a(n)),i[21](null);for(let v=0;v<k.length;v+=1)k[v].d();f=!1,s()}}}function xn(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,h=[],_=new Map,b,k,I=De(i[5]);const f=s=>s[30].id_event;for(let s=0;s<I.length;s+=1){let p=At(i,I,s),d=f(p);_.set(d,h[s]=qt(d,p))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=y(),r=c("ion-list");for(let s=0;s<h.length;s+=1)h[s].c();this.h()},l(s){e=u(s,"ION-CONTENT",{});var p=E(e);t=u(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),W(t)!=="svelte-1t1tzpj"&&(t.innerHTML=o),n=w(p),r=u(p,"ION-LIST",{});var d=E(r);for(let g=0;g<h.length;g+=1)h[g].l(d);d.forEach(a),p.forEach(a),this.h()},h(){m(t,"slot","fixed")},m(s,p){q(s,e,p),l(e,t),i[19](t),l(e,n),l(e,r);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(r,null);b||(k=ee(t,"ionRefresh",i[9]),b=!0)},p(s,p){p[0]&74784&&(I=De(s[5]),h=tt(h,p,f,1,s,I,_,r,nt,qt,null,At))},d(s){s&&a(e),i[19](null);for(let p=0;p<h.length;p+=1)h[p].d();b=!1,k()}}}function Ht(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function Ut(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,f,s,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),P,A,M="",C,L,N,S,T,O=v&&Ht();function B(){return e[22](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),k=y(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(p),g=y(),O&&O.c(),P=y(),A=c("div"),A.innerHTML=M,C=y(),L=c("ion-icon"),N=y(),this.h()},l(z){t=u(z,"ION-ITEM",{});var D=E(t);o=u(D,"ION-AVATAR",{slot:!0});var R=E(o);n=u(R,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var Z=E(r);_=se(Z,h),Z.forEach(a),V.forEach(a),R.forEach(a),k=w(D),I=u(D,"ION-LABEL",{button:!0});var ne=E(I);f=u(ne,"ION-TEXT",{color:!0});var H=E(f);s=u(H,"H3",{});var F=E(s);d=se(F,p),g=w(F),O&&O.l(F),F.forEach(a),H.forEach(a),P=w(ne),A=u(ne,"DIV",{class:!0,"data-svelte-h":!0}),W(A)!=="svelte-130ohbs"&&(A.innerHTML=M),ne.forEach(a),C=w(D),L=u(D,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(a),N=w(D),D.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",xe(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(A,"class","sub svelte-ziybgw"),m(I,"button",""),m(L,"icon",Ye),m(L,"slot","end"),this.first=t},m(z,D){q(z,t,D),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,s),l(s,d),l(s,g),O&&O.m(s,null),l(I,P),l(I,A),l(t,C),l(t,L),l(t,N),S||(T=ee(I,"click",B),S=!0)},p(z,D){e=z,D[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),D[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),D[0]&32&&j(n,"background-color",we(e[30])),D[0]&32&&j(n,"color",xe(we(e[30]))),D[0]&32&&p!==(p=e[30].title+"")&&ke(d,p),D[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?O||(O=Ht(),O.c(),O.m(s,null)):O&&(O.d(1),O=null)},d(z){z&&a(t),O&&O.d(),S=!1,T()}}}function Rt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),E(e).forEach(a),this.h()},h(){G(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&a(e)}}}function qt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,b,k,I,f,s,p=e[30].title+"",d,g,v=e[30].support_list&&e[30].support_list.length||e[13](e[30]),P,A,M="",C,L,N,S,T,O=v&&Rt();function B(){return e[20](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=ae(h),k=y(),I=c("ion-label"),f=c("ion-text"),s=c("h3"),d=ae(p),g=y(),O&&O.c(),P=y(),A=c("div"),A.innerHTML=M,C=y(),L=c("ion-icon"),N=y(),this.h()},l(z){t=u(z,"ION-ITEM",{});var D=E(t);o=u(D,"ION-AVATAR",{slot:!0});var R=E(o);n=u(R,"DIV",{class:!0,title:!0,style:!0});var V=E(n);r=u(V,"DIV",{class:!0});var Z=E(r);_=se(Z,h),Z.forEach(a),V.forEach(a),R.forEach(a),k=w(D),I=u(D,"ION-LABEL",{button:!0});var ne=E(I);f=u(ne,"ION-TEXT",{color:!0});var H=E(f);s=u(H,"H3",{});var F=E(s);d=se(F,p),g=w(F),O&&O.l(F),F.forEach(a),H.forEach(a),P=w(ne),A=u(ne,"DIV",{class:!0,"data-svelte-h":!0}),W(A)!=="svelte-130ohbs"&&(A.innerHTML=M),ne.forEach(a),C=w(D),L=u(D,"ION-ICON",{icon:!0,slot:!0}),E(L).forEach(a),N=w(D),D.forEach(a),this.h()},h(){G(r,"class","order svelte-ziybgw"),G(n,"class","order-wrapper svelte-ziybgw"),G(n,"title",b=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",xe(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),G(A,"class","sub svelte-ziybgw"),m(I,"button",""),m(L,"icon",Ye),m(L,"slot","end"),this.first=t},m(z,D){q(z,t,D),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,s),l(s,d),l(s,g),O&&O.m(s,null),l(I,P),l(I,A),l(t,C),l(t,L),l(t,N),S||(T=ee(I,"click",B),S=!0)},p(z,D){e=z,D[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&ke(_,h),D[0]&32&&b!==(b=Ke(e[30].status))&&G(n,"title",b),D[0]&32&&j(n,"background-color",we(e[30])),D[0]&32&&j(n,"color",xe(we(e[30]))),D[0]&32&&p!==(p=e[30].title+"")&&ke(d,p),D[0]&32&&(v=e[30].support_list&&e[30].support_list.length||e[13](e[30])),v?O||(O=Rt(),O.c(),O.m(s,null)):O&&(O.d(1),O=null)},d(z){z&&a(t),O&&O.d(),S=!1,T()}}}function Wn(i){let e,t,o,n,r=`<ion-icon icon="${sn}"></ion-icon>`,h,_,b,k=`<ion-icon icon="${cn}"></ion-icon>`,I,f,s=i[6].name+"",p,d,g,v,P;function A(L,N){if(L[7].length>0)return Gn;if(!L[3])return Vn}let M=A(i),C=M&&M(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=y(),_=c("ion-buttons"),b=c("ion-button"),b.innerHTML=k,I=y(),f=c("ion-title"),p=ae(s),d=y(),C&&C.c(),g=Pe(),this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var N=E(e);t=u(N,"ION-TOOLBAR",{});var S=E(t);o=u(S,"ION-BUTTONS",{slot:!0});var T=E(o);n=u(T,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),W(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),T.forEach(a),h=w(S),_=u(S,"ION-BUTTONS",{slot:!0});var O=E(_);b=u(O,"ION-BUTTON",{"data-svelte-h":!0}),W(b)!=="svelte-nf50hj"&&(b.innerHTML=k),O.forEach(a),I=w(S),f=u(S,"ION-TITLE",{});var B=E(f);p=se(B,s),B.forEach(a),S.forEach(a),N.forEach(a),d=w(L),C&&C.l(L),g=Pe(),this.h()},h(){m(n,"title","Atrás"),m(n,"alt","Atrás"),m(o,"slot","start"),m(_,"slot","end"),m(e,"translucent","")},m(L,N){q(L,e,N),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,b),l(t,I),l(t,f),l(f,p),q(L,d,N),C&&C.m(L,N),q(L,g,N),v||(P=[ee(n,"click",i[14]),ee(b,"click",i[18])],v=!0)},p(L,N){N[0]&64&&s!==(s=L[6].name+"")&&ke(p,s),M===(M=A(L))&&C?C.p(L,N):(C&&C.d(1),C=M&&M(L),C&&(C.c(),C.m(g.parentNode,g)))},d(L){L&&(a(e),a(d),a(g)),C&&C.d(L),v=!1,He(P)}}}function Xn(i){let e,t,o,n=i[2]&&Bt(i);return{c(){e=y(),n&&n.c(),t=Pe(),this.h()},l(r){Wt("svelte-kn0kph",document.head).forEach(a),e=w(r),n&&n.l(r),t=Pe(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,h){q(r,e,h),n&&n.m(r,h),q(r,t,h),o=!0},p(r,h){r[2]?n?(n.p(r,h),h[0]&4&&rt(n,1)):(n=Bt(r),n.c(),rt(n,1),n.m(t.parentNode,t)):n&&(en(),ut(n,1,1,()=>{n=null}),Jt())},i(r){o||(rt(n),o=!0)},o(r){ut(n),o=!1},d(r){r&&(a(e),a(t)),n&&n.d(r)}}}function we(i){let e="#ffffff";return i.status==="pending"?e="#f2e300":i.status==="completed"&&(e="#44d900"),e}function Ke(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function xe(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function Jn(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://app.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const Yn=i=>i.img;function Zn(i,e,t){let o;Xt(i,un,H=>t(17,o=H));var n=this&&this.__awaiter||function(H,F,J,ie){function pe(ue){return ue instanceof J?ue:new J(function(he){he(ue)})}return new(J||(J=Promise))(function(ue,he){function Ae(me){try{Le(ie.next(me))}catch(de){he(de)}}function ge(me){try{Le(ie.throw(me))}catch(de){he(de)}}function Le(me){me.done?ue(me.value):pe(me.value).then(Ae,ge)}Le((ie=ie.apply(H,F||[])).next())})};let{routeId:r}=e,{driverId:h}=e,_=new Object,b=!0,k=!1,I=[],f={},s=[],p=[],d,g=!1;const v=()=>n(void 0,void 0,void 0,function*(){yield P(r),d.complete()});st(()=>{v()});function P(H){return n(this,void 0,void 0,function*(){const F=new FormData;F.append("id_route",H);try{const ie=yield(yield fetch("https://app.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:F})).json();t(6,f=ie.data.seguimiento_list[0]),t(5,I=ie.data.event_list),t(7,s=ie.data.checklist),p=ie.data.expenses,f&&t(4,k=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,b=!1)}catch(J){t(3,b=!1),console.error("Error fetching data:",J)}})}const A=H=>new Promise((F,J)=>{const ie=new FormData;ie.append("id_route",H.id_route),ie.append("id_event",H.id_event),fetch("https://app.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:ie}).then(pe=>pe.json()).then(pe=>{F(pe.data.event_evidence[0])}).catch(pe=>{console.error("Error fetching data:",pe),J(pe)})}),M=(H,F)=>{A(H).then(J=>{J&&(H.img=J.img,H.driver_comments=J.driver_comments,H.comments=J.comments),Re("modal-delivery-info",Mn,{delivery:H,isLast:F}).then(ie=>{})})},C=(H,F,J)=>{var ie=!1;return g||(g=!0,Re("modal-checklist",Gt,{checklist:H,driverId:F,routeId:J,isLast:ie}).then(pe=>{g=!1}),Jn(J,"checklist")),""},L=H=>n(void 0,void 0,void 0,function*(){return yield P(H),p.length>0?Re("modal-expense-detail",jn,{routeId:H,expenses:p}).then(F=>{}):Re("modal-expense",dt,{routeId:H}).then(F=>{}),""}),N=H=>{if(H.tracking_type=="subscription"){if(H.subscriber_info&&H.payment_type==="cash"&&new Date(H.subscriber_info.payment_next)<new Date)return!0}else if(H.tracking_type=="ecommerce"&&Number(H.payment_pending)>0)return!0;return!1},S=()=>{_.id_driver?je(`/drivers/${_.id_driver}`):je("/drivers/me")},T=(H,F)=>n(void 0,void 0,void 0,function*(){yield(yield et.create({header:H||"Error",message:F||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function O(H){return H===I.length-1}const B=()=>L(r);function z(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const D=(H,F)=>M(H,O(F));function R(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const V=(H,F)=>M(H,O(F));function Z(H){ye[H?"unshift":"push"](()=>{d=H,t(8,d)})}const ne=H=>{const F=I.findIndex(he=>he.id_event===H.id_event),J=F===0,ie=F>0?I[F-1]:null,pe=J||ie&&ie.img!==null,ue=H.img!==null&&H.img!=="";pe||J&&!ue?M(H):T("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=H=>{"routeId"in H&&t(0,r=H.routeId),"driverId"in H&&t(1,h=H.driverId)},i.$$.update=()=>{i.$$.dirty[0]&131077&&(t(0,{routeId:r,driverId:h}=o.params,r,(t(1,h),t(17,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="super")?(P(r),je(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(P(r),je(`/drivers/${_.id_driver}/routes/${r}`)):je("/"))},[r,h,_,b,k,I,f,s,d,v,M,C,L,N,S,T,O,o,B,z,D,R,V,Z,ne]}class io extends Xe{constructor(e){super(),Je(this,e,Zn,Xn,We,{routeId:0,driverId:1},null,[-1,-1])}}export{io as component};
