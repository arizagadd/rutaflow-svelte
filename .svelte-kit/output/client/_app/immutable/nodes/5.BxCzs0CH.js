import{Z as mt,s as Xe,e as c,j as C,b as u,q as b,d as X,h as s,m as y,v as m,i as q,w as l,x as ne,n as Ee,z as Re,_ as Yt,B as j,o as tt,k as Pe,$ as vt,t as se,r as ce,f as K,a0 as Zt,a1 as et,A as ye,y as Ne,a2 as ut,l as Qt,p as $t}from"../chunks/index.BYLndrM5.js";import{S as xe,i as Je,t as ct,a as _t,c as en,b as tn,d as nn,m as on,e as ln,g as rn}from"../chunks/index.BNHbygFo.js";import{e as Be,u as nt,d as ot,a as an,c as dt,b as Kt,f as sn,g as cn,i as Wt,h as un,j as Xt,s as bt,k as Ye,m as fn,n as _n,o as dn,q as hn,r as pn,p as mn}from"../chunks/index.BlSY52ty.js";import"../chunks/index-48209844.IIRtDZyg.js";import{m as lt,a as je,I as vn}from"../chunks/IonPage.KvUD72q2.js";import{q as bn,t as gn}from"../chunks/ion-modal.CsJaVgKZ.js";import{g as Fe}from"../chunks/entry.lFdho03Q.js";const En=(i,e)=>{if(!customElements.get(i)){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const n={};for(const r of this.attributes)n[r.name]=r.value;new e({target:this.shadowRoot,props:n})}}customElements.define(i,t)}},In=function(i){return document.createElement(i).constructor!==HTMLElement},On=(i,e)=>{In(i)||En(i,e)},ze=async(i,e,t)=>{bn(),gn(),On(i,e);const o=await lt.create({component:i,componentProps:t});return o.present(),await o.onWillDismiss()};let Ge=mt({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]}),xt=mt({flag:[]});function kn(i){let e,t,o,n,r="Cancelar",h,_,v="Captura de Km/Gas",k,I,f,a="Confirmar",p,d,g,E,w,P,z;return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=v,k=C(),I=c("ion-buttons"),f=c("ion-button"),f.textContent=a,p=C(),d=c("ion-content"),g=c("ion-item"),E=c("ion-input"),this.h()},l(L){e=u(L,"ION-HEADER",{translucent:!0});var D=b(e);t=u(D,"ION-TOOLBAR",{});var N=b(t);o=u(N,"ION-BUTTONS",{slot:!0});var M=b(o);n=u(M,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),X(n)!=="svelte-17pq4f4"&&(n.textContent=r),M.forEach(s),h=y(N),_=u(N,"ION-TITLE",{"data-svelte-h":!0}),X(_)!=="svelte-1yhkaq7"&&(_.textContent=v),k=y(N),I=u(N,"ION-BUTTONS",{slot:!0});var T=b(I);f=u(T,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),X(f)!=="svelte-cm6j4s"&&(f.textContent=a),T.forEach(s),N.forEach(s),D.forEach(s),p=y(L),d=u(L,"ION-CONTENT",{fullscreen:!0});var O=b(d);g=u(O,"ION-ITEM",{});var A=b(g);E=u(A,"ION-INPUT",{class:!0,inputmode:!0,pattern:!0,type:!0,placeholder:!0,value:!0,required:!0});var B=b(E);B.forEach(s),A.forEach(s),O.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(f,"strong",""),m(I,"slot","end"),m(e,"translucent",""),m(E,"class","fin-km"),m(E,"inputmode","numeric"),m(E,"pattern","[0-9]*"),m(E,"type","number"),m(E,"placeholder",w="Ingresa "+i[0]+" actual"),m(E,"value",i[1]),m(E,"required",""),m(d,"fullscreen","")},m(L,D){q(L,e,D),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(t,k),l(t,I),l(I,f),q(L,p,D),q(L,d,D),l(d,g),l(g,E),P||(z=[ne(n,"click",i[2]),ne(f,"click",i[3]),ne(E,"input",i[4])],P=!0)},p(L,[D]){D&1&&w!==(w="Ingresa "+L[0]+" actual")&&m(E,"placeholder",w),D&2&&m(E,"value",L[1])},i:Ee,o:Ee,d(L){L&&(s(e),s(p),s(d)),P=!1,Re(z)}}}function Nn(i,e,t){const o=Yt();let n=document.querySelector("ion-modal"),r=n.componentProps.data_type;n.componentProps.isLast;let h;xt.subscribe(f=>{r=f.flag[0],r=="km_final"||r=="km_inicial"?t(0,h="kilometraje"):t(0,h="litros de gasolina")});let _=0;function v(){lt.dismiss()}function k(){o("modalResult",{data:"Your data",role:"confirm"}),r=="km_inicial"?Ge.update(a=>({...a,km_inicial:[_]})):r=="gas_inicial"?Ge.update(a=>({...a,gas_inicial:[_]})):r=="km_final"?Ge.update(a=>({...a,km_final:[_]})):r=="gas_final"&&Ge.update(a=>({...a,gas_final:[_]})),v()}return[h,_,v,k,f=>t(1,_=f.target.value)]}class Tn extends xe{constructor(e){super(),Je(this,e,Nn,kn,Xe,{})}}const ft=mt({items:[],checkedIndices:[],mandatory:[]});function Ot(i,e,t){const o=i.slice();return o[51]=e[t],o[52]=e,o[53]=t,o}function Cn(i){let e,t,o,n,r,h="Kilometraje inicial",_,v,k=i[0]?i[0]+" km.":"Cargar km",I,f,a,p,d,g,E,w="Gasolina inicial (litros)",P,z,L=i[1]?i[1]+" litros":"Cargar gas",D,N,M,T;return N=vt(i[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=C(),r=c("p"),r.textContent=h,_=C(),v=c("ion-button"),I=se(k),f=C(),a=c("ion-item"),p=c("ion-label"),d=c("input"),g=C(),E=c("p"),E.textContent=w,P=C(),z=c("ion-button"),D=se(L),this.h()},l(O){e=u(O,"ION-ITEM",{});var A=b(e);t=u(A,"ION-LABEL",{style:!0});var B=b(t);o=u(B,"INPUT",{id:!0,style:!0,type:!0}),n=y(B),r=u(B,"P",{style:!0,"data-svelte-h":!0}),X(r)!=="svelte-88twxi"&&(r.textContent=h),B.forEach(s),_=y(A),v=u(A,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var S=b(v);I=ce(S,k),S.forEach(s),A.forEach(s),f=y(O),a=u(O,"ION-ITEM",{});var R=b(a);p=u(R,"ION-LABEL",{style:!0});var G=b(p);d=u(G,"INPUT",{id:!0,style:!0,type:!0}),g=y(G),E=u(G,"P",{style:!0,"data-svelte-h":!0}),X(E)!=="svelte-1ux30eb"&&(E.textContent=w),G.forEach(s),P=y(R),z=u(R,"ION-BUTTON",{fill:!0,class:!0,size:!0,style:!0});var V=b(z);D=ce(V,L),V.forEach(s),R.forEach(s),this.h()},h(){K(o,"id","chkbox-km-ini"),j(o,"pointer-events","auto"),K(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(v,"fill","outline"),m(v,"size","small"),m(v,"class","loadKmInicial"),m(v,"aria-selected",""),K(d,"id","chkbox-gas-ini"),j(d,"pointer-events","auto"),K(d,"type","checkbox"),d.required=!0,j(E,"margin-left","10px"),j(p,"display","flex"),m(z,"fill","outline"),m(z,"class","loadGasInicial"),m(z,"size","small"),j(z,"height","16px "),N.p(o,d)},m(O,A){q(O,e,A),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[28](o),l(t,n),l(t,r),l(e,_),l(e,v),l(v,I),q(O,f,A),q(O,a,A),l(a,p),l(p,d),i[30](d),d.checked=~(i[4]||[]).indexOf(d.__value),l(p,g),l(p,E),l(a,P),l(a,z),l(z,D),M||(T=[ne(o,"change",i[27]),ne(v,"click",i[29]),ne(d,"change",i[31]),ne(z,"click",i[32])],M=!0)},p(O,A){A[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),A[0]&1&&k!==(k=O[0]?O[0]+" km.":"Cargar km")&&Ne(I,k),A[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),A[0]&2&&L!==(L=O[1]?O[1]+" litros":"Cargar gas")&&Ne(D,L)},d(O){O&&(s(e),s(f),s(a)),i[28](null),i[30](null),N.r(),M=!1,Re(T)}}}function yn(i){let e,t,o,n,r,h="Kilometraje final",_,v,k=i[2]?i[2]+" km.":"Cargar km",I,f,a,p,d,g,E,w="Gasolina final (litros)",P,z,L=i[3]?i[3]+" litros":"Cargar gas",D,N,M,T;return N=vt(i[21][0]),{c(){e=c("ion-item"),t=c("ion-label"),o=c("input"),n=C(),r=c("p"),r.textContent=h,_=C(),v=c("ion-button"),I=se(k),f=C(),a=c("ion-item"),p=c("ion-label"),d=c("input"),g=C(),E=c("p"),E.textContent=w,P=C(),z=c("ion-button"),D=se(L),this.h()},l(O){e=u(O,"ION-ITEM",{});var A=b(e);t=u(A,"ION-LABEL",{style:!0});var B=b(t);o=u(B,"INPUT",{id:!0,style:!0,type:!0}),n=y(B),r=u(B,"P",{style:!0,"data-svelte-h":!0}),X(r)!=="svelte-ccmu71"&&(r.textContent=h),B.forEach(s),_=y(A),v=u(A,"ION-BUTTON",{fill:!0,size:!0,class:!0,"aria-selected":!0});var S=b(v);I=ce(S,k),S.forEach(s),A.forEach(s),f=y(O),a=u(O,"ION-ITEM",{});var R=b(a);p=u(R,"ION-LABEL",{style:!0});var G=b(p);d=u(G,"INPUT",{id:!0,style:!0,type:!0}),g=y(G),E=u(G,"P",{style:!0,"data-svelte-h":!0}),X(E)!=="svelte-wsoyd2"&&(E.textContent=w),G.forEach(s),P=y(R),z=u(R,"ION-BUTTON",{fill:!0,size:!0,class:!0});var V=b(z);D=ce(V,L),V.forEach(s),R.forEach(s),this.h()},h(){K(o,"id","chkbox-km-fin"),j(o,"pointer-events","auto"),K(o,"type","checkbox"),o.required=!0,j(r,"margin-left","10px"),j(t,"display","flex"),m(v,"fill","outline"),m(v,"size","small"),m(v,"class","loadKmInicial"),m(v,"aria-selected",""),K(d,"id","chkbox-gas-fin"),j(d,"pointer-events","auto"),K(d,"type","checkbox"),d.required=!0,j(E,"margin-left","10px"),j(p,"display","flex"),m(z,"fill","outline"),m(z,"size","small"),m(z,"class","loadGasInicial"),N.p(o,d)},m(O,A){q(O,e,A),l(e,t),l(t,o),o.checked=~(i[4]||[]).indexOf(o.__value),i[22](o),l(t,n),l(t,r),l(e,_),l(e,v),l(v,I),q(O,f,A),q(O,a,A),l(a,p),l(p,d),d.checked=~(i[4]||[]).indexOf(d.__value),i[25](d),l(p,g),l(p,E),l(a,P),l(a,z),l(z,D),M||(T=[ne(o,"change",i[20]),ne(v,"click",i[23]),ne(d,"change",i[24]),ne(z,"click",i[26])],M=!0)},p(O,A){A[0]&16&&(o.checked=~(O[4]||[]).indexOf(o.__value)),A[0]&4&&k!==(k=O[2]?O[2]+" km.":"Cargar km")&&Ne(I,k),A[0]&16&&(d.checked=~(O[4]||[]).indexOf(d.__value)),A[0]&8&&L!==(L=O[3]?O[3]+" litros":"Cargar gas")&&Ne(D,L)},d(O){O&&(s(e),s(f),s(a)),i[22](null),i[25](null),N.r(),M=!1,Re(T)}}}function wn(i){let e=[],t=new Map,o,n=Be(i[13]);const r=h=>h[51].id_checklist_event;for(let h=0;h<n.length;h+=1){let _=Ot(i,n,h),v=r(_);t.set(v,e[h]=kt(v,_))}return{c(){for(let h=0;h<e.length;h+=1)e[h].c();o=Pe()},l(h){for(let _=0;_<e.length;_+=1)e[_].l(h);o=Pe()},m(h,_){for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(h,_);q(h,o,_)},p(h,_){_[0]&407664&&(n=Be(h[13]),e=nt(e,_,r,1,h,n,t,o.parentNode,ot,kt,o,Ot))},d(h){h&&s(o);for(let _=0;_<e.length;_+=1)e[_].d(h)}}}function Ln(i){let e,t=(i[12][i[51].id_checklist_event]?i[12][i[51].id_checklist_event]:"Cargar evidencia")+"",o;return{c(){e=c("label"),o=se(t),this.h()},l(n){e=u(n,"LABEL",{for:!0,class:!0});var r=b(e);o=ce(r,t),r.forEach(s),this.h()},h(){K(e,"for","chklist-"+i[51].id_checklist_event),K(e,"class","button-label svelte-1ruehls")},m(n,r){q(n,e,r),l(e,o)},p(n,r){r[0]&4096&&t!==(t=(n[12][n[51].id_checklist_event]?n[12][n[51].id_checklist_event]:"Cargar evidencia")+"")&&Ne(o,t)},d(n){n&&s(e)}}}function Sn(i){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0,class:!0}),b(e).forEach(s),this.h()},h(){m(e,"name","dots"),m(e,"class","button-spinner svelte-1ruehls")},m(t,o){q(t,e,o)},p:Ee,d(t){t&&s(e)}}}function kt(i,e){let t,o,n,r=e[51],h,_,v=e[51].item+"",k,I,f,a,p,d,g,E,w,P;const z=()=>e[34](n,r),L=()=>e[34](null,r);function D(){return e[35](e[51])}function N(A,B){return A[11][A[51].id_checklist_event]?Sn:Ln}let M=N(e),T=M(e);function O(...A){return e[37](e[51],...A)}return E=vt(e[21][0]),{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("input"),h=C(),_=c("p"),k=se(v),I=C(),f=c("ion-button"),a=c("div"),T.c(),p=C(),d=c("input"),g=C(),this.h()},l(A){t=u(A,"ION-ITEM",{});var B=b(t);o=u(B,"ION-LABEL",{style:!0});var S=b(o);n=u(S,"INPUT",{id:!0,style:!0,type:!0}),h=y(S),_=u(S,"P",{style:!0});var R=b(_);k=ce(R,v),R.forEach(s),S.forEach(s),I=y(B),f=u(B,"ION-BUTTON",{fill:!0,class:!0,size:!0});var G=b(f);a=u(G,"DIV",{class:!0});var V=b(a);T.l(V),p=y(V),d=u(V,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),V.forEach(s),G.forEach(s),g=y(B),B.forEach(s),this.h()},h(){K(n,"id",`chkbox-${e[51].id_checklist_event}`),j(n,"pointer-events","auto"),K(n,"type","checkbox"),n.__value=e[51].id_checklist_event,Zt(n,n.__value),n.required=!0,j(_,"margin-left","10px"),j(o,"display","flex"),j(d,"display","none"),K(d,"id","chklist-"+e[51].id_checklist_event),K(d,"name","fileToUpload"),K(d,"type","file"),K(d,"accept","image/*"),K(a,"class","button-content svelte-1ruehls"),m(f,"fill","outline"),m(f,"class","loadEvidence svelte-1ruehls"),m(f,"size","small"),E.p(n),this.first=t},m(A,B){q(A,t,B),l(t,o),l(o,n),n.checked=~(e[4]||[]).indexOf(n.__value),z(),l(o,h),l(o,_),l(_,k),l(t,I),l(t,f),l(f,a),T.m(a,null),l(a,p),l(a,d),e[36](d),l(t,g),w||(P=[ne(n,"change",e[33]),ne(n,"change",D),ne(d,"change",O)],w=!0)},p(A,B){e=A,B[0]&16&&(n.checked=~(e[4]||[]).indexOf(n.__value)),r!==e[51]&&(L(),r=e[51],z()),M===(M=N(e))&&T?T.p(e,B):(T.d(1),T=M(e),T&&(T.c(),T.m(a,p)))},d(A){A&&s(t),L(),T.d(),e[36](null),E.r(),w=!1,Re(P)}}}function Pn(i){let e,t,o,n,r="Cancelar",h,_,v="Requerimientos de ruta",k,I,f,a,p,d,g,E="Confirmar",w,P;function z(M,T){return M[14]?yn:Cn}let D=z(i)(i),N=i[13]&&wn(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=v,k=C(),I=c("ion-content"),f=c("ion-list"),D.c(),a=C(),N&&N.c(),p=C(),d=c("ion-footer"),g=c("ion-button"),g.textContent=E,this.h()},l(M){e=u(M,"ION-HEADER",{translucent:!0});var T=b(e);t=u(T,"ION-TOOLBAR",{});var O=b(t);o=u(O,"ION-BUTTONS",{slot:!0});var A=b(o);n=u(A,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),X(n)!=="svelte-1dnmkxs"&&(n.textContent=r),A.forEach(s),h=y(O),_=u(O,"ION-TITLE",{"data-svelte-h":!0}),X(_)!=="svelte-ucox25"&&(_.textContent=v),O.forEach(s),T.forEach(s),k=y(M),I=u(M,"ION-CONTENT",{fullscreen:!0});var B=b(I);f=u(B,"ION-LIST",{});var S=b(f);D.l(S),a=y(S),N&&N.l(S),S.forEach(s),B.forEach(s),p=y(M),d=u(M,"ION-FOOTER",{});var R=b(d);g=u(R,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),X(g)!=="svelte-g82qqw"&&(g.textContent=E),R.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(e,"translucent",""),m(I,"fullscreen",""),m(g,"fill","outline"),m(g,"color","tertiary"),m(g,"strong",""),j(g,"width","99%"),j(g,"height","auto")},m(M,T){q(M,e,T),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(M,k,T),q(M,I,T),l(I,f),D.m(f,null),l(f,a),N&&N.m(f,null),q(M,p,T),q(M,d,T),l(d,g),w||(P=[ne(n,"click",i[15]),ne(g,"click",i[16])],w=!0)},p(M,T){D.p(M,T),M[13]&&N.p(M,T)},i:Ee,o:Ee,d(M){M&&(s(e),s(k),s(I),s(p),s(d)),D.d(),N&&N.d(),w=!1,Re(P)}}}function ht(i,e){if(typeof i=="object"&&i!==null||Array.isArray(i)){if(Array.isArray(i))return i.map(t=>ht(t,e)).flat();{const t=Object.keys(i);let o;return e=="id_checklist_event"?o=t.filter(r=>r.toLowerCase().includes("id_checklist_event")).map(r=>i[r]):e=="mandatory"?o=t.filter(r=>r.toLowerCase().includes("mandatory")).map(r=>i[r]):(console.error("Tipo de dato no reconocido."),o=!1),o}}else return console.error("Invalid input. Please provide a valid object or array."),[]}function st(i,e){let t=new FormData;t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)})}function An(i,e,t){let o=document.querySelector("ion-modal");const n=o.componentProps.checklist,r=o.componentProps.driverId,h=o.componentProps.routeId,_=o.componentProps.isLast;let v,k,I,f,a=[],p=null,d={},g,E,w,P,z={},L={},D={};tt(()=>{_?console.log("Último checklist"):ft.update(H=>(H.mandatory=ht(n,"mandatory"),H.items=ht(n,"id_checklist_event"),H))});function N(H){t(11,z[H]=!0,z)}const M=async()=>{await(await je.create({header:"Datos o checklist incompletos",message:"Carga la evidencia requerida y marca todas las casillas para confirmar",buttons:[{text:"Cerrar"}]})).present()},T=async()=>{await(await je.create({header:"Datos capturados",message:"El kilometraje y gasolina final fueron registrados correctamente, espere aprobación para finalizar ruta",buttons:[{text:"Cerrar"}]})).present()},O=async H=>{await(await je.create({header:"Datos inválidos",message:H=="km"?"Llena correctamente el campo de kilometraje inicial":"Llena correctamente el campo de gasolina inicial",buttons:[{text:"Cerrar"}]})).present()},A=()=>{lt.dismiss(),r?Fe(`/drivers/${r}`):Fe("/drivers/me")},B=()=>{if(_){var H=V(I,"km"),Y=V(f,"gas");const ee=new FormData;ee.append("km_final",H),ee.append("gas_final",Y),ee.append("id_route",h),H&&Y?(A(),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:ee}).then(x=>x.json()).then(x=>{T()}).catch(x=>{console.error("Error fetching data:",x)})):M()}else{var fe=V(v,"km"),ke=V(k,"gas");ft.update(ee=>{const x=ee.items,Q=ee.mandatory;if(x.every(oe=>ee.checkedIndices.includes(oe))&&fe&&ke){A();const oe=new FormData;for(const $ in L)if(L.hasOwnProperty($)){const{img:de,img_id:pe}=L[$];oe.append(`selectedImages[${$}][img]`,de),oe.append(`selectedImages[${$}][img_id]`,pe)}oe.append("km_inicial",fe),oe.append("gas_inicial",ke),oe.append("id_route",h),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:oe}).then($=>$.json()).then($=>{Q&&Q[0]=="1"?st(h,"checklist-pending"):st(h,"enroute")}).catch($=>{console.error("Error fetching data:",$)})}else if(!Q&&fe&&ke){var be=new FormData;be.append("km_inicial",fe),be.append("gas_inicial",ke),fetch("https://dev.rutaflow.com/api/admin/checklist/add_evidence.php",{method:"POST",body:be}).then(oe=>oe.json()).then(oe=>{st(h,"enroute")}).catch(oe=>{console.error("Error fetching data:",oe)})}else M();return ee})}J()},S=async(H,Y)=>{N(Y);const ke=H.target.files[0],ee=await R(ke);if(ee){const x=new FormData;x.append("fileToUpload",ee);try{const Q=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:x});if(Q.ok){const le=await Q.json();L={...L,[Y]:{img:le.img,img_id:le.img_id}},t(12,D={...D,[Y]:le.filename}),G(Y),t(6,d[Y].checked=!0,d),t(11,z[Y]=!1,z)}else console.error("File upload failed:",Q.statusText)}catch(Q){console.error("Error during file upload:",Q)}}},R=async H=>new Promise(Y=>{const fe=new FileReader;fe.onload=ke=>{const ee=new Image;ee.src=ke.target.result,ee.onload=()=>{const x=document.createElement("canvas"),Q=x.getContext("2d"),le=800,be=600;let oe=ee.width,$=ee.height;oe>le&&($*=le/oe,oe=le),$>be&&(oe*=be/$,$=be),x.width=oe,x.height=$,Q.drawImage(ee,0,0,oe,$),x.toBlob(de=>{Y(de)},"image/jpeg",.7)}},fe.readAsDataURL(H)}),G=H=>{ft.update(Y=>(Y.checkedIndices.indexOf(H)===-1?Y.checkedIndices.push(H):console.error(`ID ${H} is already checked.`),Y.items.forEach(ke=>{ke.id_checklist_event===H&&(ke.checked=!0)}),Y))};function V(H,Y){return/^\d+$/.test(H)?parseInt(H,10):(O(Y),null)}function W(H,Y){U(Y),o.componentProps.data_type=Y,ze("modal-gas-km",Tn,{r:Y}).then(()=>{Ge.subscribe(fe=>{F(fe,Y)})})}function U(H){xt.update(Y=>({...Y,flag:[H]}))}function F(H,Y){t(0,v=H.km_inicial?H.km_inicial:null),t(1,k=H.gas_inicial?H.gas_inicial:null),t(2,I=H.km_final?H.km_final:null),t(3,f=H.gas_final?H.gas_final:null),Y=="km_inicial"&&t(7,g.checked=!0,g),Y=="gas_inicial"&&t(8,E.checked=!0,E),Y=="km_final"&&t(9,w.checked=!0,w),Y=="gas_final"&&t(10,P.checked=!0,P)}function J(){Ge.set({km_inicial:[],gas_inicial:[],km_final:[],gas_final:[]})}const Z=[[]];function ie(){a=et(Z[0],this.__value,this.checked),t(4,a)}function re(H){ye[H?"unshift":"push"](()=>{w=H,t(9,w)})}const me=H=>W(H,"km_final");function Ae(){a=et(Z[0],this.__value,this.checked),t(4,a)}function ge(H){ye[H?"unshift":"push"](()=>{P=H,t(10,P)})}const Le=H=>W(H,"gas_final");function ve(){a=et(Z[0],this.__value,this.checked),t(4,a)}function he(H){ye[H?"unshift":"push"](()=>{g=H,t(7,g)})}const ue=H=>W(H,"km_inicial");function Ie(H){ye[H?"unshift":"push"](()=>{E=H,t(8,E)})}function Ue(){a=et(Z[0],this.__value,this.checked),t(4,a)}const Te=H=>W(H,"gas_inicial");function Ce(){a=et(Z[0],this.__value,this.checked),t(4,a)}function He(H,Y){ye[H?"unshift":"push"](()=>{d[Y.id_checklist_event]=H,t(6,d)})}const Oe=H=>G(H.id_checklist_event);function Se(H){ye[H?"unshift":"push"](()=>{p=H,t(5,p)})}return[v,k,I,f,a,p,d,g,E,w,P,z,D,n,_,A,B,S,G,W,ie,Z,re,me,Ae,ge,Le,ve,he,ue,Ie,Ue,Te,Ce,He,Oe,Se,(H,Y)=>S(Y,H.id_checklist_event)]}class Jt extends xe{constructor(e){super(),Je(this,e,An,Pn,Xe,{},null,[-1,-1])}}function Mn(i){let e,t,o,n,r,h="Teléfono de Negocio",_,v,k=i[6].client_phone+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),this.h()},l(f){e=u(f,"ION-ITEM",{href:!0});var a=b(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(a),n=u(a,"ION-LABEL",{class:!0});var p=b(n);r=u(p,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1u5l7fz"&&(r.textContent=h),_=y(p),v=u(p,"H2",{});var d=b(v);I=ce(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",sn),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(e,"href","tel:"+i[6].client_phone)},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ee,d(f){f&&s(e)}}}function Dn(i){let e,t,o,n,r,h="Domicilio Alternativo",_,v,k=i[6].line2+"",I,f,a;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),f=C(),a=c("ion-icon"),this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var d=b(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(d),n=u(d,"ION-LABEL",{class:!0});var g=b(n);r=u(g,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=y(g),v=u(g,"H2",{});var E=b(v);I=ce(E,k),E.forEach(s),g.forEach(s),f=y(d),a=u(d,"ION-ICON",{icon:!0,slot:!0}),b(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/searhc/?api=1&query="+i[6].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a)},p:Ee,d(p){p&&s(e)}}}function Bn(i){let e,t,o,n,r,h="Domicilio",_,v,k=i[6].line1+"",I,f,a,p,d=i[6].line2&&i[6].line2.trim().length,g,E=d&&Hn(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),f=C(),a=c("ion-icon"),p=C(),E&&E.c(),g=Pe(),this.h()},l(w){e=u(w,"ION-ITEM",{href:!0});var P=b(e);t=u(P,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(P),n=u(P,"ION-LABEL",{class:!0});var z=b(n);r=u(z,"P",{"data-svelte-h":!0}),X(r)!=="svelte-cbm7q1"&&(r.textContent=h),_=y(z),v=u(z,"H2",{});var L=b(v);I=ce(L,k),L.forEach(s),z.forEach(s),f=y(P),a=u(P,"ION-ICON",{icon:!0,slot:!0}),b(a).forEach(s),P.forEach(s),p=y(w),E&&E.l(w),g=Pe(),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line1)},m(w,P){q(w,e,P),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a),q(w,p,P),E&&E.m(w,P),q(w,g,P)},p(w,P){d&&E.p(w,P)},d(w){w&&(s(e),s(p),s(g)),E&&E.d(w)}}}function Hn(i){let e,t,o,n,r,h="Domicilio Alternativo",_,v,k=i[6].line2+"",I,f,a;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),f=C(),a=c("ion-icon"),this.h()},l(p){e=u(p,"ION-ITEM",{href:!0});var d=b(e);t=u(d,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(d),n=u(d,"ION-LABEL",{class:!0});var g=b(n);r=u(g,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1ub9uzw"&&(r.textContent=h),_=y(g),v=u(g,"H2",{});var E=b(v);I=ce(E,k),E.forEach(s),g.forEach(s),f=y(d),a=u(d,"ION-ICON",{icon:!0,slot:!0}),b(a).forEach(s),d.forEach(s),this.h()},h(){m(t,"icon",bt),m(t,"slot","start"),m(n,"class","ion-text-wrap"),m(a,"icon",Ye),m(a,"slot","end"),m(e,"href","https://www.google.com/maps/search/?api=1&query="+i[6].line2)},m(p,d){q(p,e,d),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I),l(e,f),l(e,a)},p:Ee,d(p){p&&s(e)}}}function Nt(i){let e,t,o,n,r,h="Contacto del Cliente",_,v,k,I,f=i[2]&&i[2]==="1"&&Tt(i);return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),k=se(i[4]),I=C(),f&&f.c(),this.h()},l(a){e=u(a,"ION-ITEM",{});var p=b(e);t=u(p,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(p),n=u(p,"ION-LABEL",{class:!0});var d=b(n);r=u(d,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1utsyb6"&&(r.textContent=h),_=y(d),v=u(d,"H2",{});var g=b(v);k=ce(g,i[4]),g.forEach(s),d.forEach(s),I=y(p),f&&f.l(p),p.forEach(s),this.h()},h(){m(t,"icon",cn),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(a,p){q(a,e,p),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,k),l(e,I),f&&f.m(e,null)},p(a,p){p&16&&Ne(k,a[4]),a[2]&&a[2]==="1"?f?f.p(a,p):(f=Tt(a),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(a){a&&s(e),f&&f.d()}}}function Tt(i){let e,t=`<ion-icon icon="${fn}" slot="start"></ion-icon>
                        Notificar Cliente`,o,n;return{c(){e=c("ion-button"),e.innerHTML=t,this.h()},l(r){e=u(r,"ION-BUTTON",{fill:!0,style:!0,"data-svelte-h":!0}),X(e)!=="svelte-w3qtwm"&&(e.innerHTML=t),this.h()},h(){m(e,"fill","outline"),j(e,"margin-left","16px")},m(r,h){q(r,e,h),o||(n=ne(e,"click",i[10]),o=!0)},p:Ee,d(r){r&&s(e),o=!1,n()}}}function Ct(i){let e,t,o,n,r,h="Notas de ubicación",_,v,k;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),k=se(i[5]),this.h()},l(I){e=u(I,"ION-ITEM",{});var f=b(e);t=u(f,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(f),n=u(f,"ION-LABEL",{class:!0});var a=b(n);r=u(a,"P",{"data-svelte-h":!0}),X(r)!=="svelte-nhm2ft"&&(r.textContent=h),_=y(a),v=u(a,"H2",{});var p=b(v);k=ce(p,i[5]),p.forEach(s),a.forEach(s),f.forEach(s),this.h()},h(){m(t,"icon",Wt),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(I,f){q(I,e,f),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,k)},p(I,f){f&32&&Ne(k,I[5])},d(I){I&&s(e)}}}function Rn(i){let e,t,o,n,r,h="Horarios",_,v,k=i[6].schedule+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=b(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(a),n=u(a,"ION-LABEL",{});var p=b(n);r=u(p,"P",{"data-svelte-h":!0}),X(r)!=="svelte-11q7hm5"&&(r.textContent=h),_=y(p),v=u(p,"H2",{});var d=b(v);I=ce(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",un),m(t,"slot","start")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ee,d(f){f&&s(e)}}}function Un(i){let e,t,o,n,r,h="Notas del operador",_,v,k=i[6].driver_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=b(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(a),n=u(a,"ION-LABEL",{});var p=b(n);r=u(p,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1yk9qp4"&&(r.textContent=h),_=y(p),v=u(p,"H2",{});var d=b(v);I=ce(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",Xt),m(t,"slot","start")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ee,d(f){f&&s(e)}}}function zn(i){let e,t=i[6].logistic_comments!="<br>"&&qn(i);return{c(){t&&t.c(),e=Pe()},l(o){t&&t.l(o),e=Pe()},m(o,n){t&&t.m(o,n),q(o,e,n)},p(o,n){o[6].logistic_comments!="<br>"&&t.p(o,n)},d(o){o&&s(e),t&&t.d(o)}}}function qn(i){let e,t,o,n,r,h="Comentarios logísticos",_,v,k=i[6].logistic_comments+"",I;return{c(){e=c("ion-item"),t=c("ion-icon"),o=C(),n=c("ion-label"),r=c("p"),r.textContent=h,_=C(),v=c("h2"),I=se(k),this.h()},l(f){e=u(f,"ION-ITEM",{});var a=b(e);t=u(a,"ION-ICON",{icon:!0,slot:!0}),b(t).forEach(s),o=y(a),n=u(a,"ION-LABEL",{class:!0});var p=b(n);r=u(p,"P",{"data-svelte-h":!0}),X(r)!=="svelte-1iz85r6"&&(r.textContent=h),_=y(p),v=u(p,"H2",{});var d=b(v);I=ce(d,k),d.forEach(s),p.forEach(s),a.forEach(s),this.h()},h(){m(t,"icon",Wt),m(t,"slot","start"),m(n,"class","ion-text-wrap")},m(f,a){q(f,e,a),l(e,t),l(e,o),l(e,n),l(n,r),l(n,_),l(n,v),l(v,I)},p:Ee,d(f){f&&s(e)}}}function yt(i){let e;return{c(){e=c("ion-spinner"),this.h()},l(t){e=u(t,"ION-SPINNER",{name:!0}),b(e).forEach(s),this.h()},h(){m(e,"name","dots")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function wt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=b(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),b(t).forEach(s),r.forEach(s),this.h()},h(){ut(t.src,o=i[1])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&2&&!ut(t.src,o=n[1])&&m(t,"src",o)},d(n){n&&s(e)}}}function Fn(i){let e,t,o,n,r="Cancelar",h,_,v=i[6].title+"",k,I,f,a,p="Confirmar",d,g,E,w,P,z,L,D,N="Negocio",M,T,O=i[6].client_name+"",A,B,S=i[6].client_phone&&i[6].client_phone.trim().length,R,G,V,W,U=i[6].schedule&&i[6].schedule.trim().length,F,J,Z=i[6].logistic_comments&&i[6].logistic_comments.trim().length,ie,re,me,Ae,ge,Le,ve,he,ue,Ie,Ue,Te,Ce="Subir Evidencia",He,Oe,Se,Me,H,Y,fe=S&&Mn(i);function ke(te,_e){if(te[6].line1&&te[6].line1.trim().length)return Bn;if(te[6].line2&&te[6].line2.trim().length)return Dn}let ee=ke(i),x=ee&&ee(i),Q=i[4]&&Nt(i),le=i[5]&&i[5]!=="<br>"&&Ct(i),be=U&&Rn(i),oe=i[6].driver_comments&&Un(i),$=Z&&zn(i),de=i[3]&&yt(),pe=i[1]&&wt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),k=se(v),I=C(),f=c("ion-buttons"),a=c("ion-button"),a.textContent=p,d=C(),g=c("ion-content"),E=c("ion-list"),w=c("ion-item"),P=c("ion-icon"),z=C(),L=c("ion-label"),D=c("p"),D.textContent=N,M=C(),T=c("h2"),A=se(O),B=C(),fe&&fe.c(),R=C(),x&&x.c(),G=C(),Q&&Q.c(),V=C(),le&&le.c(),W=C(),be&&be.c(),F=C(),oe&&oe.c(),J=C(),$&&$.c(),ie=C(),re=c("ion-item"),me=c("ion-icon"),Ae=C(),ge=c("ion-textarea"),Le=C(),ve=c("section"),he=c("label"),ue=c("ion-button"),Ie=c("ion-icon"),Ue=C(),Te=c("label"),Te.textContent=Ce,He=C(),Oe=c("input"),Se=C(),de&&de.c(),Me=C(),pe&&pe.c(),this.h()},l(te){e=u(te,"ION-HEADER",{translucent:!0});var _e=b(e);t=u(_e,"ION-TOOLBAR",{});var De=b(t);o=u(De,"ION-BUTTONS",{slot:!0});var Ze=b(o);n=u(Ze,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),X(n)!=="svelte-1f8rjcf"&&(n.textContent=r),Ze.forEach(s),h=y(De),_=u(De,"ION-TITLE",{title:!0});var Qe=b(_);k=ce(Qe,v),Qe.forEach(s),I=y(De),f=u(De,"ION-BUTTONS",{slot:!0});var qe=b(f);a=u(qe,"ION-BUTTON",{strong:!0,"data-svelte-h":!0}),X(a)!=="svelte-1ida0il"&&(a.textContent=p),qe.forEach(s),De.forEach(s),_e.forEach(s),d=y(te),g=u(te,"ION-CONTENT",{fullscreen:!0});var $e=b(g);E=u($e,"ION-LIST",{});var ae=b(E);w=u(ae,"ION-ITEM",{});var it=b(w);P=u(it,"ION-ICON",{icon:!0,slot:!0}),b(P).forEach(s),z=y(it),L=u(it,"ION-LABEL",{});var rt=b(L);D=u(rt,"P",{"data-svelte-h":!0}),X(D)!=="svelte-57b1dg"&&(D.textContent=N),M=y(rt),T=u(rt,"H2",{});var gt=b(T);A=ce(gt,O),gt.forEach(s),rt.forEach(s),it.forEach(s),B=y(ae),fe&&fe.l(ae),R=y(ae),x&&x.l(ae),G=y(ae),Q&&Q.l(ae),V=y(ae),le&&le.l(ae),W=y(ae),be&&be.l(ae),F=y(ae),oe&&oe.l(ae),J=y(ae),$&&$.l(ae),ie=y(ae),re=u(ae,"ION-ITEM",{});var at=b(re);me=u(at,"ION-ICON",{icon:!0,slot:!0}),b(me).forEach(s),Ae=y(at),ge=u(at,"ION-TEXTAREA",{label:!0,placeholder:!0}),b(ge).forEach(s),at.forEach(s),Le=y(ae),ve=u(ae,"SECTION",{});var Et=b(ve);he=u(Et,"LABEL",{for:!0,style:!0});var It=b(he);ue=u(It,"ION-BUTTON",{fill:!0,class:!0,expand:!0});var Ve=b(ue);Ie=u(Ve,"ION-ICON",{icon:!0,slot:!0}),b(Ie).forEach(s),Ue=y(Ve),Te=u(Ve,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),X(Te)!=="svelte-1as0od8"&&(Te.textContent=Ce),He=y(Ve),Oe=u(Ve,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),Ve.forEach(s),It.forEach(s),Et.forEach(s),Se=y(ae),de&&de.l(ae),Me=y(ae),pe&&pe.l(ae),ae.forEach(s),$e.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",i[6].title),m(a,"strong",""),m(f,"slot","end"),m(e,"translucent",""),m(P,"icon",an),m(P,"slot","start"),m(me,"icon",dt),m(me,"slot","start"),m(ge,"label","Notas"),m(ge,"placeholder","Escribe aquí..."),m(Ie,"icon",Kt),m(Ie,"slot","start"),K(Te,"for","eventEvidence"),j(Te,"padding","8px 10px"),j(Oe,"display","none"),K(Oe,"id","eventEvidence"),K(Oe,"name","fileToUpload"),K(Oe,"type","file"),K(Oe,"accept","image/*"),m(ue,"fill","outline"),m(ue,"class","loadEvidence"),m(ue,"expand","block"),K(he,"for","eventEvidence"),j(he,"display","block"),j(he,"width","100%"),m(g,"fullscreen","")},m(te,_e){q(te,e,_e),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,k),l(t,I),l(t,f),l(f,a),q(te,d,_e),q(te,g,_e),l(g,E),l(E,w),l(w,P),l(w,z),l(w,L),l(L,D),l(L,M),l(L,T),l(T,A),l(E,B),fe&&fe.m(E,null),l(E,R),x&&x.m(E,null),l(E,G),Q&&Q.m(E,null),l(E,V),le&&le.m(E,null),l(E,W),be&&be.m(E,null),l(E,F),oe&&oe.m(E,null),l(E,J),$&&$.m(E,null),l(E,ie),l(E,re),l(re,me),l(re,Ae),l(re,ge),i[11](ge),l(E,Le),l(E,ve),l(ve,he),l(he,ue),l(ue,Ie),l(ue,Ue),l(ue,Te),l(ue,He),l(ue,Oe),l(E,Se),de&&de.m(E,null),l(E,Me),pe&&pe.m(E,null),H||(Y=[ne(n,"click",i[8]),ne(a,"click",i[9]),ne(Oe,"change",i[7])],H=!0)},p(te,[_e]){S&&fe.p(te,_e),x&&x.p(te,_e),te[4]?Q?Q.p(te,_e):(Q=Nt(te),Q.c(),Q.m(E,V)):Q&&(Q.d(1),Q=null),te[5]&&te[5]!=="<br>"?le?le.p(te,_e):(le=Ct(te),le.c(),le.m(E,W)):le&&(le.d(1),le=null),U&&be.p(te,_e),te[6].driver_comments&&oe.p(te,_e),Z&&$.p(te,_e),te[3]?de||(de=yt(),de.c(),de.m(E,Me)):de&&(de.d(1),de=null),te[1]?pe?pe.p(te,_e):(pe=wt(te),pe.c(),pe.m(E,null)):pe&&(pe.d(1),pe=null)},i:Ee,o:Ee,d(te){te&&(s(e),s(d),s(g)),fe&&fe.d(),x&&x.d(),Q&&Q.d(),le&&le.d(),be&&be.d(),oe&&oe.d(),$&&$.d(),i[11](null),de&&de.d(),pe&&pe.d(),H=!1,Re(Y)}}}const Lt=/Teléfono:\s*(\d{10,})/;function St(i,e){for(let t=0;t<e.length;t++)if(e[t].alias===i)return e[t].val;return""}function jn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.delivery,r=o.componentProps.isLast,h=n.driver_comments?n.driver_comments:"",_=n.img?n.img:"",v="",k={latitude:null,longitude:null},I=new Object,f="",a="",p=!1,d="",g=n.comments_ext;if(tt(()=>{O()}),n.comments_ext){const B=n.comments_ext.match(Lt);B&&(d=B[1],g=n.comments_ext.replace(Lt,"").trim())}const E=async()=>{await(await je.create({header:"SMS enviado",message:"Se envío correctamente un SMS a "+n.title+" con número de teléfono: "+d,buttons:[{text:"Cerrar"}]})).present()},w=async()=>{await(await je.create({header:"SMS no enviado",message:"Hubo un error al enviar SMS a "+n.title+" con número de teléfono: "+phoneNumber0+". Por favor contacte a soporte.",buttons:[{text:"Cerrar"}]})).present()},P=async B=>{t(3,p=!0);const R=B.target.files[0],G=await z(R);if(G){const V=new FormData;V.append("fileToUpload",G);try{const W=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:V});if(W.ok){const U=await W.json();t(1,_=U.img),v=U.img_id}else console.error("File upload failed:",W.statusText)}catch(W){console.error("Error during file upload:",W)}finally{t(3,p=!1)}}},z=async B=>new Promise(S=>{const R=new FileReader;R.onload=G=>{const V=new Image;V.src=G.target.result,V.onload=()=>{const W=document.createElement("canvas"),U=W.getContext("2d"),F=800,J=600;let Z=V.width,ie=V.height;Z>F&&(ie*=F/Z,Z=F),ie>J&&(Z*=J/ie,ie=J),W.width=Z,W.height=ie,U.drawImage(V,0,0,Z,ie),W.toBlob(re=>{S(re)},"image/jpeg",.7)}},R.readAsDataURL(B)}),L=()=>{o.dismiss({data:Date.now()})},D=async()=>{try{if(await M()){const S={id_route:n.id_route,id_event:n.id_event,comments:h.value,img:_,img_id:v,lat:k.latitude,lon:k.longitude,...f==="0"&&{approve:"0"},...r&&{isLast:!0}},R=new FormData;for(const F in S)R.append(F,S[F]);const V=await(await fetch("https://dev.rutaflow.com/api/admin/evidence/send_evidence.php",{method:"POST",body:R})).json();L();const W={},U=S.id_route;r&&N("","",U,r)}else console.log("No entré")}catch(B){console.error("Error fetching data:",B)}},N=(B,S,R,G)=>{o.componentProps.routeId=R,o.componentProps.driverId=n.id_driver,ze("modal-km-gas",Jt,{checklist:B,driverId:S,routeId:R,isLast:G}).then(V=>{})},M=async()=>navigator.geolocation?new Promise((B,S)=>{navigator.geolocation.getCurrentPosition(R=>{k.latitude=R.coords.latitude,k.longitude=R.coords.longitude,B(!0)},R=>{console.error("Error getting location:",R),B(!1)})}):(console.error("Geolocation is not supported by your browser"),!1);async function T(B){B.stopPropagation();const S=new FormData;S.append("client_phone",d),S.append("client_name",n.title),S.append("delivery_phone",n.client_phone),S.append("enterprise_name",n.enterprise_name);try{const R=await fetch("https://dev.rutaflow.com/api/admin/message_central/send_sms.php",{method:"POST",body:S});if(R.ok){const G=await R.json();E()}else w()}catch(R){console.error("Error during file upload:",R)}}const O=async B=>{if(n.id_enterprise){const S=new FormData;S.append("id_enterprise",n.id_enterprise);try{const R=await fetch("https://dev.rutaflow.com/api/admin/enterprise/enterprise_settings.php",{method:"POST",body:S});R.ok?(I=(await R.json()).nodos,f=St("stops_wait_approval",I),t(2,a=St("sms_active",I))):console.error("File upload failed:",R.statusText)}catch(R){console.error("Error during file upload:",R)}}};function A(B){ye[B?"unshift":"push"](()=>{h=B,t(0,h)})}return[h,_,a,p,d,g,n,P,L,D,T,A]}class Vn extends xe{constructor(e){super(),Je(this,e,jn,Fn,Xe,{})}}function Pt(i){let e,t,o;return{c(){e=c("section"),t=c("ion-img"),this.h()},l(n){e=u(n,"SECTION",{});var r=b(e);t=u(r,"ION-IMG",{src:!0,alt:!0,style:!0}),b(t).forEach(s),r.forEach(s),this.h()},h(){ut(t.src,o=i[0])||m(t,"src",o),m(t,"alt","Evidencia fotográfica"),j(t,"max-width","100%"),j(t,"margin-top","16px")},m(n,r){q(n,e,r),l(e,t)},p(n,r){r&1&&!ut(t.src,o=n[0])&&m(t,"src",o)},d(n){n&&s(e)}}}function Gn(i){let e,t,o,n,r="Cancelar",h,_,v="Agregar Gasto",k,I,f,a,p,d,g,E,w,P,z,L,D,N,M,T,O,A,B='Tipo de pago <ion-text color="danger">(Obligatorio)</ion-text>',S,R,G="Efectivo",V,W,U="Tarjeta",F,J,Z="Transferencia",ie,re,me,Ae,ge,Le,ve,he,ue,Ie,Ue=`<ion-icon icon="${Kt}" slot="start"></ion-icon>
                        Subir Evidencia`,Te,Ce,He,Oe,Se,Me,H,Y="Confirmar",fe,ke,ee=i[0]&&Pt(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.textContent=r,h=C(),_=c("ion-title"),_.textContent=v,k=C(),I=c("ion-content"),f=c("ion-list"),a=c("ion-item"),p=c("ion-icon"),d=C(),g=c("ion-input"),E=C(),w=c("ion-item"),P=c("ion-icon"),z=C(),L=c("ion-input"),D=C(),N=c("ion-item"),M=c("ion-icon"),T=C(),O=c("ion-select"),A=c("div"),A.innerHTML=B,S=C(),R=c("ion-select-option"),R.textContent=G,V=C(),W=c("ion-select-option"),W.textContent=U,F=C(),J=c("ion-select-option"),J.textContent=Z,ie=C(),re=c("ion-item"),me=c("ion-icon"),Ae=C(),ge=c("ion-textarea"),Le=C(),ve=c("section"),he=c("label"),ue=c("ion-button"),Ie=c("label"),Ie.innerHTML=Ue,Te=C(),Ce=c("input"),He=C(),ee&&ee.c(),Oe=C(),Se=c("ion-footer"),Me=c("ion-toolbar"),H=c("ion-button"),H.textContent=Y,this.h()},l(x){e=u(x,"ION-HEADER",{translucent:!0});var Q=b(e);t=u(Q,"ION-TOOLBAR",{});var le=b(t);o=u(le,"ION-BUTTONS",{slot:!0});var be=b(o);n=u(be,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),X(n)!=="svelte-1f8rjcf"&&(n.textContent=r),be.forEach(s),h=y(le),_=u(le,"ION-TITLE",{title:!0,"data-svelte-h":!0}),X(_)!=="svelte-10xvxus"&&(_.textContent=v),le.forEach(s),Q.forEach(s),k=y(x),I=u(x,"ION-CONTENT",{fullscreen:!0});var oe=b(I);f=u(oe,"ION-LIST",{});var $=b(f);a=u($,"ION-ITEM",{});var de=b(a);p=u(de,"ION-ICON",{icon:!0,slot:!0}),b(p).forEach(s),d=y(de),g=u(de,"ION-INPUT",{label:!0,type:!0,placeholder:!0,value:!0}),b(g).forEach(s),de.forEach(s),E=y($),w=u($,"ION-ITEM",{});var pe=b(w);P=u(pe,"ION-ICON",{icon:!0,slot:!0}),b(P).forEach(s),z=y(pe),L=u(pe,"ION-INPUT",{label:!0,type:!0,value:!0}),b(L).forEach(s),pe.forEach(s),D=y($),N=u($,"ION-ITEM",{});var te=b(N);M=u(te,"ION-ICON",{icon:!0,slot:!0}),b(M).forEach(s),T=y(te),O=u(te,"ION-SELECT",{placeholder:!0,value:!0});var _e=b(O);A=u(_e,"DIV",{slot:!0,"data-svelte-h":!0}),X(A)!=="svelte-wl764p"&&(A.innerHTML=B),S=y(_e),R=u(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),X(R)!=="svelte-i9crym"&&(R.textContent=G),V=y(_e),W=u(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),X(W)!=="svelte-fx0z11"&&(W.textContent=U),F=y(_e),J=u(_e,"ION-SELECT-OPTION",{value:!0,"data-svelte-h":!0}),X(J)!=="svelte-1c24jf2"&&(J.textContent=Z),_e.forEach(s),te.forEach(s),ie=y($),re=u($,"ION-ITEM",{});var De=b(re);me=u(De,"ION-ICON",{icon:!0,slot:!0}),b(me).forEach(s),Ae=y(De),ge=u(De,"ION-TEXTAREA",{label:!0,placeholder:!0}),b(ge).forEach(s),De.forEach(s),Le=y($),ve=u($,"SECTION",{});var Ze=b(ve);he=u(Ze,"LABEL",{for:!0,style:!0});var Qe=b(he);ue=u(Qe,"ION-BUTTON",{fill:!0,size:!0,class:!0,expand:!0});var qe=b(ue);Ie=u(qe,"LABEL",{for:!0,style:!0,"data-svelte-h":!0}),X(Ie)!=="svelte-1m9yw22"&&(Ie.innerHTML=Ue),Te=y(qe),Ce=u(qe,"INPUT",{style:!0,id:!0,name:!0,type:!0,accept:!0}),qe.forEach(s),Qe.forEach(s),Ze.forEach(s),He=y($),ee&&ee.l($),$.forEach(s),oe.forEach(s),Oe=y(x),Se=u(x,"ION-FOOTER",{});var $e=b(Se);Me=u($e,"ION-TOOLBAR",{});var ae=b(Me);H=u(ae,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),X(H)!=="svelte-1c7dl3f"&&(H.textContent=Y),ae.forEach(s),$e.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","start"),m(_,"title",""),m(e,"translucent",""),m(p,"icon",Xt),m(p,"slot","start"),m(g,"label","Concepto"),m(g,"type","text"),m(g,"placeholder","Escribe aquí..."),m(g,"value",i[5]?i[5]:""),m(P,"icon",dt),m(P,"slot","start"),m(L,"label","Cantidad"),m(L,"type","number"),m(L,"value",i[6]?i[6]:""),m(M,"icon",_n),m(M,"slot","start"),K(A,"slot","label"),m(R,"value","cash"),m(W,"value","card"),m(J,"value","transfer"),m(O,"placeholder","Tipo de pago"),m(O,"value",i[7]?i[7]:""),m(me,"icon",dt),m(me,"slot","start"),m(ge,"label","Comentarios"),m(ge,"placeholder","Escribe aquí..."),K(Ie,"for","eventEvidence"),j(Ie,"width","100%"),j(Ie,"padding","8px"),j(Ce,"display","none"),K(Ce,"id","eventEvidence"),K(Ce,"name","fileToUpload"),K(Ce,"type","file"),K(Ce,"accept","image/*"),m(ue,"fill","outline"),m(ue,"size","small"),m(ue,"class","loadEvidence"),m(ue,"expand","block"),K(he,"for","eventEvidence"),j(he,"display","block"),j(he,"width","100%"),m(I,"fullscreen",""),m(H,"fill","outline"),m(H,"color","tertiary"),m(H,"strong",""),j(H,"width","99%"),j(H,"height","auto")},m(x,Q){q(x,e,Q),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(x,k,Q),q(x,I,Q),l(I,f),l(f,a),l(a,p),l(a,d),l(a,g),i[11](g),l(f,E),l(f,w),l(w,P),l(w,z),l(w,L),i[12](L),l(f,D),l(f,N),l(N,M),l(N,T),l(N,O),l(O,A),l(O,S),l(O,R),l(O,V),l(O,W),l(O,F),l(O,J),i[13](O),l(f,ie),l(f,re),l(re,me),l(re,Ae),l(re,ge),i[14](ge),l(f,Le),l(f,ve),l(ve,he),l(he,ue),l(ue,Ie),l(ue,Te),l(ue,Ce),l(f,He),ee&&ee.m(f,null),q(x,Oe,Q),q(x,Se,Q),l(Se,Me),l(Me,H),fe||(ke=[ne(n,"click",i[9]),ne(Ce,"change",i[8]),ne(H,"click",i[10])],fe=!0)},p(x,[Q]){x[0]?ee?ee.p(x,Q):(ee=Pt(x),ee.c(),ee.m(f,null)):ee&&(ee.d(1),ee=null)},i:Ee,o:Ee,d(x){x&&(s(e),s(k),s(I),s(Oe),s(Se)),i[11](null),i[12](null),i[13](null),i[14](null),ee&&ee.d(),fe=!1,Re(ke)}}}function Kn(i,e,t){let o=document.querySelector("ion-modal"),n=o.componentProps.routeId,r=o.componentProps.ex_concept,h=o.componentProps.ex_amount,_=o.componentProps.ex_type,v=o.componentProps.id_expense,k="",I="",f="",a=0,p="",d="";tt(()=>{});const g=async(T,O)=>{await(await je.create({header:T||"Error",message:O||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()},E=async T=>{const A=T.target.files[0],B=await w(A);if(B){const S=new FormData;S.append("fileToUpload",B);try{const R=await fetch("https://dev.rutaflow.com/api/admin/manager/upload_img_driver.php",{method:"POST",body:S});if(R.ok){const G=await R.json();t(0,k=G.img),I=G.img_id}else console.error("File upload failed:",R.statusText)}catch(R){console.error("Error during file upload:",R)}}},w=async T=>new Promise(O=>{const A=new FileReader;A.onload=B=>{const S=new Image;S.src=B.target.result,S.onload=()=>{const R=document.createElement("canvas"),G=R.getContext("2d"),V=800,W=600;let U=S.width,F=S.height;U>V&&(F*=V/U,U=V),F>W&&(U*=W/F,F=W),R.width=U,R.height=F,G.drawImage(S,0,0,U,F),R.toBlob(J=>{O(J)},"image/jpeg",.7)}},A.readAsDataURL(T)}),P=()=>{lt.dismiss()},z=()=>{var T=new Object;T.id_route=n,T.comments=p.value,T.type=f.value,T.img=k,T.img_id=I,T.amount=a.value,T.concept=d.value,T.status="done",T.id_expense=v||"null";const O=new FormData;for(const A in T)O.append(A,T[A]);!I||!k||!p.value||!a.value||!d.value?g("Datos incompletos","Llena los datos requeridos para completar el registro"):fetch("https://dev.rutaflow.com/api/admin/expenses/add_expense.php",{method:"POST",body:O}).then(A=>A.json()).then(A=>{P()}).catch(A=>{console.error("Error fetching data:",A)})};function L(T){ye[T?"unshift":"push"](()=>{d=T,t(4,d)})}function D(T){ye[T?"unshift":"push"](()=>{a=T,t(2,a)})}function N(T){ye[T?"unshift":"push"](()=>{f=T,t(1,f)})}function M(T){ye[T?"unshift":"push"](()=>{p=T,t(3,p)})}return[k,f,a,p,d,r,h,_,E,P,z,L,D,N,M]}class pt extends xe{constructor(e){super(),Je(this,e,Kn,Gn,Xe,{})}}function At(i,e,t){const o=i.slice();return o[7]=e[t],o}function Wn(i){let e,t="Cargar gasto",o,n;function r(...h){return i[4](i[7],...h)}return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(h){e=u(h,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),X(e)!=="svelte-175aelj"&&(e.textContent=t),this.h()},h(){m(e,"fill","outline"),m(e,"size","small"),m(e,"aria-selected","")},m(h,_){q(h,e,_),o||(n=ne(e,"click",r),o=!0)},p(h,_){i=h},d(h){h&&s(e),o=!1,n()}}}function Xn(i){let e,t="Gasto completado";return{c(){e=c("ion-button"),e.textContent=t,this.h()},l(o){e=u(o,"ION-BUTTON",{fill:!0,size:!0,"aria-selected":!0,"data-svelte-h":!0}),X(e)!=="svelte-tlger7"&&(e.textContent=t),this.h()},h(){m(e,"fill","solid"),m(e,"size","small"),m(e,"aria-selected","")},m(o,n){q(o,e,n)},p:Ee,d(o){o&&s(e)}}}function Mt(i,e){let t,o,n,r=e[7].concept+"",h,_,v;function k(a,p){return a[7].status=="done"?Xn:Wn}let f=k(e)(e);return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-label"),n=c("p"),h=se(r),_=C(),f.c(),v=C(),this.h()},l(a){t=u(a,"ION-ITEM",{});var p=b(t);o=u(p,"ION-LABEL",{style:!0});var d=b(o);n=u(d,"P",{style:!0});var g=b(n);h=ce(g,r),g.forEach(s),d.forEach(s),_=y(p),f.l(p),v=y(p),p.forEach(s),this.h()},h(){j(n,"margin-left","10px"),j(o,"display","flex"),this.first=t},m(a,p){q(a,t,p),l(t,o),l(o,n),l(n,h),l(t,_),f.m(t,null),l(t,v)},p(a,p){e=a,f.p(e,p)},d(a){a&&s(t),f.d()}}}function xn(i){let e,t,o,n,r=`<ion-icon style="font-size: 25px!important;" icon="${dn}"></ion-icon>`,h,_,v="Lista de gastos",k,I,f,a=[],p=new Map,d,g,E,w="Cerrar",P,z,L=Be(i[0]);const D=N=>N[7].id_expenses;for(let N=0;N<L.length;N+=1){let M=At(i,L,N),T=D(M);p.set(T,a[N]=Mt(T,M))}return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=C(),_=c("ion-title"),_.textContent=v,k=C(),I=c("ion-content"),f=c("ion-list");for(let N=0;N<a.length;N+=1)a[N].c();d=C(),g=c("ion-footer"),E=c("ion-button"),E.textContent=w,this.h()},l(N){e=u(N,"ION-HEADER",{translucent:!0});var M=b(e);t=u(M,"ION-TOOLBAR",{});var T=b(t);o=u(T,"ION-BUTTONS",{slot:!0});var O=b(o);n=u(O,"ION-BUTTON",{color:!0,"data-svelte-h":!0}),X(n)!=="svelte-160xz3i"&&(n.innerHTML=r),O.forEach(s),h=y(T),_=u(T,"ION-TITLE",{"data-svelte-h":!0}),X(_)!=="svelte-e3wnox"&&(_.textContent=v),T.forEach(s),M.forEach(s),k=y(N),I=u(N,"ION-CONTENT",{fullscreen:!0});var A=b(I);f=u(A,"ION-LIST",{});var B=b(f);for(let R=0;R<a.length;R+=1)a[R].l(B);B.forEach(s),A.forEach(s),d=y(N),g=u(N,"ION-FOOTER",{});var S=b(g);E=u(S,"ION-BUTTON",{fill:!0,color:!0,strong:!0,style:!0,"data-svelte-h":!0}),X(E)!=="svelte-zv7v83"&&(E.textContent=w),S.forEach(s),this.h()},h(){m(n,"color","medium"),m(o,"slot","end"),m(e,"translucent",""),m(I,"fullscreen",""),m(E,"fill","outline"),m(E,"color","tertiary"),m(E,"strong",""),j(E,"width","99%"),j(E,"height","auto")},m(N,M){q(N,e,M),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),q(N,k,M),q(N,I,M),l(I,f);for(let T=0;T<a.length;T+=1)a[T]&&a[T].m(f,null);q(N,d,M),q(N,g,M),l(g,E),P||(z=[ne(n,"click",i[3]),ne(E,"click",i[1])],P=!0)},p(N,[M]){M&5&&(L=Be(N[0]),a=nt(a,M,D,1,N,L,p,f,ot,Mt,null,At))},i:Ee,o:Ee,d(N){N&&(s(e),s(k),s(I),s(d),s(g));for(let M=0;M<a.length;M+=1)a[M].d();P=!1,Re(z)}}}function Jn(i){let e=document.querySelector("ion-modal");e.componentProps.routeId;let t=e.componentProps.expenses;tt(()=>{});const o=()=>{lt.dismiss()};function n(_,v,k,I,f){e.componentProps.ex_amount=k,e.componentProps.ex_concept=v,e.componentProps.ex_type=I,e.componentProps.id_expense=f,ze("modal-expense",pt,{amount:k,concept:v,type:I,id_expense:f}).then(()=>{}),o()}return[t,o,n,_=>{ze("modal-expense",pt,{routeId:_}).then(v=>{}),o()},(_,v)=>n(v,_.concept,_.amount,_.type,_.id_expenses)]}class Yn extends xe{constructor(e){super(),Je(this,e,Jn,xn,Xe,{})}}function Dt(i,e,t){const o=i.slice();return o[30]=e[t],o}function Bt(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Ht(i,e,t){const o=i.slice();return o[30]=e[t],o[32]=t,o}function Rt(i){let e,t;return e=new vn({props:{$$slots:{default:[to]},$$scope:{ctx:i}}}),{c(){tn(e.$$.fragment)},l(o){nn(e.$$.fragment,o)},m(o,n){on(e,o,n),t=!0},p(o,n){const r={};n[0]&507|n[1]&32&&(r.$$scope={dirty:n,ctx:o}),e.$set(r)},i(o){t||(ct(e.$$.fragment,o),t=!0)},o(o){_t(e.$$.fragment,o),t=!1},d(o){ln(e,o)}}}function Zn(i){let e,t,o,n='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jala para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',r,h,_=[],v=new Map,k,I,f=i[4]&&Ut(i),a=Be(i[5]);const p=d=>d[30].id_event;for(let d=0;d<a.length;d+=1){let g=Dt(i,a,d),E=p(g);v.set(E,_[d]=qt(E,g))}return{c(){f&&f.c(),e=C(),t=c("ion-content"),o=c("ion-refresher"),o.innerHTML=n,r=C(),h=c("ion-list");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){f&&f.l(d),e=y(d),t=u(d,"ION-CONTENT",{});var g=b(t);o=u(g,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),X(o)!=="svelte-19e7x43"&&(o.innerHTML=n),r=y(g),h=u(g,"ION-LIST",{});var E=b(h);for(let w=0;w<_.length;w+=1)_[w].l(E);E.forEach(s),g.forEach(s),this.h()},h(){m(o,"slot","fixed")},m(d,g){f&&f.m(d,g),q(d,e,g),q(d,t,g),l(t,o),i[23](o),l(t,r),l(t,h);for(let E=0;E<_.length;E+=1)_[E]&&_[E].m(h,null);k||(I=ne(o,"ionRefresh",i[9]),k=!0)},p(d,g){d[4]?f?f.p(d,g):(f=Ut(d),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),g[0]&42016&&(a=Be(d[5]),_=nt(_,g,p,1,d,a,v,h,ot,qt,null,Dt))},d(d){d&&(s(e),s(t)),f&&f.d(d),i[23](null);for(let g=0;g<_.length;g+=1)_[g].d();k=!1,I()}}}function Qn(i){let e,t;function o(h,_){return _[0]&128&&(e=null),e==null&&(e=!!h[7].every(lo)),e?eo:$n}let n=o(i,[-1,-1]),r=n(i);return{c(){r.c(),t=Pe()},l(h){r.l(h),t=Pe()},m(h,_){r.m(h,_),q(h,t,_)},p(h,_){n===(n=o(h,_))&&r?r.p(h,_):(r.d(1),r=n(h),r&&(r.c(),r.m(t.parentNode,t)))},d(h){h&&s(t),r.d(h)}}}function Ut(i){let e=i[11]("",i[1],i[0])+"",t;return{c(){t=se(e)},l(o){t=ce(o,e)},m(o,n){q(o,t,n)},p(o,n){n[0]&3&&e!==(e=o[11]("",o[1],o[0])+"")&&Ne(t,e)},d(o){o&&s(t)}}}function zt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),b(e).forEach(s),this.h()},h(){K(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function qt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,k,I,f,a,p=e[30].title+"",d,g,E=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,z,L,D,N=E&&zt();function M(){return e[24](e[30])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=se(h),k=C(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=se(p),g=C(),N&&N.c(),w=C(),P=c("ion-icon"),z=C(),this.h()},l(T){t=u(T,"ION-ITEM",{});var O=b(t);o=u(O,"ION-AVATAR",{slot:!0});var A=b(o);n=u(A,"DIV",{class:!0,title:!0,style:!0});var B=b(n);r=u(B,"DIV",{class:!0});var S=b(r);_=ce(S,h),S.forEach(s),B.forEach(s),A.forEach(s),k=y(O),I=u(O,"ION-LABEL",{button:!0});var R=b(I);f=u(R,"ION-TEXT",{color:!0});var G=b(f);a=u(G,"H3",{});var V=b(a);d=ce(V,p),g=y(V),N&&N.l(V),V.forEach(s),G.forEach(s),R.forEach(s),w=y(O),P=u(O,"ION-ICON",{icon:!0,slot:!0,style:!0}),b(P).forEach(s),z=y(O),O.forEach(s),this.h()},h(){K(r,"class","order svelte-ziybgw"),K(n,"class","order-wrapper svelte-ziybgw"),K(n,"title",v=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),m(I,"button",""),m(P,"icon",Ye),m(P,"slot","end"),j(P,"color",we(e[30])),this.first=t},m(T,O){q(T,t,O),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),N&&N.m(a,null),l(t,w),l(t,P),l(t,z),L||(D=ne(I,"click",M),L=!0)},p(T,O){e=T,O[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Ne(_,h),O[0]&32&&v!==(v=Ke(e[30].status))&&K(n,"title",v),O[0]&32&&j(n,"background-color",we(e[30])),O[0]&32&&j(n,"color",We(we(e[30]))),O[0]&32&&p!==(p=e[30].title+"")&&Ne(d,p),O[0]&32&&(E=e[30].support_list&&e[30].support_list.length||e[13](e[30])),E?N||(N=zt(),N.c(),N.m(a,null)):N&&(N.d(1),N=null),O[0]&32&&j(P,"color",we(e[30]))},d(T){T&&s(t),N&&N.d(),L=!1,D()}}}function $n(i){let e=i[11](i[7],i[1],i[0])+"",t,o,n,r,h='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Pull to refresh" refreshing-spinner="circles" refreshing-text="Refreshing..."></ion-refresher-content>',_,v,k=[],I=new Map,f,a,p=Be(i[5]);const d=g=>g[30].id_event;for(let g=0;g<p.length;g+=1){let E=Bt(i,p,g),w=d(E);I.set(w,k[g]=jt(w,E))}return{c(){t=se(e),o=C(),n=c("ion-content"),r=c("ion-refresher"),r.innerHTML=h,_=C(),v=c("ion-list");for(let g=0;g<k.length;g+=1)k[g].c();this.h()},l(g){t=ce(g,e),o=y(g),n=u(g,"ION-CONTENT",{});var E=b(n);r=u(E,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),X(r)!=="svelte-1poui8g"&&(r.innerHTML=h),_=y(E),v=u(E,"ION-LIST",{});var w=b(v);for(let P=0;P<k.length;P+=1)k[P].l(w);w.forEach(s),E.forEach(s),this.h()},h(){m(r,"slot","fixed")},m(g,E){q(g,t,E),q(g,o,E),q(g,n,E),l(n,r),i[21](r),l(n,_),l(n,v);for(let w=0;w<k.length;w+=1)k[w]&&k[w].m(v,null);f||(a=ne(r,"ionRefresh",i[9]),f=!0)},p(g,E){E[0]&131&&e!==(e=g[11](g[7],g[1],g[0])+"")&&Ne(t,e),E[0]&74784&&(p=Be(g[5]),k=nt(k,E,d,1,g,p,I,v,ot,jt,null,Bt))},d(g){g&&(s(t),s(o),s(n)),i[21](null);for(let E=0;E<k.length;E+=1)k[E].d();f=!1,a()}}}function eo(i){let e,t,o='<ion-refresher-content pulling-icon="arrow-dropdown" pulling-text="Jale para actualizar" refreshing-spinner="circles" refreshing-text="Actualizando..."></ion-refresher-content>',n,r,h=[],_=new Map,v,k,I=Be(i[5]);const f=a=>a[30].id_event;for(let a=0;a<I.length;a+=1){let p=Ht(i,I,a),d=f(p);_.set(d,h[a]=Gt(d,p))}return{c(){e=c("ion-content"),t=c("ion-refresher"),t.innerHTML=o,n=C(),r=c("ion-list");for(let a=0;a<h.length;a+=1)h[a].c();this.h()},l(a){e=u(a,"ION-CONTENT",{});var p=b(e);t=u(p,"ION-REFRESHER",{slot:!0,"data-svelte-h":!0}),X(t)!=="svelte-1t1tzpj"&&(t.innerHTML=o),n=y(p),r=u(p,"ION-LIST",{});var d=b(r);for(let g=0;g<h.length;g+=1)h[g].l(d);d.forEach(s),p.forEach(s),this.h()},h(){m(t,"slot","fixed")},m(a,p){q(a,e,p),l(e,t),i[19](t),l(e,n),l(e,r);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(r,null);v||(k=ne(t,"ionRefresh",i[9]),v=!0)},p(a,p){p[0]&74784&&(I=Be(a[5]),h=nt(h,p,f,1,a,I,_,r,ot,Gt,null,Ht))},d(a){a&&s(e),i[19](null);for(let p=0;p<h.length;p+=1)h[p].d();v=!1,k()}}}function Ft(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),b(e).forEach(s),this.h()},h(){K(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function jt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,k,I,f,a,p=e[30].title+"",d,g,E=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,z="",L,D,N,M,T,O=E&&Ft();function A(){return e[22](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=se(h),k=C(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=se(p),g=C(),O&&O.c(),w=C(),P=c("div"),P.innerHTML=z,L=C(),D=c("ion-icon"),N=C(),this.h()},l(B){t=u(B,"ION-ITEM",{});var S=b(t);o=u(S,"ION-AVATAR",{slot:!0});var R=b(o);n=u(R,"DIV",{class:!0,title:!0,style:!0});var G=b(n);r=u(G,"DIV",{class:!0});var V=b(r);_=ce(V,h),V.forEach(s),G.forEach(s),R.forEach(s),k=y(S),I=u(S,"ION-LABEL",{button:!0});var W=b(I);f=u(W,"ION-TEXT",{color:!0});var U=b(f);a=u(U,"H3",{});var F=b(a);d=ce(F,p),g=y(F),O&&O.l(F),F.forEach(s),U.forEach(s),w=y(W),P=u(W,"DIV",{class:!0,"data-svelte-h":!0}),X(P)!=="svelte-130ohbs"&&(P.innerHTML=z),W.forEach(s),L=y(S),D=u(S,"ION-ICON",{icon:!0,slot:!0}),b(D).forEach(s),N=y(S),S.forEach(s),this.h()},h(){K(r,"class","order svelte-ziybgw"),K(n,"class","order-wrapper svelte-ziybgw"),K(n,"title",v=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),K(P,"class","sub svelte-ziybgw"),m(I,"button",""),m(D,"icon",Ye),m(D,"slot","end"),this.first=t},m(B,S){q(B,t,S),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,w),l(I,P),l(t,L),l(t,D),l(t,N),M||(T=ne(I,"click",A),M=!0)},p(B,S){e=B,S[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Ne(_,h),S[0]&32&&v!==(v=Ke(e[30].status))&&K(n,"title",v),S[0]&32&&j(n,"background-color",we(e[30])),S[0]&32&&j(n,"color",We(we(e[30]))),S[0]&32&&p!==(p=e[30].title+"")&&Ne(d,p),S[0]&32&&(E=e[30].support_list&&e[30].support_list.length||e[13](e[30])),E?O||(O=Ft(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(B){B&&s(t),O&&O.d(),M=!1,T()}}}function Vt(i){let e;return{c(){e=c("span"),this.h()},l(t){e=u(t,"SPAN",{class:!0}),b(e).forEach(s),this.h()},h(){K(e,"class","notes svelte-ziybgw")},m(t,o){q(t,e,o)},d(t){t&&s(e)}}}function Gt(i,e){let t,o,n,r,h=parseInt(e[30].pos)+1+"",_,v,k,I,f,a,p=e[30].title+"",d,g,E=e[30].support_list&&e[30].support_list.length||e[13](e[30]),w,P,z="",L,D,N,M,T,O=E&&Vt();function A(){return e[20](e[30],e[32])}return{key:i,first:null,c(){t=c("ion-item"),o=c("ion-avatar"),n=c("div"),r=c("div"),_=se(h),k=C(),I=c("ion-label"),f=c("ion-text"),a=c("h3"),d=se(p),g=C(),O&&O.c(),w=C(),P=c("div"),P.innerHTML=z,L=C(),D=c("ion-icon"),N=C(),this.h()},l(B){t=u(B,"ION-ITEM",{});var S=b(t);o=u(S,"ION-AVATAR",{slot:!0});var R=b(o);n=u(R,"DIV",{class:!0,title:!0,style:!0});var G=b(n);r=u(G,"DIV",{class:!0});var V=b(r);_=ce(V,h),V.forEach(s),G.forEach(s),R.forEach(s),k=y(S),I=u(S,"ION-LABEL",{button:!0});var W=b(I);f=u(W,"ION-TEXT",{color:!0});var U=b(f);a=u(U,"H3",{});var F=b(a);d=ce(F,p),g=y(F),O&&O.l(F),F.forEach(s),U.forEach(s),w=y(W),P=u(W,"DIV",{class:!0,"data-svelte-h":!0}),X(P)!=="svelte-130ohbs"&&(P.innerHTML=z),W.forEach(s),L=y(S),D=u(S,"ION-ICON",{icon:!0,slot:!0}),b(D).forEach(s),N=y(S),S.forEach(s),this.h()},h(){K(r,"class","order svelte-ziybgw"),K(n,"class","order-wrapper svelte-ziybgw"),K(n,"title",v=Ke(e[30].status)),j(n,"background-color",we(e[30])),j(n,"color",We(we(e[30]))),m(o,"slot","start"),m(f,"color","#2e2e2e"),K(P,"class","sub svelte-ziybgw"),m(I,"button",""),m(D,"icon",Ye),m(D,"slot","end"),this.first=t},m(B,S){q(B,t,S),l(t,o),l(o,n),l(n,r),l(r,_),l(t,k),l(t,I),l(I,f),l(f,a),l(a,d),l(a,g),O&&O.m(a,null),l(I,w),l(I,P),l(t,L),l(t,D),l(t,N),M||(T=ne(I,"click",A),M=!0)},p(B,S){e=B,S[0]&32&&h!==(h=parseInt(e[30].pos)+1+"")&&Ne(_,h),S[0]&32&&v!==(v=Ke(e[30].status))&&K(n,"title",v),S[0]&32&&j(n,"background-color",we(e[30])),S[0]&32&&j(n,"color",We(we(e[30]))),S[0]&32&&p!==(p=e[30].title+"")&&Ne(d,p),S[0]&32&&(E=e[30].support_list&&e[30].support_list.length||e[13](e[30])),E?O||(O=Vt(),O.c(),O.m(a,null)):O&&(O.d(1),O=null)},d(B){B&&s(t),O&&O.d(),M=!1,T()}}}function to(i){let e,t,o,n,r=`<ion-icon icon="${hn}"></ion-icon>`,h,_,v,k=`<ion-icon icon="${pn}"></ion-icon>`,I,f,a=i[6].name+"",p,d,g,E,w;function P(D,N){if(D[7].length>0)return Qn;if(!D[3])return Zn}let z=P(i),L=z&&z(i);return{c(){e=c("ion-header"),t=c("ion-toolbar"),o=c("ion-buttons"),n=c("ion-button"),n.innerHTML=r,h=C(),_=c("ion-buttons"),v=c("ion-button"),v.innerHTML=k,I=C(),f=c("ion-title"),p=se(a),d=C(),L&&L.c(),g=Pe(),this.h()},l(D){e=u(D,"ION-HEADER",{translucent:!0});var N=b(e);t=u(N,"ION-TOOLBAR",{});var M=b(t);o=u(M,"ION-BUTTONS",{slot:!0});var T=b(o);n=u(T,"ION-BUTTON",{title:!0,alt:!0,"data-svelte-h":!0}),X(n)!=="svelte-7ppz3r"&&(n.innerHTML=r),T.forEach(s),h=y(M),_=u(M,"ION-BUTTONS",{slot:!0});var O=b(_);v=u(O,"ION-BUTTON",{"data-svelte-h":!0}),X(v)!=="svelte-nf50hj"&&(v.innerHTML=k),O.forEach(s),I=y(M),f=u(M,"ION-TITLE",{});var A=b(f);p=ce(A,a),A.forEach(s),M.forEach(s),N.forEach(s),d=y(D),L&&L.l(D),g=Pe(),this.h()},h(){m(n,"title","Atrás"),m(n,"alt","Atrás"),m(o,"slot","start"),m(_,"slot","end"),m(e,"translucent","")},m(D,N){q(D,e,N),l(e,t),l(t,o),l(o,n),l(t,h),l(t,_),l(_,v),l(t,I),l(t,f),l(f,p),q(D,d,N),L&&L.m(D,N),q(D,g,N),E||(w=[ne(n,"click",i[14]),ne(v,"click",i[18])],E=!0)},p(D,N){N[0]&64&&a!==(a=D[6].name+"")&&Ne(p,a),z===(z=P(D))&&L?L.p(D,N):(L&&L.d(1),L=z&&z(D),L&&(L.c(),L.m(g.parentNode,g)))},d(D){D&&(s(e),s(d),s(g)),L&&L.d(D),E=!1,Re(w)}}}function no(i){let e,t,o,n=i[2]&&Rt(i);return{c(){e=C(),n&&n.c(),t=Pe(),this.h()},l(r){Qt("svelte-kn0kph",document.head).forEach(s),e=y(r),n&&n.l(r),t=Pe(),this.h()},h(){document.title="Rutaflow - Detalles de ruta"},m(r,h){q(r,e,h),n&&n.m(r,h),q(r,t,h),o=!0},p(r,h){r[2]?n?(n.p(r,h),h[0]&4&&ct(n,1)):(n=Rt(r),n.c(),ct(n,1),n.m(t.parentNode,t)):n&&(rn(),_t(n,1,1,()=>{n=null}),en())},i(r){o||(ct(n),o=!0)},o(r){_t(n),o=!1},d(r){r&&(s(e),s(t)),n&&n.d(r)}}}function we(i){let e="#ffffff";return i.status==="pending"?e="#f2e300":i.status==="completed"&&(e="#44d900"),e}function Ke(i){let e="";return i=="pending"?e="Pendiente":i=="completed"&&(e="Completado"),e}function We(i){i.slice(0,1)==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(function(r){return r+r}).join(""));const e=parseInt(i.substr(0,2),16),t=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16);return(e*299+t*587+o*114)/1e3>=128?"#414040":"#fff"}function oo(i,e){let t=new FormData;return t.append("id_route",i),t.append("status",e),fetch("https://dev.rutaflow.com/api/admin/route/change_status.php",{method:"POST",body:t}).then(o=>o.json()).then(o=>{}).catch(o=>{console.error("Error fetching data:",o)}),""}const lo=i=>i.img;function io(i,e,t){let o;$t(i,mn,U=>t(17,o=U));var n=this&&this.__awaiter||function(U,F,J,Z){function ie(re){return re instanceof J?re:new J(function(me){me(re)})}return new(J||(J=Promise))(function(re,me){function Ae(ve){try{Le(Z.next(ve))}catch(he){me(he)}}function ge(ve){try{Le(Z.throw(ve))}catch(he){me(he)}}function Le(ve){ve.done?re(ve.value):ie(ve.value).then(Ae,ge)}Le((Z=Z.apply(U,F||[])).next())})};let{routeId:r}=e,{driverId:h}=e,_=new Object,v=!0,k=!1,I=[],f={},a=[],p=[],d,g=!1;const E=()=>n(void 0,void 0,void 0,function*(){yield w(r),d.complete()});tt(()=>{E()});function w(U){return n(this,void 0,void 0,function*(){const F=new FormData;F.append("id_route",U);try{const Z=yield(yield fetch("https://dev.rutaflow.com/api/admin/report/seguimiento_list.php",{method:"POST",body:F})).json();t(6,f=Z.data.seguimiento_list[0]),t(5,I=Z.data.event_list),t(7,a=Z.data.checklist),p=Z.data.expenses,f&&t(4,k=f.km_inicial=="0"&&f.gas_inicial=="0"),t(3,v=!1)}catch(J){t(3,v=!1),console.error("Error fetching data:",J)}})}const P=U=>new Promise((F,J)=>{const Z=new FormData;Z.append("id_route",U.id_route),Z.append("id_event",U.id_event),fetch("https://dev.rutaflow.com/api/admin/evidence/evidence_by_event.php",{method:"POST",body:Z}).then(ie=>ie.json()).then(ie=>{F(ie.data.event_evidence[0])}).catch(ie=>{console.error("Error fetching data:",ie),J(ie)})}),z=(U,F)=>{P(U).then(J=>{J&&(U.img=J.img,U.driver_comments=J.driver_comments,U.comments=J.comments),ze("modal-delivery-info",Vn,{delivery:U,isLast:F}).then(Z=>{})})},L=(U,F,J)=>{var Z=!1;return g||(g=!0,ze("modal-checklist",Jt,{checklist:U,driverId:F,routeId:J,isLast:Z}).then(ie=>{g=!1}),oo(J,"checklist")),""},D=U=>n(void 0,void 0,void 0,function*(){return yield w(U),p.length>0?ze("modal-expense-detail",Yn,{routeId:U,expenses:p}).then(F=>{}):ze("modal-expense",pt,{routeId:U}).then(F=>{}),""}),N=U=>{if(U.tracking_type=="subscription"){if(U.subscriber_info&&U.payment_type==="cash"&&new Date(U.subscriber_info.payment_next)<new Date)return!0}else if(U.tracking_type=="ecommerce"&&Number(U.payment_pending)>0)return!0;return!1},M=()=>{_.id_driver?Fe(`/drivers/${_.id_driver}`):Fe("/drivers/me")},T=(U,F)=>n(void 0,void 0,void 0,function*(){yield(yield je.create({header:U||"Error",message:F||"Vuelva a intentar",buttons:[{text:"Cerrar"}]})).present()});function O(U){return U===I.length-1}const A=()=>D(r);function B(U){ye[U?"unshift":"push"](()=>{d=U,t(8,d)})}const S=(U,F)=>z(U,O(F));function R(U){ye[U?"unshift":"push"](()=>{d=U,t(8,d)})}const G=(U,F)=>z(U,O(F));function V(U){ye[U?"unshift":"push"](()=>{d=U,t(8,d)})}const W=U=>{const F=I.findIndex(me=>me.id_event===U.id_event),J=F===0,Z=F>0?I[F-1]:null,ie=J||Z&&Z.img!==null,re=U.img!==null&&U.img!=="";ie||J&&!re?z(U):T("Información incompleta","No puedes visualizar otras paradas hasta cargar evidencia del destino pasado")};return i.$$set=U=>{"routeId"in U&&t(0,r=U.routeId),"driverId"in U&&t(1,h=U.driverId)},i.$$.update=()=>{i.$$.dirty[0]&131077&&(t(0,{routeId:r,driverId:h}=o.params,r,(t(1,h),t(17,o),t(2,_),t(0,r))),t(2,_=JSON.parse(localStorage.getItem("userSession"))),_?_.id_user&&(_.type=="admin"||_.type=="superadmin")?(w(r),Fe(`/drivers/me/routes/${r}`)):_.id_user&&_.id_driver&&(w(r),Fe(`/drivers/${_.id_driver}/routes/${r}`)):Fe("/"))},[r,h,_,v,k,I,f,a,d,E,z,L,D,N,M,T,O,o,A,B,S,R,G,V,W]}class ho extends xe{constructor(e){super(),Je(this,e,io,no,Xe,{routeId:0,driverId:1},null,[-1,-1])}}export{ho as component};
